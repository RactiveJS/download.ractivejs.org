{"version":3,"file":"ractive-legacy.min.js","sources":["ractive-legacy.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tThu Oct 08 2015 21:42:26 GMT+0000 (UTC) - commit 4245ee163f683e320708d09781c31dcc2410d358\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\n  var namespaces = {\n    get html () { return _html; },\n    get mathml () { return mathml; },\n    get svg () { return svg; },\n    get xlink () { return xlink; },\n    get xml () { return xml; },\n    get xmlns () { return xmlns; }\n  };\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magic = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagic = true;\n  } catch (e) {\n  \tmagic = false;\n  }\n\n  var _svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var _defaults = {\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: null,\n\n  \t// parse:     // TODO static delimiters?\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tinterpolate: false,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\tclassCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var __toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn __toString.call(thing) === '[object Array]';\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && __toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  function __bind(x) {\n    x.bind();\n  }\n\n  function _cancel(x) {\n    x.cancel();\n  }\n\n  function _handleChange(x) {\n    x.handleChange();\n  }\n\n  function _mark(x) {\n    x.mark();\n  }\n\n  function __render(x) {\n    x.render();\n  }\n\n  function _rebind(x) {\n    x.rebind();\n  }\n\n  function _teardown(x) {\n    x.teardown();\n  }\n\n  function _unbind(x) {\n    x.unbind();\n  }\n\n  function _unrender(x) {\n    x.unrender();\n  }\n\n  function _unrenderAndDestroy(x) {\n    x.unrender(true);\n  }\n\n  function __update(x) {\n    x.update();\n  }\n\n  function _toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\tclassCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.decoratorQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \t// TODO can we move decorator stuff to element detach() methods?\n\n  \tTransitionManager.prototype.addDecorator = function addDecorator(decorator) {\n  \t\tthis.decoratorQueue.push(decorator);\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = function detachNodes() {\n  \t\tthis.decoratorQueue.forEach(_teardown);\n  \t\tthis.detachQueue.forEach(_detach);\n  \t\tthis.children.forEach(_detachNodes);\n  \t};\n\n  \tTransitionManager.prototype.init = function init() {\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function _detach(element) {\n  \telement.detach();\n  }\n\n  function _detachNodes(tm) {\n  \t// _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\t__resolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function __resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\t__resolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new _Promise(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n\n  \t\tbatch.transitionManager.init();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \tregisterDecorator: function (decorator) {\n  \t\tbatch.transitionManager.addDecorator(decorator);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function _dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tbatch.immediateObservers.forEach(_dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment = undefined;\n\n  \twhile (i--) {\n  \t\tfragment = batch.fragments[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tfragment.update();\n  \t}\n  \tbatch.fragments.length = 0;\n\n  \tbatch.transitionManager.start();\n\n  \tbatch.deferredObservers.forEach(_dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length) return flushChanges();\n  }\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \treturn normalise(keypath).split('.');\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tvar model = keypath ? this.viewmodel.joinAll(splitKeypath(keypath)) : this.viewmodel;\n\n  \tvar promise = runloop.start(this, true);\n  \tmodel.mark();\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(normalise(keypath).split('.'));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + keypath.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var _unrenderHook = new Hook('unrender');\n  function Ractive$unrender() {\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn _Promise.resolve();\n  \t}\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \t_unrenderHook.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  var _teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(_cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = this.fragment.rendered ? this.unrender() : _Promise.resolve();\n\n  \t_teardownHook.fire(this);\n\n  \treturn promise;\n  }\n\n  var _errorMessage = 'Cannot add to a non-numeric value';\n  function _add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif (!isNumeric(value)) throw new Error(_errorMessage);\n\n  \t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set(changes);\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(_errorMessage);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn _add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function _bind(fn, context) {\n  \tif (!/this/.test(fn.toString())) return fn;\n\n  \tvar bound = fn.bind(context);\n  \tfor (var prop in fn) {\n  \t\tbound[prop] = fn[prop];\n  \t}return bound;\n  }\n\n  function Ractive$set(keypath, value) {\n  \tvar promise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tvar map = keypath;\n\n  \t\tfor (keypath in map) {\n  \t\t\tif (map.hasOwnProperty(keypath)) {\n  \t\t\t\t_set(this, keypath, map[keypath]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\t_set(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function _set(ractive, keypath, value) {\n  \tif (typeof value === 'function') value = _bind(value, ractive);\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var exportedShims;\n\n  if (!win) {\n  \texportedShims = null;\n  } else {\n  \texportedShims = {};\n\n  \t// Shims for older browsers\n\n  \tif (!Date.now) {\n  \t\tDate.now = function () {\n  \t\t\treturn +new Date();\n  \t\t};\n  \t}\n\n  \tif (!String.prototype.trim) {\n  \t\tString.prototype.trim = function () {\n  \t\t\treturn this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  \t\t};\n  \t}\n\n  \t// Polyfill for Object.keys\n  \t// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys\n  \tif (!Object.keys) {\n  \t\tObject.keys = (function () {\n  \t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n  \t\t\t    hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n  \t\t\t    dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n  \t\t\t    dontEnumsLength = dontEnums.length;\n\n  \t\t\treturn function (obj) {\n  \t\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n  \t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n  \t\t\t\t}\n\n  \t\t\t\tvar result = [];\n\n  \t\t\t\tfor (var prop in obj) {\n  \t\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\n  \t\t\t\t\t\tresult.push(prop);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif (hasDontEnumBug) {\n  \t\t\t\t\tfor (var i = 0; i < dontEnumsLength; i++) {\n  \t\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\n  \t\t\t\t\t\t\tresult.push(dontEnums[i]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t})();\n  \t}\n\n  \t// TODO: use defineProperty to make these non-enumerable\n\n  \t// Array extras\n  \tif (!Array.prototype.indexOf) {\n  \t\tArray.prototype.indexOf = function (needle, i) {\n  \t\t\tvar len;\n\n  \t\t\tif (i === undefined) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti += this.length;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tfor (len = this.length; i < len; i++) {\n  \t\t\t\tif (this.hasOwnProperty(i) && this[i] === needle) {\n  \t\t\t\t\treturn i;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn -1;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.forEach) {\n  \t\tArray.prototype.forEach = function (callback, context) {\n  \t\t\tvar i, len;\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tcallback.call(context, this[i], i, this);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.map) {\n  \t\tArray.prototype.map = function (mapper, context) {\n  \t\t\tvar array = this,\n  \t\t\t    i,\n  \t\t\t    len,\n  \t\t\t    mapped = [],\n  \t\t\t    isActuallyString;\n\n  \t\t\t// incredibly, if you do something like\n  \t\t\t// Array.prototype.map.call( someString, iterator )\n  \t\t\t// then `this` will become an instance of String in IE8.\n  \t\t\t// And in IE8, you then can't do string[i]. Facepalm.\n  \t\t\tif (array instanceof String) {\n  \t\t\t\tarray = array.toString();\n  \t\t\t\tisActuallyString = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0, len = array.length; i < len; i += 1) {\n  \t\t\t\tif (array.hasOwnProperty(i) || isActuallyString) {\n  \t\t\t\t\tmapped[i] = mapper.call(context, array[i], i, array);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn mapped;\n  \t\t};\n  \t}\n\n  \tif (typeof Array.prototype.reduce !== 'function') {\n  \t\tArray.prototype.reduce = function (callback, opt_initialValue) {\n  \t\t\tvar i, value, len, valueIsSet;\n\n  \t\t\tif ('function' !== typeof callback) {\n  \t\t\t\tthrow new TypeError(callback + ' is not a function');\n  \t\t\t}\n\n  \t\t\tlen = this.length;\n  \t\t\tvalueIsSet = false;\n\n  \t\t\tif (arguments.length > 1) {\n  \t\t\t\tvalue = opt_initialValue;\n  \t\t\t\tvalueIsSet = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tif (valueIsSet) {\n  \t\t\t\t\t\tvalue = callback(value, this[i], i, this);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvalue = this[i];\n  \t\t\t\t\tvalueIsSet = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!valueIsSet) {\n  \t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n  \t\t\t}\n\n  \t\t\treturn value;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.filter) {\n  \t\tArray.prototype.filter = function (filter, context) {\n  \t\t\tvar i,\n  \t\t\t    len,\n  \t\t\t    filtered = [];\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i) && filter.call(context, this[i], i, this)) {\n  \t\t\t\t\tfiltered[filtered.length] = this[i];\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn filtered;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.every) {\n  \t\tArray.prototype.every = function (iterator, context) {\n  \t\t\tvar t, len, i;\n\n  \t\t\tif (this == null) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tt = Object(this);\n  \t\t\tlen = t.length >>> 0;\n\n  \t\t\tif (typeof iterator !== 'function') {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (i in t && !iterator.call(context, t[i], i, t)) {\n  \t\t\t\t\treturn false;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn true;\n  \t\t};\n  \t}\n\n  \tif (typeof Function.prototype.bind !== 'function') {\n  \t\tFunction.prototype.bind = function (context) {\n  \t\t\tvar args,\n  \t\t\t    fn,\n  \t\t\t    Empty,\n  \t\t\t    bound,\n  \t\t\t    slice = [].slice;\n\n  \t\t\tif (typeof this !== 'function') {\n  \t\t\t\tthrow new TypeError('Function.prototype.bind called on non-function');\n  \t\t\t}\n\n  \t\t\targs = slice.call(arguments, 1);\n  \t\t\tfn = this;\n  \t\t\tEmpty = function () {};\n\n  \t\t\tbound = function () {\n  \t\t\t\tvar ctx = this instanceof Empty && context ? this : context;\n  \t\t\t\treturn fn.apply(ctx, args.concat(slice.call(arguments)));\n  \t\t\t};\n\n  \t\t\tEmpty.prototype = this.prototype;\n  \t\t\tbound.prototype = new Empty();\n\n  \t\t\treturn bound;\n  \t\t};\n  \t}\n\n  \t// https://gist.github.com/Rich-Harris/6010282 via https://gist.github.com/jonathantneal/2869388\n  \t// addEventListener polyfill IE6+\n  \tif (!win.addEventListener) {\n  \t\t(function (win, doc) {\n  \t\t\tvar Event, addEventListener, removeEventListener, head, style, origCreateElement;\n\n  \t\t\t// because sometimes inquiring minds want to know\n  \t\t\twin.appearsToBeIELessEqual8 = true;\n\n  \t\t\tEvent = function (e, element) {\n  \t\t\t\tvar property,\n  \t\t\t\t    instance = this;\n\n  \t\t\t\tfor (property in e) {\n  \t\t\t\t\tinstance[property] = e[property];\n  \t\t\t\t}\n\n  \t\t\t\tinstance.currentTarget = element;\n  \t\t\t\tinstance.target = e.srcElement || element;\n  \t\t\t\tinstance.timeStamp = +new Date();\n\n  \t\t\t\tinstance.preventDefault = function () {\n  \t\t\t\t\te.returnValue = false;\n  \t\t\t\t};\n\n  \t\t\t\tinstance.stopPropagation = function () {\n  \t\t\t\t\te.cancelBubble = true;\n  \t\t\t\t};\n  \t\t\t};\n\n  \t\t\taddEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tlisteners = element.listeners || (element.listeners = []);\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\tlisteners[i] = [listener, function (e) {\n  \t\t\t\t\tlistener.call(element, new Event(e, element));\n  \t\t\t\t}];\n\n  \t\t\t\telement.attachEvent('on' + type, listeners[i][1]);\n  \t\t\t};\n\n  \t\t\tremoveEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tif (!element.listeners) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tlisteners = element.listeners;\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\twhile (i--) {\n  \t\t\t\t\tif (listeners[i][0] === listener) {\n  \t\t\t\t\t\telement.detachEvent('on' + type, listeners[i][1]);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\twin.addEventListener = doc.addEventListener = addEventListener;\n  \t\t\twin.removeEventListener = doc.removeEventListener = removeEventListener;\n\n  \t\t\tif ('Element' in win) {\n  \t\t\t\twin.Element.prototype.addEventListener = addEventListener;\n  \t\t\t\twin.Element.prototype.removeEventListener = removeEventListener;\n  \t\t\t} else {\n  \t\t\t\t// First, intercept any calls to document.createElement - this is necessary\n  \t\t\t\t// because the CSS hack (see below) doesn't come into play until after a\n  \t\t\t\t// node is added to the DOM, which is too late for a lot of Ractive setup work\n  \t\t\t\torigCreateElement = doc.createElement;\n\n  \t\t\t\tdoc.createElement = function (tagName) {\n  \t\t\t\t\tvar el = origCreateElement(tagName);\n  \t\t\t\t\tel.addEventListener = addEventListener;\n  \t\t\t\t\tel.removeEventListener = removeEventListener;\n  \t\t\t\t\treturn el;\n  \t\t\t\t};\n\n  \t\t\t\t// Then, mop up any additional elements that weren't created via\n  \t\t\t\t// document.createElement (i.e. with innerHTML).\n  \t\t\t\thead = doc.getElementsByTagName('head')[0];\n  \t\t\t\tstyle = doc.createElement('style');\n\n  \t\t\t\thead.insertBefore(style, head.firstChild);\n\n  \t\t\t\t//style.styleSheet.cssText = '*{-ms-event-prototype:expression(!this.addEventListener&&(this.addEventListener=addEventListener)&&(this.removeEventListener=removeEventListener))}';\n  \t\t\t}\n  \t\t})(win, doc);\n  \t}\n\n  \t// The getComputedStyle polyfill interacts badly with jQuery, so we don't attach\n  \t// it to window. Instead, we export it for other modules to use as needed\n\n  \t// https://github.com/jonathantneal/Polyfills-for-IE8/blob/master/getComputedStyle.js\n  \tif (!win.getComputedStyle) {\n  \t\texportedShims.getComputedStyle = (function () {\n  \t\t\tvar borderSizes = {};\n\n  \t\t\tfunction getPixelSize(element, style, property, fontSize) {\n  \t\t\t\tvar sizeWithSuffix = style[property];\n  \t\t\t\tvar size = parseFloat(sizeWithSuffix);\n  \t\t\t\tvar suffix = sizeWithSuffix.split(/\\d/)[0];\n\n  \t\t\t\tif (isNaN(size)) {\n  \t\t\t\t\tif (/^thin|medium|thick$/.test(sizeWithSuffix)) {\n  \t\t\t\t\t\tsize = getBorderPixelSize(sizeWithSuffix);\n  \t\t\t\t\t\tsuffix = '';\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\t// TODO...\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tfontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;\n  \t\t\t\tvar rootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;\n\n  \t\t\t\treturn suffix == 'em' ? size * fontSize : suffix == 'in' ? size * 96 : suffix == 'pt' ? size * 96 / 72 : suffix == '%' ? size / 100 * rootSize : size;\n  \t\t\t}\n\n  \t\t\tfunction getBorderPixelSize(size) {\n  \t\t\t\tvar div, bcr;\n\n  \t\t\t\t// `thin`, `medium` and `thick` vary between browsers. (Don't ever use them.)\n  \t\t\t\tif (!borderSizes[size]) {\n  \t\t\t\t\tdiv = doc.createElement('div');\n  \t\t\t\t\tdiv.style.display = 'block';\n  \t\t\t\t\tdiv.style.position = 'fixed';\n  \t\t\t\t\tdiv.style.width = div.style.height = '0';\n  \t\t\t\t\tdiv.style.borderRight = size + ' solid black';\n\n  \t\t\t\t\tdoc.getElementsByTagName('body')[0].appendChild(div);\n  \t\t\t\t\tbcr = div.getBoundingClientRect();\n\n  \t\t\t\t\tborderSizes[size] = bcr.right - bcr.left;\n  \t\t\t\t}\n\n  \t\t\t\treturn borderSizes[size];\n  \t\t\t}\n\n  \t\t\tfunction setShortStyleProperty(style, property) {\n  \t\t\t\tvar borderSuffix = property == 'border' ? 'Width' : '';\n  \t\t\t\tvar t = property + 'Top' + borderSuffix;\n  \t\t\t\tvar r = property + 'Right' + borderSuffix;\n  \t\t\t\tvar b = property + 'Bottom' + borderSuffix;\n  \t\t\t\tvar l = property + 'Left' + borderSuffix;\n\n  \t\t\t\tstyle[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]] : style[t] == style[b] && style[l] == style[r] ? [style[t], style[r]] : style[l] == style[r] ? [style[t], style[r], style[b]] : [style[t], style[r], style[b], style[l]]).join(' ');\n  \t\t\t}\n\n  \t\t\tvar normalProps = {\n  \t\t\t\tfontWeight: 400,\n  \t\t\t\tlineHeight: 1.2, // actually varies depending on font-family, but is generally close enough...\n  \t\t\t\tletterSpacing: 0\n  \t\t\t};\n\n  \t\t\tfunction CSSStyleDeclaration(element) {\n  \t\t\t\tvar currentStyle, style, fontSize, property;\n\n  \t\t\t\tcurrentStyle = element.currentStyle;\n  \t\t\t\tstyle = this;\n  \t\t\t\tfontSize = getPixelSize(element, currentStyle, 'fontSize', null);\n\n  \t\t\t\t// TODO tidy this up, test it, send PR to jonathantneal!\n  \t\t\t\tfor (property in currentStyle) {\n  \t\t\t\t\tif (currentStyle[property] === 'normal' && normalProps.hasOwnProperty(property)) {\n  \t\t\t\t\t\tstyle[property] = normalProps[property];\n  \t\t\t\t\t} else if (/width|height|margin.|padding.|border.+W/.test(property)) {\n  \t\t\t\t\t\tif (currentStyle[property] === 'auto') {\n  \t\t\t\t\t\t\tif (/^width|height/.test(property)) {\n  \t\t\t\t\t\t\t\t// just use clientWidth/clientHeight...\n  \t\t\t\t\t\t\t\tstyle[property] = (property === 'width' ? element.clientWidth : element.clientHeight) + 'px';\n  \t\t\t\t\t\t\t} else if (/(?:padding)?Top|Bottom$/.test(property)) {\n  \t\t\t\t\t\t\t\tstyle[property] = '0px';\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tstyle[property] = getPixelSize(element, currentStyle, property, fontSize) + 'px';\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (property === 'styleFloat') {\n  \t\t\t\t\t\tstyle.float = currentStyle[property];\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tstyle[property] = currentStyle[property];\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tsetShortStyleProperty(style, 'margin');\n  \t\t\t\tsetShortStyleProperty(style, 'padding');\n  \t\t\t\tsetShortStyleProperty(style, 'border');\n\n  \t\t\t\tstyle.fontSize = fontSize + 'px';\n\n  \t\t\t\treturn style;\n  \t\t\t}\n\n  \t\t\tCSSStyleDeclaration.prototype = {\n  \t\t\t\tconstructor: CSSStyleDeclaration,\n  \t\t\t\tgetPropertyPriority: noop,\n  \t\t\t\tgetPropertyValue: function (prop) {\n  \t\t\t\t\treturn this[prop] || '';\n  \t\t\t\t},\n  \t\t\t\titem: noop,\n  \t\t\t\tremoveProperty: noop,\n  \t\t\t\tsetProperty: noop,\n  \t\t\t\tgetPropertyCSSValue: noop\n  \t\t\t};\n\n  \t\t\tfunction getComputedStyle(element) {\n  \t\t\t\treturn new CSSStyleDeclaration(element);\n  \t\t\t}\n\n  \t\t\treturn getComputedStyle;\n  \t\t})();\n  \t}\n  }\n\n  var _html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns/';\n\n  var createElement;\n  var matches;\n  var _div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var __i;\n  var j;\n  var makeFunction;\n  // Test for SVG support\n  if (!_svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== _html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === _html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \t_div = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \t__i = methodNames.length;\n\n  \twhile (__i-- && !matches) {\n  \t\tunprefixed = methodNames[__i];\n\n  \t\tif (_div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj = vendors.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tprefixed = vendors[__i] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (_div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\t_div.innerHTML = '';\n\n  \t\t\t\tparentNode = _div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\t_div.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti = nodes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (nodes[i] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function __extend(target) {\n  \tvar prop, source;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \twhile (source = sources.shift()) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var Parser;\n  var ParseError;\n  var _leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(_leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next = undefined;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === '\\\\\\'') {\n  \t\t\t\t\tliteral += '\\'';\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var INVERTED = 5;\n  var CLOSING = 6;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMMENT = 9;\n  var DELIMCHANGE = 10;\n  var CLOSING_TAG = 14;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var INLINE_PARTIAL = 17;\n  var DOCTYPE = 18;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var ARRAY_LITERAL = 22;\n  var OBJECT_LITERAL = 23;\n  var BOOLEAN_LITERAL = 24;\n  var REGEXP_LITERAL = 25;\n\n  var GLOBAL = 26;\n  var KEY_VALUE_PAIR = 27;\n\n  var REFERENCE = 30;\n  var REFINEMENT = 31;\n  var MEMBER = 32;\n  var PREFIX_OPERATOR = 33;\n  var BRACKETED = 34;\n  var CONDITIONAL = 35;\n  var INFIX_OPERATOR = 36;\n\n  var INVOCATION = 40;\n\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var ELSE = 60;\n  var ELSEIF = 61;\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher('\\'');\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString('\\'')) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\\'')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var _name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var _numberPattern = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function _readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(_numberPattern)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = _readNumberLiteral(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(_name)) {\n  \t\treturn token;\n  \t}\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tif (!parser.values) return null;\n\n  \t\tvar placeholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special = parser.matchPattern(specialsPattern);\n  \t\tif (special) return { v: specials[special] };\n  \t}, function getNumber(parser) {\n  \t\tvar number = parser.matchPattern(numberPattern);\n  \t\tif (number) return { v: +number };\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser);\n  \t\tvar values = parser.values;\n\n  \t\tif (stringLiteral && values) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tif (!parser.matchString('{')) return null;\n\n  \t\tvar result = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar pair = undefined;\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tif (!parser.matchString('[')) return null;\n\n  \t\tvar result = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar valueToken = undefined;\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey(parser);\n\n  \tif (!key) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif (!valueToken) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, { values: values });\n  \treturn parser.result;\n  }\n\n  // TODO all this code needs to die\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function badReference(key) {\n  \tthrow new Error(\"An index or key reference (\" + key + \") cannot have child properties\");\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = ref.split('.');\n  \tvar key = keys[0];\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\tclassCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = reference.split('.');\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\tclassCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \treturn Item;\n  })();\n\n  var Doctype = (function (_Item) {\n  \tinherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\tclassCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  var KeypathModel = (function () {\n  \tfunction KeypathModel(parent) {\n  \t\tclassCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.value = parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange() {\n  \t\tthis.value = this.parent.getKeypath();\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\tclassCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var _stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \t_stack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \treturn _stack.pop();\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick() {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i = undefined;\n  \tvar ticker = undefined;\n\n  \tfor (i = 0; i < tickers.length; i += 1) {\n  \t\tticker = tickers[i];\n\n  \t\tif (!ticker.tick(now)) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice(i--, 1);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif (tickers.length) {\n  \t\trequestAnimationFrame(tick);\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = (function () {\n  \tfunction Ticker(options) {\n  \t\tclassCallCheck(this, Ticker);\n\n  \t\tthis.duration = options.duration;\n  \t\tthis.step = options.step;\n  \t\tthis.complete = options.complete;\n  \t\tthis.easing = options.easing;\n\n  \t\tthis.start = getTime();\n  \t\tthis.end = this.start + this.duration;\n\n  \t\tthis.running = true;\n\n  \t\ttickers.push(this);\n  \t\tif (!running) requestAnimationFrame(tick);\n  \t}\n\n  \tTicker.prototype.tick = function tick(now) {\n  \t\tif (!this.running) return false;\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) this.step(1);\n  \t\t\tif (this.complete) this.complete(1);\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar elapsed = now - this.start;\n  \t\tvar eased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) this.step(eased);\n\n  \t\treturn true;\n  \t};\n\n  \tTicker.prototype.stop = function stop() {\n  \t\tif (this.abort) this.abort();\n  \t\tthis.running = false;\n  \t};\n\n  \treturn Ticker;\n  })();\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\tclassCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tthis.ticker = null;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = key;\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar value = this.value;\n  \t\tvar len = adaptors.length;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.animate = function animate(from, to, options, interpolator) {\n  \t\tvar _this = this;\n\n  \t\tif (this.ticker) this.ticker.stop();\n\n  \t\tvar fulfilPromise = undefined;\n  \t\tvar promise = new _Promise(function (fulfil) {\n  \t\t\treturn fulfilPromise = fulfil;\n  \t\t});\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function (t) {\n  \t\t\t\tvar value = interpolator(t);\n  \t\t\t\t_this.applyValue(value);\n  \t\t\t\tif (options.step) options.step(t, value);\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\t_this.applyValue(to);\n  \t\t\t\tif (options.complete) options.complete(to);\n\n  \t\t\t\t_this.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tthis.parent.value[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.deps.forEach(_handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(_handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.discard = function discard() {\n  \t\tvar _this2 = this;\n\n  \t\tthis.deps.forEach(function (d) {\n  \t\t\tif (d.boundsSensitive) _this2.unregister(d);\n  \t\t});\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n  \t\t\t\t\tif (isArray(model.value)) {\n  \t\t\t\t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t\t\t\t// it'll do for now. Alternatives welcome\n  \t\t\t\t\t\tif (originatingModel && originatingModel.parent === model && originatingModel.key === 'length') {\n  \t\t\t\t\t\t\tmatches.push(originatingModel);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tmodel.value.forEach(function (member, i) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(i));\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else if (isObject(model.value) || typeof model.value === 'function') {\n  \t\t\t\t\t\tObject.keys(model.value).forEach(function (key) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t// special case - computed properties. TODO mappings also?\n  \t\t\t\t\t\tif (model.isRoot) {\n  \t\t\t\t\t\t\tObject.keys(model.computations).forEach(function (key) {\n  \t\t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(this.key);\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel() {\n  \t\treturn this.keypathModel || (this.keypathModel = new KeypathModel(this));\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath() {\n  \t\t// TODO keypaths inside components... tricky\n  \t\treturn this.parent.isRoot ? this.key : this.parent.getKeypath() + '.' + this.key;\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\tvar value = this.get();\n  \t\treturn value && hasProp.call(value, key);\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(_mark);\n\n  \t\t\tthis.deps.forEach(_handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (this.ticker) this.ticker.stop();\n  \t\tthis.applyValue(value);\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tvar indexModels = [];\n  \t\tvar max = 0,\n  \t\t    child = undefined;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex > max) max = newIndex;\n\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this3.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\t// some children, notably computations, need to be notified when they are\n  \t\t// no longer attached to anything so they don't recompute\n  \t\twhile (child = this.childByKey[++max]) {\n  \t\t\tif (typeof child.discard === 'function') child.discard();\n  \t\t}\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown() {\n  \t\tthis.children.forEach(_teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  var ComputationChild = (function (_Model) {\n  \tinherits(ComputationChild, _Model);\n\n  \tfunction ComputationChild() {\n  \t\tclassCallCheck(this, ComputationChild);\n\n  \t\t_Model.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[this.key] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \t// TODO this causes problems with inter-component mappings\n  \t// set () {\n  \t// \tthrow new Error( `Cannot set read-only property of computed value (${this.getKeypath()})` );\n  \t// }\n  \treturn ComputationChild;\n  })(Model);\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif (!repeater.isIteration) return;\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return context.root.joinAll(ref.slice(2).split('.'));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(ref.split('.'));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var functionCache = {};\n  function createFunction(str, i) {\n  \tif (functionCache[str]) return functionCache[str];\n\n  \tvar args = new Array(i);\n  \twhile (i--) args[i] = \"_\" + i;\n\n  \tvar fn = new Function(args.join(','), \"return (\" + str + \")\");\n\n  \treturn functionCache[str] = fn;\n  }\n\n  function __getValue(model) {\n  \treturn model ? model.get(true) : undefined;\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \tinherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = createFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(fragment, ref);\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (!model) {\n  \t\t\t\tresolver = fragment.resolve(ref, function (model) {\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t_this.bubble();\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(__getValue);\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n  \t};\n\n  \tExpressionProxy.prototype.get = function get() {\n  \t\treturn this.computation.get();\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  var ReferenceExpressionProxy = (function (_Model) {\n  \tinherits(ReferenceExpressionProxy, _Model);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = _resolve(fragment, template);\n  \t\tvar baseResolver = undefined;\n\n  \t\tif (!this.base) {\n  \t\t\tbaseResolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t_this.base = model;\n  \t\t\t\t_this.bubble();\n\n  \t\t\t\tremoveFromArray(_this.resolvers, baseResolver);\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push(baseResolver);\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i] || this.members[i].get() === undefined) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn model.get();\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function _resolve(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  var Mustache = (function (_Item) {\n  \tinherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\tclassCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = _resolve(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = _resolve(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tvar oldValue = this.model.get();\n  \t\tthis.model.unregister(this);\n\n  \t\tthis.model = model;\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tif (model.get() !== oldValue) this.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn String.fromCharCode(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn 65533;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing € signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn 65533;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t}\n\n  \treturn 65533;\n  }\n\n  var Interpolator = (function (_Mustache) {\n  \tinherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\tclassCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn this.node.parentNode.removeChild(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tthis.node = doc.createTextNode(this.getString());\n\n  \t\ttarget.appendChild(this.node);\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  function readComment(parser, tag) {\n  \tvar index;\n\n  \tif (!parser.matchString('!')) {\n  \t\treturn null;\n  \t}\n\n  \tindex = parser.remaining().indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tparser.pos += index + tag.close.length;\n  \t\treturn { t: COMMENT };\n  \t}\n  }\n\n  function flattenExpression(expression) {\n  \tvar refs;\n\n  \textractRefs(expression, refs = []);\n\n  \treturn {\n  \t\tr: refs,\n  \t\ts: stringify(expression)\n  \t};\n\n  \tfunction stringify(node) {\n  \t\tswitch (node.t) {\n  \t\t\tcase BOOLEAN_LITERAL:\n  \t\t\tcase GLOBAL:\n  \t\t\tcase NUMBER_LITERAL:\n  \t\t\tcase REGEXP_LITERAL:\n  \t\t\t\treturn node.v;\n\n  \t\t\tcase STRING_LITERAL:\n  \t\t\t\treturn JSON.stringify(String(node.v));\n\n  \t\t\tcase ARRAY_LITERAL:\n  \t\t\t\treturn '[' + (node.m ? node.m.map(stringify).join(',') : '') + ']';\n\n  \t\t\tcase OBJECT_LITERAL:\n  \t\t\t\treturn '{' + (node.m ? node.m.map(stringify).join(',') : '') + '}';\n\n  \t\t\tcase KEY_VALUE_PAIR:\n  \t\t\t\treturn node.k + ':' + stringify(node.v);\n\n  \t\t\tcase PREFIX_OPERATOR:\n  \t\t\t\treturn (node.s === 'typeof' ? 'typeof ' : node.s) + stringify(node.o);\n\n  \t\t\tcase INFIX_OPERATOR:\n  \t\t\t\treturn stringify(node.o[0]) + (node.s.substr(0, 2) === 'in' ? ' ' + node.s + ' ' : node.s) + stringify(node.o[1]);\n\n  \t\t\tcase INVOCATION:\n  \t\t\t\treturn stringify(node.x) + '(' + (node.o ? node.o.map(stringify).join(',') : '') + ')';\n\n  \t\t\tcase BRACKETED:\n  \t\t\t\treturn '(' + stringify(node.x) + ')';\n\n  \t\t\tcase MEMBER:\n  \t\t\t\treturn stringify(node.x) + stringify(node.r);\n\n  \t\t\tcase REFINEMENT:\n  \t\t\t\treturn node.n ? '.' + node.n : '[' + stringify(node.x) + ']';\n\n  \t\t\tcase CONDITIONAL:\n  \t\t\t\treturn stringify(node.o[0]) + '?' + stringify(node.o[1]) + ':' + stringify(node.o[2]);\n\n  \t\t\tcase REFERENCE:\n  \t\t\t\treturn '_' + refs.indexOf(node.n);\n\n  \t\t\tdefault:\n  \t\t\t\tthrow new Error('Expected legal JavaScript');\n  \t\t}\n  \t}\n  }\n\n  // TODO maybe refactor this?\n  function extractRefs(node, refs) {\n  \tvar i, list;\n\n  \tif (node.t === REFERENCE) {\n  \t\tif (refs.indexOf(node.n) === -1) {\n  \t\t\trefs.unshift(node.n);\n  \t\t}\n  \t}\n\n  \tlist = node.o || node.m;\n  \tif (list) {\n  \t\tif (isObject(list)) {\n  \t\t\textractRefs(list, refs);\n  \t\t} else {\n  \t\t\ti = list.length;\n  \t\t\twhile (i--) {\n  \t\t\t\textractRefs(list[i], refs);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (node.x) {\n  \t\textractRefs(node.x, refs);\n  \t}\n\n  \tif (node.r) {\n  \t\textractRefs(node.r, refs);\n  \t}\n\n  \tif (node.v) {\n  \t\textractRefs(node.v, refs);\n  \t}\n  }\n\n  var arrayMemberPattern = /^[0-9][1-9]*$/;\n  function refineExpression(expression, mustache) {\n  \tvar referenceExpression;\n\n  \tif (expression) {\n  \t\twhile (expression.t === BRACKETED && expression.x) {\n  \t\t\texpression = expression.x;\n  \t\t}\n\n  \t\t// special case - integers should be treated as array members references,\n  \t\t// rather than as expressions in their own right\n  \t\tif (expression.t === REFERENCE) {\n  \t\t\tmustache.r = expression.n;\n  \t\t} else {\n  \t\t\tif (expression.t === NUMBER_LITERAL && arrayMemberPattern.test(expression.v)) {\n  \t\t\t\tmustache.r = expression.v;\n  \t\t\t} else if (referenceExpression = getReferenceExpression(expression)) {\n  \t\t\t\tmustache.rx = referenceExpression;\n  \t\t\t} else {\n  \t\t\t\tmustache.x = flattenExpression(expression);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn mustache;\n  \t}\n  }\n\n  // TODO refactor this! it's bewildering\n  function getReferenceExpression(expression) {\n  \tvar members = [],\n  \t    refinement;\n\n  \twhile (expression.t === MEMBER && expression.r.t === REFINEMENT) {\n  \t\trefinement = expression.r;\n\n  \t\tif (refinement.x) {\n  \t\t\tif (refinement.x.t === REFERENCE) {\n  \t\t\t\tmembers.unshift(refinement.x);\n  \t\t\t} else {\n  \t\t\t\tmembers.unshift(flattenExpression(refinement.x));\n  \t\t\t}\n  \t\t} else {\n  \t\t\tmembers.unshift(refinement.n);\n  \t\t}\n\n  \t\texpression = expression.x;\n  \t}\n\n  \tif (expression.t !== REFERENCE) {\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tr: expression.n,\n  \t\tm: members\n  \t};\n  }\n\n  var prefixPattern = /^(?:~\\/|(?:\\.\\.\\/)+|\\.\\/(?:\\.\\.\\/)*|\\.)/;\n  var globals;\n  var keywords;\n  // if a reference is a browser global, we don't deference it later, so it needs special treatment\n  globals = /^(?:Array|console|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)\\b/;\n\n  // keywords are not valid references, with the exception of `this`\n  keywords = /^(?:break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with)$/;\n\n  var legalReference = /^[a-zA-Z$_0-9]+(?:(?:\\.[a-zA-Z$_0-9]+)|(?:\\[[0-9]+\\]))*/;\n  var relaxedName = /^[a-zA-Z_$][-\\/a-zA-Z_$0-9]*/;\n  function readReference(parser) {\n  \tvar startPos, prefix, name, global, reference, lastDotIndex;\n\n  \tstartPos = parser.pos;\n\n  \tname = parser.matchPattern(/^@(?:keypath|index|key)/);\n\n  \tif (!name) {\n  \t\tprefix = parser.matchPattern(prefixPattern) || '';\n  \t\tname = !prefix && parser.relaxedNames && parser.matchPattern(relaxedName) || parser.matchPattern(legalReference);\n\n  \t\tif (!name && prefix === '.') {\n  \t\t\tprefix = '';\n  \t\t\tname = '.';\n  \t\t}\n  \t}\n\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \t// bug out if it's a keyword (exception for ancestor/restricted refs - see https://github.com/ractivejs/ractive/issues/1497)\n  \tif (!prefix && !parser.relaxedNames && keywords.test(name)) {\n  \t\tparser.pos = startPos;\n  \t\treturn null;\n  \t}\n\n  \t// if this is a browser global, stop here\n  \tif (!prefix && globals.test(name)) {\n  \t\tglobal = globals.exec(name)[0];\n  \t\tparser.pos = startPos + global.length;\n\n  \t\treturn {\n  \t\t\tt: GLOBAL,\n  \t\t\tv: global\n  \t\t};\n  \t}\n\n  \treference = (prefix || '') + normalise(name);\n\n  \tif (parser.matchString('(')) {\n  \t\t// if this is a method invocation (as opposed to a function) we need\n  \t\t// to strip the method name from the reference combo, else the context\n  \t\t// will be wrong\n  \t\tlastDotIndex = reference.lastIndexOf('.');\n  \t\tif (lastDotIndex !== -1) {\n  \t\t\treference = reference.substr(0, lastDotIndex);\n  \t\t\tparser.pos = startPos + reference.length;\n  \t\t} else {\n  \t\t\tparser.pos -= 1;\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tt: REFERENCE,\n  \t\tn: reference.replace(/^this\\./, './').replace(/^this$/, '.')\n  \t};\n  }\n\n  var expectedExpression = 'Expected a JavaScript expression';\n  var expectedParen = 'Expected closing paren';\n\n  function readExpressionList(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar expr = readExpression(parser);\n\n  \tif (expr === null) return null;\n\n  \tvar expressions = [expr];\n\n  \t// allow whitespace between expression and ','\n  \tparser.allowWhitespace();\n\n  \tif (parser.matchString(',')) {\n  \t\tvar next = readExpressionList(parser);\n  \t\tif (next === null) parser.error(expectedExpression);\n\n  \t\texpressions.push.apply(expressions, next);\n  \t}\n\n  \treturn expressions;\n  }\n\n  function readRefinement(parser) {\n  \t// some things call for strict refinement (partial names), meaning no space between reference and refinement\n  \tif (!parser.strictRefinement) {\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// \".\" name\n  \tif (parser.matchString('.')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tvar _name$$ = parser.matchPattern(_name);\n  \t\tif (_name$$) {\n  \t\t\treturn {\n  \t\t\t\tt: REFINEMENT,\n  \t\t\t\tn: _name$$\n  \t\t\t};\n  \t\t}\n\n  \t\tparser.error('Expected a property name');\n  \t}\n\n  \t// \"[\" expression \"]\"\n  \tif (parser.matchString('[')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tvar expr = readExpression(parser);\n  \t\tif (!expr) parser.error(expectedExpression);\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (!parser.matchString(']')) parser.error('Expected \\']\\'');\n\n  \t\treturn {\n  \t\t\tt: REFINEMENT,\n  \t\t\tx: expr\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readBracketedExpression(parser) {\n  \tif (!parser.matchString('(')) return null;\n\n  \tparser.allowWhitespace();\n\n  \tvar expr = readExpression(parser);\n\n  \tif (!expr) parser.error(expectedExpression);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(')')) parser.error(expectedParen);\n\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expr\n  \t};\n  }\n\n  var regexpPattern = /^(\\/(?:[^\\n\\r\\u2028\\u2029/\\\\[]|\\\\.|\\[(?:[^\\n\\r\\u2028\\u2029\\]\\\\]|\\\\.)*])+\\/(?:([gimuy])(?![a-z]*\\2))*(?![a-zA-Z_$0-9]))/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(regexpPattern)) {\n  \t\treturn {\n  \t\t\tt: REGEXP_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readArrayLiteral (parser) {\n  \tvar start, expressionList;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before '['\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('[')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \texpressionList = readExpressionList(parser);\n\n  \tif (!parser.matchString(']')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: ARRAY_LITERAL,\n  \t\tm: expressionList\n  \t};\n  }\n\n  function readKeyValuePair(parser) {\n  \tvar start, key, value;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace between '{' and key\n  \tparser.allowWhitespace();\n\n  \tkey = readKey(parser);\n  \tif (key === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between key and ':'\n  \tparser.allowWhitespace();\n\n  \t// next character must be ':'\n  \tif (!parser.matchString(':')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between ':' and value\n  \tparser.allowWhitespace();\n\n  \t// next expression must be a, well... expression\n  \tvalue = readExpression(parser);\n  \tif (value === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: KEY_VALUE_PAIR,\n  \t\tk: key,\n  \t\tv: value\n  \t};\n  }\n\n  function readKeyValuePairs(parser) {\n  \tvar start, pairs, pair, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \tpair = readKeyValuePair(parser);\n  \tif (pair === null) {\n  \t\treturn null;\n  \t}\n\n  \tpairs = [pair];\n\n  \tif (parser.matchString(',')) {\n  \t\tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t\tif (!keyValuePairs) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn pairs.concat(keyValuePairs);\n  \t}\n\n  \treturn pairs;\n  }\n\n  function readObjectLiteral (parser) {\n  \tvar start, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('{')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t// allow whitespace between final value and '}'\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('}')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: OBJECT_LITERAL,\n  \t\tm: keyValuePairs\n  \t};\n  }\n\n  function readBooleanLiteral(parser) {\n  \tvar remaining = parser.remaining();\n\n  \tif (remaining.substr(0, 4) === 'true') {\n  \t\tparser.pos += 4;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'true'\n  \t\t};\n  \t}\n\n  \tif (remaining.substr(0, 5) === 'false') {\n  \t\tparser.pos += 5;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'false'\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readLiteral(parser) {\n  \treturn _readNumberLiteral(parser) || readBooleanLiteral(parser) || readStringLiteral(parser) || readObjectLiteral(parser) || readArrayLiteral(parser) || readNumberLiteral(parser);\n  }\n\n  function readPrimary (parser) {\n  \treturn readLiteral(parser) || readReference(parser) || readBracketedExpression(parser);\n  }\n\n  function readMemberOrInvocation (parser) {\n  \tvar expression = readPrimary(parser);\n\n  \tif (!expression) return null;\n\n  \twhile (expression) {\n  \t\tvar refinement = readRefinement(parser);\n  \t\tif (refinement) {\n  \t\t\texpression = {\n  \t\t\t\tt: MEMBER,\n  \t\t\t\tx: expression,\n  \t\t\t\tr: refinement\n  \t\t\t};\n  \t\t} else if (parser.matchString('(')) {\n  \t\t\tparser.allowWhitespace();\n  \t\t\tvar expressionList = readExpressionList(parser);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(')')) {\n  \t\t\t\tparser.error(expectedParen);\n  \t\t\t}\n\n  \t\t\texpression = {\n  \t\t\t\tt: INVOCATION,\n  \t\t\t\tx: expression\n  \t\t\t};\n\n  \t\t\tif (expressionList) expression.o = expressionList;\n  \t\t} else {\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \treturn expression;\n  }\n\n  var readTypeOf;\n  var makePrefixSequenceMatcher;\n  makePrefixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar expression;\n\n  \t\tif (expression = fallthrough(parser)) {\n  \t\t\treturn expression;\n  \t\t}\n\n  \t\tif (!parser.matchString(symbol)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tparser.allowWhitespace();\n\n  \t\texpression = readExpression(parser);\n  \t\tif (!expression) {\n  \t\t\tparser.error(expectedExpression);\n  \t\t}\n\n  \t\treturn {\n  \t\t\ts: symbol,\n  \t\t\to: expression,\n  \t\t\tt: PREFIX_OPERATOR\n  \t\t};\n  \t};\n  };\n\n  // create all prefix sequence matchers, return readTypeOf\n  (function () {\n  \tvar i, len, matcher, prefixOperators, fallthrough;\n\n  \tprefixOperators = '! ~ + - typeof'.split(' ');\n\n  \tfallthrough = readMemberOrInvocation;\n  \tfor (i = 0, len = prefixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makePrefixSequenceMatcher(prefixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// typeof operator is higher precedence than multiplication, so provides the\n  \t// fallthrough for the multiplication sequence matcher we're about to create\n  \t// (we're skipping void and delete)\n  \treadTypeOf = fallthrough;\n  })();\n\n  var readLogicalOr;\n  var makeInfixSequenceMatcher;\n  makeInfixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar start, left, right;\n\n  \t\tleft = fallthrough(parser);\n  \t\tif (!left) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// Loop to handle left-recursion in a case like `a * b * c` and produce\n  \t\t// left association, i.e. `(a * b) * c`.  The matcher can't call itself\n  \t\t// to parse `left` because that would be infinite regress.\n  \t\twhile (true) {\n  \t\t\tstart = parser.pos;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(symbol)) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\t// special case - in operator must not be followed by [a-zA-Z_$0-9]\n  \t\t\tif (symbol === 'in' && /[a-zA-Z_$0-9]/.test(parser.remaining().charAt(0))) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\t// right operand must also consist of only higher-precedence operators\n  \t\t\tright = fallthrough(parser);\n  \t\t\tif (!right) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tleft = {\n  \t\t\t\tt: INFIX_OPERATOR,\n  \t\t\t\ts: symbol,\n  \t\t\t\to: [left, right]\n  \t\t\t};\n\n  \t\t\t// Loop back around.  If we don't see another occurrence of the symbol,\n  \t\t\t// we'll return left.\n  \t\t}\n  \t};\n  };\n\n  // create all infix sequence matchers, and return readLogicalOr\n  (function () {\n  \tvar i, len, matcher, infixOperators, fallthrough;\n\n  \t// All the infix operators on order of precedence (source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Operator_Precedence)\n  \t// Each sequence matcher will initially fall through to its higher precedence\n  \t// neighbour, and only attempt to match if one of the higher precedence operators\n  \t// (or, ultimately, a literal, reference, or bracketed expression) already matched\n  \tinfixOperators = '* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||'.split(' ');\n\n  \t// A typeof operator is higher precedence than multiplication\n  \tfallthrough = readTypeOf;\n  \tfor (i = 0, len = infixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makeInfixSequenceMatcher(infixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// Logical OR is the fallthrough for the conditional matcher\n  \treadLogicalOr = fallthrough;\n  })();\n\n  // The conditional operator is the lowest precedence operator, so we start here\n\n  function getConditional(parser) {\n  \tvar start, expression, ifTrue, ifFalse;\n\n  \texpression = readLogicalOr(parser);\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('?')) {\n  \t\tparser.pos = start;\n  \t\treturn expression;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifTrue = readExpression(parser);\n  \tif (!ifTrue) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(':')) {\n  \t\tparser.error('Expected \":\"');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifFalse = readExpression(parser);\n  \tif (!ifFalse) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \treturn {\n  \t\tt: CONDITIONAL,\n  \t\to: [expression, ifTrue, ifFalse]\n  \t};\n  }\n\n  function readExpression(parser) {\n  \t// The conditional operator is the lowest precedence operator (except yield,\n  \t// assignment operators, and commas, none of which are supported), so we\n  \t// start there. If it doesn't match, it 'falls through' to progressively\n  \t// higher precedence operators, until it eventually matches (or fails to\n  \t// match) a 'primary' - a literal or a reference. This way, the abstract syntax\n  \t// tree has everything in its proper place, i.e. 2 + 3 * 4 === 14, not 20.\n  \treturn getConditional(parser);\n  }\n\n  function readExpressionOrReference(parser, expectedFollowers) {\n  \tvar start, expression, i;\n\n  \tstart = parser.pos;\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < expectedFollowers.length; i += 1) {\n  \t\tif (parser.remaining().substr(0, expectedFollowers[i].length) === expectedFollowers[i]) {\n  \t\t\treturn expression;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn readReference(parser);\n  }\n\n  function readInterpolator(parser, tag) {\n  \tvar start, expression, interpolator, err;\n\n  \tstart = parser.pos;\n\n  \t// TODO would be good for perf if we could do away with the try-catch\n  \ttry {\n  \t\texpression = readExpressionOrReference(parser, [tag.close]);\n  \t} catch (e) {\n  \t\terr = e;\n  \t}\n\n  \tif (!expression) {\n  \t\tif (parser.str.charAt(start) === '!') {\n  \t\t\t// special case - comment\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tif (err) {\n  \t\t\tthrow err;\n  \t\t}\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\' after reference');\n\n  \t\tif (!expression) {\n  \t\t\t// special case - comment\n  \t\t\tif (parser.nextChar() === '!') {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.error('Expected expression or legal reference');\n  \t\t}\n  \t}\n\n  \tinterpolator = { t: INTERPOLATOR };\n  \trefineExpression(expression, interpolator); // TODO handle this differently - it's mysterious\n\n  \treturn interpolator;\n  }\n\n  var yieldPattern = /^yield\\s*/;\n  function readYielder(parser, tag) {\n  \tif (!parser.matchPattern(yieldPattern)) return null;\n\n  \tvar name = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-]*/);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error(\"expected legal partial name\");\n  \t}\n\n  \tvar yielder = { t: YIELDER };\n  \tif (name) yielder.n = name;\n\n  \treturn yielder;\n  }\n\n  var handlebarsBlockCodes = {\n  \t'each': SECTION_EACH,\n  \t'if': SECTION_IF,\n  \t'if-with': SECTION_IF_WITH,\n  \t'with': SECTION_WITH,\n  \t'unless': SECTION_UNLESS\n  };\n\n  var _elsePattern = /^\\s*else\\s*/;\n  function readElse(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(_elsePattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error(\"Expected closing delimiter '\" + tag.close + \"'\");\n  \t}\n\n  \treturn {\n  \t\tt: ELSE\n  \t};\n  }\n\n  var elsePattern = /^\\s*elseif\\s+/;\n  function readElseIf(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(elsePattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar expression = readExpression(parser);\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn {\n  \t\tt: ELSEIF,\n  \t\tx: expression\n  \t};\n  }\n\n  function readClosing(parser, tag) {\n  \tvar start, remaining, index, closing;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('/')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tremaining = parser.remaining();\n  \tindex = remaining.indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tclosing = {\n  \t\t\tt: CLOSING,\n  \t\t\tr: remaining.substr(0, index).split(' ')[0]\n  \t\t};\n\n  \t\tparser.pos += index;\n\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t\t}\n\n  \t\treturn closing;\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var indexRefPattern = /^\\s*:\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var keyIndexRefPattern = /^\\s*,\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var handlebarsBlockPattern = new RegExp('^(' + Object.keys(handlebarsBlockCodes).join('|') + ')\\\\b');\n  function readSection(parser, tag) {\n  \tvar start, expression, section, child, children, hasElse, block, unlessBlock, conditions, closed, i, expectedClose;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('^')) {\n  \t\tsection = { t: SECTION, f: [], n: SECTION_UNLESS };\n  \t} else if (parser.matchString('#')) {\n  \t\tsection = { t: SECTION, f: [] };\n\n  \t\tif (parser.matchString('partial')) {\n  \t\t\tparser.pos = start - parser.standardDelimiters[0].length;\n  \t\t\tparser.error('Partial definitions can only be at the top level of the template, or immediately inside components');\n  \t\t}\n\n  \t\tif (block = parser.matchPattern(handlebarsBlockPattern)) {\n  \t\t\texpectedClose = block;\n  \t\t\tsection.n = handlebarsBlockCodes[block];\n  \t\t}\n  \t} else {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\tparser.error('Expected expression');\n  \t}\n\n  \t// optional index and key references\n  \tif (i = parser.matchPattern(indexRefPattern)) {\n  \t\tvar extra = undefined;\n\n  \t\tif (extra = parser.matchPattern(keyIndexRefPattern)) {\n  \t\t\tsection.i = i + ',' + extra;\n  \t\t} else {\n  \t\t\tsection.i = i;\n  \t\t}\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \tparser.sectionDepth += 1;\n  \tchildren = section.f;\n\n  \tconditions = [];\n\n  \tdo {\n  \t\tif (child = readClosing(parser, tag)) {\n  \t\t\tif (expectedClose && child.r !== expectedClose) {\n  \t\t\t\tparser.error('Expected ' + tag.open + '/' + expectedClose + tag.close);\n  \t\t\t}\n\n  \t\t\tparser.sectionDepth -= 1;\n  \t\t\tclosed = true;\n  \t\t} else if (child = readElseIf(parser, tag)) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('illegal {{elseif...}} after {{else}}');\n  \t\t\t}\n\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression);\n  \t\t\t}\n\n  \t\t\tunlessBlock.f.push({\n  \t\t\t\tt: SECTION,\n  \t\t\t\tn: SECTION_IF,\n  \t\t\t\tx: flattenExpression(___combine(conditions.concat(child.x))),\n  \t\t\t\tf: children = []\n  \t\t\t});\n\n  \t\t\tconditions.push(invert(child.x));\n  \t\t} else if (child = readElse(parser, tag)) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('there can only be one {{else}} block, at the end of a section');\n  \t\t\t}\n\n  \t\t\thasElse = true;\n\n  \t\t\t// use an unless block if there's no elseif\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression);\n  \t\t\t\tchildren = unlessBlock.f;\n  \t\t\t} else {\n  \t\t\t\tunlessBlock.f.push({\n  \t\t\t\t\tt: SECTION,\n  \t\t\t\t\tn: SECTION_IF,\n  \t\t\t\t\tx: flattenExpression(___combine(conditions)),\n  \t\t\t\t\tf: children = []\n  \t\t\t\t});\n  \t\t\t}\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tchildren.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \tif (unlessBlock) {\n  \t\t// special case - `with` should become `if-with` (TODO is this right?\n  \t\t// seems to me that `with` ought to behave consistently, regardless\n  \t\t// of the presence/absence of `else`. In other words should always\n  \t\t// be `if-with`\n  \t\tif (section.n === SECTION_WITH) {\n  \t\t\tsection.n = SECTION_IF_WITH;\n  \t\t}\n\n  \t\tsection.l = unlessBlock;\n  \t}\n\n  \trefineExpression(expression, section);\n\n  \t// TODO if a section is empty it should be discarded. Don't do\n  \t// that here though - we need to clean everything up first, as\n  \t// it may contain removeable whitespace. As a temporary measure,\n  \t// to pass the existing tests, remove empty `f` arrays\n  \tif (!section.f.length) {\n  \t\tdelete section.f;\n  \t}\n\n  \treturn section;\n  }\n\n  function createUnlessBlock(expression) {\n  \tvar unlessBlock = {\n  \t\tt: SECTION,\n  \t\tn: SECTION_UNLESS,\n  \t\tf: []\n  \t};\n\n  \trefineExpression(expression, unlessBlock);\n  \treturn unlessBlock;\n  }\n\n  function invert(expression) {\n  \tif (expression.t === PREFIX_OPERATOR && expression.s === '!') {\n  \t\treturn expression.o;\n  \t}\n\n  \treturn {\n  \t\tt: PREFIX_OPERATOR,\n  \t\ts: '!',\n  \t\to: parensIfNecessary(expression)\n  \t};\n  }\n\n  function ___combine(expressions) {\n  \tif (expressions.length === 1) {\n  \t\treturn expressions[0];\n  \t}\n\n  \treturn {\n  \t\tt: INFIX_OPERATOR,\n  \t\ts: '&&',\n  \t\to: [parensIfNecessary(expressions[0]), parensIfNecessary(___combine(expressions.slice(1)))]\n  \t};\n  }\n\n  function parensIfNecessary(expression) {\n  \t// TODO only wrap if necessary\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expression\n  \t};\n  }\n\n  function readUnescaped(parser, tag) {\n  \tvar expression, triple;\n\n  \tif (!parser.matchString('&')) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function readPartial(parser, tag) {\n  \tif (!parser.matchString('>')) return null;\n\n  \tparser.allowWhitespace();\n\n  \t// Partial names can include hyphens, so we can't use readExpression\n  \t// blindly. Instead, we use the `relaxedNames` flag to indicate that\n  \t// `foo-bar` should be read as a single name, rather than 'subtract\n  \t// bar from foo'\n  \tparser.relaxedNames = parser.strictRefinement = true;\n  \tvar expression = readExpression(parser);\n  \tparser.relaxedNames = parser.strictRefinement = false;\n\n  \tparser.allowWhitespace();\n  \tvar context = readExpression(parser);\n  \tparser.allowWhitespace();\n\n  \tif (!expression) return null;\n\n  \tvar partial = { t: PARTIAL };\n  \trefineExpression(expression, partial); // TODO...\n\n  \tparser.allowWhitespace();\n\n  \t// if we have another expression - e.g. `{{>foo bar}}` - then\n  \t// we turn it into `{{#with bar}}{{>foo}}{{/with}}`\n  \tif (context) {\n  \t\tpartial = {\n  \t\t\tt: SECTION,\n  \t\t\tn: SECTION_WITH,\n  \t\t\tf: [partial]\n  \t\t};\n\n  \t\trefineExpression(context, partial);\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn partial;\n  }\n\n  function readTriple(parser, tag) {\n  \tvar expression = readExpression(parser),\n  \t    triple;\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function getLowestIndex (haystack, needles) {\n  \tvar i, index, lowest;\n\n  \ti = needles.length;\n  \twhile (i--) {\n  \t\tindex = haystack.indexOf(needles[i]);\n\n  \t\t// short circuit\n  \t\tif (!index) {\n  \t\t\treturn 0;\n  \t\t}\n\n  \t\tif (index === -1) {\n  \t\t\tcontinue;\n  \t\t}\n\n  \t\tif (!lowest || index < lowest) {\n  \t\t\tlowest = index;\n  \t\t}\n  \t}\n\n  \treturn lowest || -1;\n  }\n\n  function readText(parser) {\n  \tvar index, remaining, disallowed, barrier;\n\n  \tremaining = parser.remaining();\n\n  \tbarrier = parser.inside ? '</' + parser.inside : '<';\n\n  \tif (parser.inside && !parser.interpolate[parser.inside]) {\n  \t\tindex = remaining.indexOf(barrier);\n  \t} else {\n  \t\tdisallowed = parser.tags.map(function (t) {\n  \t\t\treturn t.open;\n  \t\t});\n  \t\tdisallowed = disallowed.concat(parser.tags.map(function (t) {\n  \t\t\treturn '\\\\' + t.open;\n  \t\t}));\n\n  \t\t// http://developers.whatwg.org/syntax.html#syntax-attributes\n  \t\tif (parser.inAttribute === true) {\n  \t\t\t// we're inside an unquoted attribute value\n  \t\t\tdisallowed.push('\"', '\\'', '=', '<', '>', '`');\n  \t\t} else if (parser.inAttribute) {\n  \t\t\t// quoted attribute value\n  \t\t\tdisallowed.push(parser.inAttribute);\n  \t\t} else {\n  \t\t\tdisallowed.push(barrier);\n  \t\t}\n\n  \t\tindex = getLowestIndex(remaining, disallowed);\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tif (index === -1) {\n  \t\tindex = remaining.length;\n  \t}\n\n  \tparser.pos += index;\n\n  \treturn parser.inside ? remaining.substr(0, index) : decodeCharacterReferences(remaining.substr(0, index));\n  }\n\n  function trimWhitespace (items, leadingPattern, trailingPattern) {\n  \tvar item;\n\n  \tif (leadingPattern) {\n  \t\titem = items[0];\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(leadingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.shift();\n  \t\t\t} else {\n  \t\t\t\titems[0] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (trailingPattern) {\n  \t\titem = lastItem(items);\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(trailingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.pop();\n  \t\t\t} else {\n  \t\t\t\titems[items.length - 1] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var leadingLinebreak = /^\\s*\\r?\\n/;\n  var trailingLinebreak = /\\r?\\n\\s*$/;\n  function stripStandalones (items) {\n  \tvar i, current, backOne, backTwo, lastSectionItem;\n\n  \tfor (i = 1; i < items.length; i += 1) {\n  \t\tcurrent = items[i];\n  \t\tbackOne = items[i - 1];\n  \t\tbackTwo = items[i - 2];\n\n  \t\t// if we're at the end of a [text][comment][text] sequence...\n  \t\tif (isString(current) && isComment(backOne) && isString(backTwo)) {\n\n  \t\t\t// ... and the comment is a standalone (i.e. line breaks either side)...\n  \t\t\tif (trailingLinebreak.test(backTwo) && leadingLinebreak.test(current)) {\n\n  \t\t\t\t// ... then we want to remove the whitespace after the first line break\n  \t\t\t\titems[i - 2] = backTwo.replace(trailingLinebreak, '\\n');\n\n  \t\t\t\t// and the leading line break of the second text token\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the current item is a section, and it is preceded by a linebreak, and\n  \t\t// its first item is a linebreak...\n  \t\tif (isSection(current) && isString(backOne)) {\n  \t\t\tif (trailingLinebreak.test(backOne) && isString(current.f[0]) && leadingLinebreak.test(current.f[0])) {\n  \t\t\t\titems[i - 1] = backOne.replace(trailingLinebreak, '\\n');\n  \t\t\t\tcurrent.f[0] = current.f[0].replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the last item was a section, and it is followed by a linebreak, and\n  \t\t// its last item is a linebreak...\n  \t\tif (isString(current) && isSection(backOne)) {\n  \t\t\tlastSectionItem = lastItem(backOne.f);\n\n  \t\t\tif (isString(lastSectionItem) && trailingLinebreak.test(lastSectionItem) && leadingLinebreak.test(current)) {\n  \t\t\t\tbackOne.f[backOne.f.length - 1] = lastSectionItem.replace(trailingLinebreak, '\\n');\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn items;\n  }\n\n  function isString(item) {\n  \treturn typeof item === 'string';\n  }\n\n  function isComment(item) {\n  \treturn item.t === COMMENT || item.t === DELIMCHANGE;\n  }\n\n  function isSection(item) {\n  \treturn (item.t === SECTION || item.t === INVERTED) && item.f;\n  }\n\n  var contiguousWhitespace = /[ \\t\\f\\r\\n]+/g;\n  var preserveWhitespaceElements = /^(?:pre|script|style|textarea)$/i;\n  var leadingWhitespace = /^[ \\t\\f\\r\\n]+/;\n  var trailingWhitespace = /[ \\t\\f\\r\\n]+$/;\n  var leadingNewLine = /^(?:\\r\\n|\\r|\\n)/;\n  var trailingNewLine = /(?:\\r\\n|\\r|\\n)$/;\n  function cleanup(items, stripComments, preserveWhitespace, removeLeadingWhitespace, removeTrailingWhitespace) {\n  \tvar i, item, previousItem, nextItem, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment, key;\n\n  \t// First pass - remove standalones and comments etc\n  \tstripStandalones(items);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Remove delimiter changes, unsafe elements etc\n  \t\tif (item.exclude) {\n  \t\t\titems.splice(i, 1);\n  \t\t}\n\n  \t\t// Remove comments, unless we want to keep them\n  \t\telse if (stripComments && item.t === COMMENT) {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t}\n\n  \t// If necessary, remove leading and trailing whitespace\n  \ttrimWhitespace(items, removeLeadingWhitespace ? leadingWhitespace : null, removeTrailingWhitespace ? trailingWhitespace : null);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Recurse\n  \t\tif (item.f) {\n  \t\t\tvar isPreserveWhitespaceElement = item.t === ELEMENT && preserveWhitespaceElements.test(item.e);\n  \t\t\tpreserveWhitespaceInsideFragment = preserveWhitespace || isPreserveWhitespaceElement;\n\n  \t\t\tif (!preserveWhitespace && isPreserveWhitespaceElement) {\n  \t\t\t\ttrimWhitespace(item.f, leadingNewLine, trailingNewLine);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespaceInsideFragment) {\n  \t\t\t\tpreviousItem = items[i - 1];\n  \t\t\t\tnextItem = items[i + 1];\n\n  \t\t\t\t// if the previous item was a text item with trailing whitespace,\n  \t\t\t\t// remove leading whitespace inside the fragment\n  \t\t\t\tif (!previousItem || typeof previousItem === 'string' && trailingWhitespace.test(previousItem)) {\n  \t\t\t\t\tremoveLeadingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n\n  \t\t\t\t// and vice versa\n  \t\t\t\tif (!nextItem || typeof nextItem === 'string' && leadingWhitespace.test(nextItem)) {\n  \t\t\t\t\tremoveTrailingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tcleanup(item.f, stripComments, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Split if-else blocks into two (an if, and an unless)\n  \t\tif (item.l) {\n  \t\t\tcleanup(item.l.f, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n\n  \t\t\titems.splice(i + 1, 0, item.l);\n  \t\t\tdelete item.l; // TODO would be nice if there was a way around this\n  \t\t}\n\n  \t\t// Clean up element attributes\n  \t\tif (item.a) {\n  \t\t\tfor (key in item.a) {\n  \t\t\t\tif (item.a.hasOwnProperty(key) && typeof item.a[key] !== 'string') {\n  \t\t\t\t\tcleanup(item.a[key], stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Clean up conditional attributes\n  \t\tif (item.m) {\n  \t\t\tcleanup(item.m, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Clean up event handlers\n  \t\tif (item.v) {\n  \t\t\tfor (key in item.v) {\n  \t\t\t\tif (item.v.hasOwnProperty(key)) {\n  \t\t\t\t\t// clean up names\n  \t\t\t\t\tif (isArray(item.v[key].n)) {\n  \t\t\t\t\t\tcleanup(item.v[key].n, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// clean up params\n  \t\t\t\t\tif (isArray(item.v[key].d)) {\n  \t\t\t\t\t\tcleanup(item.v[key].d, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// final pass - fuse text nodes together\n  \ti = items.length;\n  \twhile (i--) {\n  \t\tif (typeof items[i] === 'string') {\n  \t\t\tif (typeof items[i + 1] === 'string') {\n  \t\t\t\titems[i] = items[i] + items[i + 1];\n  \t\t\t\titems.splice(i + 1, 1);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespace) {\n  \t\t\t\titems[i] = items[i].replace(contiguousWhitespace, ' ');\n  \t\t\t}\n\n  \t\t\tif (items[i] === '') {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var closingTagPattern = /^([a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*)\\s*\\>/;\n  function readClosingTag(parser) {\n  \tvar start, tag;\n\n  \tstart = parser.pos;\n\n  \t// are we looking at a closing tag?\n  \tif (!parser.matchString('</')) {\n  \t\treturn null;\n  \t}\n\n  \tif (tag = parser.matchPattern(closingTagPattern)) {\n  \t\tif (parser.inside && tag !== parser.inside) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: CLOSING_TAG,\n  \t\t\te: tag\n  \t\t};\n  \t}\n\n  \t// We have an illegal closing tag, report it\n  \tparser.pos -= 2;\n  \tparser.error('Illegal closing tag');\n  }\n\n  var methodCallPattern = /^([a-zA-Z_$][a-zA-Z_$0-9]*)\\(/;\n  var methodCallExcessPattern = /\\)\\s*$/;\n  var ExpressionParser;\n  ExpressionParser = Parser.extend({\n  \tconverters: [readExpression]\n  });\n\n  // TODO clean this up, it's shocking\n\n  function processDirective(tokens, parentParser) {\n  \tvar result, match, parser, args, token, colonIndex, directiveName, directiveArgs, parsed;\n\n  \tif (typeof tokens === 'string') {\n  \t\tif (match = methodCallPattern.exec(tokens)) {\n  \t\t\tvar end = tokens.lastIndexOf(')');\n\n  \t\t\t// check for invalid method calls\n  \t\t\tif (!methodCallExcessPattern.test(tokens)) {\n  \t\t\t\tparentParser.error('Invalid input after method call expression \\'' + tokens.slice(end + 1) + '\\'');\n  \t\t\t}\n\n  \t\t\tresult = { m: match[1] };\n  \t\t\tvar sliced = tokens.slice(result.m.length + 1, end);\n\n  \t\t\tif (sliced === '...arguments') {\n  \t\t\t\t// TODO: what the heck should this be???\n  \t\t\t\t// maybe ExpressionParser should understand ES6???\n  \t\t\t\tresult.g = true;\n  \t\t\t} else {\n  \t\t\t\targs = '[' + sliced + ']';\n  \t\t\t\tparser = new ExpressionParser(args);\n  \t\t\t\tresult.a = flattenExpression(parser.result[0]);\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t}\n\n  \t\tif (tokens.indexOf(':') === -1) {\n  \t\t\treturn tokens.trim();\n  \t\t}\n\n  \t\ttokens = [tokens];\n  \t}\n\n  \tresult = {};\n\n  \tdirectiveName = [];\n  \tdirectiveArgs = [];\n\n  \tif (tokens) {\n  \t\twhile (tokens.length) {\n  \t\t\ttoken = tokens.shift();\n\n  \t\t\tif (typeof token === 'string') {\n  \t\t\t\tcolonIndex = token.indexOf(':');\n\n  \t\t\t\tif (colonIndex === -1) {\n  \t\t\t\t\tdirectiveName.push(token);\n  \t\t\t\t} else {\n  \t\t\t\t\t// is the colon the first character?\n  \t\t\t\t\tif (colonIndex) {\n  \t\t\t\t\t\t// no\n  \t\t\t\t\t\tdirectiveName.push(token.substr(0, colonIndex));\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// if there is anything after the colon in this token, treat\n  \t\t\t\t\t// it as the first token of the directiveArgs fragment\n  \t\t\t\t\tif (token.length > colonIndex + 1) {\n  \t\t\t\t\t\tdirectiveArgs[0] = token.substring(colonIndex + 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tdirectiveName.push(token);\n  \t\t\t}\n  \t\t}\n\n  \t\tdirectiveArgs = directiveArgs.concat(tokens);\n  \t}\n\n  \tif (!directiveName.length) {\n  \t\tresult = '';\n  \t} else if (directiveArgs.length || typeof directiveName !== 'string') {\n  \t\tresult = {\n  \t\t\t// TODO is this really necessary? just use the array\n  \t\t\tn: directiveName.length === 1 && typeof directiveName[0] === 'string' ? directiveName[0] : directiveName\n  \t\t};\n\n  \t\tif (directiveArgs.length === 1 && typeof directiveArgs[0] === 'string') {\n  \t\t\tparsed = parseJSON('[' + directiveArgs[0] + ']');\n  \t\t\tresult.a = parsed ? parsed.value : [directiveArgs[0].trim()];\n  \t\t} else {\n  \t\t\tresult.d = directiveArgs;\n  \t\t}\n  \t} else {\n  \t\tresult = directiveName;\n  \t}\n\n  \treturn result;\n  }\n\n  var delimiterChangePattern = /^[^\\s=]+/;\n  var whitespacePattern = /^\\s+/;\n  function readDelimiterChange(parser) {\n  \tvar start, opening, closing;\n\n  \tif (!parser.matchString('=')) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before new opening delimiter\n  \tparser.allowWhitespace();\n\n  \topening = parser.matchPattern(delimiterChangePattern);\n  \tif (!opening) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace (in fact, it's necessary...)\n  \tif (!parser.matchPattern(whitespacePattern)) {\n  \t\treturn null;\n  \t}\n\n  \tclosing = parser.matchPattern(delimiterChangePattern);\n  \tif (!closing) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace before closing '='\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn [opening, closing];\n  }\n\n  var delimiterChangeToken = { t: DELIMCHANGE, exclude: true };\n  function readMustache(parser) {\n  \tvar mustache, i;\n\n  \t// If we're inside a <script> or <style> tag, and we're not\n  \t// interpolating, bug out\n  \tif (parser.interpolate[parser.inside] === false) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < parser.tags.length; i += 1) {\n  \t\tif (mustache = readMustacheOfType(parser, parser.tags[i])) {\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n  }\n\n  function readMustacheOfType(parser, tag) {\n  \tvar start, mustache, reader, i;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\\\\' + tag.open)) {\n  \t\tif (start === 0 || parser.str[start - 1] !== '\\\\') {\n  \t\t\treturn tag.open;\n  \t\t}\n  \t} else if (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \t// delimiter change?\n  \tif (mustache = readDelimiterChange(parser)) {\n  \t\t// find closing delimiter or abort...\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// ...then make the switch\n  \t\ttag.open = mustache[0];\n  \t\ttag.close = mustache[1];\n  \t\tparser.sortMustacheTags();\n\n  \t\treturn delimiterChangeToken;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \t// illegal section closer\n  \tif (parser.matchString('/')) {\n  \t\tparser.pos -= 1;\n  \t\tvar rewind = parser.pos;\n  \t\tif (!readNumberLiteral(parser)) {\n  \t\t\tparser.pos = rewind - tag.close.length;\n  \t\t\tparser.error('Attempted to close a section that wasn\\'t open');\n  \t\t} else {\n  \t\t\tparser.pos = rewind;\n  \t\t}\n  \t}\n\n  \tfor (i = 0; i < tag.readers.length; i += 1) {\n  \t\treader = tag.readers[i];\n\n  \t\tif (mustache = reader(parser, tag)) {\n  \t\t\tif (tag.isStatic) {\n  \t\t\t\tmustache.s = true; // TODO make this `1` instead - more compact\n  \t\t\t}\n\n  \t\t\tif (parser.includeLinePositions) {\n  \t\t\t\tmustache.p = parser.getLinePos(start);\n  \t\t\t}\n\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var attributeNamePattern = /^[^\\s\"'>\\/=]+/;\n  var unquotedAttributeValueTextPattern = /^[^\\s\"'=<>`]+/;\n  function readAttribute(parser) {\n  \tvar attr, name, value;\n\n  \tparser.allowWhitespace();\n\n  \tname = parser.matchPattern(attributeNamePattern);\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \tattr = { name: name };\n\n  \tvalue = readAttributeValue(parser);\n  \tif (value != null) {\n  \t\t// not null/undefined\n  \t\tattr.value = value;\n  \t}\n\n  \treturn attr;\n  }\n\n  function readAttributeValue(parser) {\n  \tvar start, valueStart, startDepth, value;\n\n  \tstart = parser.pos;\n\n  \t// next character must be `=`, `/`, `>` or whitespace\n  \tif (!/[=\\/>\\s]/.test(parser.nextChar())) {\n  \t\tparser.error('Expected `=`, `/`, `>` or whitespace');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tvalueStart = parser.pos;\n  \tstartDepth = parser.sectionDepth;\n\n  \tvalue = readQuotedAttributeValue(parser, '\\'') || readQuotedAttributeValue(parser, '\"') || readUnquotedAttributeValue(parser);\n\n  \tif (value === null) {\n  \t\tparser.error('Expected valid attribute value');\n  \t}\n\n  \tif (parser.sectionDepth !== startDepth) {\n  \t\tparser.pos = valueStart;\n  \t\tparser.error('An attribute value must contain as many opening section tags as closing section tags');\n  \t}\n\n  \tif (!value.length) {\n  \t\treturn '';\n  \t}\n\n  \tif (value.length === 1 && typeof value[0] === 'string') {\n  \t\treturn decodeCharacterReferences(value[0]);\n  \t}\n\n  \treturn value;\n  }\n\n  function readUnquotedAttributeValueToken(parser) {\n  \tvar start, text, haystack, needles, index;\n\n  \tstart = parser.pos;\n\n  \ttext = parser.matchPattern(unquotedAttributeValueTextPattern);\n\n  \tif (!text) {\n  \t\treturn null;\n  \t}\n\n  \thaystack = text;\n  \tneedles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n\n  \tif ((index = getLowestIndex(haystack, needles)) !== -1) {\n  \t\ttext = text.substr(0, index);\n  \t\tparser.pos = start + text.length;\n  \t}\n\n  \treturn text;\n  }\n\n  function readUnquotedAttributeValue(parser) {\n  \tvar tokens, token;\n\n  \tparser.inAttribute = true;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \t}\n\n  \tif (!tokens.length) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n  \treturn tokens;\n  }\n\n  function readQuotedAttributeValue(parser, quoteMark) {\n  \tvar start, tokens, token;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = quoteMark;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \t}\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n\n  \treturn tokens;\n  }\n\n  function readQuotedStringToken(parser, quoteMark) {\n  \tvar haystack = parser.remaining();\n\n  \tvar needles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n  \tneedles.push(quoteMark);\n\n  \tvar index = getLowestIndex(haystack, needles);\n\n  \tif (index === -1) {\n  \t\tparser.error('Quoted attribute value must have a closing quote');\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tparser.pos += index;\n  \treturn haystack.substr(0, index);\n  }\n\n  var tagNamePattern = /^[a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*/;\n  var validTagNameFollower = /^[\\s\\n\\/>]/;\n  var onPattern = /^on/;\n  var proxyEventPattern = /^on-([a-zA-Z\\\\*\\\\.$_][a-zA-Z\\\\*\\\\.$_0-9\\-]+)$/;\n  var reservedEventNames = /^(?:change|reset|teardown|update|construct|config|init|render|unrender|detach|insert)$/;\n  var directives = { 'intro-outro': 't0', intro: 't1', outro: 't2', decorator: 'o' };\n  var exclude = { exclude: true };\n  var disallowedContents;\n  // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission\n  disallowedContents = {\n  \tli: ['li'],\n  \tdt: ['dt', 'dd'],\n  \tdd: ['dt', 'dd'],\n  \tp: 'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(' '),\n  \trt: ['rt', 'rp'],\n  \trp: ['rt', 'rp'],\n  \toptgroup: ['optgroup'],\n  \toption: ['option', 'optgroup'],\n  \tthead: ['tbody', 'tfoot'],\n  \ttbody: ['tbody', 'tfoot'],\n  \ttfoot: ['tbody'],\n  \ttr: ['tr', 'tbody'],\n  \ttd: ['td', 'th', 'tr'],\n  \tth: ['td', 'th', 'tr']\n  };\n\n  function readElement(parser) {\n  \tvar start, element, directiveName, match, addProxyEvent, attribute, directive, selfClosing, children, partials, hasPartials, child, closed, pos, remaining, closingTag;\n\n  \tstart = parser.pos;\n\n  \tif (parser.inside || parser.inAttribute) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString('<')) {\n  \t\treturn null;\n  \t}\n\n  \t// if this is a closing tag, abort straight away\n  \tif (parser.nextChar() === '/') {\n  \t\treturn null;\n  \t}\n\n  \telement = {};\n  \tif (parser.includeLinePositions) {\n  \t\telement.p = parser.getLinePos(start);\n  \t}\n\n  \tif (parser.matchString('!')) {\n  \t\telement.t = DOCTYPE;\n  \t\tif (!parser.matchPattern(/^doctype/i)) {\n  \t\t\tparser.error('Expected DOCTYPE declaration');\n  \t\t}\n\n  \t\telement.a = parser.matchPattern(/^(.+?)>/);\n  \t\treturn element;\n  \t}\n\n  \telement.t = ELEMENT;\n\n  \t// element name\n  \telement.e = parser.matchPattern(tagNamePattern);\n  \tif (!element.e) {\n  \t\treturn null;\n  \t}\n\n  \t// next character must be whitespace, closing solidus or '>'\n  \tif (!validTagNameFollower.test(parser.nextChar())) {\n  \t\tparser.error('Illegal tag name');\n  \t}\n\n  \taddProxyEvent = function (name, directive) {\n  \t\tvar directiveName = directive.n || directive;\n\n  \t\tif (reservedEventNames.test(directiveName)) {\n  \t\t\tparser.pos -= directiveName.length;\n  \t\t\tparser.error('Cannot use reserved event names (change, reset, teardown, update, construct, config, init, render, unrender, detach, insert)');\n  \t\t}\n\n  \t\telement.v[name] = directive;\n  \t};\n\n  \tparser.allowWhitespace();\n\n  \t// directives and attributes\n  \twhile (attribute = readMustache(parser) || readAttribute(parser)) {\n  \t\t// regular attributes\n  \t\tif (attribute.name) {\n  \t\t\t// intro, outro, decorator\n  \t\t\tif (directiveName = directives[attribute.name]) {\n  \t\t\t\telement[directiveName] = processDirective(attribute.value, parser);\n  \t\t\t}\n\n  \t\t\t// on-click etc\n  \t\t\telse if (match = proxyEventPattern.exec(attribute.name)) {\n  \t\t\t\t\tif (!element.v) element.v = {};\n  \t\t\t\t\tdirective = processDirective(attribute.value, parser);\n  \t\t\t\t\taddProxyEvent(match[1], directive);\n  \t\t\t\t} else {\n  \t\t\t\t\tif (!parser.sanitizeEventAttributes || !onPattern.test(attribute.name)) {\n  \t\t\t\t\t\tif (!element.a) element.a = {};\n  \t\t\t\t\t\telement.a[attribute.name] = attribute.value || (attribute.value === '' ? '' : 0);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t}\n\n  \t\t// {{#if foo}}class='foo'{{/if}}\n  \t\telse {\n  \t\t\t\tif (!element.m) element.m = [];\n  \t\t\t\telement.m.push(attribute);\n  \t\t\t}\n\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// allow whitespace before closing solidus\n  \tparser.allowWhitespace();\n\n  \t// self-closing solidus?\n  \tif (parser.matchString('/')) {\n  \t\tselfClosing = true;\n  \t}\n\n  \t// closing angle bracket\n  \tif (!parser.matchString('>')) {\n  \t\treturn null;\n  \t}\n\n  \tvar lowerCaseName = element.e.toLowerCase();\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \tif (!selfClosing && !voidElementNames.test(element.e)) {\n  \t\tparser.elementStack.push(lowerCaseName);\n\n  \t\t// Special case - if we open a script element, further tags should\n  \t\t// be ignored unless they're a closing script element\n  \t\tif (lowerCaseName === 'script' || lowerCaseName === 'style') {\n  \t\t\tparser.inside = lowerCaseName;\n  \t\t}\n\n  \t\tchildren = [];\n  \t\tpartials = create(null);\n\n  \t\tdo {\n  \t\t\tpos = parser.pos;\n  \t\t\tremaining = parser.remaining();\n\n  \t\t\t// if for example we're in an <li> element, and we see another\n  \t\t\t// <li> tag, close the first so they become siblings\n  \t\t\tif (!canContain(lowerCaseName, remaining)) {\n  \t\t\t\tclosed = true;\n  \t\t\t}\n\n  \t\t\t// closing tag\n  \t\t\telse if (closingTag = readClosingTag(parser)) {\n  \t\t\t\t\tclosed = true;\n\n  \t\t\t\t\tvar closingTagName = closingTag.e.toLowerCase();\n\n  \t\t\t\t\t// if this *isn't* the closing tag for the current element...\n  \t\t\t\t\tif (closingTagName !== lowerCaseName) {\n  \t\t\t\t\t\t// rewind parser\n  \t\t\t\t\t\tparser.pos = pos;\n\n  \t\t\t\t\t\t// if it doesn't close a parent tag, error\n  \t\t\t\t\t\tif (! ~parser.elementStack.indexOf(closingTagName)) {\n  \t\t\t\t\t\t\tvar errorMessage = 'Unexpected closing tag';\n\n  \t\t\t\t\t\t\t// add additional help for void elements, since component names\n  \t\t\t\t\t\t\t// might clash with them\n  \t\t\t\t\t\t\tif (voidElementNames.test(closingTagName)) {\n  \t\t\t\t\t\t\t\terrorMessage += ' (<' + closingTagName + '> is a void element - it cannot contain children)';\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tparser.error(errorMessage);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// implicit close by closing section tag. TODO clean this up\n  \t\t\t\telse if (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (child = parser.read(PARTIAL_READERS)) {\n  \t\t\t\t\t\t\tif (partials[child.n]) {\n  \t\t\t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t\t\t\tparser.error('Duplicate partial definition');\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tcleanup(child.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\t\t\t\t\tpartials[child.n] = child.f;\n  \t\t\t\t\t\t\thasPartials = true;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tif (child = parser.read(READERS)) {\n  \t\t\t\t\t\t\t\tchildren.push(child);\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t} while (!closed);\n\n  \t\tif (children.length) {\n  \t\t\telement.f = children;\n  \t\t}\n\n  \t\tif (hasPartials) {\n  \t\t\telement.p = partials;\n  \t\t}\n\n  \t\tparser.elementStack.pop();\n  \t}\n\n  \tparser.inside = null;\n\n  \tif (parser.sanitizeElements && parser.sanitizeElements.indexOf(lowerCaseName) !== -1) {\n  \t\treturn exclude;\n  \t}\n\n  \treturn element;\n  }\n\n  function canContain(name, remaining) {\n  \tvar match, disallowed;\n\n  \tmatch = /^<([a-zA-Z][a-zA-Z0-9]*)/.exec(remaining);\n  \tdisallowed = disallowedContents[name];\n\n  \tif (!match || !disallowed) {\n  \t\treturn true;\n  \t}\n\n  \treturn ! ~disallowed.indexOf(match[1].toLowerCase());\n  }\n\n  var OPEN_COMMENT = '<!--';\n  var CLOSE_COMMENT = '-->';\n  function readHtmlComment(parser) {\n  \tvar start, content, remaining, endIndex, comment;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(OPEN_COMMENT)) {\n  \t\treturn null;\n  \t}\n\n  \tremaining = parser.remaining();\n  \tendIndex = remaining.indexOf(CLOSE_COMMENT);\n\n  \tif (endIndex === -1) {\n  \t\tparser.error('Illegal HTML - expected closing comment sequence (\\'-->\\')');\n  \t}\n\n  \tcontent = remaining.substr(0, endIndex);\n  \tparser.pos += endIndex + 3;\n\n  \tcomment = {\n  \t\tt: COMMENT,\n  \t\tc: content\n  \t};\n\n  \tif (parser.includeLinePositions) {\n  \t\tcomment.p = parser.getLinePos(start);\n  \t}\n\n  \treturn comment;\n  }\n\n  var partialDefinitionSectionPattern = /^#\\s*partial\\s+/;\n  function readPartialDefinitionSection(parser) {\n  \tvar start, name, content, child, closed;\n\n  \tstart = parser.pos;\n\n  \tvar delimiters = parser.standardDelimiters;\n\n  \tif (!parser.matchString(delimiters[0])) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(partialDefinitionSectionPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tname = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-\\/]*/);\n\n  \tif (!name) {\n  \t\tparser.error('expected legal partial name');\n  \t}\n\n  \tif (!parser.matchString(delimiters[1])) {\n  \t\tparser.error('Expected closing delimiter \\'' + delimiters[1] + '\\'');\n  \t}\n\n  \tcontent = [];\n\n  \tdo {\n  \t\t// TODO clean this up\n  \t\tif (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\tif (!child.r === 'partial') {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tn: name,\n  \t\tf: content\n  \t};\n  }\n\n  var __pattern = /[-/\\\\^$*+?.()|[\\]{}]/g;\n  function escapeRegExp(str) {\n  \treturn str.replace(__pattern, '\\\\$&');\n  }\n\n  var startPattern = /^<!--\\s*/;\n  var namePattern = /s*>\\s*([a-zA-Z_$][-a-zA-Z_$0-9]*)\\s*/;\n  var finishPattern = /\\s*-->/;\n\n  function readPartialDefinitionComment(parser) {\n  \tvar start = parser.pos;\n  \tvar open = parser.standardDelimiters[0];\n  \tvar close = parser.standardDelimiters[1];\n\n  \tif (!parser.matchPattern(startPattern) || !parser.matchString(open)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar name = parser.matchPattern(namePattern);\n\n  \twarnOnceIfDebug('Inline partial comments are deprecated.\\nUse this...\\n  {{#partial ' + name + '}} ... {{/partial}}\\n\\n...instead of this:\\n  <!-- {{>' + name + '}} --> ... <!-- {{/' + name + '}} -->\\'');\n\n  \t// make sure the rest of the comment is in the correct place\n  \tif (!parser.matchString(close) || !parser.matchPattern(finishPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar content = [];\n  \tvar closed = undefined;\n\n  \tvar endPattern = new RegExp('^<!--\\\\s*' + escapeRegExp(open) + '\\\\s*\\\\/\\\\s*' + name + '\\\\s*' + escapeRegExp(close) + '\\\\s*-->');\n\n  \tdo {\n  \t\tif (parser.matchPattern(endPattern)) {\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tvar child = parser.read(READERS);\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('expected closing comment (\\'<!-- ' + open + '/' + name + close + ' -->\\')');\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tf: content,\n  \t\tn: name\n  \t};\n  }\n\n  var TEMPLATE_VERSION = 3;\n\n  function readTemplate(parser) {\n  \tvar fragment = [];\n  \tvar partials = create(null);\n  \tvar hasPartials = false;\n\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \twhile (parser.pos < parser.str.length) {\n  \t\tvar pos = parser.pos,\n  \t\t    item = undefined,\n  \t\t    partial = undefined;\n\n  \t\tif (partial = parser.read(PARTIAL_READERS)) {\n  \t\t\tif (partials[partial.n]) {\n  \t\t\t\tparser.pos = pos;\n  \t\t\t\tparser.error('Duplicated partial definition');\n  \t\t\t}\n\n  \t\t\tcleanup(partial.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\tpartials[partial.n] = partial.f;\n  \t\t\thasPartials = true;\n  \t\t} else if (item = parser.read(READERS)) {\n  \t\t\tfragment.push(item);\n  \t\t} else {\n  \t\t\tparser.error('Unexpected template content');\n  \t\t}\n  \t}\n\n  \tvar result = {\n  \t\tv: TEMPLATE_VERSION,\n  \t\tt: fragment\n  \t};\n\n  \tif (hasPartials) {\n  \t\tresult.p = partials;\n  \t}\n\n  \treturn result;\n  }\n\n  // See https://github.com/ractivejs/template-spec for information\n  // about the Ractive template specification\n\n  var STANDARD_READERS = [readPartial, readUnescaped, readSection, readYielder, readInterpolator, readComment];\n  var TRIPLE_READERS = [readTriple];\n  var STATIC_READERS = [readUnescaped, readSection, readInterpolator]; // TODO does it make sense to have a static section?\n\n  var StandardParser = undefined;\n  function parse(template, options) {\n  \treturn new StandardParser(template, options || {}).result;\n  }\n\n  var READERS = [readMustache, readHtmlComment, readElement, readText];\n  var PARTIAL_READERS = [readPartialDefinitionComment, readPartialDefinitionSection];\n\n  StandardParser = Parser.extend({\n  \tinit: function (str, options) {\n  \t\tvar tripleDelimiters = options.tripleDelimiters || ['{{{', '}}}'],\n  \t\t    staticDelimiters = options.staticDelimiters || ['[[', ']]'],\n  \t\t    staticTripleDelimiters = options.staticTripleDelimiters || ['[[[', ']]]'];\n\n  \t\tthis.standardDelimiters = options.delimiters || ['{{', '}}'];\n\n  \t\tthis.tags = [{ isStatic: false, isTriple: false, open: this.standardDelimiters[0], close: this.standardDelimiters[1], readers: STANDARD_READERS }, { isStatic: false, isTriple: true, open: tripleDelimiters[0], close: tripleDelimiters[1], readers: TRIPLE_READERS }, { isStatic: true, isTriple: false, open: staticDelimiters[0], close: staticDelimiters[1], readers: STATIC_READERS }, { isStatic: true, isTriple: true, open: staticTripleDelimiters[0], close: staticTripleDelimiters[1], readers: TRIPLE_READERS }];\n\n  \t\tthis.sortMustacheTags();\n\n  \t\tthis.sectionDepth = 0;\n  \t\tthis.elementStack = [];\n\n  \t\tthis.interpolate = {\n  \t\t\tscript: !options.interpolate || options.interpolate.script !== false,\n  \t\t\tstyle: !options.interpolate || options.interpolate.style !== false\n  \t\t};\n\n  \t\tif (options.sanitize === true) {\n  \t\t\toptions.sanitize = {\n  \t\t\t\t// blacklist from https://code.google.com/p/google-caja/source/browse/trunk/src/com/google/caja/lang/html/html4-elements-whitelist.json\n  \t\t\t\telements: 'applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title'.split(' '),\n  \t\t\t\teventAttributes: true\n  \t\t\t};\n  \t\t}\n\n  \t\tthis.stripComments = options.stripComments !== false;\n  \t\tthis.preserveWhitespace = options.preserveWhitespace;\n  \t\tthis.sanitizeElements = options.sanitize && options.sanitize.elements;\n  \t\tthis.sanitizeEventAttributes = options.sanitize && options.sanitize.eventAttributes;\n  \t\tthis.includeLinePositions = options.includeLinePositions;\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\t// special case - empty string\n  \t\tif (!result.length) {\n  \t\t\treturn { t: [], v: TEMPLATE_VERSION };\n  \t\t}\n\n  \t\tif (this.sectionDepth > 0) {\n  \t\t\tthis.error('A section was left open');\n  \t\t}\n\n  \t\tcleanup(result[0].t, this.stripComments, this.preserveWhitespace, !this.preserveWhitespace, !this.preserveWhitespace);\n\n  \t\treturn result[0];\n  \t},\n\n  \tconverters: [readTemplate],\n\n  \tsortMustacheTags: function () {\n  \t\t// Sort in order of descending opening delimiter length (longer first),\n  \t\t// to protect against opening delimiters being substrings of each other\n  \t\tthis.tags.sort(function (a, b) {\n  \t\t\treturn b.open.length - a.open.length;\n  \t\t});\n  \t}\n  });\n\n  var _parseOptions = ['preserveWhitespace', 'sanitize', 'stripComments', 'delimiters', 'tripleDelimiters', 'interpolate'];\n\n  var _parser = {\n  \tfromId: fromId, isHashedId: isHashedId, isParsed: isParsed, getParseOptions: getParseOptions, createHelper: _createHelper,\n  \tparse: doParse\n  };\n\n  function _createHelper(parseOptions) {\n  \tvar helper = create(_parser);\n  \thelper.parse = function (template, options) {\n  \t\treturn doParse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function doParse(template, parseOptions) {\n  \tif (!parse) {\n  \t\tthrow new Error('Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser');\n  \t}\n\n  \treturn parse(template, parseOptions || this.options);\n  }\n\n  function fromId(id, options) {\n  \tif (!doc) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t}\n\n  \tif (isHashedId(id)) id = id.substring(1);\n\n  \tvar template = undefined;\n\n  \tif (!(template = doc.getElementById(id))) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Could not find template element with id #' + id);\n  \t}\n\n  \tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t}\n\n  \treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  }\n\n  function isHashedId(id) {\n  \treturn id && id[0] === '#';\n  }\n\n  function isParsed(template) {\n  \treturn !(typeof template === 'string');\n  }\n\n  function getParseOptions(ractive) {\n  \t// Could be Ractive or a Component\n  \tif (ractive.defaults) {\n  \t\tractive = ractive.defaults;\n  \t}\n\n  \treturn _parseOptions.reduce(function (val, key) {\n  \t\tval[key] = ractive[key];\n  \t\treturn val;\n  \t}, {});\n  }\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry(ractive, name, parentFragment || {});\n  \tif (partial) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = _parser.fromId(name, { noThrow: true });\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = _parser.parse(partial, _parser.getParseOptions(ractive));\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial(name, parentFragment.owner);\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tvar fn = undefined;\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, _parser);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!_parser.isParsed(partial)) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = _parser.parse(partial, _parser.getParseOptions(instance));\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (_Mustache) {\n  \tinherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\tclassCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.template.r ? getPartialTemplate(this.ractive, this.template.r, this.parentFragment) || null : null;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.template.r) {\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else {\n  \t\t\tthis.setTemplate(this.model.get());\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target) {\n  \t\tthis.fragment.render(target);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model && typeof this.model.get() === 'string' && this.model.get() !== this.name) {\n  \t\t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  function getRefs(ref, value, parent) {\n  \tvar refs = undefined;\n\n  \tif (ref) {\n  \t\trefs = {};\n  \t\tObject.keys(parent).forEach(function (ref) {\n  \t\t\trefs[ref] = parent[ref];\n  \t\t});\n  \t\trefs[ref] = value;\n  \t} else {\n  \t\trefs = parent;\n  \t}\n\n  \treturn refs;\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\tclassCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.iterations = [];\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.previousIterations = null;\n\n  \t\t// track array versus object so updates of type rest\n  \t\tthis.isArray = false;\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\tthis.isArray = false;\n\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar refs = this.indexRef.split(',');\n  \t\t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\t\tthis.indexRef = refs[1];\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar parentFragment = this.owner.parentFragment;\n  \t\tvar keyRefs = getRefs(this.keyRef, key, parentFragment.keyRefs);\n  \t\tvar indexRefs = getRefs(this.indexRef, index, parentFragment.indexRefs);\n\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template,\n  \t\t\tindexRefs: indexRefs,\n  \t\t\tkeyRefs: keyRefs\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\treturn this.iterations[iteration.index + 1].firstNode();\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode() : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(context.get())) {\n  \t\t\tthis.iterations.forEach(function (fragment, i) {\n  \t\t\t\tfragment.rebind(context.joinKey(i));\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this2 = this;\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthrow new Error('Section was already shuffled!');\n  \t\t}\n\n  \t\tthis.pendingNewIndices = newIndices;\n  \t\tthis.previousIterations = this.iterations.slice();\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this2.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : _toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind() {\n  \t\tthis.iterations.forEach(_unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? _unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this3 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.context.get(),\n  \t\t    wasArray = this.isArray;\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n  \t\tvar reset = true;\n  \t\tvar i = undefined;\n\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\tif (wasArray) {\n  \t\t\t\treset = false;\n  \t\t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (isObject(value) && !wasArray) {\n  \t\t\treset = false;\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\ti = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _fragment = this.iterations[i];\n  \t\t\t\tif (_fragment.key in value) {\n  \t\t\t\t\toldKeys[_fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(_fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (reset) {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(__update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tvar docFrag = undefined;\n  \t\tvar fragment = undefined;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\t\ti = this.iterations.length;\n\n  \t\t\tif (isArray(value)) {\n  \t\t\t\twhile (i < value.length) {\n  \t\t\t\t\tfragment = this.createIteration(i, i);\n\n  \t\t\t\t\tthis.iterations.push(fragment);\n  \t\t\t\t\tif (this.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t} else if (isObject(value)) {\n  \t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\tif (!oldKeys || !(key in oldKeys)) {\n  \t\t\t\t\t\tfragment = _this3.createIteration(key, i);\n\n  \t\t\t\t\t\t_this3.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this3.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\t\tvar anchor = this.parent.findNextNode(this.owner);\n\n  \t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this4 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices;\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar previousNewIndex = -1;\n  \t\tvar reinsertFrom = null;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this4.previousIterations[oldIndex];\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tfragment.rebind(_this4.context.joinKey(newIndex));\n\n  \t\t\t\tif (reinsertFrom === null && newIndex !== previousNewIndex + 1) {\n  \t\t\t\t\treinsertFrom = oldIndex;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tpreviousNewIndex = newIndex;\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar existingFragment = this.iterations[i];\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tif (existingFragment) {\n  \t\t\t\t\tif (reinsertFrom !== null && i >= reinsertFrom) {\n  \t\t\t\t\t\tdocFrag.appendChild(existingFragment.detach());\n  \t\t\t\t\t} else if (docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, existingFragment.firstNode());\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!this.rendered) {\n  \t\t\t\tif (!existingFragment) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(__update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \tinherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\tclassCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tvar value = this.model.parent ? this.model.get() : this.model.value;\n  \t\t\tvar fragment = undefined;\n\n  \t\t\tif (!this.sectionType) this.sectionType = getType(value, this.template.i);\n\n  \t\t\tif (isEmpty(value) && this.sectionType !== SECTION_WITH) {\n  \t\t\t\t// TODO again, WITH should not render if empty\n  \t\t\t\tif (this.sectionType === SECTION_UNLESS) {\n  \t\t\t\t\tthis.fragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind();\n  \t\t\t\t}\n\n  \t\t\t\t// otherwise, create no children\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (this.sectionType === SECTION_UNLESS) return;\n\n  \t\t\tif (this.sectionType === SECTION_IF) {\n  \t\t\t\tfragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind();\n  \t\t\t}\n\n  \t\t\t// TODO should only be WITH, and it should behave like IF_WITH\n  \t\t\telse if (this.sectionType === SECTION_WITH || this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t} else {\n  \t\t\t\t\tfragment = new RepeatedFragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n\n  \t\t\tthis.fragment = fragment;\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO DRY this out - lot of repeated stuff between this and bind()\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model) return; // TODO can this happen?\n\n  \t\tvar value = this.model.get();\n\n  \t\tif (this.sectionType === null) this.sectionType = getType(value, this.template.i);\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO same comment as before - WITH should be IF_WITH\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value;\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n\n  var ieBug = undefined;\n  var ieBlacklist = undefined;\n\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif (html == null || html === '') return nodes;\n\n  \tvar container = undefined;\n  \tvar wrapper = undefined;\n  \tvar selectedOption = undefined;\n\n  \tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\tcontainer = _element('DIV');\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector('.x');\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t} else if (node.namespaceURI === svg) {\n  \t\tcontainer = _element('DIV');\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector('.x');\n  \t} else {\n  \t\tcontainer = _element(node.tagName);\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t}\n\n  \tvar child = undefined;\n  \twhile (child = container.firstChild) {\n  \t\tnodes.push(child);\n  \t\tdocFrag.appendChild(child);\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i = undefined;\n  \tif (node.tagName === 'SELECT') {\n  \t\ti = nodes.length;\n  \t\twhile (i--) {\n  \t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function _element(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  var Triple = (function (_Mustache) {\n  \tinherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\tclassCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn node.parentNode.removeChild(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  var Yielder = (function (_Item) {\n  \tinherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\tclassCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthrow new Error('Yielder$rebind is not yet implemented!');\n  \t};\n\n  \tYielder.prototype.render = function render(target) {\n  \t\treturn this.fragment.render(target);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var ___prefix = undefined;\n\n  if (!isClient) {\n  \t___prefix = null;\n  } else {\n  \t(function () {\n  \t\tvar prefixCache = {};\n  \t\tvar testStyle = createElement('div').style;\n\n  \t\t___prefix = function (prop) {\n  \t\t\tprop = camelCase(prop);\n\n  \t\t\tif (!prefixCache[prop]) {\n  \t\t\t\tif (testStyle[prop] !== undefined) {\n  \t\t\t\t\tprefixCache[prop] = prop;\n  \t\t\t\t} else {\n  \t\t\t\t\t// test vendors...\n  \t\t\t\t\tvar capped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\t\tvar i = vendors.length;\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\t\tif (testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\t\tbreak;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn prefixCache[prop];\n  \t\t};\n  \t})();\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  function interpolate(from, to, ractive, type) {\n  \tif (from === to) return null;\n\n  \tif (type) {\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) return interpol(from, to) || null;\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators.number(from, to) || interpolators.array(from, to) || interpolators.object(from, to) || null;\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tif (!str) return ''; // edge case\n\n  \tif (vendorPattern.test(str)) str = '-' + str;\n\n  \treturn str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n  }\n\n  var createTransitions = undefined;\n\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \t(function () {\n  \t\tvar testStyle = createElement('div').style;\n  \t\tvar linear = function (x) {\n  \t\t\treturn x;\n  \t\t};\n\n  \t\tvar canUseCssTransitions = {};\n  \t\tvar cannotUseCssTransitions = {};\n\n  \t\t// determine some facts about our environment\n  \t\tvar TRANSITION = undefined;\n  \t\tvar TRANSITIONEND = undefined;\n  \t\tvar CSS_TRANSITIONS_ENABLED = undefined;\n  \t\tvar TRANSITION_DURATION = undefined;\n  \t\tvar TRANSITION_PROPERTY = undefined;\n  \t\tvar TRANSITION_TIMING_FUNCTION = undefined;\n\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n\n  \t\tif (TRANSITION) {\n  \t\t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t\t}\n\n  \t\tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t\t// TODO use a fastdom-style mechanism?\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar jsTransitionsComplete = undefined;\n  \t\t\t\tvar cssTransitionsComplete = undefined;\n\n  \t\t\t\tfunction checkComplete() {\n  \t\t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\t\tt.ractive.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\t\tresolve();\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t\t// which properties\n  \t\t\t\tvar hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(___prefix).map(hyphenate).join(',');\n  \t\t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\t\tfunction transitionEndHandler(event) {\n  \t\t\t\t\tvar index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t\t// still transitioning...\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n\n  \t\t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tsetTimeout(function () {\n  \t\t\t\t\tvar i = changedProperties.length;\n  \t\t\t\t\tvar hash = undefined;\n  \t\t\t\t\tvar originalValue = undefined;\n  \t\t\t\t\tvar index = undefined;\n  \t\t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\t\tvar prop = undefined;\n  \t\t\t\t\tvar suffix = undefined;\n  \t\t\t\t\tvar interpolator = undefined;\n\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\tt.node.style[___prefix(prop)] = to[prop];\n\n  \t\t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\t\tt.node.style[___prefix(prop)] = originalValue;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n  \t\t\t\t\t\t\tinterpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop])) || function () {\n  \t\t\t\t\t\t\t\treturn to[prop];\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\t\tname: ___prefix(prop),\n  \t\t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// javascript transitions\n  \t\t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\t\tvar easing = undefined;\n\n  \t\t\t\t\t\tif (typeof options.easing === 'string') {\n  \t\t\t\t\t\t\teasing = t.ractive.easing[options.easing];\n\n  \t\t\t\t\t\t\tif (!easing) {\n  \t\t\t\t\t\t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else if (typeof options.easing === 'function') {\n  \t\t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\t\tvar _prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\t\tt.node.style[_prop.name] = _prop.interpolator(pos) + _prop.suffix;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t},\n  \t\t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t}\n  \t\t\t\t}, 0);\n  \t\t\t}, options.delay || 0);\n  \t\t};\n  \t})();\n  }\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar __prefix = undefined;\n\n  \tif (hidden in doc) {\n  \t\t__prefix = '';\n  \t} else {\n  \t\tvar _i = vendors.length;\n  \t\twhile (_i--) {\n  \t\t\tvar vendor = vendors[_i];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\t__prefix = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (__prefix !== undefined) {\n  \t\tdoc.addEventListener(__prefix + 'visibilitychange', onChange);\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  var getComputedStyle = win && (win.getComputedStyle || exportedShims.getComputedStyle);\n  var resolved = _Promise.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\tclassCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tvar propertyNames = Object.keys(to);\n  \t\t\tvar changedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tvar computedStyle = getComputedStyle(_this.node);\n\n  \t\t\tvar i = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar prop = propertyNames[i];\n  \t\t\t\tvar current = computedStyle[___prefix(prop)];\n\n  \t\t\t\tif (current === '0px') current = 0;\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[___prefix(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions(_this, to, options, changedProperties, fulfil);\n  \t\t});\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvar value = computedStyle[___prefix(props)];\n  \t\t\treturn value === '0px' ? 0 : value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tvar styles = {};\n\n  \t\tvar i = props.length;\n  \t\twhile (i--) {\n  \t\t\tvar prop = props[i];\n  \t\t\tvar value = computedStyle[___prefix(prop)];\n\n  \t\t\tif (value === '0px') value = 0;\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn __extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[___prefix(style)] = value;\n  \t\t} else {\n  \t\t\tvar prop = undefined;\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[___prefix(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar originalStyle = node.getAttribute('style');\n\n  \t\tvar completed = undefined;\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.root, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function _updateLiveQueries(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n  \t\tclassCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  function handleBlur() {\n  \thandleDomEvent.call(this);\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \tinherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\tclassCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  var SingleSelectBinding = (function (_Binding) {\n  \tinherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\tclassCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i = undefined;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  var MultipleSelectBinding = (function (_Binding) {\n  \tinherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\tclassCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  var NumericBinding = (function (_GenericBinding) {\n  \tinherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\tclassCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  var CheckboxBinding = (function (_Binding) {\n  \tinherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\tclassCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \tinherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\tclassCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\t// TODO this should use getBindingGroup\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  var groups = {};\n  function getBindingGroup(id, group, model, getValue) {\n  \tvar hash = id + group + model.getKeypath();\n  \treturn groups[hash] || (groups[hash] = new BindingGroup(model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(model, getValue) {\n  \t\tclassCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.getValue = getValue;\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  function isChecked(binding) {\n  \treturn binding.node.checked;\n  }\n\n  function _getValue(binding) {\n  \treturn binding.element.getAttribute('value');\n  }\n\n  function _getGroupValue() {\n  \treturn this.bindings.filter(isChecked).map(_getValue);\n  }\n\n  var push = [].push;\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \tinherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\tclassCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup(this.ractive._guid, 'checkboxes', this.model, _getGroupValue);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\t\tpush.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true;\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.getValue();\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  function getGroupValue() {\n  \tvar i = this.bindings.length;\n  \twhile (i--) {\n  \t\tvar binding = this.bindings[i];\n  \t\tif (binding.node.checked) return binding.element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \tinherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\tclassCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup(this.ractive._guid, 'radioname', this.model, getGroupValue);\n  \t\tthis.group.add(this);\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  var ContentEditableBinding = (function (_Binding) {\n  \tinherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\tclassCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = keypath.split('.');\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event && !event.component) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = (function () {\n  \tfunction EventDirective(owner, event, template) {\n  \t\tclassCallCheck(this, EventDirective);\n\n  \t\tthis.owner = owner;\n  \t\tthis.event = event;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n\n  \t\tthis.context = null;\n  \t\tthis.passthru = false;\n\n  \t\t// method calls\n  \t\tthis.method = null;\n  \t\tthis.resolvers = null;\n  \t\tthis.models = null;\n  \t\tthis.argsFn = null;\n\n  \t\t// handler directive\n  \t\tthis.action = null;\n  \t\tthis.args = null;\n  \t}\n\n  \tEventDirective.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\tif (this.passthru = template.g) {\n  \t\t\t\t// on-click=\"foo(...arguments)\"\n  \t\t\t\t// no models or args, just pass thru values\n  \t\t\t} else {\n  \t\t\t\t\tthis.resolvers = [];\n  \t\t\t\t\tthis.models = template.a.r.map(function (ref, i) {\n  \t\t\t\t\t\tif (eventPattern.test(ref)) {\n  \t\t\t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\t\t\tkeys: ref.length > 5 ? ref.slice(6).split('.') : [],\n  \t\t\t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar argMatch = argumentsPattern.exec(ref);\n  \t\t\t\t\t\tif (argMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar dollarMatch = dollarArgsPattern.exec(ref);\n  \t\t\t\t\t\tif (dollarMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar resolver = undefined;\n\n  \t\t\t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\tresolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t\t});\n\n  \t\t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\treturn model;\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis.argsFn = createFunction(template.a.s, template.a.r.length);\n  \t\t\t\t}\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventDirective.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.fire = function fire(event, passedArgs) {\n  \t\t// augment event object\n  \t\tif (event) {\n  \t\t\tevent.keypath = this.context.getKeypath();\n  \t\t\tevent.context = this.context.get();\n  \t\t\tevent.index = this.parentFragment.indexRefs;\n\n  \t\t\tif (passedArgs) passedArgs.unshift(event);\n  \t\t}\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar args = undefined;\n\n  \t\t\tif (this.passthru) {\n  \t\t\t\targs = passedArgs;\n  \t\t\t} else {\n  \t\t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tif (model.event) {\n  \t\t\t\t\t\tvar obj = event;\n  \t\t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\t\treturn obj;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.argument) {\n  \t\t\t\t\t\treturn passedArgs ? passedArgs[model.index] : void 0;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.wrapper) {\n  \t\t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n\n  \t\t\t\targs = this.argsFn.apply(null, values);\n  \t\t\t}\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar ractive = this.ractive;\n  \t\t\tvar oldEvent = ractive.event;\n\n  \t\t\tractive.event = event;\n  \t\t\tractive[this.method].apply(ractive, args);\n  \t\t\tractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tif (event) event.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.rebind = function rebind() {\n  \t\tthrow new Error('EventDirective$rebind not yet implemented!'); // TODO add tests\n  \t};\n\n  \tEventDirective.prototype.render = function render() {\n  \t\tthis.event.listen(this);\n  \t};\n\n  \tEventDirective.prototype.unbind = function unbind() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.resolvers.forEach(_unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models.forEach(function (model) {\n  \t\t\t\tif (model) model.unbind();\n  \t\t\t});\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.unrender = function unrender() {\n  \t\tthis.event.unlisten();\n  \t};\n\n  \tEventDirective.prototype.update = function update() {\n  \t\tif (this.method) return; // nothing to do\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn EventDirective;\n  })();\n\n  var DOMEvent = (function () {\n  \tfunction DOMEvent(name, owner) {\n  \t\tclassCallCheck(this, DOMEvent);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.name = name;\n  \t\tthis.owner = owner;\n  \t\tthis.node = null;\n  \t\tthis.handler = null;\n  \t}\n\n  \tDOMEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar name = this.name;\n\n  \t\tif (!('on' + name in node)) {\n  \t\t\tmissingPlugin(name, 'events');\n  \t\t}\n\n  \t\tnode.addEventListener(name, this.handler = function (event) {\n  \t\t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false);\n  \t};\n\n  \tDOMEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.node.removeEventListener(this.name, this.handler, false);\n  \t};\n\n  \treturn DOMEvent;\n  })();\n\n  var CustomEvent = (function () {\n  \tfunction CustomEvent(eventPlugin, owner) {\n  \t\tclassCallCheck(this, CustomEvent);\n\n  \t\tthis.eventPlugin = eventPlugin;\n  \t\tthis.owner = owner;\n  \t\tthis.handler = null;\n  \t}\n\n  \tCustomEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.owner.node;\n\n  \t\tthis.handler = this.eventPlugin(node, function () {\n  \t\t\tvar event = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n  \t\t\tevent.node = event.node || node;\n  \t\t\tdirective.fire(event);\n  \t\t});\n  \t};\n\n  \tCustomEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.teardown();\n  \t};\n\n  \treturn CustomEvent;\n  })();\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\tclassCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\tmissingPlugin(this.name, 'decorators');\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tthis.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (this.dynamicName) {\n  \t\t\tvar _name = this.nameFragment.toString();\n\n  \t\t\tif (_name !== this.name) {\n  \t\t\t\tthis.name = _name;\n  \t\t\t\tthis.unrender();\n  \t\t\t\tthis.render();\n  \t\t\t}\n  \t\t} else if (this.intermediary.update) {\n  \t\t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t} else {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  var div = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \tinherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\tclassCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthrow new Error('ConditionalAttribute$rebind is not yet implemented'); // TODO test\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tvar str = undefined;\n  \t\tvar attrs = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes(str, this.isSvg);\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter(function (a) {\n  \t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \tdiv.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>';\n\n  \treturn toArray(div.childNodes[0].attributes);\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === _html)) return updateClassName;\n\n  \tif (attribute.useProperty) return updateProperty;\n\n  \tif (attribute.namespace) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateProperty() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tthis.node[this.propertyName] = this.getValue();\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name, safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  function determineNameAndNamespace (attribute, name) {\n  \t// are we dealing with a namespaced attribute, e.g. xlink:href?\n  \tvar colonIndex = name.indexOf(':');\n  \tif (colonIndex !== -1) {\n  \t\t// looks like we are, yes...\n  \t\tvar namespacePrefix = name.substr(0, colonIndex);\n\n  \t\t// ...unless it's a namespace *declaration*, which we ignore (on the assumption\n  \t\t// that only valid namespaces will be used)\n  \t\tif (namespacePrefix !== 'xmlns') {\n  \t\t\tname = name.substring(colonIndex + 1);\n\n  \t\t\tattribute.name = name;\n  \t\t\tattribute.namespace = namespaces[namespacePrefix.toLowerCase()];\n  \t\t\tattribute.namespacePrefix = namespacePrefix;\n\n  \t\t\tif (!attribute.namespace) {\n  \t\t\t\tthrow 'Unknown namespace (\"' + namespacePrefix + '\")';\n  \t\t\t}\n\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tattribute.name = name;\n  }\n\n  var Attribute = (function (_Item) {\n  \tinherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\tclassCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tdetermineNameAndNamespace(this, options.name);\n\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === _html) {\n  \t\t\tvar propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[propertyName] !== undefined) {\n  \t\t\t\tthis.propertyName = propertyName;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\tif (propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || (this.element.name === 'select' || this.element.name === 'textarea'))) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case – bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator) {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  function __makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \tinherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\tvar fn = findInViewHierarchy('events', _this.ractive, eventName);\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent(fn, _this) : new DOMEvent(eventName, _this);\n  \t\t\t\t\t_this.eventHandlers.push(new EventDirective(_this, event, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(__bind);\n  \t\tthis.conditionalAttributes.forEach(__bind);\n  \t\tthis.eventHandlers.forEach(__bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n\n  \t\tvar parentNode = this.node.parentNode;\n  \t\tif (parentNode) parentNode.removeChild(this.node);\n\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind() {\n  \t\tthis.attributes.forEach(_rebind);\n  \t\tthis.conditionalAttributes.forEach(_rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(__makeDirty);\n  \t};\n\n  \tElement.prototype.render = function render(target) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\tthis.node = node;\n\n  \t\tvar context = this.parentFragment.findContext();\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tractive: this.ractive,\n  \t\t\t\tfragment: this.parentFragment,\n  \t\t\t\tcontext: context,\n  \t\t\t\tkeypath: context.getKeypath()\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.render(node);\n  \t\t}\n\n  \t\tthis.attributes.forEach(__render);\n  \t\tthis.conditionalAttributes.forEach(__render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(__render);\n\n  \t\t_updateLiveQueries(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\ttarget.appendChild(node);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind() {\n  \t\tthis.attributes.forEach(_unbind);\n  \t\tthis.conditionalAttributes.forEach(_unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(_unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.attributes.forEach(__update);\n  \t\t\tthis.conditionalAttributes.forEach(__update);\n  \t\t\tthis.eventHandlers.forEach(__update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return _html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Input = (function (_Element) {\n  \tinherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\tclassCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \tinherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\tclassCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.sync();\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \tinherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\tclassCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  var Form = (function (_Element) {\n  \tinherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\tclassCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(_updateModel);\n  \trunloop.end();\n  }\n\n  function _updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  var RactiveEvent = (function () {\n  \tfunction RactiveEvent(ractive, name) {\n  \t\tclassCallCheck(this, RactiveEvent);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.name = name;\n  \t\tthis.handler = null;\n  \t}\n\n  \tRactiveEvent.prototype.listen = function listen(directive) {\n  \t\tvar ractive = this.ractive;\n\n  \t\tthis.handler = ractive.on(this.name, function () {\n  \t\t\tvar event = undefined;\n\n  \t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n\n  \t\t\tvar args = Array.prototype.slice.call(arguments);\n  \t\t\tdirective.fire(event, args);\n\n  \t\t\t// cancel bubbling\n  \t\t\treturn false;\n  \t\t});\n  \t};\n\n  \tRactiveEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.cancel();\n  \t};\n\n  \treturn RactiveEvent;\n  })();\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  var _css;\n  var _update;\n  var styleElement;\n  var head;\n  var styleSheet;\n  var inDom;\n  var _prefix = '/* Ractive.js component styles */\\n';\n  var styles = [];\n  var dirty = false;\n  if (!doc) {\n  \t// TODO handle encapsulated CSS in server-rendered HTML!\n  \t_css = {\n  \t\tadd: noop,\n  \t\tapply: noop\n  \t};\n  } else {\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \thead = doc.getElementsByTagName('head')[0];\n\n  \tinDom = false;\n\n  \t// Internet Exploder won't let you use styleSheet.innerHTML - we have to\n  \t// use styleSheet.cssText instead\n  \tstyleSheet = styleElement.styleSheet;\n\n  \t_update = function () {\n  \t\tvar css = _prefix + styles.map(function (s) {\n  \t\t\treturn '\\n/* {' + s.id + '} */\\n' + s.styles;\n  \t\t}).join('\\n');\n\n  \t\tif (styleSheet) {\n  \t\t\tstyleSheet.cssText = css;\n  \t\t} else {\n  \t\t\tstyleElement.innerHTML = css;\n  \t\t}\n\n  \t\tif (!inDom) {\n  \t\t\thead.appendChild(styleElement);\n  \t\t\tinDom = true;\n  \t\t}\n  \t};\n\n  \t_css = {\n  \t\tadd: function (s) {\n  \t\t\tstyles.push(s);\n  \t\t\tdirty = true;\n  \t\t},\n\n  \t\tapply: function () {\n  \t\t\tif (dirty) {\n  \t\t\t\t_update();\n  \t\t\t\tdirty = false;\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  var _renderHook = new Hook('render');\n  var _completeHook = new Hook('complete');\n  function _render(ractive, target, anchor) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn _renderHook.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) _css.apply();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn _completeHook.fire(ractive);\n  \t});\n  }\n\n  function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function _fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\t_fire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\tclassCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\t_fire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function (Parent, proto, options) {\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseIfString(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseIfString(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive);\n\n  \t\tif (result) {\n  \t\t\tvar parsed = parseIfString(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\tresult = parseIfString(result, ractive);\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \tvar helper = createHelper(_parser.getParseOptions(ractive));\n  \treturn fn.call(ractive, helper);\n  }\n\n  function createHelper(parseOptions) {\n  \tvar helper = create(_parser);\n  \thelper.parse = function (template, options) {\n  \t\treturn _parser.parse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function parseIfString(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// ID of an element containing the template?\n  \t\tif (template[0] === '#') {\n  \t\t\ttemplate = _parser.fromId(template);\n  \t\t}\n\n  \t\ttemplate = parse(template, _parser.getParseOptions(ractive));\n  \t}\n\n  \t// Check that the template even exists\n  \telse if (template == undefined) {\n  \t\t\tthrow new Error('The template cannot be ' + template + '.');\n  \t\t}\n\n  \t\t// Check the parsed template has a version at all\n  \t\telse if (typeof template.v !== 'number') {\n  \t\t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t\t}\n\n  \t\t\t// Check we're using the correct version\n  \t\t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t\t}\n\n  \treturn template;\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined;\n  \t\tvar value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = __combine(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = __combine(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') result = result.call(ractive);\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif (result && result.constructor === Object) {\n  \t\t\tfor (var prop in result) {\n  \t\t\t\tif (typeof result[prop] === 'function') result[prop] = _bind(result[prop], ractive);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function __combine(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>\\~:]))+)((?::[^\\s\\+\\>\\~\\(]+(?:\\([^\\)]+\\))?)?\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var mediaQueryPattern = /^@media/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim(str) {\n  \treturn str.trim();\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  function transformSelector(selector, parent) {\n  \tvar selectorUnits = [];\n  \tvar match = undefined;\n\n  \twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map(extractString);\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile (i--) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t}\n\n  \treturn transformed.join(', ');\n  }\n  function transformCss(css, id) {\n  \tvar dataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \tvar transformed = undefined;\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\t// don't transform media queries!\n  \t\t\tif (mediaQueryPattern.test($1)) return match;\n\n  \t\t\tvar selectors = $1.split(',').map(trim);\n  \t\t\tvar transformed = selectors.map(function (selector) {\n  \t\t\t\treturn transformSelector(selector, dataAttr);\n  \t\t\t}).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  var _uid = 1;\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \textend: function (Parent, proto, options) {\n  \t\tif (options.css) {\n  \t\t\tvar id = _uid++;\n  \t\t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\t\tproto.cssId = id;\n  \t\t\t_css.add({ id: id, styles: styles });\n  \t\t}\n  \t},\n\n  \tinit: function () {}\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = _combine(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function _combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var _registryNames = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var Registry = (function () {\n  \tfunction Registry(name, useDefaults) {\n  \t\tclassCallCheck(this, Registry);\n\n  \t\tthis.name = name;\n  \t\tthis.useDefaults = useDefaults;\n  \t}\n\n  \tRegistry.prototype.extend = function extend(Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t};\n\n  \tRegistry.prototype.init = function init() {\n  \t\t// noop\n  \t};\n\n  \tRegistry.prototype.configure = function configure(Parent, target, options) {\n  \t\tvar name = this.name;\n  \t\tvar option = options[name];\n\n  \t\tvar registry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t};\n\n  \tRegistry.prototype.reset = function reset(ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn changed;\n  \t};\n\n  \treturn Registry;\n  })();\n\n  var registries = _registryNames.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) return method;\n\n  \tfunction wrapper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name);\n  \t\tvar hasSuper = ('_super' in this);\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tif (name in parent) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar value = parent[name];\n\n  \t\t\treturn {\n  \t\t\t\tv: typeof value === 'function' ? value : function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \treturn noop;\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys(_defaults);\n\n  var isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  var order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  var config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn _configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn _configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function _configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \tvar fragment = undefined;\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds,\n  \t\t\tindexRefs: options.indexRefs || {},\n  \t\t\tkeyRefs: options.keyRefs || {}\n  \t\t}).bind(ractive.viewmodel);\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \tif (fragment) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var _pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function createFunctionFromString(ractive, str) {\n  \tvar hasThis = undefined;\n\n  \tvar functionBody = 'return (' + str.replace(_pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) functionBody = 'var __ractive = this; ' + functionBody;\n\n  \tvar fn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(ractive) : fn;\n  }\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = _bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(ractive, signature);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(ractive, signature.get);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = _bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = _bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \tinherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\tclassCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n  \t\tthis.key = key; // not actually used, but helps with debugging\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t\tthis.dirty = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tComputation.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed value \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  var RootModel = (function (_Model) {\n  \tinherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\tclassCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tvar _this = this;\n\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = __extend({}, this.value);\n\n  \t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\tresult[key] = _this.mappings[key].value;\n  \t\t});\n\n  \t\tObject.keys(this.computations).forEach(function (key) {\n  \t\t\tif (key[0] !== '@') {\n  \t\t\t\t// exclude template expressions\n  \t\t\t\tresult[key] = _this.computations[key].value;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\treturn key in this.mappings || key in this.computations || _Model.prototype.has.call(this, key);\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this2 = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this2.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods;\n\n  var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\tclassCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatchArrayMethods(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatchArrayMethods.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + key : key;\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var MagicArrayWrapper = (function () {\n  \tfunction MagicArrayWrapper(ractive, array, keypath) {\n  \t\tclassCallCheck(this, MagicArrayWrapper);\n\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tMagicArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicArrayWrapper.prototype.teardown = function teardown() {\n  \t\tthis.arrayWrapper.teardown();\n  \t\tthis.magicWrapper.teardown();\n  \t};\n\n  \tMagicArrayWrapper.prototype.reset = function reset(value) {\n  \t\treturn this.magicWrapper.reset(value);\n  \t};\n\n  \treturn MagicArrayWrapper;\n  })();\n\n  var magicArrayAdaptor = {\n  \tfilter: function (object, keypath, ractive) {\n  \t\treturn magicAdaptor.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t},\n\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = __extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = __extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tvar adapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tvar magic$$ = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic$$) {\n  \t\tif (!magic) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \tif (!ractive.component) {\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function _makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \tinherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\tclassCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n  \t\t\t\tvar fragment = undefined;\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tmodel = _resolve(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tindexRefs: this.instance.isolated ? {} : this.parentFragment.indexRefs,\n  \t\t\tkeyRefs: this.instance.isolated ? {} : this.parentFragment.keyRefs,\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach(__bind);\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode() {\n  \t\treturn this.instance.fragment.firstNode();\n  \t};\n\n  \tComponent.prototype.rebind = function rebind() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(_rebind);\n\n  \t\tthis.liveQueries.forEach(_makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this3.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n\n  \t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\tmodel = _resolve(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render(target) {\n  \t\t_render(this.instance, target, null);\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(__render);\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\tvar eventNames = key.split('-');\n  \t\t\tvar template = _this4.template.v[key];\n\n  \t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\tvar event = new RactiveEvent(_this4.instance, eventName);\n  \t\t\t\thandlers.push(new EventDirective(_this4, event, template));\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind() {\n  \t\tthis.complexMappings.forEach(_unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(_cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tteardownHook.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach(_unrender);\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(__update);\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  // finds the component constructor in the registry or view hierarchy registries\n\n  function getComponentConstructor(ractive, name) {\n  \tvar instance = findInstance('components', ractive, name);\n  \tvar Component = undefined;\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var Text = (function (_Item) {\n  \tinherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\tclassCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\tif (!this.node.parentNode) {\n  \t\t\tthrow new Error('TODO an unexpected situation arose');\n  \t\t}\n  \t\treturn this.node.parentNode.removeChild(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target) {\n  \t\tthis.node = doc.createTextNode(this.template);\n  \t\ttarget.appendChild(this.node);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  var constructors = {};\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Input // it may turn out we need a separate Textarea class, but until then...\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\tclassCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.indexRefs = options.indexRefs || (this.parent ? this.parent.indexRefs : []);\n  \t\tthis.keyRefs = options.keyRefs || (this.parent ? this.parent.keyRefs : {});\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(__bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\tvar nextItem = this.items[item.index + 1];\n\n  \t\tif (nextItem) return nextItem.firstNode();\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.items[0] ? this.items[0].firstNode() : this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(_rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : _toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind() {\n  \t\tthis.items.forEach(_unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.items.forEach(__update);\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate(template) {\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif (component) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif (component) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind();\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n  \tthis.fragment.bind(this.viewmodel);\n\n  \tthis.render(this.el, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && item.name === name) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function _forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(_forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others) others.forEach(_teardown);\n\n  \t\t// make sure we are the only occupants\n  \t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t}\n\n  \treturn _render(this, target, anchor);\n  }\n\n  var _push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function _trim (str) {\n    return str.trim();\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \t// allow mutliple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tvar _ret = (function () {\n  \t\t\tvar listeners = [];\n  \t\t\tvar n = undefined;\n\n  \t\t\tfor (n in eventName) {\n  \t\t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\t\tlisteners.push(_this.on(n, eventName[n]));\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn {\n  \t\t\t\tv: {\n  \t\t\t\t\tcancel: function () {\n  \t\t\t\t\t\tvar listener = undefined;\n  \t\t\t\t\t\twhile (listener = listeners.pop()) listener.cancel();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split(' ').map(_trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split(' ').map(_trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers = _this._subs[eventName];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tvar index = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = __extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = __extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\tclassCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n  \tvar map = undefined;\n\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\tvar callback = map[keypath];\n\n  \t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t});\n  \t\t});\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(_cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\tif (!viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(options.context || ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(options.context || ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(context, model, callback, options) {\n  \t\tclassCallCheck(this, Observer);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(context, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\tclassCallCheck(this, PatternObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath();\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath()] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tbaseModel.register(this);\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\tvar args = [newValue, oldValue, keypath].concat(wildcards);\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath();\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif (parentFragment) return parentFragment.owner;\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry = [item];\n  \tvar ancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\tclassCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tvar selector = this.selector;\n\n  \t\tvar index = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n  \t\tif (index !== -1) this.result.splice(index, 1);\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tif (!this.el) return [];\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) {\n  \t\treturn null;\n  \t}\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  var noAnimation = { stop: noop };\n  var linear = easing.linear;\n\n  function getOptions(options, instance) {\n  \toptions = options || {};\n\n  \tvar easing = undefined;\n  \tif (options.easing) {\n  \t\teasing = typeof options.easing === 'function' ? options.easing : instance.easing[options.easing];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n  function Ractive$animate(keypath, to, options) {\n  \tif (typeof keypath === 'object') {\n  \t\tvar keys = Object.keys(keypath);\n\n  \t\tthrow new Error('ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  ' + keys.map(function (key) {\n  \t\t\treturn '\\'' + key + '\\': ' + keypath[key];\n  \t\t}).join('\\n  ') + '\\n}, {...}), do\\n\\n' + keys.map(function (key) {\n  \t\t\treturn 'ractive.animate(\\'' + key + '\\', ' + keypath[key] + ', {...});';\n  \t\t}).join('\\n') + '\\n');\n  \t}\n\n  \toptions = getOptions(options);\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\toptions.complete(options.to);\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate(from, to, this, options.interpolator);\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif (!interpolator) {\n  \t\trunloop.start();\n  \t\tmodel.set(to);\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate(from, to, options, interpolator);\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn _add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var _proto = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: _push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn {\n  \t\tractive: storage.ractive,\n  \t\tkeypath: storage.context.getKeypath(),\n  \t\tindex: __extend({}, storage.fragment.indexRefs),\n  \t\tkey: __extend({}, storage.fragment.keyRefs)\n  \t};\n  }\n\n  function _wrap (method, superMethod, force) {\n\n  \tif (force || needsSuper(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = _wrap(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function _extend() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: _extend, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = __extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  __extend(Ractive.prototype, _proto, _defaults);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: _extend },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tparse: { value: parse },\n\n  \t// namespaced constructors\n  \tPromise: { value: _Promise },\n\n  \t// support\n  \tsvg: { value: _svg },\n  \tmagic: { value: magic },\n\n  \t// version\n  \tVERSION: { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["this","value","parsed","toString","dirtyValue","Fragment","shouldRerender","completeHook","Hook","resetHook","renderHook","unrenderHook","_push","makeArrayMethod","pop","onceOptions","init","once","ListObserver","context","model","callback","options","classCallCheck","keypath","getKeypath","pending","register","sliced","shuffle","handleChange","slice","prototype","map","negativeOne","newIndices","_this","newValue","inserted","deleted","start","undefined","hadIndex","forEach","newIndex","oldIndex","push","length","len","i","get","isArray","Observer","oldValue","defer","strict","dirty","dispatch","cancel","unregister","call","runloop","addObserver","PatternObserver","baseModel","keys","_this2","pattern","join","replace","baseKeypath","RegExp","oldValues","newValues","findMatches","_this3","Object","isEqual","wildcards","exec","args","concat","apply","_this4","comparators","insertHook","Query","ractive","selector","live","isComponentQuery","result","add","item","makeDirty","liveQueries","_root","index","indexOf","splice","scheduleTask","update","remove","nodeOrComponent","instance","sort","sortByItemPosition","sortByDocumentPosition","test","name","matches","detachHook","easing","linear","pos","easeIn","Math","pow","easeOut","easeInOut","noAnimation","stop","noop","_proto","Ractive$add","animate","Ractive$animate","detach","Ractive$detach","find","Ractive$find","findAll","Ractive$findAll","findAllComponents","Ractive$findAllComponents","findComponent","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","fire","Ractive$fire","Ractive$get","insert","Ractive$insert","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","Ractive$once","render","Ractive$render","reset","Ractive$reset","resetPartial","resetTemplate","Ractive$resetTemplate","reverse","set","Ractive$set","shift","subtract","Ractive$subtract","teardown","Ractive$teardown","toggle","Ractive$toggle","toHTML","Ractive$toHTML","toHtml","unrender","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","Array","filter","win","addEventListener","Error","__extend","Ractive","_defaults","constructor","defaults","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend","_extend","getNodeInfo","parse","Promise","_Promise","svg","_svg","magic","VERSION","adaptors","components","decorators","events","interpolators","partials","transitions","Decorator","fn","findInViewHierarchy","missingPlugin","intermediary","missingDecorator","node","owner","dynamicArgs","argsFragment","getArgsList","unbind","dynamicName","nameFragment","_name","div","doc","createElement","ConditionalAttribute","_Item","attributes","fragment","template","inherits","bind","bubble","rebind","isSvg","namespaceURI","rendered","str","attrs","parseAttributes","a","notIn","removeAttribute","setAttribute","Item","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","Attribute","determineNameAndNamespace","element","parentFragment","updateDelegate","interpolator","items","type","INTERPOLATOR","getString","getValue","valueOf","booleanAttributes","_html","propertyName","isTwoway","useProperty","_ractive","getUpdateDelegate","getAttribute","safeToStringValue","Element","e","toLowerCase","isVoid","voidElementNames","ELEMENT","parent","attributeByName","attribute","conditionalAttributes","m","o","decorator","eventHandlers","v","key","eventNames","split","eventName","event","CustomEvent","DOMEvent","EventDirective","f","cssIds","binding","__bind","createTwowayBinding","shouldBind","twoway","Binding","selectBinding","parentNode","removeChild","query","findNextNode","firstNode","_rebind","__makeDirty","target","namespace","getNamespace","findContext","defineProperty","proxy","x","__render","_updateLiveQueries","transitionTemplate","t0","t1","transitionsEnabled","transition","Transition","registerTransition","_introTransition","appendChild","tagName","stringifyAttribute","isSelected","inputIsCheckedRadio","escapeHtml","_unbind","shouldDestroy","complete","detachWhenReady","_unrender","t2","_transition","id","nodes","removeFromLiveQueries","__update","Input","_Element","arguments","defaultValue","Select","sync","defaultSelected","selected","selectNode","toArray","selectValue","isMultiple","optionWasSelected","optionValue","shouldSelect","valueContains","forceUpdate","Option","select","findParentSelect","selectedAttribute","removeFromArray","Form","formBindings","handleReset","removeEventListener","RactiveEvent","handler","listen","directive","component","unlisten","_prefix","styles","styleElement","head","getElementsByTagName","inDom","styleSheet","_update","css","s","cssText","innerHTML","_css","_renderHook","_completeHook","HookQueue","hook","inProcess","queue","begin","_guid","end","getChildQueue","_fire","templateConfigurator","Parent","proto","parseIfString","TEMPLATE_VERSION","t","getDynamicTemplate","_config","p","extendPartials","resetValue","dataConfigurator","data","isObject","warnIfDebug","__combine","prop","_bind","viewmodel","root","selectorsPattern","commentsPattern","selectorUnitPattern","mediaQueryPattern","dataRvcGuidPattern","_uid","cssConfigurator","noCssTransform","transformCss","cssId","adaptConfigurator","adapt","_combine","ensureArray","_registryNames","Registry","useDefaults","configure","option","registry","create","changed","_fn","isOwner","registries","custom","defaultKeys","isStandardKey","makeObj","isBlacklisted","r","order","config","_configure","c","configHook","initHook","_pattern","Computation","_Model","signature","isReadonly","setter","computationContext","dependencies","children","childByKey","deps","boundsSensitive","shouldCapture","capture","startCapturing","getter","err","message","console","groupCollapsed","functionBody","prettify","getterString","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","_handleChange","clearUnresolveds","joinKey","hasOwnProperty","child","ComputationChild","mark","Model","RootModel","changes","isRoot","mappings","computations","applyChanges","_changeHash","flush","compute","computation","has","localKey","origin","wrapper","shouldTeardown","_mark","retrieve","updateFromBindings","cascade","mutatorMethods","patchedArrayProto","methodName","method","_len","_key","getNewIndices","setting","wrappers","processWrapper","patchArrayMethods","unpatchArrayMethods","__proto__","array","configurable","unpatch","errorMessage","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","constructHook","registryNames","uid","teardownHook","Component","ComponentConstructor","COMPONENT","complexMappings","el","content","_partials","yielders","container","YIELDER","construct","_inlinePartials","setupEvents","childData","parseJSON","_resolve","warnOnceIfDebug","initialise","indexRefs","isolated","keyRefs","checkYielders","_makeDirty","_render","updateLiveQueries","handlers","_observers","_cancel","removeFromLiveComponentQueries","__ractive_instances__","_this5","Text","TEXT","createTextNode","escape","constructors","DOCTYPE","Doctype","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","Yielder","specialElements","doctype","form","input","textarea","componentParent","resolvers","dirtyArgs","createItems","bound","addFragment","createItem","docFrag","createDocumentFragment","found","nextItem","findParentNode","findRepeatingFragment","isIteration","values","source","processItems","argsList","wasBound","wasRendered","anchor","insertBefore","resolve","resolver","ReferenceResolver","toEscapedString","_toString","unrenderAndDestroy","forceResetTemplate","partialTemplate","getPartialTemplate","_Mustache","setTemplate","named","Mustache","RepeatedFragment","iterations","indexRef","keyRef","indexByKey","pendingNewIndices","previousIterations","createIteration","refs","getRefs","iteration","_unrenderAndDestroy","updatePostShuffle","wasArray","toRemove","oldKeys","_fragment","newLength","previousNewIndex","reinsertFrom","existingFragment","childNodes","sectionType","n","getType","isEmpty","SECTION_WITH","SECTION_UNLESS","SECTION_IF","SECTION_IF_WITH","SECTION_EACH","newFragment","fragmentShouldExist","elementCache","ieBug","ieBlacklist","TABLE","THEAD","TBODY","TR","SELECT","nodeType","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","html","insertHtml","decodeCharacterReferences","containerFragment","___prefix","isClient","prefixCache","testStyle","style","camelCase","capped","charAt","toUpperCase","substring","vendors","vendor","number","from","to","delta","isNumeric","intermediate","min","interpolate","properties","hasOwn","unprefixPattern","vendorPattern","createTransitions","canUseCssTransitions","cannotUseCssTransitions","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","webkitTransition","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","hashPrefix","hyphenate","duration","hash","originalValue","propertiesToTransitionInJs","suffix","getStyle","parseFloat","Ticker","step","_prop","delay","visible","hidden","__prefix","_i","onChange","onHide","onShow","getComputedStyle","exportedShims","resolved","params","d","animateStyle","setStyle","fulfil","computedStyle","current","props","processParams","originalStyle","completed","noReset","resetStyle","_manager","twowayBinding","isUnresolved","forceResolution","warnAboutAmbiguity","getInitialValue","parentForm","findParentForm","registerTwowayBinding","locked","unregisterTwowayBinding","GenericBinding","_Binding","lazy","timeout","handleDelay","handleDomEvent","attachEvent","handleBlur","SingleSelectBinding","disabled","setValue","MultipleSelectBinding","selectedValues","previousValue","arrayContentsMatch","initialValue","NumericBinding","_GenericBinding","isNaN","CheckboxBinding","checked","siblings","RadioBinding","getSiblings","groups","BindingGroup","bindings","CheckboxNameBinding","checkboxName","group","getBindingGroup","_getGroupValue","noInitialValue","existingValue","bindingValue","wasChecked","isChecked","arrayContains","RadioNameBinding","getGroupValue","nameAttributeBinding","getKeypathModel","ContentEditableBinding","starMaps","wildcardCache","eventPattern","argumentsPattern","dollarArgsPattern","passthru","models","argsFn","action","g","ref","argMatch","argument","dollarMatch","resolveReference","createFunction","passedArgs","obj","oldEvent","fireEvent","fatal","original","eventPlugin","valueIsSet","TypeError","opt_initialValue","filtered","every","iterator","Function","Empty","ctx","Event","origCreateElement","appearsToBeIELessEqual8","property","currentTarget","srcElement","timeStamp","preventDefault","returnValue","stopPropagation","cancelBubble","listener","listeners","detachEvent","firstChild","getPixelSize","fontSize","sizeWithSuffix","size","getBorderPixelSize","parentElement","currentStyle","rootSize","clientWidth","clientHeight","bcr","borderSizes","display","position","width","height","borderRight","getBoundingClientRect","right","left","setShortStyleProperty","borderSuffix","b","l","CSSStyleDeclaration","normalProps","fontWeight","lineHeight","letterSpacing","getPropertyPriority","getPropertyValue","removeProperty","setProperty","getPropertyCSSValue","_div","methodNames","unprefixed","prefixed","__i","makeFunction","mathml","xlink","xml","xmlns","ns","createElementNS","substr","cloneNode","desc","F","Parser","ParseError","_leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","read","leftover","remaining","postProcess","converters","getLinePos","char","columnNum","lineNum","numTabs","annotation","match","character","shortMessage","matchString","string","matchPattern","allowWhitespace","nextChar","Child","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","requestAnimationFrame","INVERTED","CLOSING","COMMENT","DELIMCHANGE","CLOSING_TAG","INLINE_PARTIAL","NUMBER_LITERAL","STRING_LITERAL","ARRAY_LITERAL","OBJECT_LITERAL","BOOLEAN_LITERAL","REGEXP_LITERAL","GLOBAL","KEY_VALUE_PAIR","REFERENCE","REFINEMENT","MEMBER","PREFIX_OPERATOR","BRACKETED","CONDITIONAL","INFIX_OPERATOR","INVOCATION","ELSE","ELSEIF","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","_numberPattern","identifier","specials","true","false","null","specialsPattern","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","parser","placeholder","special","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","reference","normalise","addUnresolved","attemptResolution","resolveAmbiguousReference","joinAll","unresolved","KeypathModel","dependant","KeyModel","_stack","captureGroup","lastTime","currTime","timeToCall","max","globals","keywords","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","hasProp","originatingModel","indexModels","unresolvedByKey","ticker","adaptor","getPrefixer","fulfilPromise","promise","applyValue","parentValue","createBranch","previousOriginatingModel","specificKey","hasKey","branch","discard","existingMatches","_loop","member","getIndexModel","fragmentIndex","getKeyModel","keypathModel","comparator","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","updateKeypathDependants","_teardown","_updateFromBindings","_updateKeypathDependants","functionCache","ExpressionProxy","__getValue","ReferenceExpressionProxy","base","baseResolver","members","isStatic","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","lessThan","greaterThan","arrayMemberPattern","prefixPattern","readTypeOf","makePrefixSequenceMatcher","legalReference","relaxedName","expectedExpression","expectedParen","regexpPattern","symbol","fallthrough","expression","readExpression","matcher","prefixOperators","readMemberOrInvocation","readLogicalOr","makeInfixSequenceMatcher","infixOperators","ExpressionParser","yieldPattern","handlebarsBlockCodes","each","if","if-with","with","unless","_elsePattern","elsePattern","indexRefPattern","keyIndexRefPattern","handlebarsBlockPattern","leadingLinebreak","trailingLinebreak","contiguousWhitespace","preserveWhitespaceElements","leadingWhitespace","trailingWhitespace","leadingNewLine","trailingNewLine","closingTagPattern","methodCallPattern","methodCallExcessPattern","disallowedContents","delimiterChangePattern","whitespacePattern","delimiterChangeToken","exclude","attributeNamePattern","unquotedAttributeValueTextPattern","tagNamePattern","validTagNameFollower","onPattern","proxyEventPattern","reservedEventNames","directives","intro-outro","intro","outro","li","dt","dd","rt","rp","optgroup","thead","tbody","tfoot","tr","td","th","OPEN_COMMENT","CLOSE_COMMENT","partialDefinitionSectionPattern","__pattern","startPattern","namePattern","finishPattern","STANDARD_READERS","readPartial","readUnescaped","readSection","readYielder","readInterpolator","readComment","TRIPLE_READERS","readTriple","STATIC_READERS","StandardParser","READERS","readMustache","readHtmlComment","readElement","readText","PARTIAL_READERS","readPartialDefinitionComment","readPartialDefinitionSection","tripleDelimiters","staticDelimiters","staticTripleDelimiters","standardDelimiters","delimiters","tags","isTriple","open","close","readers","sortMustacheTags","sectionDepth","elementStack","script","sanitize","elements","eventAttributes","stripComments","preserveWhitespace","sanitizeElements","sanitizeEventAttributes","includeLinePositions","cleanup","readTemplate","_parseOptions","_parser","fromId","isHashedId","isParsed","getParseOptions","createHelper","_createHelper","doParse","bindName","bindChecked","isBindable","getPotentialWildcardMatches","starMap","mapper","wildcardKeypath","getStarMap","star","num","binary","ones","parseInt","digit","enqueue","_eventQueue","dequeue","_noArg","getWildcardNames","fireEventAs","subscribers","initialFire","_subs","notifySubscribers","fullName","originalEvent","stopEvent","haystack","needle","updateId","updateMultipleSelectValue","updateSelectValue","updateValue","updateContentEditableValue","updateRadioValue","updateRadioName","updateCheckboxName","updateIEStyleAttribute","updateProperty","updateNamespacedAttribute","updateAttribute","updateClassName","valueAttribute","className","setAttributeNS","colonIndex","namespacePrefix","namespaces","typeAttribute","nameAttribute","_updateModel","_liveComponentQueries","noIntro","getElement","then","hookQueue","childQueue","initial","helper","parseOptions","existingPartials","newPartials","overwrite","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","getMessage","deprecated","correct","isError","deprecateOption","deprecatedOption","deprecate","superMethod","getSuperMethod","_parent","hasSuper","oldSuper","_super","_method","_ret","extendOtherMethods","userOptions","append","logIfDebug","createFunctionFromString","hasThis","getComputationSignature","setterString","fnBody","tabs","minIndent","reduce","prev","Infinity","truncated","_ref","enumerable","welcome","initialiseProperties","deprecateRactiveData","getAdaptors","computed","combine","protoAdapt","lookup","magic$$","modifyArrays","_liveQueries","getComponentConstructor","findInstance","_Parent","noRegistryFunctionReturn","ElementConstructor","collect","dest","_forceResetTemplate","partial","collection","rerender","others","notEmptyString","_trim","splitKeypath","observer","observers","createObserver","keypaths","wildcardIndex","_model","getComparator","JSON","stringify","thing","compare","isDetached","fireInsertHook","otherNode","compareDocumentPosition","bitmask","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","fragments","getParent","ancestry","ancestor","getOptions","_add","_wrap","force","needsSuper","unwrap","addRegistries","addOtherOptions","addRegistry","extendOne",{"end":{"file":"ractive-legacy.js","comments_before":[],"nlb":false,"endpos":499,"endcol":12,"endline":19,"pos":495,"col":8,"line":19,"value":"html","type":"name"},"start":{"file":"ractive-legacy.js","comments_before":[],"nlb":false,"endpos":499,"endcol":12,"endline":19,"pos":495,"col":8,"line":19,"value":"html","type":"name"},"name":"html"},"window","document","hasConsole","warn","log","printWarning","implementation","hasFeature","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","subClass","superClass","setPrototypeOf","Constructor","deprecations","replacement","arg","__toString","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","decoratorQueue","outrosComplete","addChild","list","addDecorator","decrementOutros","check","decrementTotal","detachNodes","_detach","_detachNodes","ready","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","__resolve","all","promises","processPromise","reason","changeHook","batch","returnPromise","previousBatch","transitionManager","tasks","immediateObservers","deferredObservers","flushChanges","addToArray","registerDecorator","task","postRender","_batch","refPattern","updateHook","arrayProto","_unrenderHook","badArguments","_teardownHook","_errorMessage","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","isActuallyString","mapped","global","factory","exports","module","define","amd","format","_len2","_key2","warnOnce","_len3","_key3","isFinite","arrayLike","tm","called","resolvePromise","rejectPromise","y","_dispatch","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","touchedFrom","_set","output","getElementById","sources","okQuote","literal","done","next","charCodeAt","_readNumberLiteral","readKey","token","guid","counter","placeholderId","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","prefixKeypath","prefix","rootKeypath","rootDot","relativeKeypath","repeater","parts","rx","entity","code","fromCharCode","validateCode","tag","flattenExpression","k","extractRefs","refineExpression","mustache","referenceExpression","getReferenceExpression","refinement","readReference","startPos","lastDotIndex","relaxedNames","lastIndexOf","readExpressionList","expr","expressions","readRefinement","strictRefinement","_name$$","readBracketedExpression","readNumberLiteral","readArrayLiteral","expressionList","readKeyValuePair","readKeyValuePairs","pairs","keyValuePairs","readObjectLiteral","readBooleanLiteral","readLiteral","readPrimary","getConditional","ifTrue","ifFalse","readExpressionOrReference","expectedFollowers","yielder","readElse","readElseIf","readClosing","closing","section","hasElse","block","unlessBlock","conditions","closed","expectedClose","extra","createUnlessBlock","___combine","invert","parensIfNecessary","triple","getLowestIndex","needles","lowest","disallowed","barrier","inside","inAttribute","trimWhitespace","leadingPattern","trailingPattern","stripStandalones","backOne","backTwo","lastSectionItem","isString","isComment","isSection","removeLeadingWhitespace","removeTrailingWhitespace","previousItem","preserveWhitespaceInsideFragment","removeLeadingWhitespaceInsideFragment","removeTrailingWhitespaceInsideFragment","isPreserveWhitespaceElement","readClosingTag","processDirective","tokens","parentParser","directiveName","directiveArgs","readDelimiterChange","opening","readMustacheOfType","reader","rewind","readAttribute","attr","readAttributeValue","valueStart","startDepth","readQuotedAttributeValue","readUnquotedAttributeValue","readUnquotedAttributeValueToken","text","quoteMark","readQuotedStringToken","addProxyEvent","selfClosing","hasPartials","closingTag","lowerCaseName","canContain","closingTagName","endIndex","comment","escapeRegExp","endPattern","noThrow","textContent","val","registryName","getPartialFromRegistry","findParentPartial","findOwner","findConstructor","hasIndexRef","selectedOption","_element","selectedIndex","hyphenatedStr","interpol","description","clearTimeout","_getValue"],"mappings":"CAWC,SAAU4tD,EAAQC,GACE,gBAAZC,UAA0C,mBAAXC,QAAyBA,OAAOD,QAAUD,IAC9D,kBAAXG,SAAyBA,OAAOC,IAAMD,OAAOH,GACpDD,EAAO3hD,QAAU4hD,KACjB7tD,KAAM,WAAc,YAmEpB,SAAS0H,MAwDT,QAASwmD,GAAO9uC,EAASpa,GACxB,MAAOoa,GAAQ/a,QAAQ,MAAO,WAC7B,MAAOW,GAAKsF,UAId,QAASmsB,GAAMrX,GACd,IAAK,GAAI4C,GAAO5K,UAAUrU,OAAQiC,EAAO2G,MAAMqW,EAAO,EAAIA,EAAO,EAAI,GAAIC,EAAO,EAAUD,EAAPC,EAAaA,IAC/Fjd,EAAKid,EAAO,GAAK7K,UAAU6K,EAI5B,MADA7C,GAAU8uC,EAAO9uC,EAASpa,GACpB,GAAI+G,OAAMqT,GAGjB,QAAS8jC,KACJj3C,GAAQK,OACXk8C,GAAItjD,MAAM,KAAMkS,WAIlB,QAASmxC,GAAKnpC,GACb,IAAK,GAAI+uC,GAAQ/2C,UAAUrU,OAAQiC,EAAO2G,MAAMwiD,EAAQ,EAAIA,EAAQ,EAAI,GAAIC,EAAQ,EAAWD,EAARC,EAAeA,IACrGppD,EAAKopD,EAAQ,GAAKh3C,UAAUg3C,EAG7BhvC,GAAU8uC,EAAO9uC,EAASpa,GAC1ByjD,GAAarpC,EAASpa,GAGvB,QAASqpD,GAASjvC,GACjB,IAAK,GAAIkvC,GAAQl3C,UAAUrU,OAAQiC,EAAO2G,MAAM2iD,EAAQ,EAAIA,EAAQ,EAAI,GAAIC,EAAQ,EAAWD,EAARC,EAAeA,IACrGvpD,EAAKupD,EAAQ,GAAKn3C,UAAUm3C,EAG7BnvC,GAAU8uC,EAAO9uC,EAASpa,GAEtB4jD,GAAcxpC,KAIlBwpC,GAAcxpC,IAAW,EACzBqpC,GAAarpC,EAASpa,IAGvB,QAASwW,KACJvP,GAAQK,OACXi8C,EAAKrjD,MAAM,KAAMkS,WAInB,QAASmO,KACJtZ,GAAQK,OACX+hD,EAASnpD,MAAM,KAAMkS,WAgFvB,QAASjU,GAAQgjD,GAChB,MAAkC,mBAA3BoD,GAAW3lD,KAAKuiD,GAGxB,QAASthD,GAAQ8K,EAAG+pB,GACnB,MAAU,QAAN/pB,GAAoB,OAAN+pB,GACV,EAGS,gBAAN/pB,IAA+B,gBAAN+pB,IAC5B,EAGD/pB,IAAM+pB,EAKd,QAASzL,GAAUk4B,GAClB,OAAQvyB,MAAMzD,WAAWg2B,KAAWqI,SAASrI,GAG9C,QAAS5qC,GAAS4qC,GACjB,MAAOA,IAAoC,oBAA3BoD,GAAW3lD,KAAKuiD,GAGjC,QAASuG,GAAWjqC,EAAOxiB,GAC1B,GAAIgG,GAAQwc,EAAMvc,QAAQjG,EAEZ,MAAVgG,GACHwc,EAAM3f,KAAK7C,GAIb,QAAS80B,GAActS,EAAOxiB,GAC7B,IAAK,GAAIgD,GAAI,EAAG+a,EAAIyE,EAAM1f,OAAYib,EAAJ/a,EAAOA,IACxC,GAAIwf,EAAMxf,IAAMhD,EACf,OAAO,CAIT,QAAO,EAGR,QAASuzB,GAAmB7jB,EAAG+pB,GAC9B,GAAIz2B,EAEJ,KAAKE,EAAQwM,KAAOxM,EAAQu2B,GAC3B,OAAO,CAGR,IAAI/pB,EAAE5M,SAAW22B,EAAE32B,OAClB,OAAO,CAIR,KADAE,EAAI0M,EAAE5M,OACCE,KACN,GAAI0M,EAAE1M,KAAOy2B,EAAEz2B,GACd,OAAO,CAIT,QAAO,EAGR,QAAS0Z,GAAYrH,GACpB,MAAiB,gBAANA,IACFA,GAGC7S,SAAN6S,KAIGA,EAGR,QAASwxC,GAASrkC,GACjB,MAAOA,GAAMA,EAAM1f,OAAS,GAG7B,QAASwV,GAAgBkK,EAAO2gB,GAC/B,GAAK3gB,EAAL,CAIA,GAAIxc,GAAQwc,EAAMvc,QAAQk9B,EAEZ,MAAVn9B,GACHwc,EAAMtc,OAAOF,EAAO,IAItB,QAAS0R,GAAQ82C,GAGhB,IAFA,GAAIhsC,MACAxf,EAAIwrD,EAAU1rD,OACXE,KACNwf,EAAMxf,GAAKwrD,EAAUxrD,EAGtB,OAAOwf,GAGR,QAAStO,GAAOmB,GACdA,EAAEpG,OAGJ,QAASgX,GAAQ5Q,GACfA,EAAE5R,SAGJ,QAASuc,GAAc3K,GACrBA,EAAExT,eAGJ,QAAS0f,GAAMlM,GACbA,EAAEiL,OAGJ,QAAShL,GAASD,GAChBA,EAAE1L,SAGJ,QAASkL,GAAQQ,GACfA,EAAElG,SAGJ,QAAS80B,GAAU5uB,GACjBA,EAAE7K,WAGJ,QAAS8L,GAAQjB,GACfA,EAAEjH,SAGJ,QAASsI,GAAUrB,GACjBA,EAAEtK,WAGJ,QAASwf,GAAoBlV,GAC3BA,EAAEtK,UAAS,GAGb,QAASiM,GAAS3B,GAChBA,EAAEjP,SAGJ,QAAS+iB,GAAU9T,GACjB,MAAOA,GAAEnV,WAGX,QAASgpB,GAAgB7T,GACvB,MAAOA,GAAEnV,UAAS,GA+EpB,QAASoqD,GAAQj5C,GAChBA,EAAQvJ,SAGT,QAASyiD,GAAakE,GAErBA,EAAGpE,cAGJ,QAASF,GAAMsE,IACTA,EAAGjE,OAASiE,EAAGhF,OAAO3mD,QAAU2rD,EAAG9E,gBAKnC8E,EAAG3E,iBACH2E,EAAG37C,OACN27C,EAAG37C,OAAOo3C,gBAAgBuE,GAE1BA,EAAGpE,cAGJoE,EAAG3E,gBAAiB,GAKhB2E,EAAGjF,OAAO1mD,QAAW2rD,EAAG/E,gBACD,kBAAhB+E,GAAGrtD,UACbqtD,EAAGrtD,WAGAqtD,EAAG37C,QACN27C,EAAG37C,OAAOs3C,mBA6Ib,QAASgB,GAAKhqD,GACb+tB,WAAW/tB,EAAU,GAGtB,QAAS+pD,GAAeplC,EAAUrgB,GACjC,MAAO,YAGN,IAFA,GAAIkT,GAEGA,EAAUmN,EAAS1b,SACzBuO,EAAQlT,IAKX,QAASimD,GAAUnpB,EAASntB,EAAGgc,EAAQy5B,GAEtC,GAAI1K,EAGJ,IAAI/qC,IAAMmtB,EACT,KAAM,IAAI5L,WAAU,iEAIrB,IAAIvhB,YAAaxI,IAChBwI,EAAE+qC,KAAK/uB,EAAQy5B,OAIX,KAAIz1C,GAAmB,gBAANA,IAA+B,kBAANA,GA0C7Cgc,EAAOhc,OA1CyD,CAChE,IACC+qC,EAAO/qC,EAAE+qC,KACR,MAAO3tC,GAER,WADAq4C,GAAOr4C,GAKR,GAAoB,kBAAT2tC,GAAqB,CAC/B,GAAIsO,GAAQC,EAAgBC,CAE5BD,GAAiB,SAAUE,GACtBH,IAGJA,GAAS,EACT/C,EAAUnpB,EAASqsB,EAAGx9B,EAAQy5B,KAG/B8D,EAAgB,SAAUjxC,GACrB+wC,IAGJA,GAAS,EACT5D,EAAOntC,IAGR,KACCyiC,EAAKz8C,KAAK0R,EAAGs5C,EAAgBC,GAC5B,MAAOn8C,GACR,IAAKi8C,EAIJ,MAFA5D,GAAOr4C,QACPi8C,GAAS,QAKXr9B,GAAOhc,IAkFX,QAASy5C,GAAUrJ,GAClBA,EAASjiD,WAGV,QAASgpD,KACRP,GAAMK,mBAAmB5pD,QAAQosD,EAOjC,KAHA,GAAI9rD,GAAIipD,GAAM7E,UAAUtkD,OACpBgM,EAAWtM,OAERQ,KAAK,CACX8L,EAAWm9C,GAAM7E,UAAUpkD,EAG3B,IAAIsC,GAAUwJ,EAASxJ,OACvB0mD,IAAWpjD,KAAKtD,EAASA,EAAQqW,UAAU8E,SAC3Cnb,EAAQqW,UAAU8E,WAElB3R,EAAS1I,SAEV6lD,GAAM7E,UAAUtkD,OAAS,EAEzBmpD,GAAMG,kBAAkB7pD,QAExB0pD,GAAMM,kBAAkB7pD,QAAQosD,EAEhC,IAAIzC,GAAQJ,GAAMI,KAGlB,KAFAJ,GAAMI,SAEDrpD,EAAI,EAAGA,EAAIqpD,EAAMvpD,OAAQE,GAAK,EAClCqpD,EAAMrpD,IAMP,OAAIipD,IAAM7E,UAAUtkD,OAAe0pD,IAAnC,OAKD,QAASlsB,GAAUxK,GAClB,MAAOA,GAAMA,EAAI1xB,QAAQ0oD,GAAY,OAAS,GAG/C,QAAStH,GAAajkD,GACrB,MAAO++B,GAAU/+B,GAASkS,MAAM,KAGjC,QAASrI,GAAoB7J,EAASmgB,GACrC,GAAI8gB,GAAU5+B,GAAQrB,MAAMxC,MAAM,EAUlC,OARKwB,GAGJxB,KAAK4b,UAAU+kB,QAAQ8kB,EAAajkD,IAAUkgB,mBAAmBC,KAAY,GAF7E3hB,KAAK4b,UAAU8F,oBAAmB,GAKnC7d,GAAQ0W,MAEDkoB,EAIR,QAASt3B,GAAe3J,GACvB,GAAIJ,GAAQI,EAAUxB,KAAK4b,UAAU+kB,QAAQ8kB,EAAajkD,IAAYxB,KAAK4b,UAEvE6mB,EAAU5+B,GAAQrB,MAAMxC,MAAM,EAMlC,OALAoB,GAAMmf,OACN1c,GAAQ0W,MAERyyC,GAAWnkD,KAAK7I,KAAMoB,GAEfqhC,EA4BR,QAASvgB,GAAcnf,EAAQ+e,EAAY9c,GAC1C,GAAIgqD,GAEAC,EACAC,EACAC,EACAlsD,EAJAd,IAQJ,IAFA6sD,EAAkBI,EAAoBrsD,EAAQ+e,EAAY9c,IAErDgqD,EACJ,MAAO,KAQR,KALAG,EAAUH,EAAgBjsD,OAAS,EAAIisD,EAAgB,GAEvDC,EAAc7nD,KAAK+mB,IAAIprB,EAAQisD,EAAgB,IAC/CE,EAAYD,EAAcD,EAAgB,GAErC/rD,EAAI,EAAOgsD,EAAJhsD,EAAiBA,GAAK,EACjCd,EAAWW,KAAKG,EAGjB,MAAWisD,EAAJjsD,EAAeA,GAAK,EAC1Bd,EAAWW,KAAK,GAGjB,MAAWC,EAAJE,EAAYA,GAAK,EACvBd,EAAWW,KAAKG,EAAIksD,EAUrB,OANgB,KAAZA,EACHhtD,EAAWktD,YAAcL,EAAgB,GAEzC7sD,EAAWktD,YAActsD,EAGnBZ,EAKR,QAASitD,GAAoBrsD,EAAQ+e,EAAY9c,GAChD,OAAQ8c,GACP,IAAK,SAKJ,IAJgBrf,SAAZuC,EAAK,IAAoBA,EAAK,GAAK,IACtCA,EAAK,GAAKjC,EAASqE,KAAKi6B,IAAIr8B,EAAK,IAAKjC,IAGhCiC,EAAKjC,OAAS,GACpBiC,EAAKlC,KAAKC,EAASiC,EAAK,GAMzB,OAFAA,GAAK,GAAKoC,KAAK+mB,IAAInpB,EAAK,GAAIjC,EAASiC,EAAK,IAEnCA,CAER,KAAK,OACL,IAAK,UACJ,MAAO,KAER,KAAK,MACJ,MAAIjC,IACKA,EAAS,EAAG,IAEb,EAAG,EAEZ,KAAK,OACJ,OAAQA,EAAQ,GAAGkC,OAAOD,EAE3B,KAAK,QACJ,OAAQ,EAAGjC,EAAS,EAAI,EAEzB,KAAK,UACJ,OAAQ,EAAG,GAAGkC,OAAOD,IAMxB,QAASnE,GAAiBihB,GACzB,MAAO,UAAUtgB,GAChB,GAAIJ,GAAQpB,KAAK4b,UAAU+kB,QAAQJ,EAAU/+B,GAASkS,MAAM,MACxD+O,EAAQrhB,EAAM8B,KAElB,KAAKC,EAAQsf,GACZ,KAAM,IAAI1W,OAAM,wBAA0B+V,EAAa,2BAA6BtgB,EAAQC,aAG7F,KAAK,GAAIugB,GAAO5K,UAAUrU,OAAQiC,EAAO2G,MAAMqW,EAAO,EAAIA,EAAO,EAAI,GAAIC,EAAO,EAAUD,EAAPC,EAAaA,IAC/Fjd,EAAKid,EAAO,GAAK7K,UAAU6K,EAG5B,IAAI9f,GAAa+f,EAAcO,EAAM1f,OAAQ+e,EAAY9c,GACrDW,EAASsnD,GAAWnrC,GAAY5c,MAAMud,EAAOzd,GAE7Cy9B,EAAU5+B,GAAQrB,MAAMxC,MAAM,GAAMqgD,KAAK,WAC5C,MAAO16C,IAWR,OARIxD,GACHf,EAAMS,QAAQM,GAEdf,EAAMgJ,IAAIzE,GAGX9B,GAAQ0W,MAEDkoB,GAOT,QAASx3B,KACR,IAAKjL,KAAK+O,SAASQ,SAElB,MADAiM,GAAY,6EACL1O,GAASkc,SAGjB,IAAIyZ,GAAU5+B,GAAQrB,MAAMxC,MAAM,GAI9BwW,GAAiBxW,KAAKgZ,WAAahZ,KAAKgZ,UAAUxC,eAAiBxW,KAAKwW,aAQ5E,OAPAxW,MAAK+O,SAAS/D,SAASwL,GAEvB+B,EAAgBvY,KAAK2kB,GAAGyB,sBAAuBpmB,MAE/CktD,GAAcrkD,KAAK7I,MAEnB6D,GAAQ0W,MACDkoB,EAGR,QAAS33B,KACR,MAAO9K,MAAK+O,SAAS5O,UAAS,GAU/B,QAASyK,GAAepJ,GACvB,GAAuB,gBAAZA,GACV,KAAM,IAAIq1B,WAAUs2B,GAGrB,IAAIzsC,GAAUje,MAEd,OAAI,KAAKmE,KAAKpF,IACbkf,KAEA1gB,KAAK4b,UAAUlX,YAAY+gD,EAAajkD,IAAUmB,QAAQ,SAAUvB,GACnEsf,EAAQtf,EAAMK,eAAiBL,EAAM8B,QAG/BlD,KAAKoK,IAAIsW,IAGV1gB,KAAKoK,IAAI5I,GAAUxB,KAAKkD,IAAI1B,IAQpC,QAASkJ,KACR1K,KAAK+O,SAASV,SACdrO,KAAK4b,UAAUnR,WAEfzK,KAAKimB,WAAWtjB,QAAQujB,GAEpBlmB,KAAK+O,SAASQ,UAAYvP,KAAK2kB,GAAGyB,uBACrC7N,EAAgBvY,KAAK2kB,GAAGyB,sBAAuBpmB,MAGhDA,KAAKwW,eAAgB,CACrB,IAAIisB,GAAUziC,KAAK+O,SAASQ,SAAWvP,KAAKgL,WAAa8B,GAASkc,SAIlE,OAFAokC,IAAcvkD,KAAK7I,MAEZyiC,EAIR,QAASilB,GAAKniD,EAAS/D,EAAS2vB,GAC/B,GAAuB,gBAAZ3vB,KAAyBysB,EAAUkD,GAC7C,KAAM,IAAIplB,OAAM,gBAGjB,IAAI2U,GAAUje,MAEd,IAAI,KAAKmE,KAAKpF,GAWb,MAVAkf,MAEAnb,EAAQqW,UAAUlX,YAAY+gD,EAAajkD,IAAUmB,QAAQ,SAAUvB,GACtE,GAAInB,GAAQmB,EAAM8B,KAElB,KAAK+qB,EAAUhuB,GAAQ,KAAM,IAAI8L,OAAMshD,GAEvC3sC,GAAQtf,EAAMK,cAAgBxB,EAAQkxB,IAGhC5rB,EAAQ6E,IAAIsW,EAGpB,IAAIzgB,GAAQsF,EAAQrC,IAAI1B,EAExB,KAAKysB,EAAUhuB,GACd,KAAM,IAAI8L,OAAMshD,GAGjB,OAAO9nD,GAAQ6E,IAAI5I,GAAUvB,EAAQkxB,GAGtC,QAAS3mB,GAAiBhJ,EAAS2vB,GAClC,MAAOu2B,GAAK1nD,KAAMwB,EAAeiB,SAAN0uB,EAAkB,IAAMA,GASpD,QAASxV,GAAMhO,EAAIxM,GAClB,IAAK,OAAOyF,KAAK+G,EAAGxN,YAAa,MAAOwN,EAExC,IAAIma,GAAQna,EAAGuB,KAAK/N,EACpB,KAAK,GAAIua,KAAQ/N,GAChBma,EAAMpM,GAAQ/N,EAAG+N,EACjB,OAAOoM,GAGT,QAASzd,IAAY7I,EAASvB,GAC7B,GAAIwiC,GAAU5+B,GAAQrB,MAAMxC,MAAM,EAGlC,IAAIub,EAAS/Z,GAAU,CACtB,GAAIS,GAAMT,CAEV,KAAKA,IAAWS,GACXA,EAAIme,eAAe5e,IACtB8tD,GAAKtvD,KAAMwB,EAASS,EAAIT,QAMzB8tD,IAAKtvD,KAAMwB,EAASvB,EAKtB,OAFA4D,IAAQ0W,MAEDkoB,EAGR,QAAS6sB,IAAK/pD,EAAS/D,EAASvB,GAG/B,GAFqB,kBAAVA,KAAsBA,EAAQ0b,EAAM1b,EAAOsF,IAElD,KAAKqB,KAAKpF,GACb+D,EAAQqW,UAAUlX,YAAY+gD,EAAajkD,IAAUmB,QAAQ,SAAUvB,GACtEA,EAAMgJ,IAAInK,SAEL,CACN,GAAImB,GAAQmE,EAAQqW,UAAU+kB,QAAQ8kB,EAAajkD,GACnDJ,GAAMgJ,IAAInK,IAseZ,QAASioB,MACR,MAAOxZ,IAAIwZ,yBAGZ,QAASk4B,IAAW54B,GACnB,GAAI+nC,EAEJ,IAAK/nC,GAA0B,iBAAVA,GAIrB,MAAK3b,KAAQ6C,IAAQ8Y,EAKjBA,EAAM8E,SACF9E,EAIa,gBAAVA,KAEV+nC,EAAS7gD,GAAI8gD,eAAehoC,IAGvB+nC,GAAU7gD,GAAI8d,gBAClB+iC,EAAS7gD,GAAI8d,cAAchF,IAIxB+nC,GAAUA,EAAOjjC,UACbijC,EAKL/nC,EAAM,IAAMA,EAAM,GAAG8E,SACjB9E,EAAM,GAGP,KA7BC,KA+FT,QAAShV,IAAkBvS,GAC1B,MAAgB,OAATA,GAAkBA,EAAME,SAAgB,GAAKF,EAAV,GA2E3C,QAAS+L,IAASgJ,GAGjB,IAAK,GAFD0G,GAAM+M,EAEDzG,EAAO5K,UAAUrU,OAAQ0sD,EAAU9jD,MAAMqW,EAAO,EAAIA,EAAO,EAAI,GAAIC,EAAO,EAAUD,EAAPC,EAAaA,IAClGwtC,EAAQxtC,EAAO,GAAK7K,UAAU6K,EAG/B,MAAOwG,EAASgnC,EAAQnlD,SACvB,IAAKoR,IAAQ+M,GACR6F,GAAO1qB,KAAK6kB,EAAQ/M,KACvB1G,EAAO0G,GAAQ+M,EAAO/M,GAKzB,OAAO1G,GA4KR,QAAS+pB,IAAyB2wB,GACjC,MAAO,UAAU7vB,GAKhB,IAJA,GAAI8vB,GAAU,IACVC,GAAO,EACPC,EAAOptD,QAEHmtD,GACPC,EAAOhwB,EAAO/C,aAAaI,KAAwB2C,EAAO/C,aAAaK,KAA0B0C,EAAOjD,YAAY8yB,GAChHG,EAEFF,GADY,MAATE,EACQ,MACQ,QAATA,EACC,IAEAA,GAGZA,EAAOhwB,EAAO/C,aAAaM,IACvByyB,EAEHF,GAAW,OAAS,MAAQE,EAAKC,WAAW,GAAG3vD,SAAS,KAAK4B,MAAM,IAEnE6tD,GAAO,EAQV,OAHAD,IAAW,IAGJ1J,KAAKr5C,MAAM+iD,IAoDpB,QAAS1vB,IAAmBJ,GAC3B,GAAIr9B,GAAOq6B,CAIX,OAFAr6B,GAAQq9B,EAAO34B,IAEX24B,EAAOjD,YAAY,MACtBC,EAASmC,GAAsBa,GAE1BA,EAAOjD,YAAY,MAMvB7hB,EAAG8iB,GACHtqB,EAAGspB,IANHgD,EAAO34B,IAAM1E,EACN,OASLq9B,EAAOjD,YAAY,MACtBC,EAASiC,GAAsBe,GAE1BA,EAAOjD,YAAY,MAMvB7hB,EAAG8iB,GACHtqB,EAAGspB,IANHgD,EAAO34B,IAAM1E,EACN,OASF,KAOR,QAASutD,IAAmBlwB,GAC3B,GAAIl6B,EAEJ,QAAIA,EAASk6B,EAAO/C,aAAamC,MAE/BlkB,EAAG6iB,GACHrqB,EAAG5N,GAIE,KAQR,QAASqqD,IAAQnwB,GAChB,GAAIowB,EAEJ,QAAIA,EAAQhwB,GAAkBJ,IACtBX,GAAWt4B,KAAKqpD,EAAM18C,GAAK08C,EAAM18C,EAAI,IAAM08C,EAAM18C,EAAElP,QAAQ,KAAM,OAAS,KAG9E4rD,EAAQF,GAAmBlwB,IACvBowB,EAAM18C,GAGV08C,EAAQpwB,EAAO/C,aAAatuB,KACxByhD,EADR,OA4HD,QAAS7vB,IAAgBP,GACxBA,EAAO9C,iBAEP,IAAIvpB,GAAMw8C,GAAQnwB,EAElB,KAAKrsB,EAAK,MAAO,KAEjB,IAAI2sB,IAAS3sB,IAAKA,EAGlB,IADAqsB,EAAO9C,mBACF8C,EAAOjD,YAAY,KACvB,MAAO,KAERiD,GAAO9C,iBAEP,IAAIsD,GAAaR,EAAO/D,MAExB,OAAKuE,IAELF,EAAKlgC,MAAQogC,EAAW9sB,EACjB4sB,GAHiB,KAMzB,QAAS9a,IAAW7V,EAAKgZ,GACxB,GAAIqX,GAAS,GAAID,IAAWpwB,GAAOgZ,OAAQA,GAC3C,OAAOqX,GAAOl6B,OAKf,QAAS+iB,IAAahX,EAAO8W,EAAQ0nC,GACpC,GAAIC,GAAU/4C,UAAUrU,QAAU,GAAsBN,SAAjB2U,UAAU,GAAmB,EAAIA,UAAU,EAElF,OAAO1F,GAAMzP,IAAI,SAAU4D,GAC1B,GAAIA,EAAK8L,OAAS4U,GACjB,MAAO1gB,GAAKmJ,QAGb,IAAInJ,EAAKkJ,SACR,MAAIlJ,GAAKkJ,SAAS+a,WACVjkB,EAAKkJ,SAAS+a,WAAW7nB,IAAI,SAAU8M,GAC7C,MAAO2Z,IAAa3Z,EAAS2C,MAAO8W,EAAQ0nC,EAAMC,KAChD/rD,KAAK,IAEDskB,GAAa7iB,EAAKkJ,SAAS2C,MAAO8W,EAAQ0nC,EAAMC,EAIzD,IAAIC,GAAgBF,EAAO,IAAMC,GAIjC,OAFA3nC,GAAO4nC,GAAiBvqD,EAAKzE,MAAQyE,EAAKzE,MAAMkgB,QAAUzb,EAAKzE,MAAMkgB,QAAQrhB,MAAQ4F,EAAKzE,MAAM8B,MAAQT,OAEjG,KAAO2tD,EAAgB,MAC5BhsD,KAAK,IAGT,QAASisD,IAAa78C,GACrB,KAAM,IAAIzH,OAAM,8BAAgCyH,EAAM,kCAEvD,QAASktB,IAA0B3xB,EAAUgnB,GAQ5C,IAPA,GAAIu6B,GAAiBvhD,EAASoG,cAAc0G,KACxC5X,EAAO8xB,EAAIriB,MAAM,KACjBF,EAAMvP,EAAK,GAEXssD,EAAkB9tD,OAClB+tD,EAA2B/tD,OAExBsM,GAAU,CAEhB,GAAIA,EAASwZ,YAAa,CACzB,GAAI/U,IAAQzE,EAASgE,OAAOiX,OAE3B,MADI/lB,GAAKlB,OAAS,GAAGstD,GAAa78C,GAC3BzE,EAAS5N,QAAQoiC,aAGzB,IAAI/vB,IAAQzE,EAASgE,OAAOgX,SAE3B,MADI9lB,GAAKlB,OAAS,GAAGstD,GAAa78C,GAC3BzE,EAAS5N,QAAQkiC,cAAct0B,EAAS9I,OAIjD,GAAI8I,EAAS5N,YAEP4N,EAAS4R,QAAU5R,EAASxJ,QAAQyT,aAAWu3C,GAAkB,GAElExhD,EAAS5N,QAAQggB,IAAI3N,IAKxB,MAJIg9C,IACHF,EAAeruD,IAAIuR,EAAKzE,EAAS5N,QAAQgf,QAAQ3M,IAG3CzE,EAAS5N,QAAQw/B,QAAQ18B,EAI9B8K,GAAS2Y,kBAAoB3Y,EAASxJ,QAAQmgB,UAEjD3W,EAAWA,EAAS2Y,gBACpB8oC,GAA2B,GAE3BzhD,EAAWA,EAASgE,OAItB,MAAKw9C,GAAL,OACQD,EAAe3vB,QAAQ18B,GA2MhC,QAASgb,MACR+hB,GAAOl+B,KAAKm+B,OAGb,QAASlhB,MACR,MAAOihB,IAAOlgC,MAGf,QAASke,IAAQ5d,GACZ6/B,IACHA,GAAan+B,KAAK1B,GAuDpB,QAASwgC,MACR/9B,GAAQrB,OAER,IAAIgJ,GAAMg2B,KAENv+B,EAAIR,OACJ4/B,EAAS5/B,MAEb,KAAKQ,EAAI,EAAGA,EAAIy+B,GAAQ3+B,OAAQE,GAAK,EACpCo/B,EAASX,GAAQz+B,GAEZo/B,EAAOT,KAAKp2B,IAEhBk2B,GAAQv7B,OAAOlD,IAAK,EAItBY,IAAQ0W,MAEJmnB,GAAQ3+B,OACXs6B,GAAsBuE,IAEtBD,IAAU,EAmDZ,QAAS8uB,IAAcn6B,EAAKo6B,GAC3B,GACIl9C,GADAinB,IAGJ,KAAKi2B,EACJ,MAAOp6B,EAGRo6B,IAAU,GAEV,KAAKl9C,IAAO8iB,GACPA,EAAIlW,eAAe5M,KACtBinB,EAASi2B,EAASl9C,GAAO8iB,EAAI9iB,GAI/B,OAAOinB,GAER,QAAS8H,IAAYouB,GACpB,GAAIC,EAqBJ,OAnBK5uB,IAAU2uB,KACdC,EAAUD,EAAcA,EAAc,IAAM,GAE5C3uB,GAAU2uB,GAAe,SAAUE,EAAiB5wD,GACnD,GAAIq2B,EAEJ,OAA+B,gBAApBu6B,IACVv6B,KACAA,EAAIs6B,EAAUC,GAAmB5wD,EAC1Bq2B,GAGuB,gBAApBu6B,GAEHD,EAAUH,GAAcI,EAAiBF,GAAeE,EAFhE,SAOK7uB,GAAU2uB,GAKlB,QAASxsB,IAAoB/iC,GAC5BA,EAAMsgB,oBAAmB,GAG1B,QAAS0iB,IAAyBhjC,GACjCA,EAAM6iC,0BA2eP,QAAS9N,IAAiBpnB,EAAUgnB,GACnC,GAAI50B,GAAU4N,EAASoG,aAIvB,IAAY,MAAR4gB,GAAuB,SAARA,EAAgB,MAAO50B,EAC1C,IAAY,aAAR40B,EAAoB,MAAO50B,GAAQg0B,iBACvC,IAAY,WAARY,EAAkB,CACrB,GAAI+6B,GAAW/hD,EAASuZ,uBAExB,KAAKwoC,EAASvoC,YAAa,MAC3B,OAAOuoC,GAAS3vD,QAAQkiC,cAAcytB,EAAS7qD,OAEhD,GAAY,SAAR8vB,EAAgB,MAAOhnB,GAASuZ,wBAAwBnnB,QAAQoiC,aAGpE,IAAe,MAAXxN,EAAI,GAAY,MAAO50B,GAAQ0a,KAAK8kB,QAAQ5K,EAAIh0B,MAAM,GAAG2R,MAAM,KACnE,IAAe,MAAXqiB,EAAI,GAAY,CAGnB,IAFA,GAAIg7B,GAAQh7B,EAAIriB,MAAM,KAEF,MAAbq9C,EAAM,IAA2B,OAAbA,EAAM,IAAa,CAC7C,GAAIrf,GAAOqf,EAAMzmD,OAEJ,QAATonC,IACHvwC,EAAUA,EAAQ4R,QAQpB,MAJAgjB,GAAMg7B,EAAM3sD,KAAK,KAGF,MAAX2xB,EAAI,KAAYA,EAAMA,EAAIh0B,MAAM,IAC7BZ,EAAQw/B,QAAQ5K,EAAIriB,MAAM,MAGlC,MAAOgtB,IAA0B3xB,EAAUgnB,GAI5C,QAASK,IAAe5mB,EAAKvM,GAC5B,GAAIohC,GAAc70B,GAAM,MAAO60B,IAAc70B,EAG7C,KADA,GAAIxK,GAAO,GAAI2G,OAAM1I,GACdA,KAAK+B,EAAK/B,GAAK,IAAMA,CAE5B,IAAI0K,GAAK,GAAIupB,UAASlyB,EAAKZ,KAAK,KAAM,WAAaoL,EAAM,IAEzD,OAAO60B,IAAc70B,GAAO7B,EAG7B,QAAS42B,IAAWnjC,GACnB,MAAOA,GAAQA,EAAM8B,KAAI,GAAQT,OAiRlC,QAAS6iB,IAASvW,EAAUC,GAC3B,MAAIA,GAAS4O,EACLuY,GAAiBpnB,EAAUC,EAAS4O,GACjC5O,EAASsG,EACZ,GAAIgvB,IAAgBv1B,EAAUC,EAASsG,GAEvC,GAAIkvB,IAAyBz1B,EAAUC,EAASgiD,IA0FzD,QAASjkC,IAA0BF,GAClC,MAAOA,GAAKxoB,QAAQqwC,GAAe,SAAUjY,EAAOw0B,GACnD,GAAIC,EAWJ,OAPCA,GADiB,MAAdD,EAAO,GACHpsB,GAAaosB,GACI,MAAdA,EAAO,GACVtT,SAASsT,EAAOvjC,UAAU,GAAI,IAE9BiwB,SAASsT,EAAOvjC,UAAU,GAAI,IAGjCwjC,EAIEzlD,OAAO0lD,aAAaC,GAAaF,IAHhCz0B,IAWV,QAASnmB,IAAW9G,GACnB,MAAOA,GAAInL,QAAQ0gC,GAAK,SAAS1gC,QAAQswC,GAAU,QAAQtwC,QAAQuwC,GAAa,QAQjF,QAASwc,IAAaF,GACrB,MAAKA,GAKQ,KAATA,EACI,GAIG,IAAPA,EACIA,EAKI,KAARA,EACIzc,GAAkByc,EAAO,KAItB,MAAPA,EACIA,EAII,OAARA,EACI,MAII,OAARA,EACIA,EAGD,MAlCC,MA4FT,QAASjX,IAAYpa,EAAQwxB,GAC5B,GAAIprD,EAEJ,OAAK45B,GAAOjD,YAAY,MAIxB32B,EAAQ45B,EAAO7D,YAAY91B,QAAQmrD,EAAI/V,OAEzB,KAAVr1C,GACH45B,EAAO34B,KAAOjB,EAAQorD,EAAI/V,MAAMv4C,QACvBgY,EAAGyiB,KAFb,QALQ,KAWT,QAAS8zB,IAAkB9b,GAU1B,QAAS0Q,GAAUl4C,GAClB,OAAQA,EAAK+M,GACZ,IAAKijB,IACL,IAAKE,IACL,IAAKN,IACL,IAAKK,IACJ,MAAOjwB,GAAKuF,CAEb,KAAKsqB,IACJ,MAAOooB,MAAKC,UAAUz6C,OAAOuC,EAAKuF,GAEnC,KAAKuqB,IACJ,MAAO,KAAO9vB,EAAKmF,EAAInF,EAAKmF,EAAElR,IAAIikD,GAAW9hD,KAAK,KAAO,IAAM,GAEhE,KAAK25B,IACJ,MAAO,KAAO/vB,EAAKmF,EAAInF,EAAKmF,EAAElR,IAAIikD,GAAW9hD,KAAK,KAAO,IAAM,GAEhE,KAAK+5B,IACJ,MAAOnwB,GAAKujD,EAAI,IAAMrL,EAAUl4C,EAAKuF,EAEtC,KAAKgrB,IACJ,OAAmB,WAAXvwB,EAAK2L,EAAiB,UAAY3L,EAAK2L,GAAKusC,EAAUl4C,EAAKoF,EAEpE,KAAKsrB,IACJ,MAAOwnB,GAAUl4C,EAAKoF,EAAE,KAA+B,OAAxBpF,EAAK2L,EAAEuhB,OAAO,EAAG,GAAc,IAAMltB,EAAK2L,EAAI,IAAM3L,EAAK2L,GAAKusC,EAAUl4C,EAAKoF,EAAE,GAE/G,KAAKurB,IACJ,MAAOunB,GAAUl4C,EAAKsH,GAAK,KAAOtH,EAAKoF,EAAIpF,EAAKoF,EAAEnR,IAAIikD,GAAW9hD,KAAK,KAAO,IAAM,GAEpF,KAAKo6B,IACJ,MAAO,IAAM0nB,EAAUl4C,EAAKsH,GAAK,GAElC,KAAKgpB,IACJ,MAAO4nB,GAAUl4C,EAAKsH,GAAK4wC,EAAUl4C,EAAK4P,EAE3C,KAAKygB,IACJ,MAAOrwB,GAAKod,EAAI,IAAMpd,EAAKod,EAAI,IAAM86B,EAAUl4C,EAAKsH,GAAK,GAE1D,KAAKmpB,IACJ,MAAOynB,GAAUl4C,EAAKoF,EAAE,IAAM,IAAM8yC,EAAUl4C,EAAKoF,EAAE,IAAM,IAAM8yC,EAAUl4C,EAAKoF,EAAE,GAEnF,KAAKgrB,IACJ,MAAO,IAAM/T,EAAKnkB,QAAQ8H,EAAKod,EAEhC,SACC,KAAM,IAAIrf,OAAM,8BAtDnB,GAAIse,EAIJ,OAFAmnC,IAAYhc,EAAYnrB,OAGvBzM,EAAGyM,EACH1Q,EAAGusC,EAAU1Q,IAsDf,QAASgc,IAAYxjD,EAAMqc,GAC1B,GAAIpnB,GAAGgnD,CASP,IAPIj8C,EAAK+M,IAAMqjB,IACe,KAAzB/T,EAAKnkB,QAAQ8H,EAAKod,IACrBf,EAAKnf,QAAQ8C,EAAKod,GAIpB6+B,EAAOj8C,EAAKoF,GAAKpF,EAAKmF,EAErB,GAAIoI,EAAS0uC,GACZuH,GAAYvH,EAAM5/B,OAGlB,KADApnB,EAAIgnD,EAAKlnD,OACFE,KACNuuD,GAAYvH,EAAKhnD,GAAIonB,EAKpBrc,GAAKsH,GACRk8C,GAAYxjD,EAAKsH,EAAG+U,GAGjBrc,EAAK4P,GACR4zC,GAAYxjD,EAAK4P,EAAGyM,GAGjBrc,EAAKuF,GACRi+C,GAAYxjD,EAAKuF,EAAG8W,GAKtB,QAASonC,IAAiBjc,EAAYkc,GACrC,GAAIC,EAEJ,IAAInc,EAAY,CACf,KAAOA,EAAWz6B,IAAMyjB,IAAagX,EAAWlgC,GAC/CkgC,EAAaA,EAAWlgC,CAiBzB,OAZIkgC,GAAWz6B,IAAMqjB,GACpBszB,EAAS9zC,EAAI43B,EAAWpqB,EAEpBoqB,EAAWz6B,IAAM6iB,IAAkBiX,GAAmBjuC,KAAK4uC,EAAWjiC,GACzEm+C,EAAS9zC,EAAI43B,EAAWjiC,GACdo+C,EAAsBC,GAAuBpc,IACvDkc,EAASV,GAAKW,EAEdD,EAASp8C,EAAIg8C,GAAkB9b,GAI1Bkc,GAKT,QAASE,IAAuBpc,GAI/B,IAHA,GACIqc,GADAltB,KAGG6Q,EAAWz6B,IAAMujB,IAAUkX,EAAW53B,EAAE7C,IAAMsjB,IACpDwzB,EAAarc,EAAW53B,EAEpBi0C,EAAWv8C,EACVu8C,EAAWv8C,EAAEyF,IAAMqjB,GACtBuG,EAAQz5B,QAAQ2mD,EAAWv8C,GAE3BqvB,EAAQz5B,QAAQomD,GAAkBO,EAAWv8C,IAG9CqvB,EAAQz5B,QAAQ2mD,EAAWzmC,GAG5BoqB,EAAaA,EAAWlgC,CAGzB,OAAIkgC,GAAWz6B,IAAMqjB,GACb,MAIPxgB,EAAG43B,EAAWpqB,EACdjY,EAAGwxB,GAeL,QAASmtB,IAAcjyB,GACtB,GAAIkyB,GAAUrB,EAAQ7pD,EAAM+mD,EAAQttB,EAAW0xB,CAgB/C,OAdAD,GAAWlyB,EAAO34B,IAElBL,EAAOg5B,EAAO/C,aAAa,2BAEtBj2B,IACJ6pD,EAAS7wB,EAAO/C,aAAagY,KAAkB,GAC/CjuC,GAAQ6pD,GAAU7wB,EAAOoyB,cAAgBpyB,EAAO/C,aAAaoY,KAAgBrV,EAAO/C,aAAamY,IAE5FpuC,GAAmB,MAAX6pD,IACZA,EAAS,GACT7pD,EAAO,MAIJA,EAKA6pD,GAAW7wB,EAAOoyB,eAAgB1wB,GAAS36B,KAAKC,IAMhD6pD,GAAUpvB,GAAQ16B,KAAKC,IAC3B+mD,EAAStsB,GAAQv8B,KAAK8B,GAAM,GAC5Bg5B,EAAO34B,IAAM6qD,EAAWnE,EAAO7qD,QAG9BgY,EAAGmjB,GACH3qB,EAAGq6C,KAILttB,GAAaowB,GAAU,IAAMnwB,EAAU15B,GAEnCg5B,EAAOjD,YAAY,OAItBo1B,EAAe1xB,EAAU4xB,YAAY,KAChB,KAAjBF,GACH1xB,EAAYA,EAAUpF,OAAO,EAAG82B,GAChCnyB,EAAO34B,IAAM6qD,EAAWzxB,EAAUv9B,QAElC88B,EAAO34B,KAAO,IAKf6T,EAAGqjB,GACHhT,EAAGkV,EAAUj8B,QAAQ,UAAW,MAAMA,QAAQ,SAAU,QAhCxDw7B,EAAO34B,IAAM6qD,EACN,MANA,KA4CT,QAASI,IAAmBtyB,GAC3BA,EAAO9C,iBAEP,IAAIq1B,GAAO3c,GAAe5V,EAE1B,IAAa,OAATuyB,EAAe,MAAO,KAE1B,IAAIC,IAAeD,EAKnB,IAFAvyB,EAAO9C,kBAEH8C,EAAOjD,YAAY,KAAM,CAC5B,GAAIizB,GAAOsC,GAAmBtyB,EACjB,QAATgwB,GAAehwB,EAAOhgB,MAAMs1B,IAEhCkd,EAAYvvD,KAAKoC,MAAMmtD,EAAaxC,GAGrC,MAAOwC,GAGR,QAASC,IAAezyB,GAOvB,GALKA,EAAO0yB,kBACX1yB,EAAO9C,kBAIJ8C,EAAOjD,YAAY,KAAM,CAC5BiD,EAAO9C,iBAEP,IAAIy1B,GAAU3yB,EAAO/C,aAAatuB,GAClC,IAAIgkD,EACH,OACCz3C,EAAGsjB,GACHjT,EAAGonC,EAIL3yB,GAAOhgB,MAAM,4BAId,GAAIggB,EAAOjD,YAAY,KAAM,CAC5BiD,EAAO9C,iBAEP,IAAIq1B,GAAO3c,GAAe5V,EAO1B,OANKuyB,IAAMvyB,EAAOhgB,MAAMs1B,IAExBtV,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAAMiD,EAAOhgB,MAAM,iBAG1C9E,EAAGsjB,GACH/oB,EAAG88C,GAIL,MAAO,MAGR,QAASK,IAAwB5yB,GAChC,IAAKA,EAAOjD,YAAY,KAAM,MAAO,KAErCiD,GAAO9C,iBAEP,IAAIq1B,GAAO3c,GAAe5V,EAQ1B,OANKuyB,IAAMvyB,EAAOhgB,MAAMs1B,IAExBtV,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAAMiD,EAAOhgB,MAAMu1B,KAG1Cr6B,EAAGyjB,GACHlpB,EAAG88C,GAKL,QAASM,IAAkB7yB,GAC1B,GAAIl6B,EAEJ,QAAIA,EAASk6B,EAAO/C,aAAauY,MAE/Bt6B,EAAGkjB,GACH1qB,EAAG5N,GAIE,KAGR,QAASgtD,IAAkB9yB,GAC1B,GAAIr9B,GAAOowD,CAOX,OALApwD,GAAQq9B,EAAO34B,IAGf24B,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAKxBg2B,EAAiBT,GAAmBtyB,GAE/BA,EAAOjD,YAAY,MAMvB7hB,EAAG+iB,GACH3qB,EAAGy/C,IANH/yB,EAAO34B,IAAM1E,EACN,QARPq9B,EAAO34B,IAAM1E,EACN,MAgBT,QAASqwD,IAAiBhzB,GACzB,GAAIr9B,GAAOgR,EAAKvT,CAQhB,OANAuC,GAAQq9B,EAAO34B,IAGf24B,EAAO9C,kBAEPvpB,EAAMw8C,GAAQnwB,GACF,OAARrsB,GACHqsB,EAAO34B,IAAM1E,EACN,OAIRq9B,EAAO9C,kBAGF8C,EAAOjD,YAAY,MAMxBiD,EAAO9C,kBAGP98B,EAAQw1C,GAAe5V,GACT,OAAV5/B,GACH4/B,EAAO34B,IAAM1E,EACN,OAIPuY,EAAGojB,GACHozB,EAAG/9C,EACHD,EAAGtT,KAjBH4/B,EAAO34B,IAAM1E,EACN,OAoBT,QAASswD,IAAkBjzB,GAC1B,GAAIr9B,GAAOuwD,EAAO5yB,EAAM6yB,CAKxB,OAHAxwD,GAAQq9B,EAAO34B,IAEfi5B,EAAO0yB,GAAiBhzB,GACX,OAATM,EACI,MAGR4yB,GAAS5yB,GAELN,EAAOjD,YAAY,MACtBo2B,EAAgBF,GAAkBjzB,GAE7BmzB,EAKED,EAAM9tD,OAAO+tD,IAJnBnzB,EAAO34B,IAAM1E,EACN,OAMFuwD,GAGR,QAASE,IAAmBpzB,GAC3B,GAAIr9B,GAAOwwD,CAOX,OALAxwD,GAAQq9B,EAAO34B,IAGf24B,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAKxBo2B,EAAgBF,GAAkBjzB,GAGlCA,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAMvB7hB,EAAGgjB,GACH5qB,EAAG6/C,IANHnzB,EAAO34B,IAAM1E,EACN,QAXPq9B,EAAO34B,IAAM1E,EACN,MAmBT,QAAS0wD,IAAmBrzB,GAC3B,GAAI7D,GAAY6D,EAAO7D,WAEvB,OAA+B,SAA3BA,EAAUd,OAAO,EAAG,IACvB2E,EAAO34B,KAAO,GAEb6T,EAAGijB,GACHzqB,EAAG,SAI0B,UAA3ByoB,EAAUd,OAAO,EAAG,IACvB2E,EAAO34B,KAAO,GAEb6T,EAAGijB,GACHzqB,EAAG,UAIE,KAGR,QAAS4/C,IAAYtzB,GACpB,MAAOkwB,IAAmBlwB,IAAWqzB,GAAmBrzB,IAAWI,GAAkBJ,IAAWozB,GAAkBpzB,IAAW8yB,GAAiB9yB,IAAW6yB,GAAkB7yB,GAG5K,QAASuzB,IAAavzB,GACrB,MAAOszB,IAAYtzB,IAAWiyB,GAAcjyB,IAAW4yB,GAAwB5yB,GAGhF,QAAS+V,IAAwB/V,GAChC,GAAI2V,GAAa4d,GAAYvzB,EAE7B,KAAK2V,EAAY,MAAO,KAExB,MAAOA,GAAY,CAClB,GAAIqc,GAAaS,GAAezyB,EAChC,IAAIgyB,EACHrc,GACCz6B,EAAGujB,GACHhpB,EAAGkgC,EACH53B,EAAGi0C,OAEE,CAAA,IAAIhyB,EAAOjD,YAAY,KAiB7B,KAhBAiD,GAAO9C,iBACP,IAAI61B,GAAiBT,GAAmBtyB,EAExCA,GAAO9C,kBAEF8C,EAAOjD,YAAY,MACvBiD,EAAOhgB,MAAMu1B,IAGdI,GACCz6B,EAAG4jB,GACHrpB,EAAGkgC,GAGAod,IAAgBpd,EAAWpiC,EAAIw/C,IAMrC,MAAOpd,GA4HR,QAAS6d,IAAexzB,GACvB,GAAIr9B,GAAOgzC,EAAY8d,EAAQC,CAG/B,QADA/d,EAAaK,GAAchW,KAK3Br9B,EAAQq9B,EAAO34B,IAEf24B,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAKxBiD,EAAO9C,kBAEPu2B,EAAS7d,GAAe5V,GACnByzB,GACJzzB,EAAOhgB,MAAMs1B,IAGdtV,EAAO9C,kBAEF8C,EAAOjD,YAAY,MACvBiD,EAAOhgB,MAAM,gBAGdggB,EAAO9C,kBAEPw2B,EAAU9d,GAAe5V,GACpB0zB,GACJ1zB,EAAOhgB,MAAMs1B,KAIbp6B,EAAG0jB,GACHrrB,GAAIoiC,EAAY8d,EAAQC,MA1BxB1zB,EAAO34B,IAAM1E,EACNgzC,IATA,KAsCT,QAASC,IAAe5V,GAOvB,MAAOwzB,IAAexzB,GAGvB,QAAS2zB,IAA0B3zB,EAAQ4zB,GAC1C,GAAIjxD,GAAOgzC,EAAYvyC,CAKvB,IAHAT,EAAQq9B,EAAO34B,IACfsuC,EAAaC,GAAe5V,IAEvB2V,EACJ,MAAO,KAGR,KAAKvyC,EAAI,EAAGA,EAAIwwD,EAAkB1wD,OAAQE,GAAK,EAC9C,GAAI48B,EAAO7D,YAAYd,OAAO,EAAGu4B,EAAkBxwD,GAAGF,UAAY0wD,EAAkBxwD,GACnF,MAAOuyC,EAKT,OADA3V,GAAO34B,IAAM1E,EACNsvD,GAAcjyB,GAGtB,QAASma,IAAiBna,EAAQwxB,GACjC,GAAI7uD,GAAOgzC,EAAY/jC,EAAc0N,CAErC3c,GAAQq9B,EAAO34B,GAGf,KACCsuC,EAAage,GAA0B3zB,GAASwxB,EAAI/V,QACnD,MAAO5oC,GACRyM,EAAMzM,EAGP,IAAK8iC,EAAY,CAChB,GAAiC,MAA7B3V,EAAOrwB,IAAIge,OAAOhrB,GAGrB,MADAq9B,GAAO34B,IAAM1E,EACN,IAGR,IAAI2c,EACH,KAAMA,GAIR,IAAK0gB,EAAOjD,YAAYy0B,EAAI/V,SAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,sBAEtD9F,GAAY,CAEhB,GAA0B,MAAtB3V,EAAO7C,WACV,MAAO,KAGR6C,GAAOhgB,MAAM,0CAOf,MAHApO,IAAiBsJ,EAAGnJ,IACpB6/C,GAAiBjc,EAAY/jC,GAEtBA,EAIR,QAASsoC,IAAYla,EAAQwxB,GAC5B,IAAKxxB,EAAO/C,aAAamZ,IAAe,MAAO,KAE/C,IAAIpvC,GAAOg5B,EAAO/C,aAAa,8BAE/B+C,GAAO9C,kBAEF8C,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,8BAGd,IAAI6zC,IAAY34C,EAAGiK,GAGnB,OAFIne,KAAM6sD,EAAQtoC,EAAIvkB,GAEf6sD,EAYR,QAASC,IAAS9zB,EAAQwxB,GACzB,GAAI7uD,GAAQq9B,EAAO34B,GAEnB,OAAK24B,GAAOjD,YAAYy0B,EAAIhW,MAIvBxb,EAAO/C,aAAa0Z,KAKpB3W,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAiCwxC,EAAI/V,MAAQ,MAI1DvgC,EAAG6jB,MATHiB,EAAO34B,IAAM1E,EACN,MALA,KAkBT,QAASoxD,IAAW/zB,EAAQwxB,GAC3B,GAAI7uD,GAAQq9B,EAAO34B,GAEnB,KAAK24B,EAAOjD,YAAYy0B,EAAIhW,MAC3B,MAAO,KAGR,KAAKxb,EAAO/C,aAAa2Z,IAExB,MADA5W,GAAO34B,IAAM1E,EACN,IAGR,IAAIgzC,GAAaC,GAAe5V,EAMhC,OAJKA,GAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,MAI3DvgC,EAAG8jB,GACHvpB,EAAGkgC,GAIL,QAASqe,IAAYh0B,EAAQwxB,GAC5B,GAAI7uD,GAAOw5B,EAAW/1B,EAAO6tD,CAI7B,OAFAtxD,GAAQq9B,EAAO34B,IAEV24B,EAAOjD,YAAYy0B,EAAIhW,OAI5Bxb,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAKxBiD,EAAO9C,kBAEPf,EAAY6D,EAAO7D,YACnB/1B,EAAQ+1B,EAAU91B,QAAQmrD,EAAI/V,OAEhB,KAAVr1C,GACH6tD,GACC/4C,EAAGwiB,GACH3f,EAAGoe,EAAUd,OAAO,EAAGj1B,GAAOyN,MAAM,KAAK,IAG1CmsB,EAAO34B,KAAOjB,EAET45B,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,KAGrDwY,IAGRj0B,EAAO34B,IAAM1E,EACN,QAzBNq9B,EAAO34B,IAAM1E,EACN,OAPA,KAqCT,QAASs3C,IAAYja,EAAQwxB,GAC5B,GAAI7uD,GAAOgzC,EAAYue,EAAS1zC,EAAO1B,EAAUq1C,EAASC,EAAOC,EAAaC,EAAYC,EAAQnxD,EAAGoxD,CAIrG,IAFA7xD,EAAQq9B,EAAO34B,IAEX24B,EAAOjD,YAAY,KACtBm3B,GAAYh5C,EAAGiM,GAAShT,KAAOoX,EAAGI,QAC5B,CAAA,IAAIqU,EAAOjD,YAAY,KAa7B,MAAO,KAZPm3B,IAAYh5C,EAAGiM,GAAShT,MAEpB6rB,EAAOjD,YAAY,aACtBiD,EAAO34B,IAAM1E,EAAQq9B,EAAOob,mBAAmB,GAAGl4C,OAClD88B,EAAOhgB,MAAM,wGAGVo0C,EAAQp0B,EAAO/C,aAAa8Z,OAC/Byd,EAAgBJ,EAChBF,EAAQ3oC,EAAI8qB,GAAqB+d,IAenC,GATAp0B,EAAO9C,kBAEPyY,EAAaC,GAAe5V,GAEvB2V,GACJ3V,EAAOhgB,MAAM,uBAIV5c,EAAI48B,EAAO/C,aAAa4Z,IAAkB,CAC7C,GAAI4d,GAAQ7xD,QAER6xD,EAAQz0B,EAAO/C,aAAa6Z,KAC/Bod,EAAQ9wD,EAAIA,EAAI,IAAMqxD,EAEtBP,EAAQ9wD,EAAIA,EAId48B,EAAO9C,kBAEF8C,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,KAG5Dzb,EAAO4b,cAAgB,EACvB98B,EAAWo1C,EAAQ//C,EAEnBmgD,IAEA,GACC,IAAI9zC,EAAQwzC,GAAYh0B,EAAQwxB,GAC3BgD,GAAiBh0C,EAAMzC,IAAMy2C,GAChCx0B,EAAOhgB,MAAM,YAAcwxC,EAAIhW,KAAO,IAAMgZ,EAAgBhD,EAAI/V,OAGjEzb,EAAO4b,cAAgB,EACvB2Y,GAAS,MACH,IAAI/zC,EAAQuzC,GAAW/zB,EAAQwxB,GACjC0C,EAAQ3oC,IAAMI,IACjBqU,EAAOhgB,MAAM,uCAGVm0C,GACHn0B,EAAOhgB,MAAM,wCAGTq0C,IACJA,EAAcK,GAAkB/e,IAGjC0e,EAAYlgD,EAAElR,MACbiY,EAAGiM,GACHoE,EAAGK,GACHnW,EAAGg8C,GAAkBkD,GAAWL,EAAWlvD,OAAOob,EAAM/K,KACxDtB,EAAG2K,OAGJw1C,EAAWrxD,KAAK2xD,GAAOp0C,EAAM/K,QACvB,IAAI+K,EAAQszC,GAAS9zB,EAAQwxB,GAC/B0C,EAAQ3oC,IAAMI,IACjBqU,EAAOhgB,MAAM,uCAGVm0C,GACHn0B,EAAOhgB,MAAM,iEAGdm0C,GAAU,EAGLE,EAIJA,EAAYlgD,EAAElR,MACbiY,EAAGiM,GACHoE,EAAGK,GACHnW,EAAGg8C,GAAkBkD,GAAWL,IAChCngD,EAAG2K,QAPJu1C,EAAcK,GAAkB/e,GAChC72B,EAAWu1C,EAAYlgD,OASlB,CAGN,GAFAqM,EAAQwf,EAAO/D,KAAKwe,KAEfj6B,EACJ,KAGD1B,GAAS7b,KAAKud,UAEN+zC,EAwBV,OAtBIF,KAKCH,EAAQ3oC,IAAMG,KACjBwoC,EAAQ3oC,EAAIM,IAGbqoC,EAAQp6B,EAAIu6B,GAGbzC,GAAiBjc,EAAYue,GAMxBA,EAAQ//C,EAAEjR,cACPgxD,GAAQ//C,EAGT+/C,EAGR,QAASQ,IAAkB/e,GAC1B,GAAI0e,IACHn5C,EAAGiM,GACHoE,EAAGI,GACHxX,KAID,OADAy9C,IAAiBjc,EAAY0e,GACtBA,EAGR,QAASO,IAAOjf,GACf,MAAIA,GAAWz6B,IAAMwjB,IAAoC,MAAjBiX,EAAW77B,EAC3C67B,EAAWpiC,GAIlB2H,EAAGwjB,GACH5kB,EAAG,IACHvG,EAAGshD,GAAkBlf,IAIvB,QAASgf,IAAWnC,GACnB,MAA2B,KAAvBA,EAAYtvD,OACRsvD,EAAY,IAInBt3C,EAAG2jB,GACH/kB,EAAG,KACHvG,GAAIshD,GAAkBrC,EAAY,IAAKqC,GAAkBF,GAAWnC,EAAYtwD,MAAM,OAIxF,QAAS2yD,IAAkBlf,GAE1B,OACCz6B,EAAGyjB,GACHlpB,EAAGkgC,GAIL,QAASqE,IAAcha,EAAQwxB,GAC9B,GAAI7b,GAAYmf,CAEhB,OAAK90B,GAAOjD,YAAY,MAIxBiD,EAAO9C,mBAEPyY,EAAaC,GAAe5V,KAMvBA,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,KAG5DqZ,GAAW55C,EAAGmM,IACduqC,GAAiBjc,EAAYmf,GAEtBA,GAVC,MARA,KAqBT,QAAS/a,IAAY/Z,EAAQwxB,GAC5B,IAAKxxB,EAAOjD,YAAY,KAAM,MAAO,KAErCiD,GAAO9C,kBAMP8C,EAAOoyB,aAAepyB,EAAO0yB,kBAAmB,CAChD,IAAI/c,GAAaC,GAAe5V,EAChCA,GAAOoyB,aAAepyB,EAAO0yB,kBAAmB,EAEhD1yB,EAAO9C,iBACP,IAAI57B,GAAUs0C,GAAe5V,EAG7B,IAFAA,EAAO9C,mBAEFyY,EAAY,MAAO,KAExB,IAAI2P,IAAYpqC,EAAG+L,GAqBnB,OApBA2qC,IAAiBjc,EAAY2P,GAE7BtlB,EAAO9C,kBAIH57B,IACHgkD,GACCpqC,EAAGiM,GACHoE,EAAGG,GACHvX,GAAImxC,IAGLsM,GAAiBtwD,EAASgkD,IAGtBtlB,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,KAGrD6J,EAGR,QAAShL,IAAWta,EAAQwxB,GAC3B,GACIsD,GADAnf,EAAaC,GAAe5V,EAGhC,OAAK2V,IAIA3V,EAAOjD,YAAYy0B,EAAI/V,QAC3Bzb,EAAOhgB,MAAM,+BAAkCwxC,EAAI/V,MAAQ,KAG5DqZ,GAAW55C,EAAGmM,IACduqC,GAAiBjc,EAAYmf,GAEtBA,GAVC,KAaT,QAASC,IAAgBlW,EAAUmW,GAClC,GAAI5xD,GAAGgD,EAAO6uD,CAGd,KADA7xD,EAAI4xD,EAAQ9xD,OACLE,KAAK,CAIX,GAHAgD,EAAQy4C,EAASx4C,QAAQ2uD,EAAQ5xD,KAG5BgD,EACJ,MAAO,EAGM,MAAVA,KAIC6uD,GAAkBA,EAAR7uD,KACd6uD,EAAS7uD,GAIX,MAAO6uD,IAAU,GAGlB,QAASpa,IAAS7a,GACjB,GAAI55B,GAAO+1B,EAAW+4B,EAAYC,CA8BlC,OA5BAh5B,GAAY6D,EAAO7D,YAEnBg5B,EAAUn1B,EAAOo1B,OAAS,KAAOp1B,EAAOo1B,OAAS,IAE7Cp1B,EAAOo1B,SAAWp1B,EAAOzR,YAAYyR,EAAOo1B,QAC/ChvD,EAAQ+1B,EAAU91B,QAAQ8uD,IAE1BD,EAAal1B,EAAOsb,KAAKl5C,IAAI,SAAU8Y,GACtC,MAAOA,GAAEsgC,OAEV0Z,EAAaA,EAAW9vD,OAAO46B,EAAOsb,KAAKl5C,IAAI,SAAU8Y,GACxD,MAAO,KAAOA,EAAEsgC,QAIbxb,EAAOq1B,eAAgB,EAE1BH,EAAWjyD,KAAK,IAAK,IAAM,IAAK,IAAK,IAAK,KAChC+8B,EAAOq1B,YAEjBH,EAAWjyD,KAAK+8B,EAAOq1B,aAEvBH,EAAWjyD,KAAKkyD,GAGjB/uD,EAAQ2uD,GAAe54B,EAAW+4B,IAG9B9uD,GAIS,KAAVA,IACHA,EAAQ+1B,EAAUj5B,QAGnB88B,EAAO34B,KAAOjB,EAEP45B,EAAOo1B,OAASj5B,EAAUd,OAAO,EAAGj1B,GAAS8mB,GAA0BiP,EAAUd,OAAO,EAAGj1B,KAT1F,KAYT,QAASkvD,IAAgBzjD,EAAO0jD,EAAgBC,GAC/C,GAAIxvD,EAEAuvD,KACHvvD,EAAO6L,EAAM,GACO,gBAAT7L,KACVA,EAAOA,EAAKxB,QAAQ+wD,EAAgB,IAE/BvvD,EAGJ6L,EAAM,GAAK7L,EAFX6L,EAAMpH,UAOL+qD,IACHxvD,EAAOihD,EAASp1C,GACI,gBAAT7L,KACVA,EAAOA,EAAKxB,QAAQgxD,EAAiB,IAEhCxvD,EAGJ6L,EAAMA,EAAM3O,OAAS,GAAK8C,EAF1B6L,EAAM5Q,QAUV,QAASw0D,IAAkB5jD,GAC1B,GAAIzO,GAAGuuB,EAAS+jC,EAASC,EAASC,CAElC,KAAKxyD,EAAI,EAAGA,EAAIyO,EAAM3O,OAAQE,GAAK,EAClCuuB,EAAU9f,EAAMzO,GAChBsyD,EAAU7jD,EAAMzO,EAAI,GACpBuyD,EAAU9jD,EAAMzO,EAAI,GAGhByyD,GAASlkC,IAAYmkC,GAAUJ,IAAYG,GAASF,IAGnD1e,GAAkBlwC,KAAK4uD,IAAY3e,GAAiBjwC,KAAK4qB,KAG5D9f,EAAMzO,EAAI,GAAKuyD,EAAQnxD,QAAQyyC,GAAmB,MAGlDplC,EAAMzO,GAAKuuB,EAAQntB,QAAQwyC,GAAkB,KAM3C+e,GAAUpkC,IAAYkkC,GAASH,IAC9Bze,GAAkBlwC,KAAK2uD,IAAYG,GAASlkC,EAAQxd,EAAE,KAAO6iC,GAAiBjwC,KAAK4qB,EAAQxd,EAAE,MAChGtC,EAAMzO,EAAI,GAAKsyD,EAAQlxD,QAAQyyC,GAAmB,MAClDtlB,EAAQxd,EAAE,GAAKwd,EAAQxd,EAAE,GAAG3P,QAAQwyC,GAAkB,KAMpD6e,GAASlkC,IAAYokC,GAAUL,KAClCE,EAAkB3O,EAASyO,EAAQvhD,GAE/B0hD,GAASD,IAAoB3e,GAAkBlwC,KAAK6uD,IAAoB5e,GAAiBjwC,KAAK4qB,KACjG+jC,EAAQvhD,EAAEuhD,EAAQvhD,EAAEjR,OAAS,GAAK0yD,EAAgBpxD,QAAQyyC,GAAmB,MAC7EplC,EAAMzO,GAAKuuB,EAAQntB,QAAQwyC,GAAkB,KAKhD,OAAOnlC,GAGR,QAASgkD,IAAS7vD,GACjB,MAAuB,gBAATA,GAGf,QAAS8vD,IAAU9vD,GAClB,MAAOA,GAAKkV,IAAMyiB,IAAW33B,EAAKkV,IAAM0iB,GAGzC,QAASm4B,IAAU/vD,GAClB,OAAQA,EAAKkV,IAAMiM,IAAWnhB,EAAKkV,IAAMuiB,KAAaz3B,EAAKmO,EAS5D,QAASooC,IAAQ1qC,EAAOqqC,EAAeC,EAAoB6Z,EAAyBC,GACnF,GAAI7yD,GAAG4C,EAAMkwD,EAAc3tC,EAAU4tC,EAAkCC,EAAuCC,EAAwC1iD,CAMtJ,KAHA8hD,GAAiB5jD,GAEjBzO,EAAIyO,EAAM3O,OACHE,KACN4C,EAAO6L,EAAMzO,GAGT4C,EAAK+xC,QACRlmC,EAAMvL,OAAOlD,EAAG,GAIR84C,GAAiBl2C,EAAKkV,IAAMyiB,IACnC9rB,EAAMvL,OAAOlD,EAAG,EAQnB,KAHAkyD,GAAezjD,EAAOmkD,EAA0B5e,GAAoB,KAAM6e,EAA2B5e,GAAqB,MAE1Hj0C,EAAIyO,EAAM3O,OACHE,KAAK,CAIX,GAHA4C,EAAO6L,EAAMzO,GAGT4C,EAAKmO,EAAG,CACX,GAAImiD,GAA8BtwD,EAAKkV,IAAMjI,IAAWkkC,GAA2BpwC,KAAKf,EAAK6M,EAC7FsjD,GAAmCha,GAAsBma,GAEpDna,GAAsBma,GAC1BhB,GAAetvD,EAAKmO,EAAGmjC,GAAgBC,IAGnC4e,IACJD,EAAerkD,EAAMzO,EAAI,GACzBmlB,EAAW1W,EAAMzO,EAAI,KAIhB8yD,GAAwC,gBAAjBA,IAA6B7e,GAAmBtwC,KAAKmvD,MAChFE,GAAwC,KAIpC7tC,GAAgC,gBAAbA,IAAyB6uB,GAAkBrwC,KAAKwhB,MACvE8tC,GAAyC,IAI3C9Z,GAAQv2C,EAAKmO,EAAG+nC,EAAeia,EAAkCC,EAAuCC,GAYzG,GARIrwD,EAAK8zB,IACRyiB,GAAQv2C,EAAK8zB,EAAE3lB,EAAG+nC,EAAeC,EAAoBia,EAAuCC,GAE5FxkD,EAAMvL,OAAOlD,EAAI,EAAG,EAAG4C,EAAK8zB,SACrB9zB,GAAK8zB,GAIT9zB,EAAK8J,EACR,IAAK6D,IAAO3N,GAAK8J,EACZ9J,EAAK8J,EAAEyQ,eAAe5M,IAA+B,gBAAhB3N,GAAK8J,EAAE6D,IAC/C4oC,GAAQv2C,EAAK8J,EAAE6D,GAAMuoC,EAAeC,EAAoBia,EAAuCC,EAWlG,IALIrwD,EAAKsN,GACRipC,GAAQv2C,EAAKsN,EAAG4oC,EAAeC,EAAoBia,EAAuCC,GAIvFrwD,EAAK0N,EACR,IAAKC,IAAO3N,GAAK0N,EACZ1N,EAAK0N,EAAE6M,eAAe5M,KAErBrQ,EAAQ0C,EAAK0N,EAAEC,GAAK4X,IACvBgxB,GAAQv2C,EAAK0N,EAAEC,GAAK4X,EAAG2wB,EAAeC,EAAoBia,EAAuCC,GAI9F/yD,EAAQ0C,EAAK0N,EAAEC,GAAK2d,IACvBirB,GAAQv2C,EAAK0N,EAAEC,GAAK2d,EAAG4qB,EAAeC,EAAoBia,EAAuCC,IAStG,IADAjzD,EAAIyO,EAAM3O,OACHE,KACkB,gBAAbyO,GAAMzO,KACY,gBAAjByO,GAAMzO,EAAI,KACpByO,EAAMzO,GAAKyO,EAAMzO,GAAKyO,EAAMzO,EAAI,GAChCyO,EAAMvL,OAAOlD,EAAI,EAAG,IAGhB+4C,IACJtqC,EAAMzO,GAAKyO,EAAMzO,GAAGoB,QAAQ0yC,GAAsB,MAGlC,KAAbrlC,EAAMzO,IACTyO,EAAMvL,OAAOlD,EAAG,IAOpB,QAASmzD,IAAev2B,GACvB,GAAIr9B,GAAO6uD,CAKX,OAHA7uD,GAAQq9B,EAAO34B,IAGV24B,EAAOjD,YAAY,OAIpBy0B,EAAMxxB,EAAO/C,aAAaua,KACzBxX,EAAOo1B,QAAU5D,IAAQxxB,EAAOo1B,QACnCp1B,EAAO34B,IAAM1E,EACN,OAIPuY,EAAG2iB,GACHhrB,EAAG2+C,IAKLxxB,EAAO34B,KAAO,MACd24B,GAAOhgB,MAAM,wBAjBL,KA6BT,QAASw2C,IAAiBC,EAAQC,GACjC,GAAI5wD,GAAQ82B,EAAOoD,EAAQ76B,EAAMirD,EAAOrQ,EAAY4W,EAAeC,EAAev2D,CAElF,IAAsB,gBAAXo2D,GAAqB,CAC/B,GAAI75B,EAAQ6a,GAAkBvyC,KAAKuxD,GAAS,CAC3C,GAAI/7C,GAAM+7C,EAAOpE,YAAY,IAGxB3a,IAAwB3wC,KAAK0vD,IACjCC,EAAa12C,MAAM,+CAAkDy2C,EAAOv0D,MAAMwY,EAAM,GAAK,KAG9F5U,GAAWwN,EAAGspB,EAAM,GACpB,IAAI76B,GAAS00D,EAAOv0D,MAAM4D,EAAOwN,EAAEpQ,OAAS,EAAGwX,EAY/C,OAVe,iBAAX3Y,EAGH+D,EAAOmwB,GAAI,GAEX9wB,EAAO,IAAMpD,EAAS,IACtBi+B,EAAS,GAAImW,IAAiBhxC,GAC9BW,EAAOgK,EAAI2hD,GAAkBzxB,EAAOl6B,OAAO,KAGrCA,EAGR,GAA4B,KAAxB2wD,EAAOpwD,QAAQ,KAClB,MAAOowD,GAAO5qD,MAGf4qD,IAAUA,GAQX,GALA3wD,KAEA6wD,KACAC,KAEIH,EAAQ,CACX,KAAOA,EAAOvzD,QAGb,GAFAktD,EAAQqG,EAAOhsD,QAEM,gBAAV2lD,GAAoB,CAG9B,GAFArQ,EAAaqQ,EAAM/pD,QAAQ,KAER,KAAf05C,EAEG,CAEFA,GAEH4W,EAAc1zD,KAAKmtD,EAAM/0B,OAAO,EAAG0kB,IAKhCqQ,EAAMltD,OAAS68C,EAAa,IAC/B6W,EAAc,GAAKxG,EAAMviC,UAAUkyB,EAAa,GAGjD,OAdA4W,EAAc1zD,KAAKmtD,OAiBpBuG,GAAc1zD,KAAKmtD,EAIrBwG,GAAgBA,EAAcxxD,OAAOqxD,GAqBtC,MAlBKE,GAAczzD,OAER0zD,EAAc1zD,QAAmC,gBAAlByzD,IACzC7wD,GAECylB,EAA4B,IAAzBorC,EAAczzD,QAA4C,gBAArByzD,GAAc,GAAkBA,EAAc,GAAKA,GAG/D,IAAzBC,EAAc1zD,QAA4C,gBAArB0zD,GAAc,IACtDv2D,EAASmlB,GAAU,IAAMoxC,EAAc,GAAK,KAC5C9wD,EAAOgK,EAAIzP,EAASA,EAAOD,OAASw2D,EAAc,GAAG/qD,SAErD/F,EAAOwrB,EAAIslC,GAGZ9wD,EAAS6wD,EAdT7wD,EAAS,GAiBHA,EAKR,QAAS+wD,IAAoB72B,GAC5B,GAAIr9B,GAAOm0D,EAAS7C,CAEpB,OAAKj0B,GAAOjD,YAAY,MAIxBp6B,EAAQq9B,EAAO34B,IAGf24B,EAAO9C,mBAEP45B,EAAU92B,EAAO/C,aAAa2a,KAOzB5X,EAAO/C,aAAa4a,KAIzBoc,EAAUj0B,EAAO/C,aAAa2a,MAO9B5X,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAKhB+5B,EAAS7C,IAJhBj0B,EAAO34B,IAAM1E,EACN,QATPq9B,EAAO34B,IAAM1E,EACN,MANA,MANPq9B,EAAO34B,IAAM1E,EACN,OAXA,KAqCT,QAAS+3C,IAAa1a,GACrB,GAAI6xB,GAAUzuD,CAId,IAAI48B,EAAOzR,YAAYyR,EAAOo1B,WAAY,EACzC,MAAO,KAGR,KAAKhyD,EAAI,EAAGA,EAAI48B,EAAOsb,KAAKp4C,OAAQE,GAAK,EACxC,GAAIyuD,EAAWkF,GAAmB/2B,EAAQA,EAAOsb,KAAKl4C,IACrD,MAAOyuD,GAKV,QAASkF,IAAmB/2B,EAAQwxB,GACnC,GAAI7uD,GAAOkvD,EAAUmF,EAAQ5zD,CAI7B,IAFAT,EAAQq9B,EAAO34B,IAEX24B,EAAOjD,YAAY,KAAOy0B,EAAIhW,OACjC,GAAc,IAAV74C,GAAyC,OAA1Bq9B,EAAOrwB,IAAIhN,EAAQ,GACrC,MAAO6uD,GAAIhW,SAEN,KAAKxb,EAAOjD,YAAYy0B,EAAIhW,MAClC,MAAO,KAIR,IAAIqW,EAAWgF,GAAoB72B,GAElC,MAAKA,GAAOjD,YAAYy0B,EAAI/V,QAK5B+V,EAAIhW,KAAOqW,EAAS,GACpBL,EAAI/V,MAAQoW,EAAS,GACrB7xB,EAAO2b,mBAEA7D,IARC,IAcT,IAHA9X,EAAO9C,kBAGH8C,EAAOjD,YAAY,KAAM,CAC5BiD,EAAO34B,KAAO,CACd,IAAI4vD,GAASj3B,EAAO34B,GACfwrD,IAAkB7yB,GAItBA,EAAO34B,IAAM4vD,GAHbj3B,EAAO34B,IAAM4vD,EAASzF,EAAI/V,MAAMv4C,OAChC88B,EAAOhgB,MAAM,kDAMf,IAAK5c,EAAI,EAAGA,EAAIouD,EAAI9V,QAAQx4C,OAAQE,GAAK,EAGxC,GAFA4zD,EAASxF,EAAI9V,QAAQt4C,GAEjByuD,EAAWmF,EAAOh3B,EAAQwxB,GAS7B,MARIA,GAAIzsB,WACP8sB,EAAS/3C,GAAI,GAGVkmB,EAAOsc,uBACVuV,EAASx2C,EAAI2kB,EAAO1D,WAAW35B,IAGzBkvD,CAKT,OADA7xB,GAAO34B,IAAM1E,EACN,KAKR,QAASu0D,IAAcl3B,GACtB,GAAIm3B,GAAMnwD,EAAM5G,CAKhB,OAHA4/B,GAAO9C,mBAEPl2B,EAAOg5B,EAAO/C,aAAa+a,MAK3Bmf,GAASnwD,KAAMA,GAEf5G,EAAQg3D,GAAmBp3B,GACd,MAAT5/B,IAEH+2D,EAAK/2D,MAAQA,GAGP+2D,GAXC,KAcT,QAASC,IAAmBp3B,GAC3B,GAAIr9B,GAAO00D,EAAYC,EAAYl3D,CAWnC,OATAuC,GAAQq9B,EAAO34B,IAGV,WAAWN,KAAKi5B,EAAO7C,aAC3B6C,EAAOhgB,MAAM,wCAGdggB,EAAO9C,kBAEF8C,EAAOjD,YAAY,MAKxBiD,EAAO9C,kBAEPm6B,EAAar3B,EAAO34B,IACpBiwD,EAAat3B,EAAO4b,aAEpBx7C,EAAQm3D,GAAyBv3B,EAAQ,MAASu3B,GAAyBv3B,EAAQ,MAAQw3B,GAA2Bx3B,GAExG,OAAV5/B,GACH4/B,EAAOhgB,MAAM,kCAGVggB,EAAO4b,eAAiB0b,IAC3Bt3B,EAAO34B,IAAMgwD,EACbr3B,EAAOhgB,MAAM,yFAGT5f,EAAM8C,OAIU,IAAjB9C,EAAM8C,QAAoC,gBAAb9C,GAAM,GAC/B8sB,GAA0B9sB,EAAM,IAGjCA,EAPC,KArBP4/B,EAAO34B,IAAM1E,EACN,MA8BT,QAAS80D,IAAgCz3B,GACxC,GAAIr9B,GAAO+0D,EAAM7Y,EAAUmW,EAAS5uD,CAMpC,OAJAzD,GAAQq9B,EAAO34B,KAEfqwD,EAAO13B,EAAO/C,aAAagb,MAM3B4G,EAAW6Y,EACX1C,EAAUh1B,EAAOsb,KAAKl5C,IAAI,SAAU8Y,GACnC,MAAOA,GAAEsgC,OAG0C,MAA/Cp1C,EAAQ2uD,GAAelW,EAAUmW,MACrC0C,EAAOA,EAAKr8B,OAAO,EAAGj1B,GACtB45B,EAAO34B,IAAM1E,EAAQ+0D,EAAKx0D,QAGpBw0D,GAbC,KAgBT,QAASF,IAA2Bx3B,GACnC,GAAIy2B,GAAQrG,CAOZ,KALApwB,EAAOq1B,aAAc,EAErBoB,KAEArG,EAAQ1V,GAAa1a,IAAWy3B,GAAgCz3B,GAC/C,OAAVowB,GACNqG,EAAOxzD,KAAKmtD,GACZA,EAAQ1V,GAAa1a,IAAWy3B,GAAgCz3B,EAGjE,OAAKy2B,GAAOvzD,QAIZ88B,EAAOq1B,aAAc,EACdoB,GAJC,KAOT,QAASc,IAAyBv3B,EAAQ23B,GACzC,GAAIh1D,GAAO8zD,EAAQrG,CAInB,IAFAztD,EAAQq9B,EAAO34B,KAEV24B,EAAOjD,YAAY46B,GACvB,MAAO,KAQR,KALA33B,EAAOq1B,YAAcsC,EAErBlB,KAEArG,EAAQ1V,GAAa1a,IAAW43B,GAAsB53B,EAAQ23B,GAC7C,OAAVvH,GACNqG,EAAOxzD,KAAKmtD,GACZA,EAAQ1V,GAAa1a,IAAW43B,GAAsB53B,EAAQ23B,EAG/D,OAAK33B,GAAOjD,YAAY46B,IAKxB33B,EAAOq1B,aAAc,EAEdoB,IANNz2B,EAAO34B,IAAM1E,EACN,MAQT,QAASi1D,IAAsB53B,EAAQ23B,GACtC,GAAI9Y,GAAW7e,EAAO7D,YAElB64B,EAAUh1B,EAAOsb,KAAKl5C,IAAI,SAAU8Y,GACvC,MAAOA,GAAEsgC,MAEVwZ,GAAQ/xD,KAAK00D,EAEb,IAAIvxD,GAAQ2uD,GAAelW,EAAUmW,EAMrC,OAJc,KAAV5uD,GACH45B,EAAOhgB,MAAM,oDAGT5Z,GAIL45B,EAAO34B,KAAOjB,EACPy4C,EAASxjB,OAAO,EAAGj1B,IAJlB,KAiCT,QAASw0C,IAAY5a,GACpB,GAAIr9B,GAAO8O,EAASklD,EAAe/5B,EAAOi7B,EAAezkD,EAAW8F,EAAW4+C,EAAah5C,EAAUnR,EAAUoqD,EAAav3C,EAAO+zC,EAAQltD,EAAK80B,EAAW67B,CAI5J,IAFAr1D,EAAQq9B,EAAO34B,IAEX24B,EAAOo1B,QAAUp1B,EAAOq1B,YAC3B,MAAO,KAGR,KAAKr1B,EAAOjD,YAAY,KACvB,MAAO,KAIR,IAA0B,MAAtBiD,EAAO7C,WACV,MAAO,KAQR,IALA1rB,KACIuuB,EAAOsc,uBACV7qC,EAAQ4J,EAAI2kB,EAAO1D,WAAW35B,IAG3Bq9B,EAAOjD,YAAY,KAOtB,MANAtrB,GAAQyJ,EAAI4L,GACPkZ,EAAO/C,aAAa,cACxB+C,EAAOhgB,MAAM,gCAGdvO,EAAQ3B,EAAIkwB,EAAO/C,aAAa,WACzBxrB,CAOR,IAJAA,EAAQyJ,EAAIjI,GAGZxB,EAAQoB,EAAImtB,EAAO/C,aAAaib,KAC3BzmC,EAAQoB,EACZ,MAAO,KAsBR,KAlBKslC,GAAqBpxC,KAAKi5B,EAAO7C,aACrC6C,EAAOhgB,MAAM,oBAGd63C,EAAgB,SAAU7wD,EAAMkS,GAC/B,GAAIy9C,GAAgBz9C,EAAUqS,GAAKrS,CAE/Bo/B,IAAmBvxC,KAAK4vD,KAC3B32B,EAAO34B,KAAOsvD,EAAczzD,OAC5B88B,EAAOhgB,MAAM,iIAGdvO,EAAQiC,EAAE1M,GAAQkS,GAGnB8mB,EAAO9C,kBAGA9pB,EAAYsnC,GAAa1a,IAAWk3B,GAAcl3B,IAEpD5sB,EAAUpM,MAET2vD,EAAgBpe,GAAWnlC,EAAUpM,OACxCyK,EAAQklD,GAAiBH,GAAiBpjD,EAAUhT,MAAO4/B,IAInDpD,EAAQyb,GAAkBnzC,KAAKkO,EAAUpM,QAC3CyK,EAAQiC,IAAGjC,EAAQiC,MACxBwF,EAAYs9C,GAAiBpjD,EAAUhT,MAAO4/B,GAC9C63B,EAAcj7B,EAAM,GAAI1jB,IAEnB8mB,EAAOqc,yBAA4BjE,GAAUrxC,KAAKqM,EAAUpM,QAC3DyK,EAAQ3B,IAAG2B,EAAQ3B,MACxB2B,EAAQ3B,EAAEsD,EAAUpM,MAAQoM,EAAUhT,QAA8B,KAApBgT,EAAUhT,MAAe,GAAK,KAO3EqR,EAAQ6B,IAAG7B,EAAQ6B,MACxB7B,EAAQ6B,EAAErQ,KAAKmQ,IAGjB4sB,EAAO9C,iBAYR,IARA8C,EAAO9C,kBAGH8C,EAAOjD,YAAY,OACtB+6B,GAAc,IAIV93B,EAAOjD,YAAY,KACvB,MAAO,KAGR,IAAIk7B,GAAgBxmD,EAAQoB,EAAEC,cAC1BqpC,EAAqBnc,EAAOmc,kBAEhC,KAAK2b,IAAgB9kD,GAAiBjM,KAAK0K,EAAQoB,GAAI,CACtDmtB,EAAO6b,aAAa54C,KAAKg1D,IAIH,WAAlBA,GAAgD,UAAlBA,KACjCj4B,EAAOo1B,OAAS6C,GAGjBn5C,KACAnR,EAAW0P,GAAO,KAElB,GAMC,IALAhW,EAAM24B,EAAO34B,IACb80B,EAAY6D,EAAO7D,YAId+7B,GAAWD,EAAe97B,GAK1B,GAAI67B,EAAazB,GAAev2B,GAAS,CAC5Cu0B,GAAS,CAET,IAAI4D,GAAiBH,EAAWnlD,EAAEC,aAGlC,IAAIqlD,IAAmBF,IAEtBj4B,EAAO34B,IAAMA,IAGN24B,EAAO6b,aAAax1C,QAAQ8xD,IAAiB,CACnD,GAAIp1C,GAAe,wBAIf/P,IAAiBjM,KAAKoxD,KACzBp1C,GAAgB,MAAQo1C,EAAiB,qDAG1Cn4B,EAAOhgB,MAAM+C,SAMPvC,EAAQwzC,GAAYh0B,GAAUwb,KAAMxb,EAAOob,mBAAmB,GAAIK,MAAOzb,EAAOob,mBAAmB,OAC1GmZ,GAAS,EACTv0B,EAAO34B,IAAMA,IAETmZ,EAAQwf,EAAO/D,KAAK6e,MACnBntC,EAAS6S,EAAM+K,KAClByU,EAAO34B,IAAMA,EACb24B,EAAOhgB,MAAM,iCAGdu8B,GAAQ/7B,EAAMrM,EAAG6rB,EAAOkc,cAAeC,GAAqBA,GAAqBA,GAEjFxuC,EAAS6S,EAAM+K,GAAK/K,EAAMrM,EAC1B4jD,GAAc,IAEVv3C,EAAQwf,EAAO/D,KAAKwe,KACvB37B,EAAS7b,KAAKud,GAEd+zC,GAAS,MAhDbA,IAAS,SAoDDA,EAENz1C,GAAS5b,SACZuO,EAAQ0C,EAAI2K,GAGTi5C,IACHtmD,EAAQ4J,EAAI1N,GAGbqyB,EAAO6b,aAAa56C,MAKrB,MAFA++B,GAAOo1B,OAAS,KAEZp1B,EAAOoc,kBAAuE,KAAnDpc,EAAOoc,iBAAiB/1C,QAAQ4xD,GACvDlgB,GAGDtmC,EAGR,QAASymD,IAAWlxD,EAAMm1B,GACzB,GAAIS,GAAOs4B,CAKX,OAHAt4B,GAAQ,2BAA2B13B,KAAKi3B,GACxC+4B,EAAavd,GAAmB3wC,GAE3B41B,GAAUs4B,IAILA,EAAW7uD,QAAQu2B,EAAM,GAAG9pB,gBAH9B,EAQT,QAAS6nC,IAAgB3a,GACxB,GAAIr9B,GAAOoiB,EAASoX,EAAWi8B,EAAUC,CAIzC,OAFA11D,GAAQq9B,EAAO34B,IAEV24B,EAAOjD,YAAYwc,KAIxBpd,EAAY6D,EAAO7D,YACnBi8B,EAAWj8B,EAAU91B,QAAQmzC,IAEZ,KAAb4e,GACHp4B,EAAOhgB,MAAM,4DAGd+E,EAAUoX,EAAUd,OAAO,EAAG+8B,GAC9Bp4B,EAAO34B,KAAO+wD,EAAW,EAEzBC,GACCn9C,EAAGyiB,GACHxf,EAAG4G,GAGAib,EAAOsc,uBACV+b,EAAQh9C,EAAI2kB,EAAO1D,WAAW35B,IAGxB01D,GAtBC,KA0BT,QAASrd,IAA6Bhb,GACrC,GAAIr9B,GAAOqE,EAAM+d,EAASvE,EAAO+zC,CAEjC5xD,GAAQq9B,EAAO34B,GAEf,IAAIg0C,GAAarb,EAAOob,kBAExB,KAAKpb,EAAOjD,YAAYse,EAAW,IAClC,MAAO,KAGR,KAAKrb,EAAO/C,aAAawc,IAExB,MADAzZ,GAAO34B,IAAM1E,EACN,IAGRqE,GAAOg5B,EAAO/C,aAAa,iCAEtBj2B,GACJg5B,EAAOhgB,MAAM,+BAGTggB,EAAOjD,YAAYse,EAAW,KAClCrb,EAAOhgB,MAAM,+BAAkCq7B,EAAW,GAAK,KAGhEt2B,IAEA,IAEKvE,EAAQwzC,GAAYh0B,GAAUwb,KAAMxb,EAAOob,mBAAmB,GAAIK,MAAOzb,EAAOob,mBAAmB,OACrF,aAAZ56B,EAAMzC,GACViiB,EAAOhgB,MAAM,YAAcq7B,EAAW,GAAK,WAAaA,EAAW,IAGpEkZ,GAAS,IAET/zC,EAAQwf,EAAO/D,KAAKwe,IAEfj6B,GACJwf,EAAOhgB,MAAM,YAAcq7B,EAAW,GAAK,WAAaA,EAAW,IAGpEt2B,EAAQ9hB,KAAKud,WAEL+zC,EAEV,QACCr5C,EAAG4iB,GACHvS,EAAGvkB,EACHmN,EAAG4Q,GAKL,QAASuzC,IAAa3oD,GACrB,MAAOA,GAAInL,QAAQk1C,GAAW,QAO/B,QAASqB,IAA6B/a,GACrC,GAAIr9B,GAAQq9B,EAAO34B,IACfm0C,EAAOxb,EAAOob,mBAAmB,GACjCK,EAAQzb,EAAOob,mBAAmB,EAEtC,KAAKpb,EAAO/C,aAAa0c,MAAkB3Z,EAAOjD,YAAYye,GAE7D,MADAxb,GAAO34B,IAAM1E,EACN,IAGR,IAAIqE,GAAOg5B,EAAO/C,aAAa2c,GAK/B,IAHAl0B,EAAgB,sEAAwE1e,EAAO,yDAA2DA,EAAO,sBAAwBA,EAAO,YAG3Lg5B,EAAOjD,YAAY0e,KAAWzb,EAAO/C,aAAa4c,IAEtD,MADA7Z,GAAO34B,IAAM1E,EACN,IAGR,IAAIoiB,MACAwvC,EAAS3xD,OAET21D,EAAa,GAAI7zD,QAAO,YAAc4zD,GAAa9c,GAAQ,cAAgBx0C,EAAO,OAASsxD,GAAa7c,GAAS,UAErH,GACC,IAAIzb,EAAO/C,aAAas7B,GACvBhE,GAAS,MACH,CACN,GAAI/zC,GAAQwf,EAAO/D,KAAKwe,GACnBj6B,IACJwf,EAAOhgB,MAAM,mCAAsCw7B,EAAO,IAAMx0C,EAAOy0C,EAAQ,UAGhF12B,EAAQ9hB,KAAKud,UAEL+zC,EAEV,QACCr5C,EAAG4iB,GACH3pB,EAAG4Q,EACHwG,EAAGvkB,GAML,QAASw1C,IAAaxc,GAOrB,IANA,GAAI9wB,MACAvB,EAAW0P,GAAO,MAClB06C,GAAc,EAEd5b,EAAqBnc,EAAOmc,mBAEzBnc,EAAO34B,IAAM24B,EAAOrwB,IAAIzM,QAAQ,CACtC,GAAImE,GAAM24B,EAAO34B,IACbrB,EAAOpD,OACP0iD,EAAU1iD,QAEV0iD,EAAUtlB,EAAO/D,KAAK6e,MACrBntC,EAAS23C,EAAQ/5B,KACpByU,EAAO34B,IAAMA,EACb24B,EAAOhgB,MAAM,kCAGdu8B,GAAQ+I,EAAQnxC,EAAG6rB,EAAOkc,cAAeC,GAAqBA,GAAqBA,GAEnFxuC,EAAS23C,EAAQ/5B,GAAK+5B,EAAQnxC,EAC9B4jD,GAAc,IACJ/xD,EAAOg6B,EAAO/D,KAAKwe,KAC7BvrC,EAASjM,KAAK+C,GAEdg6B,EAAOhgB,MAAM,+BAIf,GAAIla,IACH4N,EAAGuH,GACHC,EAAGhM,EAOJ,OAJI6oD,KACHjyD,EAAOuV,EAAI1N,GAGL7H,EAWR,QAASiH,IAAMoC,EAAU1N,GACxB,MAAO,IAAI+4C,IAAerrC,EAAU1N,OAAeqE,OA0EpD,QAASk3C,IAAc6D,GACtB,GAAID,GAASvjC,GAAOq/B,GAIpB,OAHAkE,GAAO7zC,MAAQ,SAAUoC,EAAU1N,GAClC,MAAOw7C,IAAQ9tC,EAAU1N,GAAWo/C,IAE9BD,EAGR,QAAS3D,IAAQ9tC,EAAU0xC,GAC1B,IAAK9zC,GACJ,KAAM,IAAIb,OAAM,6GAGjB,OAAOa,IAAMoC,EAAU0xC,GAAgB1gD,KAAKsB,SAG7C,QAASk7C,IAAO1lC,EAAIxV,GACnB,IAAKoN,GAAK,CACT,GAAIpN,GAAWA,EAAQ+2D,QACtB,MAED,MAAM,IAAItsD,OAAM,6BAA+B+K,EAAK,4CAGjD2lC,GAAW3lC,KAAKA,EAAKA,EAAG4W,UAAU,GAEtC,IAAI1e,GAAWvM,MAEf,MAAMuM,EAAWN,GAAI8gD,eAAe14C,IAAM,CACzC,GAAIxV,GAAWA,EAAQ+2D,QACtB,MAED,MAAM,IAAItsD,OAAM,4CAA8C+K,GAG/D,GAAuC,WAAnC9H,EAASkH,QAAQuX,cAA4B,CAChD,GAAInsB,GAAWA,EAAQ+2D,QACtB,MAED,MAAM,IAAItsD,OAAM,6BAA+B+K,EAAK,gCAGrD,MAAO,eAAiB9H,GAAWA,EAASspD,YAActpD,EAAS6K,UAGpE,QAAS4iC,IAAW3lC,GACnB,MAAOA,IAAgB,MAAVA,EAAG,GAGjB,QAAS4lC,IAAS1tC,GACjB,QAA6B,gBAAbA,IAGjB,QAAS2tC,IAAgBp3C,GAMxB,MAJIA,GAAQ6G,WACX7G,EAAUA,EAAQ6G,UAGZkwC,GAAcoH,OAAO,SAAU6U,EAAK/kD,GAE1C,MADA+kD,GAAI/kD,GAAOjO,EAAQiO,GACZ+kD,OAIT,QAAS3qD,IAAoB4qD,EAAcjzD,EAASsB,GACnD,GAAIL,GAAWo+C,GAAa4T,EAAcjzD,EAASsB,EACnD,OAAOL,GAAWA,EAASgyD,GAAc3xD,GAAQ,KAGlD,QAAS+9C,IAAa4T,EAAcjzD,EAASsB,GAC5C,KAAOtB,GAAS,CACf,GAAIsB,IAAQtB,GAAQizD,GACnB,MAAOjzD,EAGR,IAAIA,EAAQmgB,SACX,MAAO,KAGRngB,GAAUA,EAAQwN,QAIpB,QAASyW,IAAmBjkB,EAASsB,EAAM0K,GAE1C,GAAI4zC,GAAUsT,GAAuBlzD,EAASsB,EAAM0K,MACpD,IAAI4zC,EAAS,MAAOA,EAIpB,IADAA,EAAU5I,GAAQC,OAAO31C,GAAQwxD,SAAS,IAC7B,CAEZ,GAAIn4D,GAASq8C,GAAQ3vC,MAAMu4C,EAAS5I,GAAQI,gBAAgBp3C,GAG5D,OAAOA,GAAQiI,SAAS3G,GAAQ3G,EAAO6a,GAIzC,QAAS09C,IAAuBlzD,EAASsB,EAAM0K,GAE9C,GAAI4zC,GAAUuT,GAAkB7xD,EAAM0K,EAAetD,MACrD,IAAIk3C,EAAS,MAAOA,EAGpB,IAAI3+C,GAAWo+C,GAAa,WAAYr/C,EAASsB,EAEjD,IAAKL,EAAL,CAIA2+C,EAAU3+C,EAASgH,SAAS3G,EAG5B,IAAI8G,GAAKlL,MAOT,IANuB,kBAAZ0iD,KACVx3C,EAAKw3C,EAAQj2C,KAAK1I,GAClBmH,EAAG0P,QAAU7W,EAASgH,SAAS4S,eAAevZ,GAC9Cs+C,EAAUx3C,EAAG/J,KAAK2B,EAASg3C,MAGvB4I,GAAuB,KAAZA,EAEf,WADA3pC,GAAYspC,GAA0Bj+C,EAAM,UAAW,WAAatB,QAASA,GAM9E,KAAKg3C,GAAQG,SAASyI,GAAU,CAE/B,GAAIjlD,GAASq8C,GAAQ3vC,MAAMu4C,EAAS5I,GAAQI,gBAAgBn2C,GAIxDtG,GAAOgb,GACVM,EAAY,2DAA4D3U,GAAQtB,QAASA,GAK1F,IAAIyP,GAASrH,EAAKnH,EAAWmyD,GAAUnyD,EAAUK,EAGjDmO,GAAOxH,SAAS3G,GAAQs+C,EAAUjlD,EAAO6a,EAM1C,MAFIpN,KAAIw3C,EAAQ/nC,IAAMzP,GAEfw3C,EAAQ5xC,EAAI4xC,EAAQpqC,EAAIoqC,GAGhC,QAASwT,IAAUpzD,EAASiO,GAC3B,MAAOjO,GAAQiI,SAAS4S,eAAe5M,GAAOjO,EAAUqzD,GAAgBrzD,EAAQ4G,YAAaqH,GAG9F,QAASolD,IAAgBzsD,EAAaqH,GACrC,MAAKrH,GAGEA,EAAYqB,SAAS4S,eAAe5M,GAAOrH,EAAcysD,GAAgBzsD,EAAY04C,QAASrxC,GAHrG,OAMD,QAASklD,IAAkB7xD,EAAMkM,GAChC,GAAIA,EAAQ,CACX,GAAIA,EAAO/D,UAAY+D,EAAO/D,SAASkM,GAAKnI,EAAO/D,SAASkM,EAAErU,GAC7D,MAAOkM,GAAO/D,SAASkM,EAAErU,EACnB,IAAIkM,EAAOxB,gBAAkBwB,EAAOxB,eAAetD,MACzD,MAAOyqD,IAAkB7xD,EAAMkM,EAAOxB,eAAetD,QA2HxD,QAASqc,IAAQyL,EAAK91B,EAAO8S,GAC5B,GAAIsX,GAAO5nB,MAYX,OAVIszB,IACH1L,KACAzlB,OAAOX,KAAK8O,GAAQpQ,QAAQ,SAAUozB,GACrC1L,EAAK0L,GAAOhjB,EAAOgjB,KAEpB1L,EAAK0L,GAAO91B,GAEZoqB,EAAOtX,EAGDsX,EA+XR,QAASiB,IAAQrrB,GAChB,OAAQA,GAASkD,EAAQlD,IAA2B,IAAjBA,EAAM8C,QAAgBwY,EAAStb,IAAwC,IAA9B2E,OAAOX,KAAKhE,GAAO8C,OAGhG,QAASsoB,IAAQprB,EAAO44D,GACvB,MAAIA,IAAe11D,EAAQlD,GAAe0rB,GACtCpQ,EAAStb,IAA2B,kBAAVA,GAA6BsrB,GAC7C9oB,SAAVxC,EAA4B,KACzBwrB,GA6PR,QAASqB,IAAYD,EAAM7e,EAAMia,GAChC,GAAIlR,KAGJ,IAAY,MAAR8V,GAAyB,KAATA,EAAa,MAAO9V,EAExC,IAAIgO,GAAYtiB,OACZ6e,EAAU7e,OACVq2D,EAAiBr2D,MAEjBspB,MAAUzK,EAAU0K,GAAYhe,EAAKkI,WACxC6O,EAAYg0C,GAAS,OACrBh0C,EAAUlL,UAAYyH,EAAQ,GAAKuL,EAAOvL,EAAQ,GAClDyD,EAAYA,EAAUyH,cAAc,MAEV,WAAtBzH,EAAU7O,UACb4iD,EAAiB/zC,EAAUzjB,QAAQyjB,EAAUi0C,iBAEpChrD,EAAKsB,eAAiBvC,IAChCgY,EAAYg0C,GAAS,OACrBh0C,EAAUlL,UAAY,kBAAoBgT,EAAO,SACjD9H,EAAYA,EAAUyH,cAAc,QAEpCzH,EAAYg0C,GAAS/qD,EAAKkI,SAC1B6O,EAAUlL,UAAYgT,EAEI,WAAtB9H,EAAU7O,UACb4iD,EAAiB/zC,EAAUzjB,QAAQyjB,EAAUi0C,gBAK/C,KADA,GAAI34C,GAAQ5d,OACL4d,EAAQ0E,EAAUoT,YACxBphB,EAAMjU,KAAKud,GACX4H,EAAQhS,YAAYoK,EAQrB,IAAIpd,GAAIR,MACR,IAAqB,WAAjBuL,EAAKkI,QAER,IADAjT,EAAI8T,EAAMhU,OACHE,KACF8T,EAAM9T,KAAO61D,IAChB/hD,EAAM9T,GAAGwU,UAAW,EAKvB,OAAOV,GAGR,QAASgiD,IAAS7iD,GACjB,MAAO4V,IAAa5V,KAAa4V,GAAa5V,GAAWvH,GAAcuH,IA4MxE,QAAS4b,IAAW9jB,EAAMqf,GACrBA,EACHrf,EAAK8B,aAAa,QAASud,IAI3Brf,EAAKuE,aAAa,SAClBvE,EAAK6B,gBAAgB,UAIvB,QAASyd,IAAW2rC,GACnB,MAAOA,GAAc50D,QAAQ,eAAgB,SAAUo4B,EAAOyD,GAC7D,MAAOA,GAAGzS,gBA+IZ,QAASW,IAAYN,EAAMC,EAAIxoB,EAASoM,GACvC,GAAImc,IAASC,EAAI,MAAO,KAExB,IAAIpc,EAAM,CACT,GAAIunD,GAAWtrD,GAAoB,gBAAiBrI,EAASoM,EAC7D,IAAIunD,EAAU,MAAOA,GAASprC,EAAMC,IAAO,IAE3C0I,GAAM5oB,GAAc8D,EAAM,iBAG3B,MAAOpE,IAAcsgB,OAAOC,EAAMC,IAAOxgB,GAAckV,MAAMqL,EAAMC,IAAOxgB,GAAcuV,OAAOgL,EAAMC,IAAO,KAK7G,QAAS2B,IAAUhU,GAClB,MAAOA,GAAKrX,QAAQkqB,GAAiB,IAKtC,QAASqB,IAAWpgB,GACnB,MAAKA,IAEDgf,GAAc5nB,KAAK4I,KAAMA,EAAM,IAAMA,GAElCA,EAAInL,QAAQ,SAAU,SAAUo4B,GACtC,MAAO,IAAMA,EAAM9pB,iBALH,GAuPlB,QAASie,MACRJ,IAAW9hB,GAAI+hB,IAGhB,QAASI,MACRL,IAAU,EAGX,QAASM,MACRN,IAAU,EAwOX,QAAShb,IAAmBlE,GAE3B,GAAItD,GAAOsD,EAAQtD,KACfxH,EAAW8K,EAAQ/L,OAEvB,GAIC,KAHA,GAAIQ,GAAcS,EAASk+C,aAEvBzhD,EAAI8C,EAAYhD,OACbE,KAAK,CACX,GAAIuC,GAAWO,EAAY9C,GACvB0R,EAAQ5O,EAAY,IAAMP,EAE1BmP,GAAM/N,KAAKoH,KACd2G,EAAM/O,IAAIoI,GAEVsD,EAAQvL,YAAYjD,KAAK6R,UAGnBnO,EAAWA,EAASuM,QAI9B,QAASuf,IAAehhB,GACvB,KAAOA,EAAUA,EAAQyB,QACxB,GAAqB,SAAjBzB,EAAQzK,KACX,MAAOyK,GAKV,QAAS6gB,IAAmBgnC,EAAa5zD,GACxCggB,EAAgB,OAAS4zC,EAAc,8IAAgJ5zD,QAASA,IAkGjM,QAASwtB,MACR/yB,KAAKqS,SAAS6B,QAAQpS,eAGvB,QAASmxB,MACRF,GAAenvB,KAAK5D,KAEpB,IAAIC,GAAQD,KAAKqS,SAAS6B,QAAQ9S,MAAM8B,KACxClD,MAAKC,MAAiBwC,QAATxC,EAAqB,GAAKA,EAGxC,QAAS6yB,IAAYvC,GACpB,GAAIsC,GAAUpwB,MAEd,OAAO,YACN,GAAIL,GAAQpC,IAER6yB,IAASumC,aAAavmC,GAE1BA,EAAUzD,WAAW,WACpB,GAAIlb,GAAU9R,EAAMiQ,SAAS6B,OACzBA,GAAQ3E,UAAUwjB,GAAenvB,KAAKxB,GAC1CywB,EAAU,MACRtC,IAoUL,QAAS0D,IAAYnE,GACpB,MAAOiE,IAASjE,KAAUiE,GAASjE,OAqDpC,QAAS0E,IAAgB1d,EAAIyd,EAAOnzB,EAAO0Q,GAC1C,GAAIge,GAAOhZ,EAAKyd,EAAQnzB,EAAMK,YAC9B,OAAOyyB,IAAOpE,KAAUoE,GAAOpE,GAAQ,GAAIqE,IAAa/yB,EAAO0Q,IAqChE,QAASgjB,IAAU5gB,GAClB,MAAOA,GAAQlG,KAAK8lB,QAGrB,QAASulC,IAAUnlD,GAClB,MAAOA,GAAQ5C,QAAQiB,aAAa,SAGrC,QAASkiB,MACR,MAAOz0B,MAAKo0B,SAASxoB,OAAOkpB,IAAW7yB,IAAIo3D,IA2G5C,QAASpkC,MAER,IADA,GAAIhyB,GAAIjD,KAAKo0B,SAASrxB,OACfE,KAAK,CACX,GAAIiR,GAAUlU,KAAKo0B,SAASnxB,EAC5B,IAAIiR,EAAQlG,KAAK8lB,QAAS,MAAO5f,GAAQ5C,QAAQiB,aAAa,UAgIhE,QAAS0qC,IAAWhqC,GACnB,MAAOA,IAA2C,IAA9BA,EAAUjE,SAASjM,QAAgBkQ,EAAUjE,SAAS,GAAG+L,IAAMnJ,KAAiBqB,EAAUjE,SAAS,GAAG2K,EAE3H,QAASnF,IAAclD,GACtB,GAAIxC,GAAawC,EAAQ0B,eAIzB,IAAI1B,EAAQiB,aAAa,oBAAsB0qC,GAAWnuC,EAAWyB,iBAEpE,MAAO0sC,IAAWnuC,EAAW7O,OAASm1B,GAAyB,IAIhE,IAAqB,UAAjB9jB,EAAQzK,KAAkB,CAC7B,GAAI8K,GAAOL,EAAQiB,aAAa,OAEhC,IAAa,UAATZ,GAA6B,aAATA,EAAqB,CAC5C,GAAIorC,GAAWE,GAAWnuC,EAAWjI,MACjCm2C,EAAcC,GAAWnuC,EAAWglB;AAOxC,GAJIipB,GAAYC,GACfxhC,EAAY,qGAAuGjW,QAAS+L,EAAQuK,OAGjIkhC,EACH,MAAgB,UAATprC,EAAmBqjB,GAAmBX,EAG9C,IAAI2oB,EACH,MAAgB,UAATrrC,EAAmBqiB,GAAeH,GAI3C,MAAa,SAATliB,GAAmBsrC,GAAWnuC,EAAW7O,OACrCsU,GAGJ0oC,GAAWnuC,EAAW7O,OACT,WAAT0R,GAA8B,UAATA,EAAmB+hB,GAAiBhB,GAG1D,KAIR,MAAqB,WAAjBphB,EAAQzK,MAAqBo2C,GAAWnuC,EAAW7O,OAC/CqR,EAAQiB,aAAa,YAAc8gB,GAAwBH,GAI9C,aAAjB5hB,EAAQzK,MAAuBo2C,GAAWnuC,EAAW7O,OACjDyyB,GADR,OAcD,QAASwqB,IAA4B17C,GACpC,GAAIyC,GAAMk5C,EAASC,EAAQn6C,EAAG0C,EAAQ03C,CActC,KAZAp5C,EAAOzC,EAAQkS,MAAM,MACfypC,EAAU9nB,GAASpxB,EAAKlB,WAC7Bo6C,EAAUG,GAAWr5C,EAAKlB,SAG3B4C,KAEAy3C,EAAS,SAAUG,EAAMt6C,GACxB,MAAOs6C,GAAO,IAAMt5C,EAAKhB,IAG1BA,EAAIk6C,EAAQp6C,OACLE,KACNo6C,EAAkBF,EAAQl6C,GAAGhB,IAAIm7C,GAAQh5C,KAAK,KAEzCuB,EAAOya,eAAei9B,KAC1B13C,EAAO7C,KAAKu6C,GACZ13C,EAAO03C,IAAmB,EAI5B,OAAO13C,GAOR,QAAS23C,IAAWE,GACnB,GACInc,GACAoc,EACAN,EACAC,EACAn6C,EACA2pB,EACA+M,EACA13B,EARAy7C,EAAO,EAUX,KAAKroB,GAASmoB,GAAM,CAGnB,IAFAL,KAEOO,EAAK36C,OAASy6C,GACpBE,GAAQ,CAST,KANArc,EAAMsc,SAASD,EAAM,GAErBN,EAAS,SAAUQ,GAClB,MAAiB,MAAVA,GAGH36C,EAAI,EAAQo+B,GAALp+B,EAAUA,GAAK,EAAG,CAE7B,IADAw6C,EAASx6C,EAAE9C,SAAS,GACbs9C,EAAO16C,OAASy6C,GACtBC,EAAS,IAAMA,CAKhB,KAFAx7C,KACA03B,EAAI8jB,EAAO16C,OACN6pB,EAAI,EAAO+M,EAAJ/M,EAAOA,IAClB3qB,EAAIa,KAAKs6C,EAAOK,EAAO7wB,IAExBuwB,GAAQl6C,GAAKhB,EAGdozB,GAASmoB,GAAOL,EAGjB,MAAO9nB,IAASmoB,GAGjB,QAASK,IAAQt4C,EAASqO,GACrBrO,EAAQqO,OACXrO,EAAQu4C,YAAYh7C,KAAKyC,EAAQqO,OAGlCrO,EAAQqO,MAAQA,EAGjB,QAASmqC,IAAQx4C,GACZA,EAAQu4C,YAAY/6C,OACvBwC,EAAQqO,MAAQrO,EAAQu4C,YAAYh9C,MAEpCyE,EAAQqO,MAAQ,KAKlB,QAAS4iB,IAAUjxB,EAASoO,GAC3B,GAAIrS,GAAU8V,UAAUrU,QAAU,GAAsBN,SAAjB2U,UAAU,MAAwBA,UAAU,EAEnF,IAAKzD,EAAL,CAIKrS,EAAQsS,MAOZtS,EAAQsS,MAAM/M,KAAO8M,EANrBrS,EAAQsS,OACP/M,KAAM8M,EAENqqC,QAAQ,EAMV,IAAIvqC,GAAawqC,GAAiBtqC,EAElCuqC,IAAY34C,EAASkO,EAAYnS,EAAQsS,MAAOtS,EAAQ0D,MAAM,IAG/D,QAASi5C,IAAiBtqC,GACzB,MAAI2hB,IAAclV,eAAezM,GACzB2hB,GAAc3hB,GAEd2hB,GAAc3hB,GAAaupC,GAA4BvpC,GAIhE,QAASuqC,IAAY34C,EAASkO,EAAYG,EAAO5O,GAChD,GAEIm5C,GACAl7C,EAHAm7C,EAAchnC,UAAUrU,QAAU,GAAsBN,SAAjB2U,UAAU,IAAmB,EAAQA,UAAU,GAItFjI,GAAS,CAIb,KAFA0uC,GAAQt4C,EAASqO,GAEZ3Q,EAAIwQ,EAAW1Q,OAAQE,GAAK,EAAGA,IACnCk7C,EAAc54C,EAAQ84C,MAAM5qC,EAAWxQ,IAEnCk7C,IACHhvC,EAASmvC,GAAkB/4C,EAAS44C,EAAavqC,EAAO5O,IAASmK,EAMnE,IAFA4uC,GAAQx4C,GAEJA,EAAQwN,QAAU5D,EAAQ,CAE7B,GAAIivC,GAAe74C,EAAQyT,UAAW,CACrC,GAAIulC,GAAWh5C,EAAQyT,UAAUnS,KAAO,IAAM4M,EAAWA,EAAW1Q,OAAS,EAC7E0Q,GAAawqC,GAAiBM,GAE1B3qC,IAAUA,EAAMoF,YACnBpF,EAAMoF,UAAYzT,GAIpB24C,GAAY34C,EAAQwN,OAAQU,EAAYG,EAAO5O,IAIjD,QAASs5C,IAAkB/4C,EAAS44C,EAAavqC,EAAO5O,GACvD,GAAIw5C,GAAgB,KAChBC,GAAY,CAEZ7qC,KAAUA,EAAMoqC,SACnBh5C,GAAQ4O,GAAO3O,OAAOD,IAKvBm5C,EAAcA,EAAYp8C,OAE1B,KAAK,GAAIkB,GAAI,EAAGD,EAAMm7C,EAAYp7C,OAAYC,EAAJC,EAASA,GAAK,EACnDk7C,EAAYl7C,GAAGiC,MAAMK,EAASP,MAAU,IAC3Cy5C,GAAY,EASd,OALI7qC,KAAUA,EAAMoqC,QAAUS,IAAcD,EAAgB5qC,EAAM8iB,YACjE8nB,EAAc5mB,gBAAkB4mB,EAAc5mB,iBAC9C4mB,EAAc1mB,iBAAmB0mB,EAAc1mB,oBAGxC2mB,EA+eT,QAAS/uC,IAAgBF,EAAKH,GAC7B,GAAI6G,GAAU7G,EAAQ,MAAQ,KAG9B,OAFAZ,IAAIoL,UAAY,IAAM3D,EAAU,IAAM1G,EAAM,MAAQ0G,EAAU,IAEvDyB,EAAQlJ,GAAIyc,WAAW,GAAGpc,YAGlC,QAASc,IAAM8uC,EAAUC,GAGxB,IAFA,GAAI17C,GAAIy7C,EAAS37C,OAEVE,KACN,GAAIy7C,EAASz7C,GAAG4D,OAAS83C,EAAO93C,KAC/B,OAAO,CAIT,QAAO,EAGR,QAASyL,IAAkBW,GAC1B,GAAI3B,GAAU2B,EAAU3B,QACpBzK,EAAOoM,EAAUpM,IAErB,IAAa,OAATA,EAAe,MAAO+3C,GAE1B,IAAa,UAAT/3C,EAAkB,CAErB,GAAqB,WAAjByK,EAAQzK,MAA8B,UAATA,EAChC,MAAOyK,GAAQiB,aAAa,YAAcssC,GAA4BC,EAGvE,IAAqB,aAAjBxtC,EAAQzK,KAAqB,MAAOk4C,GAGxC,IAA+C,MAA3CztC,EAAQiB,aAAa,mBAA4B,MAAOysC,GAG5D,IAAqB,UAAjB1tC,EAAQzK,KAAkB,CAC7B,GAAI8K,GAAOL,EAAQiB,aAAa,OAGhC,IAAa,SAATZ,EAAiB,MAAOjK,EAG5B,IAAa,UAATiK,GAAoBL,EAAQ4C,SAA8C,SAAnC5C,EAAQ4C,QAAQjB,UAAUpM,KAAiB,MAAOo4C,IAG9F,MAAOF,IAGR,GAAI/wC,GAAOsD,EAAQtD,IAGnB,IAAIiF,EAAUd,UAAqB,SAATtL,EAAiB,CAC1C,GAAkB,UAAdmH,EAAK2D,KAAkB,MAAOutC,GAClC,IAAkB,aAAdlxC,EAAK2D,KAAqB,MAAOwtC,IAItC,MAAa,UAATt4C,GAAoBmH,EAAKqf,MAAMvd,aAAqBsvC,GAG3C,UAATv4C,GAAsBmH,EAAKsB,cAAgBtB,EAAKsB,eAAiB2C,GAEjEgB,EAAUb,YAAoBitC,GAE9BpsC,EAAUgC,UAAkBqqC,GAEzBC,GAN6EC,GASrF,QAASZ,MACR,GAAI5wC,GAAOhO,KAAKgO,KAEZ/N,EAAQD,KAAK8R,iBAEV9R,MAAKuF,QAAQwR,MAAM/I,EAAK8I,IAC/B9W,KAAKuF,QAAQwR,MAAM9W,GAAS+N,EAE5BA,EAAK8I,GAAK7W,EAGX,QAAS4+C,MACR,GAAI5+C,GAAQD,KAAK8R,UAEZ3O,GAAQlD,KAAQA,GAASA,GAK9B,KAHA,GAAIqB,GAAUtB,KAAKgO,KAAK1M,QACpB2B,EAAI3B,EAAQyB,OAETE,KAAK,CACX,GAAI+Z,GAAS1b,EAAQ2B,GACjB8U,EAAciF,EAAO3K,SAAW2K,EAAO3K,SAASpS,MAAQ+c,EAAO/c,KAEnE+c,GAAOvF,SAAWsd,EAAc90B,EAAO8X,IAIzC,QAAS+mC,MACR,GAAI7+C,GAAQD,KAAK8R,UAEjB,KAAK9R,KAAKwyB,OAAQ,CAEjBxyB,KAAKgO,KAAKqE,SAASpS,MAAQA,CAK3B,KAHA,GAAIqB,GAAUtB,KAAKgO,KAAK1M,QACpB2B,EAAI3B,EAAQyB,OAETE,KAAK,CACX,GAAI+Z,GAAS1b,EAAQ2B,GACjB8U,EAAciF,EAAO3K,SAAW2K,EAAO3K,SAASpS,MAAQ+c,EAAO/c,KAEnE,IAAI8X,GAAe9X,EAAO,CAEzB+c,EAAOvF,UAAW,CAClB,UASJ,QAASunC,MACR,GAAI/+C,GAAQD,KAAK8R,UAEZ9R,MAAKwyB,SACTxyB,KAAKgO,KAAK6L,UAAsBpX,SAAVxC,EAAsB,GAAKA,GAInD,QAASg/C,MACR,GAAIjxC,GAAOhO,KAAKgO,KACZ6mB,EAAa7mB,EAAK8lB,QAElB7zB,EAAQD,KAAK8R,UAGjB9D,GAAK/N,MAAQD,KAAKgO,KAAKqE,SAASpS,MAAQA,EACxC+N,EAAK8lB,QAAU7zB,IAAUD,KAAKsR,QAAQiB,aAAa,QAM/CsiB,IAAe7mB,EAAK8lB,SAAW9zB,KAAKsR,QAAQ4C,SAAWlU,KAAKsR,QAAQ4C,QAAQ3E,UAC/EvP,KAAKsR,QAAQ4C,QAAQqgB,MAAMnzB,MAAMgJ,IAAIpK,KAAKsR,QAAQ4C,QAAQqgB,MAAMziB,YAIlE,QAASitC,MACR,IAAK/+C,KAAKwyB,OAAQ,CACjB,GAAIvyB,GAAQD,KAAK8R,UAEjB9R,MAAKgO,KAAK/N,MAAQD,KAAKgO,KAAKqE,SAASpS,MAAQA,EAC7CD,KAAKgO,KAAK8B,aAAa,QAAS7P,IAIlC,QAASi/C,MACRl/C,KAAKgO,KAAK8lB,QAAU9zB,KAAK8R,YAAc9R,KAAKgO,KAAKqE,SAASpS,MAG3D,QAASk/C,MACR,GAAI7tC,GAAUtR,KAAKsR,QACftD,EAAOhO,KAAKgO,KAEZkG,EAAU5C,EAAQ4C,QAElBjU,EAAQD,KAAK8R,WACb2tC,EAAiBnuC,EAAQiB,aAAa,QAE1C,IAAKpP,EAAQlD,GAEN,CAEN,IADA,GAAIgD,GAAIhD,EAAM8C,OACPE,KACN,GAAIw8C,GAAkBx/C,EAAMgD,GAE3B,YADAiR,EAAQ4gB,UAAY9mB,EAAK8lB,SAAU,EAIrC5f,GAAQ4gB,UAAY9mB,EAAK8lB,SAAU,MATnC5f,GAAQ4gB,UAAY9mB,EAAK8lB,QAAU7zB,GAASw/C,EAa9C,QAASL,MACRp/C,KAAKgO,KAAKqf,MAAMvd,aAAa,UAAW9P,KAAK8R,YAAc,IAG5D,QAAS0tC,MACRx/C,KAAKgO,KAAK0xC,UAAYltC,GAAkBxS,KAAK8R,YAG9C,QAASutC,MAGHr/C,KAAKwyB,SACTxyB,KAAKgO,KAAKhO,KAAKkS,cAAgBlS,KAAK8R,YAItC,QAASytC,MACRv/C,KAAKgO,KAAK8B,aAAa9P,KAAK6G,KAAM2L,GAAkBxS,KAAK6R,cAG1D,QAASytC,MACRt/C,KAAKgO,KAAK2xC,eAAe3/C,KAAKiV,UAAWjV,KAAK6G,KAAM2L,GAAkBxS,KAAK6R,cAyB5E,QAASR,IAA2B4B,EAAWpM,GAE9C,GAAI+4C,GAAa/4C,EAAKX,QAAQ,IAC9B,IAAmB,KAAf05C,EAAmB,CAEtB,GAAIC,GAAkBh5C,EAAKq0B,OAAO,EAAG0kB,EAIrC,IAAwB,UAApBC,EAA6B,CAOhC,GANAh5C,EAAOA,EAAK6mB,UAAUkyB,EAAa,GAEnC3sC,EAAUpM,KAAOA,EACjBoM,EAAUgC,UAAY6qC,GAAWD,EAAgBltC,eACjDM,EAAU4sC,gBAAkBA,GAEvB5sC,EAAUgC,UACd,KAAM,uBAAyB4qC,EAAkB,IAGlD,SAIF5sC,EAAUpM,KAAOA,EAkIlB,QAASkO,IAAYJ,GACpBA,EAAM7O,YAmWP,QAASuQ,IAAoB/E,GAC5B,GAAIxC,GAAawC,EAAQ0B,gBAErB+sC,EAAgBjxC,EAAW6C,KAC3B8tC,EAAiB3wC,EAAW7O,MAC5B+/C,EAAgBlxC,EAAWjI,IAE/B,OAAKk5C,IAAyC,UAAxBA,EAAc9/C,OAAsBw/C,GAAmBO,EAAcvuC,cAIvFguC,EAAe3tC,aAAekuC,EAAcvuC,aAAarQ,MAAM8B,OAC3D,EALR,OASD,QAASiT,IAAmBlD,GAC3B,GAAIzD,GAAMyD,EAAU9S,UACpB,OAAOqP,GAAM,IAAMA,EAAM,GAG1B,QAASwH,IAAsB1F,GAE9B,IADA,GAAIrO,GAAIqO,EAAQvL,YAAYhD,OACrBE,KAAK,CACX,GAAI0R,GAAQrD,EAAQvL,YAAY9C,EAChC0R,GAAMrO,OAAOgL,EAAQtD,OAIvB,QAASkH,IAAa5D,GAErB,GAAIypB,GAAQzpB,EAAQiB,aAAa,QACjC,IAAIwoB,EAAO,MAAOA,EAGlB,IAAqB,QAAjBzpB,EAAQzK,KAAgB,MAAOkG,GAEnC,IAAIgG,GAASzB,EAAQyB,MAErB,OAAIA,GAEiB,kBAAhBA,EAAOlM,KAAiCoL,GAGrCc,EAAO/E,KAAKsB,aAGbgC,EAAQ/L,QAAQof,GAAGrV,aAoB3B,QAAS2I,IAAcL,EAAaG,GAEnC,IADA,GAAI9U,GAAI2U,EAAY7U,OACbE,KACN,GAAI2U,EAAY3U,IAAM8U,EAAa,OAAO,EAiG5C,QAASM,IAAiB/G,GACzB,KAAOA,GAAS,CACf,GAAqB,WAAjBA,EAAQzK,KAAmB,MAAOyK,EACtCA,GAAUA,EAAQyB,QAmGpB,QAAS2F,MACR,GAAIpH,GAAUtR,KAAKqS,SAASgD,KAE5BxR,IAAQrB,QACR8O,EAAQmH,aAAa9V,QAAQs9C,IAC7Bp8C,GAAQ0W,MAGT,QAAS0lC,IAAa/rC,GACrBA,EAAQ9S,MAAMgJ,IAAI8J,EAAQkH,YA0C3B,QAAS2K,IAAkB/M,GAE1B,GAAIxS,GAAWwS,EAAUzT,OAEzB,GAIC,KAHA,GAAIQ,GAAcS,EAAS05C,sBAEvBj9C,EAAI8C,EAAYhD,OACbE,KAAK,CACX,GAAIuL,GAAQzI,EAAY9C,GACpB0R,EAAQ5O,EAAY,IAAMyI,EAE1BmG,GAAM/N,KAAKoS,KACdrE,EAAM/O,IAAIoT,EAAUxS,UAEpBwS,EAAUjT,YAAYjD,KAAK6R,UAGrBnO,EAAWA,EAASuM,QAgE9B,QAAS+S,IAAQvgB,EAASyP,EAAQ8T,GAEjC,GAAIlT,GAAqBrQ,EAAQqQ,kBAC7BrQ,GAAQ46C,UAAS56C,EAAQqQ,oBAAqB,EAElD,IAAI6sB,GAAU5+B,GAAQrB,MAAM+C,GAAS,EAKrC,IAJA1B,GAAQuC,aAAa,WACpB,MAAO2T,IAAYlR,KAAKtD,KACtB,GAECA,EAAQwJ,SAASQ,SACpB,KAAM,IAAIxD,OAAM,kGAWjB,IARA+c,EAASs3B,GAAWt3B,IAAWvjB,EAAQujB,OAEvCvjB,EAAQof,GAAK3P,EACbzP,EAAQujB,OAASA,EAGbvjB,EAAQgX,OAAOzC,GAAK5U,QAEpB8P,EAGH,IAFCA,EAAOoR,wBAA0BpR,EAAOoR,2BAA6BtjB,KAAKyC,GAEvEujB,EAAQ,CACX,GAAIb,GAAUvZ,GAAIwZ,wBAClB3iB,GAAQwJ,SAASnF,OAAOqe,GACxBjT,EAAO+T,aAAad,EAASa,OAE7BvjB,GAAQwJ,SAASnF,OAAOoL,EAO1B,OAHAnR,IAAQ0W,MACRhV,EAAQqQ,mBAAqBA,EAEtB6sB,EAAQ4d,KAAK,WACnB,MAAOrmC,IAAcnR,KAAKtD,KAI5B,QAASiV,IAAcJ,EAAO7U,GAC7B,MAAO6U,GAAM7U,EAAQ+U,SAAWF,EAAM7U,EAAQ+U,WAG/C,QAASG,IAAM6lC,EAAW/6C,GACzB,GAAIg7C,GAAa/lC,GAAc8lC,EAAUlmC,MAAO7U,EAMhD,KAJA+6C,EAAUpmC,KAAKrR,KAAKtD,GAIbg7C,EAAWx9C,QACjB0X,GAAM6lC,EAAWC,EAAWj2C,eAGtBg2C,GAAUlmC,MAAM7U,EAAQ+U,OA+FhC,QAASc,IAAW7V,GACnB,GAAIi7C,GAAUj7C,EAAQ0V,QAAQjM,QAG9B,IAAKwxC,GAAYA,EAAQ7yC,GAAzB,CAIA,GAAIhI,GAASqV,GAAmBzV,EAASi7C,EAAQ7yC,GAIjD,OAAIhI,KAAW66C,EAAQ76C,QACtB66C,EAAQ76C,OAASA,EACjBA,EAASkV,GAAclV,EAAQJ,IAFhC,QAOD,QAASyV,IAAmBzV,EAASoI,GACpC,GAAI8yC,GAAS7D,GAAaL,GAAQI,gBAAgBp3C,GAClD,OAAOoI,GAAG/J,KAAK2B,EAASk7C,GAGzB,QAAS7D,IAAa8D,GACrB,GAAID,GAASvjC,GAAOq/B,GAIpB,OAHAkE,GAAO7zC,MAAQ,SAAUoC,EAAU1N,GAClC,MAAOi7C,IAAQ3vC,MAAMoC,EAAU1N,GAAWo/C,IAEpCD,EAGR,QAAS5lC,IAAc7L,EAAUzJ,GAChC,GAAwB,gBAAbyJ,GAEU,MAAhBA,EAAS,KACZA,EAAWutC,GAAQC,OAAOxtC,IAG3BA,EAAWpC,GAAMoC,EAAUutC,GAAQI,gBAAgBp3C,QAI/C,CAAA,GAAgB9C,QAAZuM,EACP,KAAM,IAAIjD,OAAM,0BAA4BiD,EAAW,IAInD,IAA0B,gBAAfA,GAASuE,EACvB,KAAM,IAAIxH,OAAM,8JAIZ,IAAIiD,EAASuE,IAAMuH,GACtB,KAAM,IAAI/O,OAAM,yCAA2C+O,GAAmB,SAAW9L,EAASuE,EAAI,+GAG1G,MAAOvE,GAGR,QAASmM,IAAewlC,EAAkBC,EAAaC,GACtD,GAAKD,EAKL,IAAK,GAAIptC,KAAOotC,IACXC,IAAcF,EAAiBvgC,eAAe5M,MACjDmtC,EAAiBntC,GAAOotC,EAAYptC,IAKvC,QAASstC,IAASxlC,GAEbA,GAAQA,EAAKnP,cAAgBvH,SACZ,kBAAT0W,KAEgB,gBAATA,GAChBmb,EAAM,iDAAmDnb,EAAO,kBAEhEE,EAAY,sIAmDhB,QAASC,IAAUknB,EAAaoe,GAC/BD,GAASC,EAET,IAAIC,GAAoC,kBAAhBre,GACpBse,EAAkC,kBAAfF,EAWvB,OANKA,IAAeC,IACnBD,MAKIC,GAAeC,EAIb,WACN,GAAI5gC,GAAQ4gC,EAAYC,GAAiBH,EAAY/gD,MAAQ+gD,EACzDhuC,EAASiuC,EAAaE,GAAiBve,EAAa3iC,MAAQ2iC,CAEhE,OAAOwe,IAAe9gC,EAAOtN,IAPtBouC,GAAeJ,EAAYpe,GAWpC,QAASue,IAAiBvzC,EAAIxM,GAC7B,GAAIma,GAAO3N,EAAG/J,KAAKzC,EAEnB,IAAKma,EAUL,MARoB,gBAATA,IACVmb,EAAM,uCAGHnb,EAAKnP,cAAgBvH,QACxB2gB,EAAgB,uHAGVjK,EAGR,QAAS6lC,IAAeC,EAASC,GAChC,GAAID,GAAWC,EAAW,CACzB,IAAK,GAAI7tC,KAAO6tC,GACT7tC,IAAO4tC,KACZA,EAAQ5tC,GAAO6tC,EAAU7tC,GAI3B,OAAO4tC,GAGR,MAAOA,IAAWC,EASnB,QAAS31C,IAAK8D,GACb,MAAOA,GAAI9D,OAGZ,QAAS41C,IAAcC,GACtB,MAAOA,GAAK/xC,IAGb,QAASgyC,IAAkBh8C,EAAUuN,GAIpC,IAHA,GAAI0uC,MACAhlB,EAAQh6B,OAELg6B,EAAQzgB,GAAoBjX,KAAKS,IACvCi8C,EAAc3+C,MACb0M,IAAKitB,EAAM,GACXgI,KAAMhI,EAAM,GACZilB,UAAWjlB,EAAM,IAWnB,KALA,GAAIgI,GAAOgd,EAAcx/C,IAAIq/C,IAEzBK,KACA1+C,EAAIw+C,EAAc1+C,OAEfE,KAAK,CACX,GAAI2+C,GAAWnd,EAAK1iC,QAGhBw/C,EAAOE,EAAcx+C,EACzB2+C,GAAS3+C,GAAKs+C,EAAK9c,KAAO1xB,EAASwuC,EAAKG,WAAa,EAErD,IAAIG,GAAYpd,EAAK1iC,OACrB8/C,GAAU5+C,GAAK8P,EAAS,IAAM8uC,EAAU5+C,GAExC0+C,EAAY7+C,KAAK8+C,EAASx9C,KAAK,KAAMy9C,EAAUz9C,KAAK,MAGrD,MAAOu9C,GAAYv9C,KAAK,MAEzB,QAASkY,IAAa5C,EAAK5C,GAC1B,GAAIgrC,GAAW,wBAA0BhrC,EAAK,MAE1C6qC,EAAcl/C,MAkBlB,OAfCk/C,GADGzlC,GAAmBtV,KAAK8S,GACbA,EAAIrV,QAAQ6X,GAAoB4lC,GAEhCpoC,EAAIrV,QAAQ0X,GAAiB,IAAI1X,QAAQyX,GAAkB,SAAU2gB,EAAOyD,GAEzF,GAAIjkB,GAAkBrV,KAAKs5B,GAAK,MAAOzD,EAEvC,IAAIslB,GAAY7hB,EAAGxsB,MAAM,KAAKzR,IAAIyJ,IAC9Bi2C,EAAcI,EAAU9/C,IAAI,SAAUuD,GACzC,MAAOg8C,IAAkBh8C,EAAUs8C,KACjC19C,KAAK,MAAQ,GAEhB,OAAOq4B,GAAMp4B,QAAQ67B,EAAIyhB,KAiC5B,QAASjlC,IAAS/M,EAAG+pB,GAIpB,IAHA,GAAI1b,GAAIrO,EAAE5N,QACNkB,EAAIy2B,EAAE32B,OAEHE,MACC+a,EAAE9X,QAAQwzB,EAAEz2B,KAClB+a,EAAElb,KAAK42B,EAAEz2B,GAIX,OAAO+a,GA6DR,QAASgkC,IAAWC,EAAYC,EAASC,GACxC,MAAO,WAAaF,EAAa,6CAA+CC,EAAU,KAAOC,EAAU,wDAA0DD,EAAU,IAAM,IAGtL,QAASE,IAAgB9gD,EAAS+gD,EAAkBH,GACnD,GAAIG,IAAoB/gD,GAAS,CAChC,GAAM4gD,IAAW5gD,GAIhB,KAAM,IAAIyK,OAAMi2C,GAAWK,EAAkBH,GAAS,GAHtD1mC,GAAYwmC,GAAWK,EAAkBH,IACzC5gD,EAAQ4gD,GAAW5gD,EAAQ+gD,IAM9B,QAASC,IAAUhhD,GAClB8gD,GAAgB9gD,EAAS,aAAc,eACvC8gD,GAAgB9gD,EAAS,OAAQ,YACjC8gD,GAAgB9gD,EAAS,WAAY,cACrC8gD,GAAgB9gD,EAAS,mBAAoB,UAKzC6B,EAAQ7B,EAAQ6L,WACnBi1C,GAAgB9gD,EAAS,WAAY,SAIvC,QAASyhB,IAAKhQ,EAAQlM,EAAMkb,GAG3B,QAAST,KACR,GAAIihC,GAAcC,GAAelhC,EAAQmhC,QAAS57C,GAC9C67C,EAAY,UAAY1iD,MACxB2iD,EAAW3iD,KAAK4iD,MAEpB5iD,MAAK4iD,OAASL,CAEd,IAAI58C,GAASoc,EAAO7c,MAAMlF,KAAMoX,UAQhC,OANIsrC,GACH1iD,KAAK4iD,OAASD,QAEP3iD,MAAK4iD,OAGNj9C,EAjBR,MAAK,SAASiB,KAAKmb,IAoBnBT,EAAQmhC,QAAU1vC,EAClBuO,EAAQuhC,QAAU9gC,EAEXT,GAvB4BS,EA0BpC,QAASygC,IAAezvC,EAAQlM,GAC/B,GAAIA,IAAQkM,GAAQ,CACnB,GAAI+vC,GAAO,WACV,GAAI7iD,GAAQ8S,EAAOlM,EAEnB,QACC0M,EAAoB,kBAAVtT,GAAuBA,EAAQ,WACxC,MAAOA,OAKV,IAAoB,gBAAT6iD,GAAmB,MAAOA,GAAKvvC,EAG3C,MAAO7L,GAiDR,QAASqW,IAAWgE,EAAQpH,EAAQ3F,EAAQ1T,GAC3CghD,GAAUhhD,EAEV,KAAK,GAAIkS,KAAOlS,GACf,GAAImc,GAAc2C,eAAe5M,GAAM,CACtC,GAAIvT,GAAQqB,EAAQkS,EAOR,QAARA,GAAiC,kBAAVvT,GAC1Bub,EAAYhI,EAAM,2EAAuF,SAAXuO,EAAoB/M,EAAS,MAE3HA,EAAOxB,GAAOvT,EAKjBqd,GAAW3a,QAAQ,SAAUsa,GAC5BA,EAAS8E,GAAQpH,EAAQ3F,EAAQ1T,KAGlCkb,GAAkBuF,GAAQpH,EAAQ3F,EAAQ1T,GAC1CoZ,GAAqBqH,GAAQpH,EAAQ3F,EAAQ1T,GAC7C8a,GAAgB2F,GAAQpH,EAAQ3F,EAAQ1T,GAExCyhD,GAAmBpoC,EAAO3Y,UAAWgT,EAAQ1T,GAG9C,QAASyhD,IAAmBhwC,EAAQiC,EAAQ1T,GAC3C,IAAK,GAAIkS,KAAOlS,GACf,IAAKqc,GAAcnK,IAAQlS,EAAQ8e,eAAe5M,GAAM,CACvD,GAAI4vB,GAAS9hC,EAAQkS,EAGC,mBAAX4vB,KACVA,EAASrgB,GAAKhQ,EAAQS,EAAK4vB,IAG5BpuB,EAAOxB,GAAO4vB,GAKjB,QAAS1lB,IAAQ+E,GAChB,GAAI6T,KAIJ,OAHA7T,GAAM9f,QAAQ,SAAU2S,GACvB,MAAOghB,GAAIhhB,IAAK,IAEVghB,EAKR,QAAS9Q,IAAWjgB,EAASy9C,EAAa1hD,GACzCsD,OAAOX,KAAKsB,EAAQqW,UAAUiF,cAAcle,QAAQ,SAAU6Q,GAC7D,GAAI0N,GAAc3b,EAAQqW,UAAUiF,aAAarN,EAE7CjO,GAAQqW,UAAU3b,MAAMmgB,eAAe5M,IAC1C0N,EAAY9W,IAAI7E,EAAQqW,UAAU3b,MAAMuT,MAK1CsK,GAAO9c,KAAKuE,EAAQ4G,YAAa5G,EAASy9C,GAE1C/kC,GAAWpV,KAAKtD,GAChB2Y,GAAS7D,MAAM9U,EAEf,IAAIwJ,GAAWtM,MAGf,IAAI8C,EAAQyJ,SAAU,CACrB,GAAIiF,GAASxR,QAETnB,EAAQ2S,QAAU1O,EAAQgX,SAC7BtI,EAAS3S,EAAQ2S,OAAS3S,EAAQ2S,OAAOlS,WAErCwD,EAAQgX,OACXtI,EAAOnR,KAAKyC,EAAQgX,QAItBhX,EAAQwJ,SAAWA,EAAW,GAAI1O,KACjC4N,MAAO1I,EACPyJ,SAAUzJ,EAAQyJ,SAClBiF,OAAQA,EACRwR,UAAWnkB,EAAQmkB,cACnBE,QAASrkB,EAAQqkB,cACfzW,KAAK3J,EAAQqW,WAKjB,GAFAsC,GAAS3D,IAAIhV,GAETwJ,EAAU,CAEb,GAAI4V,GAAKy7B,GAAW76C,EAAQof,GAC5B,IAAIA,EAAI,CACP,GAAI8d,GAAUl9B,EAAQqE,OAAO+a,EAAIpf,EAAQ09C,OAErCh3C,IAAQO,gBACXi2B,EAAQ,SAAS,SAAUtjB,GAK1B,KAJAoG,GAAgB,kOAChB/J,EAAY,sCAAwCjW,QAASA,IAC7D4Z,EAAIO,OAASwjC,EAAW/jC,EAAIO,OAEtBP,MASX,QAASgkC,IAAyB59C,EAASiK,GAC1C,GAAI4zC,GAAU3gD,OAEV8c,EAAe,WAAa/P,EAAInL,QAAQ8Z,GAAU,SAAUse,EAAOj7B,GAEtE,MADA4hD,IAAU,EACH,kBAAoB5hD,EAAU,OACjC,IAED4hD,KAAS7jC,EAAe,yBAA2BA,EAEvD,IAAI5R,GAAK,GAAIupB,UAAS3X,EACtB,OAAO6jC,GAAUz1C,EAAGuB,KAAK3J,GAAWoI,EAErC,QAAS01C,IAAwB99C,EAASiO,EAAK8K,GAC9C,GAAIY,GAASzc,OACT+b,EAAS/b,OAGTgd,EAAehd,OACfkd,EAAiBld,OACjB6gD,EAAe7gD,MA+BnB,OA7ByB,kBAAd6b,KACVY,EAASvD,EAAM2C,EAAW/Y,GAC1Bka,EAAenB,EAAUne,WACzBwf,GAAiB,GAGO,gBAAdrB,KACVY,EAASikC,GAAyB59C,EAAS+Y,GAC3CmB,EAAenB,GAGS,gBAAdA,KACmB,gBAAlBA,GAAUpb,KACpBgc,EAASikC,GAAyB59C,EAAS+Y,EAAUpb,KACrDuc,EAAenB,EAAUpb,KACU,kBAAlBob,GAAUpb,KAC3Bgc,EAASvD,EAAM2C,EAAUpb,IAAKqC,GAC9Bka,EAAenB,EAAUpb,IAAI/C,WAC7Bwf,GAAiB,GAEjB8W,EAAM,8CAA+CjjB,GAGzB,kBAAlB8K,GAAUlU,MACpBoU,EAAS7C,EAAM2C,EAAUlU,IAAK7E,GAC9B+9C,EAAehlC,EAAUlU,IAAIjK,cAK9B+e,OAAQA,EACRV,OAAQA,EACRiB,aAAcA,EACd6jC,aAAcA,EACd3jC,eAAgBA,GAKlB,QAASH,IAAS+jC,GACjB,GAAI7nB,GAAQ6nB,EAAOl/C,QAAQ,SAAU,SAAUm/C,GAC9C,MAAOA,GAAK9vC,MAAM,KAAMtP,KAAK,QAC3BsP,MAAM,MAEL+vC,EAAY/nB,EAAM34B,OAAS,EAAI,EAAI24B,EAAM35B,MAAM,GAAG2hD,OAAO,SAAUC,EAAM/nB,GAC5E,MAAOx0B,MAAK+mB,IAAIw1B,EAAM,OAAO5+C,KAAK62B,GAAM,GAAG74B,SACzC6gD,EAAAA,EAEH,OAAOloB,GAAMz5B,IAAI,SAAU25B,EAAM34B,GAChC,MAAO,QAAUA,EAAI24B,EAAKlO,UAAU+1B,GAAa7nB,KAC/Cx3B,KAAK,MAIT,QAASwb,IAAcF,GACtB,IAAKA,EAAO,MAAO,EAQnB,KAAK,GANDgc,GAAQhc,EAAMhM,MAAM,MACpB7M,EAAOuX,GAAYvX,KAAO,YAE1Bg9C,KAEA7gD,EAAM04B,EAAM34B,OACPE,EAAI,EAAOD,EAAJC,EAASA,GAAK,EAAG,CAChC,GAAI24B,GAAOF,EAAMz4B,EAEjB,KAAK24B,EAAK11B,QAAQW,GACjB,MAAOg9C,GAAUz/C,KAAK,KAEtBy/C,GAAU/gD,KAAK84B,IAqPlB,QAASvZ,IAAgBf,EAASmB,EAAOX,EAAY3f,GACpD,GAAI8gB,GAAU3B,EAAQ2B,OAElB9gB,IACH8gB,EAAQphB,QAAQM,GA8LlB,QAASwhB,IAAuBJ,EAAoBhe,EAAS/D,GAC5D,GAAI+hB,EAAmBnZ,KAAOmZ,EAAmBnZ,IAAIwZ,QAEpD,MADAL,GAAmBnZ,IAAIwZ,QAAQE,WAAWhhB,MAAOyC,QAASA,EAAS/D,QAASA,IACrE+hB,CAGR,IAAIpB,GAAU1f,OAEVqhB,IAAgBve,QAASA,EAAS/D,QAASA,IAE3CkiB,GACHxgB,IAAK,WACJ,MAAO,SAAWqgB,GAAqBA,EAAmBtjB,MAAQsjB,EAAmBrgB,OAEtFkH,IAAK,SAAUnK,GACVkiB,IAEA,SAAWoB,GACdA,EAAmBtjB,MAAQA,EAE3BsjB,EAAmBnZ,IAAInK,GAGxBkiB,GAAU,EACV2B,EAAWnhB,QAAQ,SAAUmhD,GAC5B,GAAIv+C,GAAUu+C,EAAKv+C,QACf/D,EAAUsiD,EAAKtiD,OAEnB+D,GAAQ6E,IAAI5I,EAASvB,KAEtBkiB,GAAU,IAEX4hC,YAAY,EAKb,OAFArgC,GAAWtZ,IAAIwZ,SAAYE,WAAYA,EAAYP,mBAAoBA,GAEhEG,EAGR,QAASG,IAAOH,EAAYne,EAAS/D,GACpC,IAAKkiB,EAAWtZ,MAAQsZ,EAAWtZ,IAAIwZ,QAAS,OAAO,CAIvD,KAFA,GAAIE,GAAaJ,EAAWtZ,IAAIwZ,QAC5B3gB,EAAI6gB,EAAW/gB,OACZE,KAAK,CACX,GAAI69B,GAAYhd,EAAW7gB,EAC3B,IAAI69B,EAAUv7B,UAAYA,GAAWu7B,EAAUt/B,UAAYA,EAE1D,MADAsiB,GAAW3d,OAAOlD,EAAG,IACd,GAiHV,QAASgiB,IAAU1f,EAASjE,GACvB2K,GAAQK,OAAO03C,KAEnBC,GAAqB1+C,GAGrB6P,GAAe7P,EAAS,QAAUrC,IAAKghD,KAGvC//B,GAActb,KAAKtD,EAASjE,GAG5B8iB,GAAczhB,QAAQ,SAAUkE,GAC/BtB,EAAQsB,GAAQmF,GAASkR,GAAO3X,EAAQ4G,YAAYtF,IAAS,MAAOvF,EAAQuF,KAI7E,IAAI+U,GAAY,GAAI6E,KACnBhE,MAAO0nC,GAAY5+C,EAASA,EAAQkX,MAAOnb,GAC3Cga,KAAMD,GAAiBra,KAAKuE,EAAQ4G,YAAa5G,EAASjE,GAC1DiE,QAASA,GAGVA,GAAQqW,UAAYA,CAGpB,IAAIwoC,GAAWp4C,GAASkR,GAAO3X,EAAQ4G,YAAYnK,UAAUoiD,UAAW9iD,EAAQ8iD,SAEhF,KAAK,GAAI5wC,KAAO4wC,GAAU,CACzB,GAAI9lC,GAAY+kC,GAAwB99C,EAASiO,EAAK4wC,EAAS5wC,GAC/DoI,GAAUqF,QAAQzN,EAAK8K,IAIzB,QAAS+lC,IAAQ10C,EAAG+pB,GAInB,IAHA,GAAI1b,GAAIrO,EAAE5N,QACNkB,EAAIy2B,EAAE32B,OAEHE,MACC+a,EAAE9X,QAAQwzB,EAAEz2B,KAClB+a,EAAElb,KAAK42B,EAAEz2B,GAIX,OAAO+a,GAGR,QAASmmC,IAAY5+C,EAAS++C,EAAYhjD,GA2BzC,QAASijD,GAAOjiB,GASf,MARuB,gBAAZA,KACVA,EAAU10B,GAAoB,WAAYrI,EAAS+8B,GAE9CA,GACJ7L,EAAM5oB,GAAcy0B,EAAS,aAIxBA,EAnCRgiB,EAAaA,EAAWriD,IAAIsiD,EAC5B,IAAI9nC,GAAQE,EAAYrb,EAAQmb,OAAOxa,IAAIsiD,EAE3C9nC,GAAQ4nC,GAAQC,EAAY7nC,EAE5B,IAAI+nC,GAAU,SAAWljD,GAAUA,EAAQ2L,MAAQ1H,EAAQ0H,MACvDw3C,EAAe,gBAAkBnjD,GAAUA,EAAQmjD,aAAel/C,EAAQk/C,YAE9E,IAAID,EAAS,CACZ,IAAKv3C,GACJ,KAAM,IAAIlB,OAAM,qEAGb04C,IACHhoC,EAAM3Z,KAAKohB,IAGZzH,EAAM3Z,KAAKsgB,IAOZ,MAJIqhC,IACHhoC,EAAM3Z,KAAK+f,IAGLpG,EAeR,QAASwnC,IAAqB1+C,GAG7BA,EAAQ+U,MAAQ,KAAO+J,KAGvB9e,EAAQ84C,MAAQnhC,GAAO,MAIvB3X,EAAQ0V,WAGR1V,EAAQwR,SAGRxR,EAAQqO,MAAQ,KAChBrO,EAAQu4C,eAGRv4C,EAAQm/C,gBACRn/C,EAAQ26C,yBAGR36C,EAAQ0gB,cAEH1gB,EAAQyT,YACZzT,EAAQsW,KAAOtW,EACfA,EAAQwN,OAASxN,EAAQwf,UAAY,MAIvC,QAASm/B,MACR,KAAM,IAAIn4C,OAAM,8FAGjB,QAASoa,IAA+BnN,GAGvC,IAFA,GAAIxS,GAAWwS,EAAUzT,QAElBiB,GAAU,CAChB,GAAImO,GAAQnO,EAAS05C,sBAAsB,IAAMlnC,EAAUnS,KACvD8N,IAAOA,EAAMrO,OAAO0S,GAExBxS,EAAWA,EAASuM,QAItB,QAAS8S,IAAWlR,GACnBA,EAAM7O,YA8RP,QAAS6+C,IAAwBp/C,EAASsB,GACzC,GAAIL,GAAWo+C,GAAa,aAAcr/C,EAASsB,GAC/C0d,EAAY9hB,MAEhB,IAAI+D,IACH+d,EAAY/d,EAAS4G,WAAWvG,IAG3B0d,EAAUsgC,SAAS,CAEvB,GAAIl3C,GAAK4W,EAAUrV,KAAK1I,EAIxB,IAHAmH,EAAG0P,QAAU7W,EAAS4G,WAAWgT,eAAevZ,GAChD0d,EAAY5W,KAEP4W,EAEJ,WADA/I,GAAYspC,GAA0Bj+C,EAAM,YAAa,aAAetB,QAASA,GAIzD,iBAAdgf,KAEVA,EAAYogC,GAAwBp/C,EAASgf,IAG9CA,EAAUnH,IAAMzP,EAChBnH,EAAS4G,WAAWvG,GAAQ0d,EAI9B,MAAOA,GA8ER,QAASyD,IAAW1mB,GACnB,GAAgC,gBAArBA,GAAQ0N,SAClB,MAAO,IAAIsX,IAAKhlB,EAGjB,IAAIA,EAAQ0N,SAAS+L,IAAMjI,GAAS,CAEnC,GAAI0R,GAAuBmgC,GAAwBrjD,EAAQiQ,eAAehM,QAASjE,EAAQ0N,SAAS0D,EACpG,IAAI8R,EACH,MAAO,IAAID,IAAUjjB,EAASkjB,EAG/B,IAAItO,GAAU5U,EAAQ0N,SAAS0D,EAAEC,cAE7BoyC,EAAqB19B,GAAgBnR,IAAYzD,EACrD,OAAO,IAAIsyC,GAAmBzjD,GAG/B,GAAIyO,GAAO2W,GAAaplB,EAAQ0N,SAAS+L,EAEzC,KAAKhL,EAAM,KAAM,IAAIhE,OAAM,0BAA4BzK,EAAQ0N,SAAS+L,EAExE,OAAO,IAAIhL,GAAKzO,GAGjB,QAAS+nB,IAAmBxjB,GAC3BA,EAAKmF,UAAS,GAiUf,QAASd,IAAsB8E,GAC9B0L,GAAqB1Z,KAAK,KAAMhB,MAAQgP,SAAUA,GAElD,IAAI4G,GAAqB5V,KAAK4V,kBAC9B5V,MAAK4V,oBAAqB,CAM1B,IAAIoD,GAAYhZ,KAAKgZ,SACjBA,KAAWA,EAAUxC,eAAgB,GACzCxW,KAAKgL,WACDgO,IAAWA,EAAUxC,eAAgB,GAGzCxW,KAAK+O,SAASV,SACdrO,KAAK+O,SAAW,GAAI1O,KACnB2O,SAAUhP,KAAKgP,SACf6M,KAAM7b,KACNiO,MAAOjO,OAERA,KAAK+O,SAASG,KAAKlP,KAAK4b,WAExB5b,KAAK4J,OAAO5J,KAAK2kB,GAAI3kB,KAAK8oB,QAE1B9oB,KAAK4V,mBAAqBA,EAG3B,QAASovC,IAAQv8B,EAAQ5hB,EAAMo+C,GAC9Bx8B,EAAO9lB,QAAQ,SAAUkD,GAExB,GAAIA,EAAK8L,OAASmV,IAAWjhB,EAAKgB,OAASA,EAE1C,WADAo+C,GAAKniD,KAAK+C,EAKX,IAAIA,EAAKkJ,SACRi2C,GAAQn/C,EAAKkJ,SAAS+a,YAAcjkB,EAAKkJ,SAAS2C,MAAO7K,EAAMo+C,OAI3D,IAAI9hD,EAAQ0C,EAAK6L,OACpBszC,GAAQn/C,EAAK6L,MAAO7K,EAAMo+C,OAItB,IAAIp/C,EAAK8L,OAAS8S,IAAa5e,EAAKW,SAAU,CAEjD,GAAIX,EAAKW,SAASgH,SAAS3G,GAAO,MAClCm+C,IAAQn/C,EAAKW,SAASuI,SAAS2C,MAAO7K,EAAMo+C,GAI3Cp/C,EAAK8L,OAASmB,KACb3P,EAAQ0C,EAAKiJ,aAChBk2C,GAAQn/C,EAAKiJ,WAAYjI,EAAMo+C,GAG5B9hD,EAAQ0C,EAAKqN,wBAChB8xC,GAAQn/C,EAAKqN,sBAAuBrM,EAAMo+C,MAM9C,QAASC,IAAoBC,GAC5BA,EAAQ77B,qBAGT,QAAStf,IAAcnD,EAAMs+C,GAC5B,GAAIC,KACJJ,IAAQhlD,KAAK+O,SAAS2C,MAAO7K,EAAMu+C,EAEnC,IAAI3iB,GAAU5+B,GAAQrB,MAAMxC,MAAM,EAOlC,OALAA,MAAKwN,SAAS3G,GAAQs+C,EACtBC,EAAWziD,QAAQuiD,IAEnBrhD,GAAQ0W,MAEDkoB,EASR,QAAS14B,IAAcuR,GAGtB,GAFAA,EAAOA,MAEa,gBAATA,GACV,KAAM,IAAIvP,OAAM,+EAIjBuP,GAAOD,GAAiBra,KAAKhB,KAAKmM,YAAanM,MAAQsb,KAAMA,GAE7D,IAAImnB,GAAU5+B,GAAQrB,MAAMxC,MAAM,GAG9BshB,EAAUthB,KAAK4b,UAAU0F,OACzBA,IAAWA,EAAQxX,MAClBwX,EAAQxX,MAAMwR,MAAU,GAE3Btb,KAAK4b,UAAUxR,IAAIkR,GAGpBtb,KAAK4b,UAAUxR,IAAIkR,EAQpB,KAJA,GAAIoF,GAAU5C,GAAOhU,MAAM9J,MACvBqlD,EAAW5iD,OAEXQ,EAAIyd,EAAQ3d,OACTE,KACN,GAAI3C,GAAe4F,QAAQwa,EAAQzd,IAAM,GAAI,CAC5CoiD,GAAW,CACX,OAeF,MAXIA,KACH1kD,GAAakI,KAAK7I,MAClBA,KAAK+O,SAAS9E,cAAcjK,KAAKgP,UACjCtO,GAAWmI,KAAK7I,MAChBO,GAAasI,KAAK7I,OAGnB6D,GAAQ0W,MAER9Z,GAAUoI,KAAK7I,KAAMsb,GAEdmnB,EAGR,QAAS54B,IAAemL,EAAQ8T,GAG/B,GAFA9T,EAASorC,GAAWprC,IAAWhV,KAAK2kB,IAE/B3kB,KAAKijD,QAAUjuC,EAAQ,CAG3B,GAAIswC,GAAStwC,EAAOoR,qBAChBk/B,IAAQA,EAAO3iD,QAAQuhC,GAG3BlvB,EAAO6E,UAAY,GAGpB,MAAOiM,IAAQ9lB,KAAMgV,EAAQ8T,GAO9B,QAASnf,IAAagK,EAAWkF,GAChC,GAAImf,GAAWh4B,KAAKyJ,GAAGkK,EAAW,WACjCkF,EAAQ3T,MAAMlF,KAAMoX,WACpB4gB,EAASt0B,UAIV,OAAOs0B,GAGR,QAASutB,IAAgB/1C,GACvB,MAAe,KAARA,EAGT,QAASg2C,IAAOh2C,GACd,MAAOA,GAAI9D,OAGb,QAAShC,IAAWiK,EAAWtS,GAC9B,GAAIe,GAAQpC,IAGZ,IAAyB,gBAAd2T,GAAwB,CAClC,GAAImvC,GAAO,WACV,GAAI7qB,MACA7M,EAAI3oB,MAER,KAAK2oB,IAAKzX,GACLA,EAAUyM,eAAegL,IAC5B6M,EAAUn1B,KAAKV,EAAMqH,GAAG2hB,EAAGzX,EAAUyX,IAIvC,QACC7X,GACC7P,OAAQ,WAEP,IADA,GAAIs0B,GAAWv1B,OACRu1B,EAAWC,EAAUn3B,OAAOk3B,EAASt0B,cAMhD,IAAoB,gBAATo/C,GAAmB,MAAOA,GAAKvvC,EAI3C,GAAIE,GAAaE,EAAUD,MAAM,KAAKzR,IAAIujD,IAAO55C,OAAO25C,GAMxD,OAJA9xC,GAAW9Q,QAAQ,SAAUgR,IAC3BvR,EAAMi8C,MAAM1qC,KAAevR,EAAMi8C,MAAM1qC,QAAkB7Q,KAAKzB,MAI/DqC,OAAQ,WACP,MAAOtB,GAAMmH,IAAIoK,EAAWtS,KAK/B,QAASmI,IAAYmK,EAAWtS,GAC/B,GAAIe,GAAQpC,IAGZ,IAAK2T,EAQE,CAEN,GAAIF,GAAaE,EAAUD,MAAM,KAAKzR,IAAIujD,IAAO55C,OAAO25C,GAExD9xC,GAAW9Q,QAAQ,SAAUgR,GAC5B,GAAIwqC,GAAc/7C,EAAMi8C,MAAM1qC,EAG9B,IAAIwqC,EAEH,GAAI98C,EAAU,CACb,GAAI4E,GAAQk4C,EAAYj4C,QAAQ7E,EAClB,MAAV4E,GACHk4C,EAAYh4C,OAAOF,EAAO,OAM1B7D,GAAMi8C,MAAM1qC,YAtBhB,KAAKA,IAAa3T,MAAKq+C,YACfr+C,MAAKq+C,MAAM1qC,EA2BpB,OAAO3T,MAIR,QAASsJ,IAAY9H,EAASH,EAAUC,GACvC,MAAIia,GAAS/Z,IAA+B,kBAAZA,IAC/BF,EAAU0K,GAAS3K,MAAgBN,IAC5Bf,KAAKoJ,QAAQ5H,EAASF,KAG9BA,EAAU0K,GAAS1K,MAAeP,IAC3Bf,KAAKoJ,QAAQ5H,EAASH,EAAUC,IAGxC,QAAS+H,IAAY7H,EAASH,EAAUC,GACvC,GAAuB,gBAAZE,GACV,KAAM,IAAIuK,OAAM,sEAGjB,IAAI3K,GAAQpB,KAAK4b,UAAU+kB,QAAQ8kB,EAAajkD,IAC5CkkD,EAAW,GAAIxkD,IAAalB,KAAMoB,EAAOC,EAAUC,MAMvD,OAFAtB,MAAKimB,WAAWnjB,KAAK4iD,IAGpBhiD,OAAQ,WACPgiD,EAAShiD,WAKZ,QAASxB,MACR,MAAO,GA+ER,QAASkH,IAAQ5H,EAASH,EAAUC,GACnC,GAAIc,GAAQpC,KAER2lD,KACA1jD,EAAMQ,MAEV,IAAI8Y,EAAS/Z,GACZS,EAAMT,EACNF,EAAUD,MAEVuD,OAAOX,KAAKhC,GAAKU,QAAQ,SAAUnB,GAClC,GAAIH,GAAWY,EAAIT,EAEnBA,GAAQkS,MAAM,KAAK/Q,QAAQ,SAAUnB,GACpCmkD,EAAU7iD,KAAK8iD,GAAexjD,EAAOZ,EAASH,EAAUC,YAGpD,CACN,GAAIukD,GAAWpjD,MAEQ,mBAAZjB,IACVF,EAAUD,EACVA,EAAWG,EACXqkD,GAAY,KAEZA,EAAWrkD,EAAQkS,MAAM,KAG1BmyC,EAASljD,QAAQ,SAAUnB,GAC1BmkD,EAAU7iD,KAAK8iD,GAAexjD,EAAOZ,EAASH,EAAUC,UAQ1D,MAFAtB,MAAKimB,WAAWnjB,KAAKoC,MAAMlF,KAAKimB,WAAY0/B,IAG3CjiD,OAAQ,WACPiiD,EAAUhjD,QAAQujB,KAKrB,QAAS0/B,IAAergD,EAAS/D,EAASH,EAAUC,GACnD,GAAIsa,GAAYrW,EAAQqW,UAEpB3X,EAAOwhD,EAAajkD,GACpBskD,EAAgB7hD,EAAKiC,QAAQ,IAGjC,MAAO4/C,EAAe,CACrB,GAAItyC,GAAMvP,EAAK,EAEf,KAAK2X,EAAUuF,IAAI3N,IAEdjO,EAAQyT,UAAW,CACtB,GAAI+sC,GAAS5vB,GAAiB5wB,EAAQyT,UAAUzH,eAAgBiC,EAC5DuyC,IAAQnqC,EAAU3Z,IAAIuR,EAAKuyC,GAIjC,GAAI3kD,GAAQwa,EAAU+kB,QAAQ18B,EAC9B,OAAO,IAAIb,IAAS9B,EAAQH,SAAWoE,EAASnE,EAAOC,EAAUC,GAIlE,GAAI0C,GAA8B,IAAlB8hD,EAAsBlqC,EAAYA,EAAU+kB,QAAQ18B,EAAKlC,MAAM,EAAG+jD,GAElF,OAAO,IAAI/hD,IAAgBzC,EAAQH,SAAWoE,EAASvB,EAAWC,EAAKkC,OAAO2/C,GAAgBzkD,EAAUC,GAmJzG,QAAS0kD,IAAchpC,GACtB,IAAKA,EAAQ,MAAO,KACpB,IAAIA,KAAW,EAAM,MAAOipC,MAAKC,SACjC,IAAsB,kBAAXlpC,GAAuB,MAAOA,EAEzC,IAAsB,gBAAXA,GACV,MAAO5X,IAAY4X,KAAY5X,GAAY4X,GAAU,SAAUmpC,GAC9D,MAAOA,GAAMnpC,IAIf,MAAM,IAAIjR,OAAM,sEAEjB,QAAS5C,IAAc3H,EAASihB,EAAOnhB,GACtC,GAAIF,GAAQpB,KAAK4b,UAAU+kB,QAAQ8kB,EAAajkD,IAC5CihC,EAAU5+B,GAAQrB,MAAMxC,MAAM,GAC9BC,EAAQmB,EAAM8B,KAElB,IAAIuf,IAAUxiB,EACb,KAAM,IAAI8L,OAAM,wCACV,KAAK5I,EAAQlD,KAAWkD,EAAQsf,GACrC,KAAM,IAAI1W,OAAM,6CAGlB,IAAI03B,GAAauiB,GAAc1kD,GAAWA,EAAQ8kD,QAIlD,OAHAhlD,GAAM8H,MAAMuZ,EAAOghB,GAEnB5/B,GAAQ0W,MACDkoB,EAIR,QAASx5B,IAAe+L,EAAQ8T,GAC/B,IAAK9oB,KAAK+O,SAASQ,SAElB,KAAM,IAAIxD,OAAM,wJAMjB,IAHAiJ,EAASorC,GAAWprC,GACpB8T,EAASs3B,GAAWt3B,IAAW,MAE1B9T,EACJ,KAAM,IAAIjJ,OAAM,iDAGjBiJ,GAAO+T,aAAa/oB,KAAK+H,SAAU+gB,GACnC9oB,KAAK2kB,GAAK3P,GAETA,EAAOoR,wBAA0BpR,EAAOoR,2BAA6BtjB,KAAK9C,MAC3EA,KAAKqmD,YAAa,EAElBC,GAAetmD,MAGhB,QAASsmD,IAAe/gD,GACvBF,GAAWwD,KAAKtD,GAEhBA,EAAQ8C,kBAAkB,KAAK1F,QAAQ,SAAU0d,GAChDimC,GAAejmC,EAAM7Z,YAIvB,QAASuC,IAAYvH,GACpB,IAAKA,EAAS,MAAOxB,MAAK4b,UAAU1Y,KAAI,EAExC,IAAIe,GAAOwhD,EAAajkD,GACpBgS,EAAMvP,EAAK,GAEX7C,EAAQqB,MAeZ,OAbKzC,MAAK4b,UAAUuF,IAAI3N,IAGnBxT,KAAKgZ,YACR5X,EAAQ+0B,GAAiBn2B,KAAKgZ,UAAUzH,eAAgBiC,GAEpDpS,GACHpB,KAAK4b,UAAU3Z,IAAIuR,EAAKpS,IAK3BA,EAAQpB,KAAK4b,UAAU+kB,QAAQ18B,GACxB7C,EAAM8B,KAAI,GAGlB,QAAS4F,IAAa6K,GACrB,IAAK,GAAIqO,GAAO5K,UAAUrU,OAAQiC,EAAO2G,MAAMqW,EAAO,EAAIA,EAAO,EAAI,GAAIC,EAAO,EAAUD,EAAPC,EAAaA,IAC/Fjd,EAAKid,EAAO,GAAK7K,UAAU6K,EAG5BuU,IAAUx2B,KAAM2T,GAAa3O,KAAMA,IAGpC,QAAS4D,IAAmBpD,GAE3B,MAAIxF,MAAK+S,OACJ/S,KAAK+S,OAAOiG,WAAahZ,KAAK+S,OAAOiG,UAAUnS,OAASrB,EACpDxF,KAAK+S,OAEL/S,KAAK+S,OAAOpK,WAAWnD,GAIzB,KAGR,QAASkD,IAAsBlD,GAC9B,MAAIxF,MAAK+kB,UACJ/kB,KAAK+kB,UAAU/L,WAAahZ,KAAK+kB,UAAU/L,UAAUnS,OAASrB,EAC1DxF,KAAK+kB,UAEL/kB,KAAK+kB,UAAUtc,cAAcjD,GAI/B,KAGR,QAASgD,IAAsBhD,GAC9B,MAAOxF,MAAK+O,SAASxG,cAAc/C,GAGpC,QAASmB,IAAuBqH,EAAMu4C,GACrC,GAAIv4C,EAAKw4C,wBAAyB,CACjC,GAAIC,GAAUz4C,EAAKw4C,wBAAwBD,EAC3C,OAAiB,GAAVE,EAAc,EAAI,GAK1B,MAAO//C,IAAmBsH,EAAMu4C,GAGjC,QAAS7/C,IAAmBiJ,EAAG+pB,GAU9B,IATA,GAAIgtB,GAAYC,GAAYh3C,EAAEqJ,WAAarJ,EAAE0C,SAASgD,OAClDuxC,EAAYD,GAAYjtB,EAAE1gB,WAAa0gB,EAAErnB,SAASgD,OAElDwxC,EAAUC,EAASJ,GACnBK,EAAUD,EAASF,GACnBI,EAAiBvkD,OAIdokD,GAAWA,IAAYE,GAC7BL,EAAU5lD,MACV8lD,EAAU9lD,MAEVkmD,EAAiBH,EAEjBA,EAAUC,EAASJ,GACnBK,EAAUD,EAASF,EAIpBC,GAAUA,EAAQ7tC,WAAa6tC,EAC/BE,EAAUA,EAAQ/tC,WAAa+tC,CAE/B,IAAIE,GAAYJ,EAAQt1C,eACpB21C,EAAYH,EAAQx1C,cAGxB,IAAI01C,IAAcC,EAAW,CAC5B,GAAIC,GAASF,EAAUv1C,MAAMxL,QAAQ2gD,GACjCO,EAASF,EAAUx1C,MAAMxL,QAAQ6gD,EAIrC,OAAOI,GAASC,GAAUV,EAAU3jD,OAAS6jD,EAAU7jD,OAKxD,GAAIskD,GAAYL,EAAel9B,UAC/B,IAAIu9B,EAAW,CACd,GAAIF,GAASE,EAAUnhD,QAAQ+gD,GAC3BG,EAASC,EAAUnhD,QAAQghD,EAE/B,OAAOC,GAASC,GAAUV,EAAU3jD,OAAS6jD,EAAU7jD,OAGxD,KAAM,IAAIgJ,OAAM,iKAGjB,QAASu7C,IAAUzhD,GAClB,GAAI0L,GAAiB1L,EAAK0L,cAE1B,OAAIA,GAAuBA,EAAetD,MAEtCpI,EAAKmT,YAAczH,EAAiB1L,EAAKmT,UAAUzH,gBAC/CA,EAAetD,MADvB,OAKD,QAAS04C,IAAY9gD,GAIpB,IAHA,GAAI0hD,IAAY1hD,GACZ2hD,EAAWF,GAAUzhD,GAElB2hD,GACND,EAASzkD,KAAK0kD,GACdA,EAAWF,GAAUE,EAGtB,OAAOD,GAqER,QAASj/C,IAA0B9C,EAAUlE,GAC5CA,EAAUA,KACV,IAAIyE,GAAc/F,KAAKkgD,sBAInBvrC,EAAQ5O,EAAYP,EACxB,OAAImP,GAEIrT,GAAWA,EAAQmE,KAAOkP,EAAQA,EAAM5S,SAGhD4S,EAAQ,GAAIrP,IAAMtF,KAAMwF,IAAYlE,EAAQmE,MAAM,GAI9CkP,EAAMlP,OACTM,EAAYjD,KAAK0C,GACjBO,EAAY,IAAMP,GAAYmP,GAG/B3U,KAAK+O,SAAS1G,kBAAkB7C,EAAUmP,GAE1CA,EAAM3T,OACC2T,EAAMhP,QAGd,QAASyC,IAAgB5C,EAAUlE,GAClC,IAAKtB,KAAK2kB,GAAI,QAEdrjB,GAAUA,KACV,IAAIyE,GAAc/F,KAAK0kD,aAInB/vC,EAAQ5O,EAAYP,EACxB,OAAImP,GAEIrT,GAAWA,EAAQmE,KAAOkP,EAAQA,EAAM5S,SAGhD4S,EAAQ,GAAIrP,IAAMtF,KAAMwF,IAAYlE,EAAQmE,MAAM,GAI9CkP,EAAMlP,OACTM,EAAYjD,KAAK0C,GACjBO,EAAY,IAAMP,GAAYmP,GAG/B3U,KAAK+O,SAAS5G,QAAQ3C,EAAUmP,GAEhCA,EAAM3T,OACC2T,EAAMhP,QAGd,QAASuC,IAAa1C,GACrB,MAAKxF,MAAK2kB,GAIH3kB,KAAK+O,SAAS9G,KAAKzC,GAHlB,KAOT,QAASwC,MACR,MAAIhI,MAAKqmD,WACDrmD,KAAK2kB,IAGT3kB,KAAK2kB,IACRpM,EAAgBvY,KAAK2kB,GAAGyB,sBAAuBpmB,MAGhDA,KAAK2kB,GAAK3kB,KAAK+O,SAAShH,SACxB/H,KAAKqmD,YAAa,EAElBt/C,GAAW8B,KAAK7I,MACTA,KAAK2kB,IA+Cb,QAAS8iC,IAAWnmD,EAASkF,GAC5BlF,EAAUA,KAEV,IAAI0F,GAASvE,MAKb,OAJInB,GAAQ0F,SACXA,EAAmC,kBAAnB1F,GAAQ0F,OAAwB1F,EAAQ0F,OAASR,EAASQ,OAAO1F,EAAQ0F,UAIzFA,OAAQA,GAAUC,GAClB4oB,SAAU,YAAcvuB,GAAUA,EAAQuuB,SAAW,IACrDpZ,SAAUnV,EAAQmV,UAAY/O,EAC9B2oB,KAAM/uB,EAAQ+uB,MAAQ3oB,GAGxB,QAASI,IAAgBtG,EAASusB,EAAIzsB,GACrC,GAAuB,gBAAZE,GAAsB,CAChC,GAAIyC,GAAOW,OAAOX,KAAKzC,EAEvB,MAAM,IAAIuK,OAAM,oFAAsF9H,EAAKhC,IAAI,SAAUuR,GACxH,MAAO,IAAOA,EAAM,MAAShS,EAAQgS,KACnCpP,KAAK,QAAU,sBAAwBH,EAAKhC,IAAI,SAAUuR,GAC5D,MAAO,oBAAuBA,EAAM,MAAShS,EAAQgS,GAAO,cAC1DpP,KAAK,MAAQ,MAGjB9C,EAAUmmD,GAAWnmD,EAErB,IAAIF,GAAQpB,KAAK4b,UAAU+kB,QAAQ8kB,EAAajkD,IAC5CssB,EAAO1sB,EAAM8B,KAGjB,IAAI2B,EAAQipB,EAAMC,GAEjB,MADAzsB,GAAQmV,SAASnV,EAAQysB,IAClBvmB,EAGR,IAAIiK,GAAe2c,GAAYN,EAAMC,EAAI/tB,KAAMsB,EAAQmQ,aAGvD,OAAKA,GAQErQ,EAAMyG,QAAQimB,EAAMC,EAAIzsB,EAASmQ,IAPvC5N,GAAQrB,QACRpB,EAAMgJ,IAAI2jB,GACVlqB,GAAQ0W,MAED/S,IAMT,QAASI,IAAYpG,EAAS2vB,GAC7B,MAAOu2B,GAAK1nD,KAAMwB,EAAeiB,SAAN0uB,EAAkB,GAAKA,GA+CnD,QAASxkB,IAAaqB,GACrB,IAAKA,IAASA,EAAKqE,SAAU,QAE7B,IAAI8Q,GAAUnV,EAAKqE,QAEnB,QACC9M,QAAS4d,EAAQ5d,QACjB/D,QAAS2hB,EAAQhiB,QAAQM,aACzBwE,MAAO+F,MAAamX,EAAQpU,SAAS0W,WACrCjS,IAAKxH,MAAamX,EAAQpU,SAAS4W,UAIrC,QAASgiC,IAAO5lC,EAAQwgC,EAAaqF,GAEpC,MAAIA,IAASC,GAAW9lC,EAAQwgC,GAExB,WAEN,GAEI58C,GAFA+8C,EAAY,UAAY1iD,MACxB4iD,EAAS5iD,KAAK4iD,MAWlB,OARA5iD,MAAK4iD,OAASL,EAEd58C,EAASoc,EAAO7c,MAAMlF,KAAMoX,WAExBsrC,IACH1iD,KAAK4iD,OAASA,GAGRj9C,GAGDoc,EAIT,QAAS8lC,IAAW9lC,EAAQwgC,GAC3B,MAA8B,kBAAhBA,IAA8B,SAAS37C,KAAKmb,GAG3D,QAAS+lC,IAAO7qB,GAGf,IAFA,GAAI37B,MAEG27B,GACN8qB,GAAc9qB,EAAO37B,GACrB0mD,GAAgB/qB,EAAO37B,GAGtB27B,EADGA,EAAM4nB,UAAY54C,GACbgxB,EAAM4nB,SAEN,CAIV,OAAOvjD,GAGR,QAASymD,IAAc9qB,EAAO37B,GAC7Bgc,GAAW3a,QAAQ,SAAUib,GAC5BqqC,GAAYrqC,EAAEd,YAAcmgB,EAAMj7B,UAAYi7B,EAAO37B,EAASsc,EAAE/W,QAIlE,QAASohD,IAAYjzC,EAAQ1T,EAASuF,GACrC,GAAIoW,GACAhZ,EAAOW,OAAOX,KAAK+Q,EAAOnO,GAEzB5C,GAAKlB,UAIJka,EAAW3b,EAAQuF,MACxBoW,EAAW3b,EAAQuF,OAGpB5C,EAAK2H,OAAO,SAAU4H,GACrB,QAASA,IAAOyJ,MACdta,QAAQ,SAAU6Q,GACpB,MAAOyJ,GAASzJ,GAAOwB,EAAOnO,GAAM2M,MAItC,QAASw0C,IAAgB/qB,EAAO37B,GAC/BsD,OAAOX,KAAKg5B,EAAMj7B,WAAWW,QAAQ,SAAU6Q,GAC9C,GAAY,aAARA,EAAJ,CAIA,GAAIvT,GAAQg9B,EAAMj7B,UAAUwR,EAE5B,IAAMA,IAAOlS,IAKR,GAA4B,kBAAjBA,GAAQkS,IAAwC,kBAAVvT,IAAwBqB,EAAQkS,GAAKqvC,QAAS,CAElG,GAAIl9C,GAASlD,OACTolD,EAAa5nD,EAAM4iD,OAEnBgF,KACH5nD,EAAQA,EAAM4iD,SAIfl9C,EAASgiD,GAAMrmD,EAAQkS,GAAKqvC,QAAS5iD,GAEjC4nD,IACHliD,EAAOk9C,QAAUl9C,GAGlBrE,EAAQkS,GAAO7N,OApBhBrE,GAAQkS,GAAOvT,EAAM4iD,QAAU5iD,EAAM4iD,QAAU5iD,KAyBlD,QAASyM,MACR,IAAK,GAAIsV,GAAO5K,UAAUrU,OAAQzB,EAAUqK,MAAMqW,GAAOC,EAAO,EAAUD,EAAPC,EAAaA,IAC/E3gB,EAAQ2gB,GAAQ7K,UAAU6K,EAG3B,OAAK3gB,GAAQyB,OAGLzB,EAAQoiD,OAAOwE,GAAWloD,MAF1BkoD,GAAUloD,MAMnB,QAASkoD,IAAUvtC,GAClB,GAEIsiB,GAAOriB,EAFPtZ,EAAU8V,UAAUrU,QAAU,GAAsBN,SAAjB2U,UAAU,MAAwBA,UAAU,EA+CnF,OArCI9V,GAAQU,oBAAqBiK,MAChC3K,EAAUwmD,GAAOxmD,IAGlB27B,EAAQ,SAAU37B,GACjB,MAAMtB,gBAAgBi9B,IAEtBhY,GAAUjlB,KAAMsB,WAChBkkB,IAAWxlB,KAAMsB,WAHoB,GAAI27B,GAAM37B,IAMhDsZ,EAAQsC,GAAOvC,EAAO3Y,WACtB4Y,EAAMzO,YAAc8wB,EAGpB5wB,GAAiB4wB,GAEhB7wB,UAAYnM,MAAO2a,GAGnBnO,QAAUxM,MAAOyM,GAASH,UAAU,EAAMmW,cAAc,GAGxDmiC,SAAW5kD,MAAO0a,KAInBmD,GAAOrR,OAAOkO,EAAQC,EAAOtZ,GAE7B+Z,GAAiB5O,OAAOkO,EAAQC,EAAOtZ,GAEnCA,EAAQ8iD,WACXxpC,EAAMwpC,SAAWp4C,GAASkR,GAAOvC,EAAO3Y,UAAUoiD,UAAW9iD,EAAQ8iD,WAGtEnnB,EAAMj7B,UAAY4Y,EAEXqiB,EAYR,QAAShxB,IAAQ3K,GAChB,MAAMtB,gBAAgBiM,KAEtBgZ,GAAUjlB,KAAMsB,WAChBkkB,IAAWxlB,KAAMsB,WAHsB,GAAI2K,IAAQ3K,GA3hcpD,GAAIw+C,KACFqI,GAAIt7B,QAAU,MAAO5a,KACrBk2C,GAAIvtB,UAAY,MAAOA,KACvButB,GAAIp7C,OAAS,MAAOA,KACpBo7C,GAAIttB,SAAW,MAAOA,KACtBstB,GAAIrtB,OAAS,MAAOA,KACpBqtB,GAAIptB,SAAW,MAAOA,MAKpBlvB,GAAwB,mBAAXu8C,QAAyBA,OAAS,KAC/C15C,GAAM7C,GAAMw8C,SAAW,KAEvBn7B,KAAaxe,GACb45C,GAAgC,mBAAZjpC,UAAmD,kBAAjBA,SAAQkpC,MAAqD,kBAAvBlpC,SAAQkpC,KAAKrjD,MAEzG+H,GAAQxK,MACZ,KACCmC,OAAOwQ,kBAAmB,QAAUnV,MAAO,IAC3CgN,IAAQ,EACP,MAAOyF,IACRzF,IAAQ,EAGT,GA2CIu7C,IACAC,GACAzE,GA7CAh3C,GAAO0B,GAAMA,GAAIg6C,eAAeC,WAAW,oDAAqD,QAAS,EAEzGh7B,IAAW,IAAK,KAAM,MAAO,UAE7BzhB,IAEHyY,GAAI,OACJs+B,QAAQ,EAGRj0C,SAAU,KAGVgtC,oBAAoB,EACpBJ,UAAU,EACVG,eAAe,EACfb,YAAa,KAAM,MACnBJ,kBAAmB,MAAO,OAC1B1sB,aAAa,EAGb9S,QACA8oC,YACAn3C,OAAO,EACPw3C,cAAc,EACdhoC,SACAiJ,UAAU,EACVpR,QAAQ,EACRse,MAAM,EAGNutB,SAAS,EACTvqC,oBAAoB,EACpBa,SAAU,OAGViD,IAAK,KACL2C,gBAAgB,GAKbusC,KAIAN,KACH,WACC,GAAIO,IAAgB,uDAAwD,iDAAkD,+CAAgD,+CAAgD,8EAC1NC,EAAiB,4oBAErB9E,IAAU,WACT,GAAI+E,KAAa1pC,QAAQC,cACzBD,SAAQ0pC,EAAW,iBAAmB,OAAO7jD,MAAMma,QAASwpC,GAC5DxpC,QAAQmpC,IAAIM,GACRC,GACH1pC,QAAQS,SAAS+oC,GAGlB7E,GAAUt8C,GAGX+gD,GAAe,SAAUrpC,EAASpa,GAIjC,GAHAg/C,KAGqC,gBAA1Bh/C,GAAKA,EAAKjC,OAAS,GAAiB,CAC9C,GAAIzB,GAAU0D,EAAKlE,MACfyE,EAAUjE,EAAUA,EAAQiE,QAAU,IAE1C,IAAIA,EAAS,CAGZ,GAAIiJ,GAAQ/L,MACR8C,GAAQyT,YAAcxK,EAAQjJ,EAAQyT,UAAUnS,QACnDuY,EAAU,IAAM5Q,EAAQ,KAAO4Q,EAGhC,IAAIpR,GAAOvL,QACPuL,EAAO1M,EAAQ0M,MAAQzI,EAAQwJ,UAAYxJ,EAAQwJ,SAASQ,UAAYhK,EAAQ0C,KAAK,OACxFjD,EAAKlC,KAAKkL,IAKbqR,QAAQkpC,KAAKrjD,MAAMma,SAAU,mBAAqBD,EAAS,4BAA6B,2BAA2Bna,OAAOD,KAG3HwjD,GAAM,WACLnpC,QAAQmpC,IAAItjD,MAAMma,QAASjI,eAI7BqxC,GAAeD,GAAMxE,GAAUt8C,CA4DlC,IAyVMoF,IAzVFmC,GAAW,SAAU+5C,EAAUC,GACjC,GAA0B,kBAAfA,IAA4C,OAAfA,EACtC,KAAM,IAAIpyB,WAAU,iEAAoEoyB,GAG1FD,GAAShnD,UAAY4C,OAAOsY,OAAO+rC,GAAcA,EAAWjnD,WAC1DmK,aACElM,MAAO+oD,EACPjF,YAAY,EACZx3C,UAAU,EACVmW,cAAc,KAGdumC,IAAYrkD,OAAOskD,eAAiBtkD,OAAOskD,eAAeF,EAAUC,GAAcD,EAASxmC,UAAYymC,IAGzG1nD,GAAiB,SAAUiF,EAAU2iD,GACvC,KAAM3iD,YAAoB2iD,IACxB,KAAM,IAAItyB,WAAU,sCAKlBuyB,IACHnkC,WACCg9B,WAAY,aACZoH,YAAa,eAEdz/C,QACCq4C,WAAY,OACZ7iC,QAAS,6WAEV3I,UACCwrC,WAAY,WACZoH,YAAa,eAIX7oD,GAAO,WACV,QAASA,GAAKoT,GACbrS,GAAevB,KAAMQ,GAErBR,KAAK4T,MAAQA,EACb5T,KAAK+hB,OAAS,KAAOnO,EACrB5T,KAAKsiD,UAAY8G,GAAax1C,GA0B/B,MAvBApT,GAAKwB,UAAU4B,KAAO,SAAcme,EAAQxc,EAAS+jD,GACpD,MAAI/jD,GAAQwc,IACXunC,EAAM/jD,EAAQwc,GAAQunC,GAAO/jD,EAAQwc,MAC9B,GAFR,QAMDvhB,EAAKwB,UAAU6G,KAAO,SAActD,EAAS+jD,GAC5CtpD,KAAK4D,KAAK5D,KAAK+hB,OAAQxc,EAAS+jD,IAG3B/jD,EAAQvF,KAAK+hB,SAAW/hB,KAAKsiD,WAAatiD,KAAK4D,KAAK5D,KAAKsiD,UAAUL,WAAY18C,EAAS+jD,KACxFtpD,KAAKsiD,UAAUljC,QAClB5D,EAAYxb,KAAKsiD,UAAUljC,SAE3B5D,EAAY,4KAA6Kxb,KAAKsiD,UAAUL,WAAYjiD,KAAKsiD,UAAU+G,cAKrOC,EAAM/jD,EAAQsD,KAAK7I,KAAK4T,MAAO01C,GAAO/jD,EAAQsD,KAAK7I,KAAK4T,QAGlDpT,KAGJ+oD,GAAa3kD,OAAO5C,UAAU7B,SA8J9BqpD,GAAoB,WACvB,QAASA,GAAkBnoD,EAAU0R,GACpCxR,GAAevB,KAAMwpD,GAErBxpD,KAAKqB,SAAWA,EAChBrB,KAAK+S,OAASA,EAEd/S,KAAKypD,UACLzpD,KAAK0pD,UAEL1pD,KAAK2e,YACL3e,KAAK2pD,cAAgB3pD,KAAK4pD,cAAgB,EAE1C5pD,KAAK6pD,eACL7pD,KAAK8pD,kBACL9pD,KAAK+pD,gBAAiB,EAElBh3C,GACHA,EAAOi3C,SAAShqD,MAuDlB,MAnDAwpD,GAAkBxnD,UAAU4D,IAAM,SAAaiQ,GAC9C,GAAIo0C,GAAOp0C,EAAW2Z,QAAUxvB,KAAKypD,OAASzpD,KAAK0pD,MACnDO,GAAKnnD,KAAK+S,IAGX2zC,EAAkBxnD,UAAUgoD,SAAW,SAAkB3pC,GACxDrgB,KAAK2e,SAAS7b,KAAKud,GAEnBrgB,KAAK2pD,eAAiB,EACtB3pD,KAAK4pD,eAAiB,GAKvBJ,EAAkBxnD,UAAUkoD,aAAe,SAAsB72C,GAChErT,KAAK8pD,eAAehnD,KAAKuQ,IAG1Bm2C,EAAkBxnD,UAAUmoD,gBAAkB,WAC7CnqD,KAAK4pD,eAAiB,EACtBQ,EAAMpqD,OAGPwpD,EAAkBxnD,UAAUqoD,eAAiB,WAC5CrqD,KAAK2pD,eAAiB,EACtBS,EAAMpqD,OAGPwpD,EAAkBxnD,UAAUsoD,YAAc,WACzCtqD,KAAK8pD,eAAennD,QAAQuhC,GAC5BlkC,KAAK6pD,YAAYlnD,QAAQ4nD,GACzBvqD,KAAK2e,SAAShc,QAAQ6nD,IAGvBhB,EAAkBxnD,UAAUhB,KAAO,WAClChB,KAAKyqD,OAAQ,EACbL,EAAMpqD,OAGPwpD,EAAkBxnD,UAAUsE,OAAS,SAAgBuP,GACpD,GAAIo0C,GAAOp0C,EAAW2Z,QAAUxvB,KAAKypD,OAASzpD,KAAK0pD,MACnDnxC,GAAgB0xC,EAAMp0C,GACtBu0C,EAAMpqD,OAGPwpD,EAAkBxnD,UAAUQ,MAAQ,WACnCxC,KAAKypD,OAAOxkD,OAAOjF,KAAK0pD,QAAQ/mD,QAAQ,SAAUoY,GACjD,MAAOA,GAAEvY,WAIJgnD,KA0CJkB,MACAC,MACAC,KACmB,mBAAZ/9C,SAEVC,GAAWD,SAEXC,GAAW,SAAUzL,GACpB,GAGIsE,GACAklD,EACAC,EACAx5B,EACAy5B,EACAtoB,EARAuoB,KACAC,KACAC,EAAQR,EAQZI,GAAe,SAAUK,GACxB,MAAO,UAAUlrD,GACZirD,IAAUR,KAId/kD,EAAS1F,EACTirD,EAAQC,EAERN,EAAmBO,EAAeF,IAAUP,GAAYK,EAAoBC,EAAkBtlD,GAG9F0lD,EAAKR,MAIPv5B,EAASw5B,EAAaH,IACtBI,EAASD,EAAaF,GAEtB,KACCvpD,EAASiwB,EAAQy5B,GAChB,MAAO5rC,GACR4rC,EAAO5rC,GA+CR,MA5CAsjB,IAEC4d,KAAM,SAAUiL,EAAaC,GAC5B,GAAIC,GAAW,GAAI1+C,IAAS,SAAUwkB,EAAQy5B,GAE7C,GAAIU,GAA2B,SAAU5yC,EAASmN,EAAU0lC,GAGpC,kBAAZ7yC,GACVmN,EAASljB,KAAK,SAAU6oD,GACvB,GAAIr2C,EAEJ,KACCA,EAAIuD,EAAQ8yC,GACZC,EAAUJ,EAAUl2C,EAAGgc,EAAQy5B,GAC9B,MAAO5rC,GACR4rC,EAAO5rC,MAMT6G,EAASljB,KAAK4oD,GAKhBD,GAAyBH,EAAaN,EAAmB15B,GACzDm6B,EAAyBF,EAAYN,EAAkBF,GAEnDG,IAAUR,IAEbW,EAAKR,IAIP,OAAOW,KAIT/oB,EAAQ,SAAW,SAAU8oB,GAC5B,MAAOvrD,MAAKqgD,KAAK,KAAMkL,IAGjB9oB,GAGR31B,GAAS++C,IAAM,SAAUC,GACxB,MAAO,IAAIh/C,IAAS,SAAUwkB,EAAQy5B,GACrC,GACIrpD,GACAuB,EACA8oD,EAHApmD,IAKJ,KAAKmmD,EAAS/oD,OAEb,WADAuuB,GAAO3rB,EAiBR,KAbAomD,EAAiB,SAAUtpB,EAASx/B,GAC/Bw/B,GAAmC,kBAAjBA,GAAQ4d,KAC7B5d,EAAQ4d,KAAK,SAAUpgD,GACtB0F,EAAO1C,GAAKhD,IACVyB,GAAW4vB,EAAO3rB,IAClBolD,IAEHplD,EAAO1C,GAAKw/B,IACV/gC,GAAW4vB,EAAO3rB,KAItBjE,EAAUuB,EAAI6oD,EAAS/oD,OAChBE,KACN8oD,EAAeD,EAAS7oD,GAAIA,MAK/B6J,GAASkc,QAAU,SAAU/oB,GAC5B,MAAO,IAAI6M,IAAS,SAAUwkB,GAC7BA,EAAOrxB,MAIT6M,GAASi+C,OAAS,SAAUiB,GAC3B,MAAO,IAAIl/C,IAAS,SAAUwkB,EAAQy5B,GACrCA,EAAOiB,MAiFV,IA0cIh7B,IA1cAi7B,GAAa,GAAIzrD,IAAK,UAEtB0rD,GAAQzpD,OAERoB,IACHrB,MAAO,SAAUgE,EAAU2lD,GAC1B,GAAI1pB,GAASD,CAkBb,OAhBI2pB,KACH1pB,EAAU,GAAI31B,IAAS,SAAUkH,GAChC,MAAOwuB,GAAgBxuB,KAIzBk4C,IACCE,cAAeF,GACfG,kBAAmB,GAAI7C,IAAkBhnB,EAAe0pB,IAASA,GAAMG,mBACvEhF,aACAiF,SACAC,sBACAC,qBACAhmD,SAAUA,GAGJi8B,GAGRloB,IAAK,WACJkyC,IAEAP,GAAMG,kBAAkBrrD,OACxBkrD,GAAQA,GAAME,eAGfrkC,YAAa,SAAUhZ,GACtB29C,EAAWR,GAAM7E,UAAWt4C,IAG7BjL,YAAa,SAAU4hD,EAAUpiD,GAChCopD,EAAWppD,EAAQ4oD,GAAMM,kBAAoBN,GAAMK,mBAAoB7G,IAGxE3vC,mBAAoB,SAAUF,GAC7BA,EAAWkc,SAAWm6B,GAAMG,kBAC5BH,GAAMG,kBAAkBzmD,IAAIiQ,IAG7B82C,kBAAmB,SAAUt5C,GAC5B64C,GAAMG,kBAAkBnC,aAAa72C,IAItCqD,gBAAiB,SAAUyvC,GAC1B+F,GAAMG,kBAAkBxC,YAAY/mD,KAAKqjD,IAG1C//C,aAAc,SAAUwmD,EAAMC,GAC7B,GAAIC,EAEJ,IAAKZ,GAEE,CAEN,IADAY,EAASZ,GACFW,GAAcC,EAAOV,eAI3BU,EAASA,EAAOV,aAGjBU,GAAOR,MAAMxpD,KAAK8pD,OAVlBA,OAwDCG,GAAa,oCAwBbC,GAAa,GAAIxsD,IAAK,UAsHtBysD,GAAathD,MAAM3J,UAkCnBkJ,GAAUrK,EAAgB,WAE1BqsD,GAAgB,GAAI1sD,IAAK,YA2BzB2sD,GAAe,gBACfrI,GAA2B,+DAC3Bj3C,GAAgB,SAAUhH,EAAM8K,GAClC,MAAO,YAAc9K,EAAO,KAAO8K,EAAO,2FAA6FA,EAAO,KAuB5Iy7C,GAAgB,GAAI5sD,IAAK,YAuBzB6sD,GAAgB,oCAmChBlnD,GAAStF,EAAgB,UAEzB4F,GAAO5F,EAAgB,QAEvByJ,GAAQzJ,EAAgB,SA+CxBsJ,GAAUtJ,EAAgB,UAIzBgL,KAGJmlB,MAIKzlB,KAAKC,MACTD,KAAKC,IAAM,WACV,OAAQ,GAAID,QAITE,OAAOzJ,UAAU0J,OACrBD,OAAOzJ,UAAU0J,KAAO,WACvB,MAAO1L,MAAKqE,QAAQ,OAAQ,IAAIA,QAAQ,OAAQ,MAM7CO,OAAOX,OACXW,OAAOX,KAAO,WACb,GAAImc,GAAiBxb,OAAO5C,UAAUoe,eAClCktC,IAAqBntD,SAAU,MAAQotD,qBAAqB,YAC5DC,GAAa,WAAY,iBAAkB,UAAW,iBAAkB,gBAAiB,uBAAwB,eACjHC,EAAkBD,EAAUzqD,MAEhC,OAAO,UAAUuzB,GAChB,GAAmB,gBAARA,IAAmC,kBAARA,IAA8B,OAARA,EAC3D,KAAM,IAAIO,WAAU,mCAGrB,IAAIlxB,KAEJ,KAAK,GAAI+V,KAAQ4a,GACZlW,EAAexc,KAAK0yB,EAAK5a,IAC5B/V,EAAO7C,KAAK4Y,EAId,IAAI4xC,EACH,IAAK,GAAIrqD,GAAI,EAAOwqD,EAAJxqD,EAAqBA,IAChCmd,EAAexc,KAAK0yB,EAAKk3B,EAAUvqD,KACtC0C,EAAO7C,KAAK0qD,EAAUvqD,GAIzB,OAAO0C,QAQLgG,MAAM3J,UAAUkE,UACpByF,MAAM3J,UAAUkE,QAAU,SAAUy4C,EAAQ17C,GAC3C,GAAID,EAcJ,KAZUP,SAANQ,IACHA,EAAI,GAGG,EAAJA,IACHA,GAAKjD,KAAK+C,QAGH,EAAJE,IACHA,EAAI,GAGAD,EAAMhD,KAAK+C,OAAYC,EAAJC,EAASA,IAChC,GAAIjD,KAAKogB,eAAend,IAAMjD,KAAKiD,KAAO07C,EACzC,MAAO17C,EAIT,OAAO,KAIJ0I,MAAM3J,UAAUW,UACpBgJ,MAAM3J,UAAUW,QAAU,SAAUtB,EAAUF,GAC7C,GAAI8B,GAAGD,CAEP,KAAKC,EAAI,EAAGD,EAAMhD,KAAK+C,OAAYC,EAAJC,EAASA,GAAK,EACxCjD,KAAKogB,eAAend,IACvB5B,EAASuC,KAAKzC,EAASnB,KAAKiD,GAAIA,EAAGjD,QAMlC2L,MAAM3J,UAAUC,MACpB0J,MAAM3J,UAAUC,IAAM,SAAUm7C,EAAQj8C,GACvC,GACI8B,GACAD,EAEA0qD,EAJAjrC,EAAQziB,KAGR2tD,IAYJ,KALIlrC,YAAiBhX,UACpBgX,EAAQA,EAAMtiB,WACdutD,GAAmB,GAGfzqD,EAAI,EAAGD,EAAMyf,EAAM1f,OAAYC,EAAJC,EAASA,GAAK,GACzCwf,EAAMrC,eAAend,IAAMyqD,KAC9BC,EAAO1qD,GAAKm6C,EAAOx5C,KAAKzC,EAASshB,EAAMxf,GAAIA,EAAGwf,GAIhD,OAAOkrC,KAI6B,kBAA3BhiD,OAAM3J,UAAU0hD,SAC1B/3C,MAAM3J,UAAU0hD,OAAS,SAAUriD,EAAUy1B;AAC5C,GAAI7zB,GAAGhD,EAAO+C,EAAK4zB,CAEnB,IAAI,kBAAsBv1B,GACzB,KAAM,IAAIw1B,WAAUx1B,EAAW,qBAWhC,KARA2B,EAAMhD,KAAK+C,OACX6zB,GAAa,EAETxf,UAAUrU,OAAS,IACtB9C,EAAQ62B,EACRF,GAAa,GAGT3zB,EAAI,EAAOD,EAAJC,EAASA,GAAK,EACrBjD,KAAKogB,eAAend,GACnB2zB,IACH32B,EAAQoB,EAASpB,EAAOD,KAAKiD,GAAIA,EAAGjD,QAGrCC,EAAQD,KAAKiD,GACb2zB,GAAa,EAIf,KAAKA,EACJ,KAAM,IAAIC,WAAU,8CAGrB,OAAO52B,KAIJ0L,MAAM3J,UAAU4J,SACpBD,MAAM3J,UAAU4J,OAAS,SAAUA,EAAQzK,GAC1C,GAAI8B,GACAD,EACA+zB,IAEJ,KAAK9zB,EAAI,EAAGD,EAAMhD,KAAK+C,OAAYC,EAAJC,EAASA,GAAK,EACxCjD,KAAKogB,eAAend,IAAM2I,EAAOhI,KAAKzC,EAASnB,KAAKiD,GAAIA,EAAGjD,QAC9D+2B,EAASA,EAASh0B,QAAU/C,KAAKiD,GAInC,OAAO8zB,KAIJprB,MAAM3J,UAAUg1B,QACpBrrB,MAAM3J,UAAUg1B,MAAQ,SAAUC,EAAU91B,GAC3C,GAAI4Z,GAAG/X,EAAKC,CAEZ,IAAY,MAARjD,KACH,KAAM,IAAI62B,UAMX,IAHA9b,EAAInW,OAAO5E,MACXgD,EAAM+X,EAAEhY,SAAW,EAEK,kBAAbk0B,GACV,KAAM,IAAIJ,UAGX,KAAK5zB,EAAI,EAAOD,EAAJC,EAASA,GAAK,EACzB,GAAIA,IAAK8X,KAAMkc,EAASrzB,KAAKzC,EAAS4Z,EAAE9X,GAAIA,EAAG8X,GAC9C,OAAO,CAIT,QAAO,IAI8B,kBAA5Bmc,UAASl1B,UAAUkN,OAC7BgoB,SAASl1B,UAAUkN,KAAO,SAAU/N,GACnC,GAAI6D,GACA2I,EACAwpB,EACArP,EACA/lB,KAAWA,KAEf,IAAoB,kBAAT/B,MACV,KAAM,IAAI62B,WAAU,iDAerB,OAZA7xB,GAAOjD,EAAM6B,KAAKwT,UAAW,GAC7BzJ,EAAK3N,KACLm3B,EAAQ,aAERrP,EAAQ,WACP,GAAIsP,GAAMp3B,eAAgBm3B,IAASh2B,EAAUnB,KAAOmB,CACpD,OAAOwM,GAAGzI,MAAMkyB,EAAKpyB,EAAKC,OAAOlD,EAAM6B,KAAKwT,cAG7C+f,EAAMn1B,UAAYhC,KAAKgC,UACvB8lB,EAAM9lB,UAAY,GAAIm1B,GAEfrP,IAMJjc,GAAIC,mBACR,SAAWD,EAAK6C,GACf,GAAI2oB,GAAOvrB,EAAkB6M,EAAqBU,EAAMgU,EAAOiK,CAG/DzrB,GAAI0rB,yBAA0B,EAE9BF,EAAQ,SAAU3kB,EAAGpB,GACpB,GAAIkmB,GACAhxB,EAAWxG,IAEf,KAAKw3B,IAAY9kB,GAChBlM,EAASgxB,GAAY9kB,EAAE8kB,EAGxBhxB,GAASixB,cAAgBnmB,EACzB9K,EAASwO,OAAStC,EAAEglB,YAAcpmB,EAClC9K,EAASmxB,WAAa,GAAIpsB,MAE1B/E,EAASoxB,eAAiB,WACzBllB,EAAEmlB,aAAc,GAGjBrxB,EAASsxB,gBAAkB,WAC1BplB,EAAEqlB,cAAe,IAInBjsB,EAAmB,SAAU6F,EAAMqmB,GAClC,GACIC,GACAh1B,EAFAqO,EAAUtR,IAIdi4B,GAAY3mB,EAAQ2mB,YAAc3mB,EAAQ2mB,cAC1Ch1B,EAAIg1B,EAAUl1B,OAEdk1B,EAAUh1B,IAAM+0B,EAAU,SAAUtlB,GACnCslB,EAASp0B,KAAK0N,EAAS,GAAI+lB,GAAM3kB,EAAGpB,MAGrCA,EAAQ0hB,YAAY,KAAOrhB,EAAMsmB,EAAUh1B,GAAG,KAG/C0V,EAAsB,SAAUhH,EAAMqmB,GACrC,GACIC,GACAh1B,EAFAqO,EAAUtR,IAId,IAAKsR,EAAQ2mB,UAOb,IAHAA,EAAY3mB,EAAQ2mB,UACpBh1B,EAAIg1B,EAAUl1B,OAEPE,KACFg1B,EAAUh1B,GAAG,KAAO+0B,GACvB1mB,EAAQ4mB,YAAY,KAAOvmB,EAAMsmB,EAAUh1B,GAAG,KAKjD4I,EAAIC,iBAAmB4C,EAAI5C,iBAAmBA,EAC9CD,EAAI8M,oBAAsBjK,EAAIiK,oBAAsBA,EAEhD,WAAa9M,IAChBA,EAAI4G,QAAQzQ,UAAU8J,iBAAmBA,EACzCD,EAAI4G,QAAQzQ,UAAU2W,oBAAsBA,IAK5C2e,EAAoB5oB,EAAIC,cAExBD,EAAIC,cAAgB,SAAUuH,GAC7B,GAAIyO,GAAK2S,EAAkBphB,EAG3B,OAFAyO,GAAG7Y,iBAAmBA,EACtB6Y,EAAGhM,oBAAsBA,EAClBgM,GAKRtL,EAAO3K,EAAI4K,qBAAqB,QAAQ,GACxC+T,EAAQ3e,EAAIC,cAAc,SAE1B0K,EAAK0P,aAAasE,EAAOhU,EAAK8e,cAI7BtsB,GAAK6C,IAOJ7C,GAAIklB,mBACRC,GAAcD,iBAAmB,WAGhC,QAASqH,GAAa9mB,EAAS+b,EAAOmK,EAAUa,GAC/C,GAAIC,GAAiBjL,EAAMmK,GACvBe,EAAOpI,WAAWmI,GAClBrI,EAASqI,EAAe5kB,MAAM,MAAM,EAEpCkgB,OAAM2E,IACL,sBAAsB3xB,KAAK0xB,KAC9BC,EAAOC,EAAmBF,GAC1BrI,EAAS,IAMXoI,EAAuB,MAAZA,EAAmBA,EAAW,OAAOzxB,KAAKqpB,IAAW3e,EAAQmnB,cAAgBL,EAAa9mB,EAAQmnB,cAAennB,EAAQmnB,cAAcC,aAAc,WAAY,MAAQ,EACpL,IAAIC,GAAuB,YAAZnB,EAAyBa,EAAW,SAASzxB,KAAK4wB,GAAYlmB,EAAQsnB,YAActnB,EAAQunB,YAE3G,OAAiB,MAAV5I,EAAiBsI,EAAOF,EAAqB,MAAVpI,EAAwB,GAAPsI,EAAsB,MAAVtI,EAAwB,GAAPsI,EAAY,GAAe,KAAVtI,EAAgBsI,EAAO,IAAMI,EAAWJ,EAGlJ,QAASC,GAAmBD,GAC3B,GAAI9pB,GAAKqqB,CAgBT,OAbKC,GAAYR,KAChB9pB,EAAMC,GAAIC,cAAc,OACxBF,EAAI4e,MAAM2L,QAAU,QACpBvqB,EAAI4e,MAAM4L,SAAW,QACrBxqB,EAAI4e,MAAM6L,MAAQzqB,EAAI4e,MAAM8L,OAAS,IACrC1qB,EAAI4e,MAAM+L,YAAcb,EAAO,eAE/B7pB,GAAI4K,qBAAqB,QAAQ,GAAGrD,YAAYxH,GAChDqqB,EAAMrqB,EAAI4qB,wBAEVN,EAAYR,GAAQO,EAAIQ,MAAQR,EAAIS,MAG9BR,EAAYR,GAGpB,QAASiB,GAAsBnM,EAAOmK,GACrC,GAAIiC,GAA2B,UAAZjC,EAAuB,QAAU,GAChDzc,EAAIyc,EAAW,MAAQiC,EACvB7b,EAAI4Z,EAAW,QAAUiC,EACzBC,EAAIlC,EAAW,SAAWiC,EAC1BE,EAAInC,EAAW,OAASiC,CAE5BpM,GAAMmK,IAAanK,EAAMtS,IAAMsS,EAAMzP,IAAMyP,EAAMqM,IAAMrM,EAAMsM,IAAMtM,EAAMtS,IAAMsS,EAAMtS,IAAMsS,EAAMqM,IAAMrM,EAAMsM,IAAMtM,EAAMzP,IAAMyP,EAAMtS,GAAIsS,EAAMzP,IAAMyP,EAAMsM,IAAMtM,EAAMzP,IAAMyP,EAAMtS,GAAIsS,EAAMzP,GAAIyP,EAAMqM,KAAOrM,EAAMtS,GAAIsS,EAAMzP,GAAIyP,EAAMqM,GAAIrM,EAAMsM,KAAKv1B,KAAK,KAS7P,QAASw1B,GAAoBtoB,GAC5B,GAAIonB,GAAcrL,EAAOgL,EAAUb,CAEnCkB,GAAepnB,EAAQonB,aACvBrL,EAAQrtB,KACRq4B,EAAWD,EAAa9mB,EAASonB,EAAc,WAAY,KAG3D,KAAKlB,IAAYkB,GACe,WAA3BA,EAAalB,IAA0BqC,EAAYzZ,eAAeoX,GACrEnK,EAAMmK,GAAYqC,EAAYrC,GACpB,0CAA0C5wB,KAAK4wB,GAC1B,SAA3BkB,EAAalB,GACZ,gBAAgB5wB,KAAK4wB,GAExBnK,EAAMmK,IAA0B,UAAbA,EAAuBlmB,EAAQsnB,YAActnB,EAAQunB,cAAgB,KAC9E,0BAA0BjyB,KAAK4wB,KACzCnK,EAAMmK,GAAY,OAGnBnK,EAAMmK,GAAYY,EAAa9mB,EAASonB,EAAclB,EAAUa,GAAY,KAEtD,eAAbb,EACVnK,EAAAA,SAAcqL,EAAalB,GAE3BnK,EAAMmK,GAAYkB,EAAalB,EAUjC,OANAgC,GAAsBnM,EAAO,UAC7BmM,EAAsBnM,EAAO,WAC7BmM,EAAsBnM,EAAO,UAE7BA,EAAMgL,SAAWA,EAAW,KAErBhL,EAeR,QAAS0D,GAAiBzf,GACzB,MAAO,IAAIsoB,GAAoBtoB,GA7GhC,GAAIynB,MAoDAc,GACHC,WAAY,IACZC,WAAY,IACZC,cAAe,EAyDhB,OAhBAJ,GAAoB53B,WACnBmK,YAAaytB,EACbK,oBAAqBvyB,EACrBwyB,iBAAkB,SAAUxe,GAC3B,MAAO1b,MAAK0b,IAAS,IAEtB7V,KAAM6B,EACNyyB,eAAgBzyB,EAChB0yB,YAAa1yB,EACb2yB,oBAAqB3yB,GAOfqpB,OArbTC,GAAgB,IA0bjB,IAOIriB,IACA7H,GACAwzB,GACAC,GACAC,GACAC,GACAC,GACA9N,GACA+N,GAfA1oB,GAAQ,+BACR2oB,GAAS,qCACT7tB,GAAM,6BACN8tB,GAAQ,+BACRC,GAAM,uCACNC,GAAQ,+BA0EZ,IArDCpsB,GATI3B,GASY,SAAU2E,EAAMqpB,EAAIvuB,GACnC,MAAKuuB,IAAMA,IAAO/oB,GAIXxF,EAASiC,GAAIusB,gBAAgBD,EAAIrpB,EAAMlF,GAAUiC,GAAIusB,gBAAgBD,EAAIrpB,GAHxElF,EAASiC,GAAIC,cAAcgD,EAAMlF,GAAUiC,GAAIC,cAAcgD,IAVtD,SAAUA,EAAMqpB,EAAIvuB,GACnC,GAAIuuB,GAAMA,IAAO/oB,GAChB,KAAM,iQAGP,OAAOxF,GAASiC,GAAIC,cAAcgD,EAAMlF,GAAUiC,GAAIC,cAAcgD,IAwDjEub,GAEE,CAYN,IAXAoN,GAAO3rB,GAAc,OACrB4rB,IAAe,UAAW,mBAE1BI,GAAe,SAAU7Y,GACxB,MAAO,UAAU9T,EAAMxI,GACtB,MAAOwI,GAAK8T,GAAYtc,KAI1Bk1B,GAAMH,GAAYx3B,OAEX23B,OAAU5zB,IAGhB,GAFA0zB,GAAaD,GAAYG,IAErBJ,GAAKE,IACR1zB,GAAU6zB,GAAaH,QAGvB,KADA5N,GAAIe,GAAQ5qB,OACL6pB,MAGN,GAFA6N,GAAW9M,GAAQ+M,IAAOF,GAAWU,OAAO,EAAG,GAAGzN,cAAgB+M,GAAW9M,UAAU,GAEnF4M,GAAKG,IAAW,CACnB3zB,GAAU6zB,GAAaF,GACvB,OAOC3zB,KACJA,GAAU,SAAUkH,EAAMxI,GACzB,GAAIuR,GAAOtC,EAAYxR,CAiBvB,KAfAwR,EAAazG,EAAKyG,WAEbA,IAEJ6lB,GAAKzgB,UAAY,GAEjBpF,EAAa6lB,GACbtsB,EAAOA,EAAKmtB,YAEZb,GAAKrkB,YAAYjI,IAGlB+I,EAAQtC,EAAWiY,iBAAiBlnB,GAEpCvC,EAAI8T,EAAMhU,OACHE,KACN,GAAI8T,EAAM9T,KAAO+K,EAChB,OAAO,CAIT,QAAO,QAzDTlH,IAAU,IAkEX,IAAIoW,IACA9H,GACA/I,EACJ,KACCzH,OAAOwQ,kBAAmB,QAAUnV,MAAO,IAEvCyO,IACH9J,OAAOwQ,eAAezG,GAAc,OAAQ,QAAU1O,MAAO,IAG9DmV,GAAiBxQ,OAAOwQ,eACvB,MAAO+J,IAGR/J,GAAiB,SAAUkhB,EAAK5a,EAAM0f,GACrC9E,EAAI5a,GAAQ0f,EAAKn7B,OAInB,IACC,IACC2E,OAAOyH,qBAAuBzF,MAAQ3G,MAAO,KAC5C,MAAOkf,IAER,KAAMA,IAGHzQ,IACH9J,OAAOyH,iBAAiBsC,GAAc,QAAU/H,MAAQ3G,MAAO,KAGhEoM,GAAmBzH,OAAOyH,iBACzB,MAAO8S,IACR9S,GAAmB,SAAUiqB,EAAK7E,GACjC,GAAI/V,EAEJ,KAAKA,IAAQ+V,GACRA,EAAMrR,eAAe1E,IACxBtG,GAAekhB,EAAK5a,EAAM+V,EAAM/V,KAMpC,IACC9W,OAAOsY,OAAO,MAEdA,GAAStY,OAAOsY,OACf,MAAOiC,IAERjC,GAAS,WACR,GAAIme,GAAI,YAER,OAAO,UAAUzgB,EAAO6W,GACvB,GAAI6E,EAEJ,OAAc,QAAV1b,MAIJygB,EAAEr5B,UAAY4Y,EACd0b,EAAM,GAAI+E,GAEN5J,GACH7sB,OAAOyH,iBAAiBiqB,EAAK7E,GAGvB6E,OAuBV,GAEIgF,IACAC,GAHAjN,GAAS1pB,OAAO5C,UAAUoe,eAI1Bob,GAAqB,MACzBD,IAAa,SAAUnc,GACtBpf,KAAK6G,KAAO,aACZ7G,KAAKof,QAAUA,CACf,KACC,KAAM,IAAIrT,OAAMqT,GACf,MAAO1M,GACR1S,KAAK0f,MAAQhN,EAAEgN,QAIjB6b,GAAWv5B,UAAY+J,MAAM/J,UAE7Bs5B,GAAS,SAAU9rB,EAAKlO,GACvB,GAAIoQ,GACA7L,EACA41B,EAAY,CAmBhB,KAjBAz7B,KAAKwP,IAAMA,EACXxP,KAAKsB,QAAUA,MACftB,KAAKkH,IAAM,EAEXlH,KAAK07B,MAAQ17B,KAAKwP,IAAIkE,MAAM,MAC5B1T,KAAK27B,SAAW37B,KAAK07B,MAAMz5B,IAAI,SAAU25B,GACxC,GAAIC,GAAUJ,EAAYG,EAAK74B,OAAS,CAGxC,OADA04B,GAAYI,EACLA,GACL,GAGC77B,KAAKgB,MAAMhB,KAAKgB,KAAKwO,EAAKlO,GAE9BoQ,KAEO1R,KAAKkH,IAAMlH,KAAKwP,IAAIzM,SAAW8C,EAAO7F,KAAK87B,SACjDpqB,EAAM5O,KAAK+C,EAGZ7F,MAAK+7B,SAAW/7B,KAAKg8B,YACrBh8B,KAAK2F,OAAS3F,KAAKi8B,YAAcj8B,KAAKi8B,YAAYvqB,EAAOpQ,GAAWoQ,GAGrE4pB,GAAOt5B,WACN85B,KAAM,SAAUI,GACf,GAAIh1B,GAAKjE,EAAGD,EAAK6C,CAOjB,KALKq2B,IAAYA,EAAal8B,KAAKk8B,YAEnCh1B,EAAMlH,KAAKkH,IAEXlE,EAAMk5B,EAAWn5B,OACZE,EAAI,EAAOD,EAAJC,EAASA,GAAK,EAGzB,GAFAjD,KAAKkH,IAAMA,EAEPrB,EAAOq2B,EAAWj5B,GAAGjD,MACxB,MAAO6F,EAIT,OAAO,OAGRs2B,WAAY,SAAUC,GAKrB,IAJA,GAEIC,GAFAC,EAAU,EACVb,EAAY,EAGTW,GAAQp8B,KAAK27B,SAASW,IAC5Bb,EAAYz7B,KAAK27B,SAASW,GAC1BA,GAAW,CAIZ,OADAD,GAAYD,EAAOX,GACXa,EAAU,EAAGD,EAAY,EAAGD,IAGrCvc,MAAO,SAAUT,GAChB,GAAIlY,GAAMlH,KAAKm8B,WAAWn8B,KAAKkH,KAC3Bo1B,EAAUp1B,EAAI,GACdm1B,EAAYn1B,EAAI,GAEhB00B,EAAO57B,KAAK07B,MAAMx0B,EAAI,GAAK,GAC3Bq1B,EAAU,EACVC,EAAaZ,EAAKv3B,QAAQ,MAAO,SAAUo4B,EAAOL,GAKrD,MAJIA,GAAOl1B,EAAI,KACdq1B,GAAW,GAGL,OACH,KAAO,GAAI5wB,OAAMzE,EAAI,GAAKq1B,GAASn4B,KAAK,KAAO,QAEhDyb,EAAQ,GAAI0b,IAAWnc,EAAU,YAAckd,EAAU,cAAgBD,EAAY,MAAQG,EAMjG,MAJA3c,GAAM+b,KAAO10B,EAAI,GACjB2Y,EAAM6c,UAAYx1B,EAAI,GACtB2Y,EAAM8c,aAAevd,EAEfS,GAGP+c,YAAa,SAAUC,GACtB,MAAI78B,MAAKwP,IAAI0rB,OAAOl7B,KAAKkH,IAAK21B,EAAO95B,UAAY85B,GAChD78B,KAAKkH,KAAO21B,EAAO95B,OACZ85B,GAFR,QAMDC,aAAc,SAAU34B,GACvB,GAAIs4B,EAEJ,QAAIA,EAAQt4B,EAAQY,KAAK/E,KAAKg8B,eAC7Bh8B,KAAKkH,KAAOu1B,EAAM,GAAG15B,OACd05B,EAAM,IAAMA,EAAM,IAF1B,QAMDM,gBAAiB,WAChB/8B,KAAK88B,aAAatB,KAGnBQ,UAAW,WACV,MAAOh8B,MAAKwP,IAAIke,UAAU1tB,KAAKkH,MAGhC81B,SAAU,WACT,MAAOh9B,MAAKwP,IAAIge,OAAOxtB,KAAKkH,OAI9Bo0B,GAAO7uB,OAAS,SAAUmO,GACzB,GACIqiB,GACAzpB,EAFAmH,EAAS3a,IAIbi9B,GAAQ,SAAUztB,EAAKlO,GACtBg6B,GAAO13B,KAAK5D,KAAMwP,EAAKlO,IAGxB27B,EAAMj7B,UAAYkb,GAAOvC,EAAO3Y,UAEhC,KAAKwR,IAAOoH,GACP0T,GAAO1qB,KAAKgX,EAAOpH,KACtBypB,EAAMj7B,UAAUwR,GAAOoH,EAAMpH,GAK/B,OADAypB,GAAMxwB,OAAS6uB,GAAO7uB,OACfwwB,EAGR,IAAIC,IACAC,GACAC,EAGJF,IAAsB,sCAGtBC,GAAwB,8EAGxBC,GAA0B,wCAqC1B,IAkjBIC,IAljBA9W,GAAO,EACP3U,GAAe,EACfsV,GAAS,EACTF,GAAU,EACVsW,GAAW,EACXC,GAAU,EACVzqB,GAAU,EACVgU,GAAU,EACV0W,GAAU,EACVC,GAAc,GACdC,GAAc,GACdjZ,GAAY,GACZO,GAAU,GACV2Y,GAAiB,GACjBhX,GAAU,GAEViX,GAAiB,GACjBC,GAAiB,GACjBC,GAAgB,GAChBC,GAAiB,GACjBC,GAAkB,GAClBC,GAAiB,GAEjBC,GAAS,GACTC,GAAiB,GAEjBC,GAAY,GACZC,GAAa,GACbC,GAAS,GACTC,GAAkB,GAClBC,GAAY,GACZC,GAAc,GACdC,GAAiB,GAEjBC,GAAa,GAEblT,GAAa,GACbD,GAAiB,GACjBG,GAAe,GACfJ,GAAe,GACfG,GAAkB,GAElBkT,GAAO,GACPC,GAAS,GAETC,GAAwBC,GAAwB,KAChDC,GAAwBD,GAAwB,KAsChDvwB,GAAQ,4BAGRywB,GAAiB,8FAcjBC,GAAa,6BA2BbC,IACHC,QAAQ,EACRC,SAAS,EACTC,OAAQ,KACR78B,UAAWA,QAGR88B,GAAkB,GAAIh7B,QAAO,OAASK,OAAOX,KAAKk7B,IAAU/6B,KAAK,KAAO,KACxEo7B,GAAgB,8FAChBC,GAAqB,kBACrBC,GAA4B,kBAC5BC,GAAiB,QAEjBC,GAAatE,GAAO7uB,QACvBzL,KAAM,SAAUwO,EAAKlO,GACpBtB,KAAKwoB,OAASlnB,EAAQknB,OACtBxoB,KAAK+8B,mBAGNd,YAAa,SAAUt2B,GACtB,MAAsB,KAAlBA,EAAO5C,QAAiB48B,GAAe/4B,KAAK5G,KAAK+7B,WAI5C97B,MAAO0F,EAAO,GAAG4N,GAHlB,MAMT2oB,YAAa,SAAwB2D,GACpC,IAAKA,EAAOrX,OAAQ,MAAO,KAE3B,IAAIsX,GAAcD,EAAO/C,aAAa4C,GAEtC,OAAII,IAAeD,EAAOrX,OAAOpI,eAAe0f,IACtCvsB,EAAGssB,EAAOrX,OAAOsX,IAD3B,QAGE,SAAoBD,GACtB,GAAIE,GAAUF,EAAO/C,aAAayC,GAClC,OAAIQ,IAAkBxsB,EAAG4rB,GAASY,IAAlC,QACE,SAAmBF,GACrB,GAAIhS,GAASgS,EAAO/C,aAAa0C,GACjC,OAAI3R,IAAiBta,GAAIsa,GAAzB,QACE,SAAmBgS,GACrB,GAAIG,GAAgBC,GAAkBJ,GAClCrX,EAASqX,EAAOrX,MAEpB,OAAIwX,IAAiBxX,GAEnBjV,EAAGysB,EAAczsB,EAAElP,QAAQo7B,GAAoB,SAAUhD,EAAOyD,GAC/D,MAAOA,KAAM1X,GAASA,EAAO0X,GAAMA,KAK/BF,GACL,SAAmBH,GACrB,IAAKA,EAAOjD,YAAY,KAAM,MAAO,KAErC,IAAIj3B,KAIJ,IAFAk6B,EAAO9C,kBAEH8C,EAAOjD,YAAY,KACtB,OAASrpB,EAAG5N,EAIb,KADA,GAAIw6B,GAAO19B,OACJ09B,EAAOC,GAAgBP,IAAS,CAKtC,GAJAl6B,EAAOw6B,EAAK3sB,KAAO2sB,EAAKlgC,MAExB4/B,EAAO9C,kBAEH8C,EAAOjD,YAAY,KACtB,OAASrpB,EAAG5N,EAGb,KAAKk6B,EAAOjD,YAAY,KACvB,MAAO,MAIT,MAAO,OACL,SAAkBiD,GACpB,IAAKA,EAAOjD,YAAY,KAAM,MAAO,KAErC,IAAIj3B,KAIJ,IAFAk6B,EAAO9C,kBAEH8C,EAAOjD,YAAY,KACtB,OAASrpB,EAAG5N,EAIb,KADA,GAAI06B,GAAa59B,OACV49B,EAAaR,EAAO/D,QAAQ,CAKlC,GAJAn2B,EAAO7C,KAAKu9B,EAAW9sB,GAEvBssB,EAAO9C,kBAEH8C,EAAOjD,YAAY,KACtB,OAASrpB,EAAG5N,EAGb,KAAKk6B,EAAOjD,YAAY,KACvB,MAAO,KAGRiD,GAAO9C,kBAGR,MAAO,UAgHL7T,GAAoB,WACvB,QAASA,GAAkBna,EAAUuxB,EAAWj/B,GAc/C,IAbAE,GAAevB,KAAMkpB,GAErBlpB,KAAK+O,SAAWA,EAChB/O,KAAKsgC,UAAYC,EAAUD,GAC3BtgC,KAAKqB,SAAWA,EAEhBrB,KAAKiE,KAAOq8B,EAAU5sB,MAAM,KAC5B1T,KAAKixB,UAAW,EAMTliB,GACFA,EAAS5N,SACZ4N,EAAS5N,QAAQq/B,cAAcxgC,KAAKiE,KAAK,GAAIjE,MAG9C+O,EAAWA,EAAS2Y,iBAAmB3Y,EAASgE,OA2BlD,MAvBAmW,GAAkBlnB,UAAUy+B,kBAAoB,WAC/C,IAAIzgC,KAAKixB,SAAT,CAEA,GAAI7vB,GAAQs/B,GAA0B1gC,KAAK+O,SAAU/O,KAAKsgC,UAEtDl/B,KACHpB,KAAKixB,UAAW,EAChBjxB,KAAKqB,SAASD,MAIhB8nB,EAAkBlnB,UAAUkwB,gBAAkB,WAC7C,IAAIlyB,KAAKixB,SAAT,CAEA,GAAI7vB,GAAQpB,KAAK+O,SAASoG,cAAcwrB,QAAQ3gC,KAAKiE,KACrDjE,MAAKqB,SAASD,GACdpB,KAAKixB,UAAW,IAGjB/H,EAAkBlnB,UAAUqM,OAAS,WACpCkK,EAAgBvY,KAAK+O,SAAS6xB,WAAY5gC,OAGpCkpB,KAGJnZ,GAAO,WACV,QAASA,GAAKzO,GACbC,GAAevB,KAAM+P,GAErB/P,KAAKuR,eAAiBjQ,EAAQiQ,eAC9BvR,KAAKuF,QAAUjE,EAAQiQ,eAAehM,QAEtCvF,KAAKgP,SAAW1N,EAAQ0N,SACxBhP,KAAKiG,MAAQ3E,EAAQ2E,MACrBjG,KAAK2R,KAAOrQ,EAAQ0N,SAAS+L,EAE7B/a,KAAKwD,OAAQ,EA8Bd,MA3BAuM,GAAK/N,UAAUmN,OAAS,WAClBnP,KAAKwD,QACTxD,KAAKwD,OAAQ,EACbxD,KAAKuR,eAAepC,WAItBY,EAAK/N,UAAUiG,KAAO,WACrB,MAAO,OAGR8H,EAAK/N,UAAUmG,QAAU,aAIzB4H,EAAK/N,UAAUuG,cAAgB,WAC9B,MAAO,OAGRwH,EAAK/N,UAAUqG,kBAAoB,aAInC0H,EAAK/N,UAAU4S,aAAe,WAC7B,MAAO5U,MAAKuR,eAAeqD,aAAa5U,OAGlC+P,KAGJ6W,GAAU,SAAW/X,GAGxB,QAAS+X,KACRrlB,GAAevB,KAAM4mB,GAErB/X,EAAM3J,MAAMlF,KAAMoX,WA2BnB,MAhCAnI,IAAS2X,EAAS/X,GAQlB+X,EAAQ5kB,UAAUkN,KAAO,aAIzB0X,EAAQ5kB,UAAU4H,OAAS,aAI3Bgd,EAAQ5kB,UAAUyI,SAAW,aAI7Bmc,EAAQ5kB,UAAU7B,SAAW,WAC5B,MAAO,YAAcH,KAAKgP,SAASW,EAAI,KAGxCiX,EAAQ5kB,UAAUqM,OAAS,aAI3BuY,EAAQ5kB,UAAUgJ,SAAW,aAItB4b,GACL7W,IAEC8wB,GAAe,WAClB,QAASA,GAAa9tB,GACrBxR,GAAevB,KAAM6gC,GAErB7gC,KAAK+S,OAASA,EACd/S,KAAKC,MAAQ8S,EAAOtR,aACpBzB,KAAK8jB,cAwBN,MArBA+c,GAAa7+B,UAAUkB,IAAM,WAC5B,MAAOlD,MAAKC,OAGb4gC,EAAa7+B,UAAUP,WAAa,WACnC,MAAOzB,MAAKC,OAGb4gC,EAAa7+B,UAAUF,aAAe,WACrC9B,KAAKC,MAAQD,KAAK+S,OAAOtR,aACzBzB,KAAK8jB,WAAWnhB,QAAQsd,IAGzB4gB,EAAa7+B,UAAUL,SAAW,SAAkBm/B,GACnD9gC,KAAK8jB,WAAWhhB,KAAKg+B,IAGtBD,EAAa7+B,UAAU2B,WAAa,SAAoBm9B,GACvDvoB,EAAgBvY,KAAK8jB,WAAYgd,IAG3BD,KAGJE,GAAW,WACd,QAASA,GAASvtB,GACjBjS,GAAevB,KAAM+gC,GAErB/gC,KAAKC,MAAQuT,EACbxT,KAAKue,YAAa,EAClBve,KAAK8jB,cAwBN,MArBAid,GAAS/+B,UAAUkB,IAAM,WACxB,MAAOlD,MAAKC,OAGb8gC,EAAS/+B,UAAUP,WAAa,WAC/B,MAAOzB,MAAKC,OAGb8gC,EAAS/+B,UAAUoN,OAAS,SAAgBoE,GAC3CxT,KAAKC,MAAQuT,EACbxT,KAAK8jB,WAAWnhB,QAAQsd,IAGzB8gB,EAAS/+B,UAAUL,SAAW,SAAkBm/B,GAC/C9gC,KAAK8jB,WAAWhhB,KAAKg+B,IAGtBC,EAAS/+B,UAAU2B,WAAa,SAAoBm9B,GACnDvoB,EAAgBvY,KAAK8jB,WAAYgd,IAG3BC,KAGJC,MACAC,GAAex+B,MAmBdoJ,MAIJ,SAAW8hB,EAASuT,EAAUr1B,GAE7B,GAAIyJ,GAAG8Z,CAEP,KAAIvjB,EAAIwxB,sBAAR,CAIA,IAAK/nB,EAAI,EAAGA,EAAIqY,EAAQ5qB,SAAW8I,EAAIwxB,wBAAyB/nB,EAC/DzJ,EAAIwxB,sBAAwBxxB,EAAI8hB,EAAQrY,GAAK,wBAGzCzJ,GAAIwxB,wBACRjO,EAAavjB,EAAIujB,WAEjBvjB,EAAIwxB,sBAAwB,SAAUh8B,GACrC,GAAI8/B,GAAUC,EAAYtqB,CAS1B,OAPAqqB,GAAW51B,KAAKC,MAChB41B,EAAah6B,KAAKi6B,IAAI,EAAG,IAAMF,EAAWD,IAC1CpqB,EAAKsY,EAAW,WACf/tB,EAAS8/B,EAAWC,IAClBA,GAEHF,EAAWC,EAAWC,EACftqB,MAGP6W,GAAS,EAAG9hB,IAEfwxB,GAAwBxxB,GAAIwxB,uBAjC5BA,GAAwB,IAoCzB,IA8zCIiE,IACAC,GA/zCAC,GAAU31B,IAAOA,GAAI41B,aAA8C,kBAAxB51B,IAAI41B,YAAYj2B,IAAqB,WACnF,MAAOK,IAAI41B,YAAYj2B,OACpB,WACH,MAAOD,MAAKC,OAKTk2B,MACAC,IAAU,EA4BVvR,GAAS,WACZ,QAASA,GAAO9uB,GACfC,GAAevB,KAAMowB,GAErBpwB,KAAK6vB,SAAWvuB,EAAQuuB,SACxB7vB,KAAKqwB,KAAO/uB,EAAQ+uB,KACpBrwB,KAAKyW,SAAWnV,EAAQmV,SACxBzW,KAAKgH,OAAS1F,EAAQ0F,OAEtBhH,KAAKwC,MAAQg/B,KACbxhC,KAAKua,IAAMva,KAAKwC,MAAQxC,KAAK6vB,SAE7B7vB,KAAK2hC,SAAU,EAEfD,GAAQ5+B,KAAK9C,MACR2hC,IAAStE,GAAsBuE,IA0BrC,MAvBAxR,GAAOpuB,UAAU4/B,KAAO,SAAcp2B,GACrC,IAAKxL,KAAK2hC,QAAS,OAAO,CAE1B,IAAIn2B,EAAMxL,KAAKua,IAId,MAHIva,MAAKqwB,MAAMrwB,KAAKqwB,KAAK,GACrBrwB,KAAKyW,UAAUzW,KAAKyW,SAAS,IAE1B,CAGR,IAAIorB,GAAUr2B,EAAMxL,KAAKwC,MACrBs/B,EAAQ9hC,KAAKgH,OAAO66B,EAAU7hC,KAAK6vB,SAIvC,OAFI7vB,MAAKqwB,MAAMrwB,KAAKqwB,KAAKyR,IAElB,GAGR1R,EAAOpuB,UAAUyF,KAAO,WACnBzH,KAAK+hC,OAAO/hC,KAAK+hC,QACrB/hC,KAAK2hC,SAAU,GAGTvR,KAGJ4R,MA8CAC,GAAUr9B,OAAO5C,UAAUoe,eAU3B8hB,GAAmB,KAEnB1hB,GAAQ,WACX,QAASA,GAAMzN,EAAQS,GACtBjS,GAAevB,KAAMwgB,GAErBxgB,KAAK6e,QAEL7e,KAAK2e,YACL3e,KAAK4e,cAEL5e,KAAKmiC,eAELniC,KAAK4gC,cACL5gC,KAAKoiC,mBAELpiC,KAAKo0B,YAELp0B,KAAKC,MAAQwC,OAEbzC,KAAKqiC,OAAS,KAEVtvB,IACH/S,KAAK+S,OAASA,EACd/S,KAAK6b,KAAO9I,EAAO8I,KACnB7b,KAAKwT,IAAMA,EACXxT,KAAKue,WAAaxL,EAAOwL,WAErBxL,EAAO9S,QACVD,KAAKC,MAAQ8S,EAAO9S,MAAMD,KAAKwT,KAC/BxT,KAAKyc,UA4ZR,MAvZA+D,GAAMxe,UAAUya,MAAQ,WACvB,GAAItP,GAAWnN,KAAK6b,KAAK1O,SACrBlN,EAAQD,KAAKC,MACb+C,EAAMmK,EAASpK,OAGfwC,EAAUvF,KAAK6b,KAAKtW,QACpB/D,EAAUxB,KAAKyB,aAEfwB,EAAIR,MAER,KAAKQ,EAAI,EAAOD,EAAJC,EAASA,GAAK,EAAG,CAC5B,GAAIq/B,GAAUn1B,EAASlK,EACvB,IAAIq/B,EAAQ12B,OAAO3L,EAAOuB,EAAS+D,GAAU,CAC5CvF,KAAKshB,QAAUghB,EAAQvf,KAAKxd,EAAStF,EAAOuB,EAAS+gC,GAAY/gC,IACjExB,KAAKshB,QAAQrhB,MAAQD,KAAKC,MAC1BD,KAAKshB,QAAQ2B,QAAUjjB,KAEvBA,KAAKC,MAAQD,KAAKshB,QAAQpe,KAE1B,UAKHsd,EAAMxe,UAAUw+B,cAAgB,SAAuBhtB,EAAKyV,GACtDjpB,KAAKoiC,gBAAgB5uB,KACzBxT,KAAK4gC,WAAW99B,KAAK0Q,GACrBxT,KAAKoiC,gBAAgB5uB,OAGtBxT,KAAKoiC,gBAAgB5uB,GAAK1Q,KAAKmmB,IAGhCzI,EAAMxe,UAAU6F,QAAU,SAAiBimB,EAAMC,EAAIzsB,EAASmQ,GAC7D,GAAIrP,GAAQpC,IAERA,MAAKqiC,QAAQriC,KAAKqiC,OAAO56B,MAE7B,IAAI+6B,GAAgB//B,OAChBggC,EAAU,GAAI31B,IAAS,SAAUwkB,GACpC,MAAOkR,GAAgBlR,GAqBxB,OAlBAtxB,MAAKqiC,OAAS,GAAIjS,KACjBP,SAAUvuB,EAAQuuB,SAClB7oB,OAAQ1F,EAAQ0F,OAChBqpB,KAAM,SAAUtV,GACf,GAAI9a,GAAQwR,EAAasJ,EACzB3Y,GAAMsgC,WAAWziC,GACbqB,EAAQ+uB,MAAM/uB,EAAQ+uB,KAAKtV,EAAG9a,IAEnCwW,SAAU,WACTrU,EAAMsgC,WAAW3U,GACbzsB,EAAQmV,UAAUnV,EAAQmV,SAASsX,GAEvC3rB,EAAMigC,OAAS,KACfG,OAIFC,EAAQh7B,KAAOzH,KAAKqiC,OAAO56B,KACpBg7B,GAGRjiB,EAAMxe,UAAU0gC,WAAa,SAAoBziC,GAChD,IAAI4E,EAAQ5E,EAAOD,KAAKC,OAAxB,CAKA,GAFAD,KAAK6b,KAAK6E,QAAQ1gB,KAAKyB,cAAgBxB,EAEnCD,KAAK+S,OAAOuO,SAAWthB,KAAK+S,OAAOuO,QAAQlX,IAC9CpK,KAAK+S,OAAOuO,QAAQlX,IAAIpK,KAAKwT,IAAKvT,GAClCD,KAAK+S,OAAO9S,MAAQD,KAAK+S,OAAOuO,QAAQpe,MAExClD,KAAKC,MAAQD,KAAK+S,OAAO9S,MAAMD,KAAKwT,SAE9B,IAAIxT,KAAKshB,QAAS,CACvB,GAAIC,IAAkBvhB,KAAKshB,QAAQxX,OAAS9J,KAAKshB,QAAQxX,MAAM7J,MAAW,CAEtEshB,IACHvhB,KAAKshB,QAAQ7W,WACbzK,KAAKshB,QAAU,KACfthB,KAAK+S,OAAO9S,MAAMD,KAAKwT,KAAOxT,KAAKC,MAAQA,EAC3CD,KAAKyc,SAELzc,KAAKC,MAAQD,KAAKshB,QAAQpe,UAErB,CACN,GAAIy/B,GAAc3iC,KAAK+S,OAAO9S,OAASD,KAAK+S,OAAO6vB,aAAa5iC,KAAKwT,IACrEmvB,GAAY3iC,KAAKwT,KAAOvT,EAExBD,KAAKC,MAAQA,EACbD,KAAKyc,QAGPzc,KAAK+S,OAAOmN,mBACZlgB,KAAKkgB,kBAGL,IAAI2iB,GAA2BX,EAC/BA,IAAmBliC,KAEnBA,KAAK2e,SAAShc,QAAQ6e,GACtBxhB,KAAK6e,KAAKlc,QAAQsd,EAGlB,KADA,GAAIlN,GAAS/S,KAAK+S,OACXA,GACNA,EAAO8L,KAAKlc,QAAQsd,GACpBlN,EAASA,EAAOA,MAGjBmvB,IAAmBW,IAGpBriB,EAAMxe,UAAUke,iBAAmB,SAA0B4iB,GAG5D,IAFA,GAAI7/B,GAAIjD,KAAK4gC,WAAW79B,OAEjBE,KAAK,CACX,GAAIuQ,GAAMxT,KAAK4gC,WAAW39B,EAE1B,KAAI6/B,GAAetvB,IAAQsvB,EAA3B,CAMA,IAJA,GAAInb,GAAY3nB,KAAKoiC,gBAAgB5uB,GACjCuvB,EAAS/iC,KAAKmhB,IAAI3N,GAElBoZ,EAAIjF,EAAU5kB,OACX6pB,KACFmW,GAAQpb,EAAUiF,GAAG6T,oBACrB9Y,EAAUiF,GAAGqE,UAAUtJ,EAAUxhB,OAAOymB,EAAG,EAG3CjF,GAAU5kB,SACd/C,KAAK4gC,WAAWz6B,OAAOlD,EAAG,GAC1BjD,KAAKoiC,gBAAgB5uB,GAAO,SAK/BgN,EAAMxe,UAAU4gC,aAAe,SAAsBpvB,GACpD,GAAIwvB,GAAS/U,EAAUza,QAGvB,OAFAxT,MAAKoK,IAAI44B,GAEFA,GAGRxiB,EAAMxe,UAAUihC,QAAU,WACzB,GAAI/+B,GAASlE,IAEbA,MAAK6e,KAAKlc,QAAQ,SAAUwuB,GACvBA,EAAErS,iBAAiB5a,EAAOP,WAAWwtB,MAI3C3Q,EAAMxe,UAAU0C,YAAc,SAAqBT,GAClD,GAAIjB,GAAMiB,EAAKlB,OAEXmgC,GAAmBljC,MACnB8G,EAAUrE,OACVQ,EAAIR,OAEJ0gC,EAAQ,WACX,GAAI3vB,GAAMvP,EAAKhB,EAEH,OAARuQ,GACH1M,KACAo8B,EAAgBvgC,QAAQ,SAAUvB,GAC7B+B,EAAQ/B,EAAMnB,QAGbiiC,IAAoBA,GAAiBnvB,SAAW3R,GAAkC,WAAzB8gC,GAAiB1uB,KAC7E1M,EAAQhE,KAAKo/B,IAGd9gC,EAAMnB,MAAM0C,QAAQ,SAAUygC,EAAQngC,GACrC6D,EAAQhE,KAAK1B,EAAM+e,QAAQld,QAElBsY,EAASna,EAAMnB,QAAiC,kBAAhBmB,GAAMnB,SAChD2E,OAAOX,KAAK7C,EAAMnB,OAAO0C,QAAQ,SAAU6Q,GAC1C1M,EAAQhE,KAAK1B,EAAM+e,QAAQ3M,MAIxBpS,EAAMuf,QACT/b,OAAOX,KAAK7C,EAAMyf,cAAcle,QAAQ,SAAU6Q,GACjD1M,EAAQhE,KAAK1B,EAAM+e,QAAQ3M,UAM/B1M,EAAUo8B,EAAgBjhC,IAAI,SAAUb,GACvC,MAAOA,GAAM+e,QAAQ3M,KAIvB0vB,EAAkBp8B,EAGnB,KAAK7D,EAAI,EAAOD,EAAJC,EAASA,GAAK,EACzBkgC,GAGD,OAAOr8B,IAGR0Z,EAAMxe,UAAUkB,IAAM,SAAa6b,GAElC,MADIA,IAAeC,GAAQhf,MACpBA,KAAKC,OAGbugB,EAAMxe,UAAUqhC,cAAgB,SAAuBC,GACtD,GAAInB,GAAcniC,KAAK+S,OAAOovB,WAG9B,OAAwB,gBAAbniC,MAAKwT,KAAsC/Q,SAAlB6gC,EAC5B,GAAIvC,IAASuC,IACTnB,EAAYniC,KAAKwT,OAC5B2uB,EAAYniC,KAAKwT,KAAO,GAAIutB,IAAS/gC,KAAKwT,MAGpC2uB,EAAYniC,KAAKwT,OAGzBgN,EAAMxe,UAAUuhC,YAAc,WAE7B,MAAO,IAAIxC,IAAS/gC,KAAKwT,MAG1BgN,EAAMxe,UAAUmzB,gBAAkB,WACjC,MAAOn1B,MAAKwjC,eAAiBxjC,KAAKwjC,aAAe,GAAI3C,IAAa7gC,QAGnEwgB,EAAMxe,UAAUP,WAAa,WAE5B,MAAOzB,MAAK+S,OAAO4N,OAAS3gB,KAAKwT,IAAMxT,KAAK+S,OAAOtR,aAAe,IAAMzB,KAAKwT,KAG9EgN,EAAMxe,UAAUmf,IAAM,SAAa3N,GAClC,GAAIvT,GAAQD,KAAKkD,KACjB,OAAOjD,IAASgiC,GAAQr+B,KAAK3D,EAAOuT,IAGrCgN,EAAMxe,UAAUme,QAAU,SAAiB3M,GAC1C,GAAY/Q,SAAR+Q,GAA6B,KAARA,EAAY,MAAOxT,KAE5C,KAAKA,KAAK4e,WAAWwB,eAAe5M,GAAM,CACzC,GAAI6M,GAAQ,GAAIG,GAAMxgB,KAAMwT,EAC5BxT,MAAK2e,SAAS7b,KAAKud,GACnBrgB,KAAK4e,WAAWpL,GAAO6M,EAGxB,MAAOrgB,MAAK4e,WAAWpL,IAGxBgN,EAAMxe,UAAU2+B,QAAU,SAAiB18B,GAE1C,IAAK,GADD7C,GAAQpB,KACHiD,EAAI,EAAGA,EAAIgB,EAAKlB,OAAQE,GAAK,EACrC7B,EAAQA,EAAM+e,QAAQlc,EAAKhB,GAG5B,OAAO7B,IAGRof,EAAMxe,UAAUue,KAAO,WACtB,GAAItgB,GAAQD,KAAKyhB,UAEZ5c,GAAQ5E,EAAOD,KAAKC,SACxBD,KAAKC,MAAQA,EAEbD,KAAK2e,SAAShc,QAAQ6e,GAEtBxhB,KAAK6e,KAAKlc,QAAQsd,GAClBjgB,KAAKkgB,qBAIPM,EAAMxe,UAAUkH,MAAQ,SAAeuZ,EAAOghB,GAC7C,GAAIC,GAAWD,EAAazjC,KAAKC,MAAMgC,IAAIwhC,GAAczjC,KAAKC,MAC1D0jC,EAAWF,EAAahhB,EAAMxgB,IAAIwhC,GAAchhB,EAEhDmhB,EAAYF,EAAS3gC,OAErB8gC,KACAC,EAAmB,EAEnB3hC,EAAauhC,EAASzhC,IAAI,SAAU4D,GACvC,GAAII,GAAQxD,OACRD,EAAQshC,CAEZ,GAAG,CAGF,GAFA79B,EAAQ09B,EAASz9B,QAAQL,EAAMrD,GAEjB,KAAVyD,EACH,MAAO,EAGRzD,GAAQyD,EAAQ,QACR49B,EAAY59B,MAAW,GAAgB29B,EAARphC,EASxC,OALIyD,KAAU69B,IACbA,GAAoB,GAGrBD,EAAY59B,IAAS,EACdA,GAGRjG,MAAK+S,OAAO9S,MAAMD,KAAKwT,KAAOiP,EAC9BziB,KAAK+jC,SAAU,EACf/jC,KAAK6B,QAAQM,IAGdqe,EAAMxe,UAAUL,SAAW,SAAkBqiC,GAC5ChkC,KAAK6e,KAAK/b,KAAKkhC,IAGhBxjB,EAAMxe,UAAUuwB,sBAAwB,SAA+Bre,GACtElU,KAAKo0B,SAAStxB,KAAKoR,IAGpBsM,EAAMxe,UAAUyf,SAAW,WAC1B,MAAOzhB,MAAK+S,OAAO9S,MAAQD,KAAK+S,OAAO9S,MAAMD,KAAKwT,KAAO/Q,QAG1D+d,EAAMxe,UAAUoI,IAAM,SAAanK,GAC9BD,KAAKqiC,QAAQriC,KAAKqiC,OAAO56B,OAC7BzH,KAAK0iC,WAAWziC,IAGjBugB,EAAMxe,UAAUH,QAAU,SAAiBM,GAC1C,GAAIwC,GAAS3E,KAETmiC,KACAd,EAAM,EACNhhB,EAAQ5d,MAoBZ,KAlBAN,EAAWQ,QAAQ,SAAUC,EAAUC,GAGtC,GAFID,EAAWy+B,IAAKA,EAAMz+B,IAEnBA,EAAP,CAEA,GAAIxB,GAAQuD,EAAOw9B,YAAYt/B,EAE1BzB,KAEL+gC,EAAYv/B,GAAYxB,EAEpBwB,IAAaC,GAChBzB,EAAMgO,OAAOxM,OAMRyd,EAAQrgB,KAAK4e,aAAayiB,IACH,kBAAlBhhB,GAAM4iB,SAAwB5iB,EAAM4iB,SAGhDjjC,MAAKmiC,YAAcA,EAGnBniC,KAAK6e,KAAKlc,QAAQ,SAAUqhC,GACvBA,EAAIniC,SAASmiC,EAAIniC,QAAQM,KAG9BnC,KAAKikC,0BACLjkC,KAAKugB,OAGLvgB,KAAK6e,KAAKlc,QAAQ,SAAUqhC,GACtBA,EAAIniC,SAASmiC,EAAIliC,kBAIxB0e,EAAMxe,UAAUyI,SAAW,WAC1BzK,KAAK2e,SAAShc,QAAQuhC,GAClBlkC,KAAKshB,SAASthB,KAAKshB,QAAQ7W,YAGhC+V,EAAMxe,UAAU2B,WAAa,SAAoBm9B,GAChDvoB,EAAgBvY,KAAK6e,KAAMiiB,IAG5BtgB,EAAMxe,UAAUywB,wBAA0B,SAAiCve,GAC1EqE,EAAgBvY,KAAKo0B,SAAUlgB,IAGhCsM,EAAMxe,UAAU0f,mBAAqB,SAA4BC,GAEhE,IADA,GAAI1e,GAAIjD,KAAKo0B,SAASrxB,OACfE,KAAK,CACX,GAAIhD,GAAQD,KAAKo0B,SAASnxB,GAAG6O,UACzB7R,KAAUD,KAAKC,OAAOD,KAAKoK,IAAInK,GAGhC0hB,GACH3hB,KAAK2e,SAAShc,QAAQwhC,KAIxB3jB,EAAMxe,UAAUiiC,wBAA0B,WACzCjkC,KAAK2e,SAAShc,QAAQyhC,IAClBpkC,KAAKwjC,cAAcxjC,KAAKwjC,aAAa1hC,gBAGnC0e,KAGJF,GAAmB,SAAWjC,GAGjC,QAASiC,KACR/e,GAAevB,KAAMsgB,GAErBjC,EAAOnZ,MAAMlF,KAAMoX,WAkCpB,MAvCAnI,IAASqR,EAAkBjC,GAQ3BiC,EAAiBte,UAAUkB,IAAM,SAAa6b,GACzCA,GAAeC,GAAQhf,KAE3B,IAAI2iC,GAAc3iC,KAAK+S,OAAO7P,KAC9B,OAAOy/B,GAAcA,EAAY3iC,KAAKwT,KAAO/Q,QAG9C6d,EAAiBte,UAAUF,aAAe,WACzC9B,KAAKwD,OAAQ,EAEbxD,KAAK6e,KAAKlc,QAAQsd,GAClBjgB,KAAK2e,SAAShc,QAAQsd,GACtBjgB,KAAKkgB,oBAGNI,EAAiBte,UAAUme,QAAU,SAAiB3M,GACrD,GAAY/Q,SAAR+Q,GAA6B,KAARA,EAAY,MAAOxT,KAE5C,KAAKA,KAAK4e,WAAWwB,eAAe5M,GAAM,CACzC,GAAI6M,GAAQ,GAAIC,GAAiBtgB,KAAMwT,EACvCxT,MAAK2e,SAAS7b,KAAKud,GACnBrgB,KAAK4e,WAAWpL,GAAO6M,EAGxB,MAAOrgB,MAAK4e,WAAWpL,IAOjB8M,GACLE,IAwCC6jB,MAgBAC,GAAkB,SAAWjmB,GAGhC,QAASimB,GAAgBv1B,EAAUC,GAClC,GAAI5M,GAAQpC,IAEZuB,IAAevB,KAAMskC,GAErBjmB,EAAOza,KAAK5D,KAAM+O,EAASxJ,QAAQqW,UAAW,MAE9C5b,KAAK+O,SAAWA,EAChB/O,KAAKgP,SAAWA,EAEhBhP,KAAKue,YAAa,EAElBve,KAAK2N,GAAKyoB,GAAepnB,EAAS2K,EAAG3K,EAAS4O,EAAE7a,QAChD/C,KAAKkhB,YAAc,KAEnBlhB,KAAK2nB,aACL3nB,KAAK21B,OAAS3mB,EAAS4O,EAAE3b,IAAI,SAAU8zB,EAAK9vB,GAC3C,GAAI7E,GAAQ+0B,GAAiBpnB,EAAUgnB,GACnC9M,EAAWxmB,MAYf,OAVKrB,KACJ6nB,EAAWla,EAASia,QAAQ+M,EAAK,SAAU30B,GAC1CmX,EAAgBnW,EAAMulB,UAAWsB,GACjC7mB,EAAMuzB,OAAO1vB,GAAS7E,EACtBgB,EAAM+M,WAGP/M,EAAMulB,UAAU7kB,KAAKmmB,IAGf7nB,IAGRpB,KAAKmP,SA+EN,MAlHAF,IAASq1B,EAAiBjmB,GAsC1BimB,EAAgBtiC,UAAUmN,OAAS,WAClC,GAAIjL,GAASlE,KAETuF,EAAUvF,KAAK+O,SAASxJ,QAKxBiO,EAAM,IAAMxT,KAAKgP,SAAS2K,EAAEtV,QAAQ,UAAW,SAAUo4B,EAAOx5B,GACnE,GAAIA,GAAKiB,EAAOyxB,OAAO5yB,OAAQ,MAAO05B,EAEtC,IAAIr7B,GAAQ8C,EAAOyxB,OAAO1yB,EAC1B,OAAO7B,GAAQA,EAAMK,aAAe,eAIjC6c,GACHY,OAAQ,WACP,GAAIsJ,GAAStkB,EAAOyxB,OAAO1zB,IAAIsiC,GAC/B,OAAOrgC,GAAOyJ,GAAGzI,MAAMK,EAASijB,IAEjC/I,aAAcjM,GAGX0N,EAAc3b,EAAQqW,UAAUqF,QAAQzN,EAAK8K,EAEjDte,MAAKC,MAAQihB,EAAYhe,MAErBlD,KAAKkhB,aACRlhB,KAAKkhB,YAAYvd,WAAW3D,MAI7BA,KAAKkhB,YAAcA,EACnBA,EAAYvf,SAAS3B,OAGtBskC,EAAgBtiC,UAAUkB,IAAM,WAC/B,MAAOlD,MAAKkhB,YAAYhe,OAGzBohC,EAAgBtiC,UAAUP,WAAa,WACtC,MAAOzB,MAAKkhB,YAAclhB,KAAKkhB,YAAYzf,aAAe,cAG3D6iC,EAAgBtiC,UAAUF,aAAe,WACxC9B,KAAK6e,KAAKlc,QAAQsd,GAClBjgB,KAAK2e,SAAShc,QAAQsd,GAEtBjgB,KAAKkgB,oBAGNokB,EAAgBtiC,UAAUme,QAAU,SAAiB3M,GACpD,GAAY/Q,SAAR+Q,GAA6B,KAARA,EAAY,MAAOxT,KAE5C,KAAKA,KAAK4e,WAAWwB,eAAe5M,GAAM,CACzC,GAAI6M,GAAQ,GAAIC,IAAiBtgB,KAAMwT,EACvCxT,MAAK2e,SAAS7b,KAAKud,GACnBrgB,KAAK4e,WAAWpL,GAAO6M,EAGxB,MAAOrgB,MAAK4e,WAAWpL,IAGxB8wB,EAAgBtiC,UAAUue,KAAO,WAChCvgB,KAAK8B,gBAGNwiC,EAAgBtiC,UAAUyf,SAAW,WACpC,MAAOzhB,MAAKkD,OAGbohC,EAAgBtiC,UAAUqM,OAAS,WAClCrO,KAAK2nB,UAAUhlB,QAAQ4T,IAGjB+tB,GACL9jB,IAECgkB,GAA2B,SAAWnmB,GAGzC,QAASmmB,GAAyBz1B,EAAUC,GAC3C,GAAI5M,GAAQpC,IAEZuB,IAAevB,KAAMwkC,GAErBnmB,EAAOza,KAAK5D,KAAM,KAAM,MACxBA,KAAK6b,KAAO9M,EAASxJ,QAAQqW,UAE7B5b,KAAK2nB,aAEL3nB,KAAKykC,KAAOnf,GAASvW,EAAUC,EAC/B,IAAI01B,GAAejiC,MAEdzC,MAAKykC,OACTC,EAAe31B,EAASia,QAAQha,EAAS4O,EAAG,SAAUxc,GACrDgB,EAAMqiC,KAAOrjC,EACbgB,EAAM+M,SAENoJ,EAAgBnW,EAAMulB,UAAW+c,KAGlC1kC,KAAK2nB,UAAU7kB,KAAK4hC,GAGrB,IAAI52B,IACHhM,aAAc,WACb,MAAOM,GAAM+M,UAIfnP,MAAK2kC,QAAU31B,EAASmE,EAAElR,IAAI,SAAU+M,EAAU/L,GACjD,GAAwB,gBAAb+L,GACV,OAAS9L,IAAK,WACZ,MAAO8L,IAIV,IAAI5N,GAAQqB,OACRwmB,EAAWxmB,MAEf,OAAIuM,GAAS+L,IAAMqjB,IAClBh9B,EAAQ+0B,GAAiBpnB,EAAUC,EAASoc,GAExChqB,EACHA,EAAMO,SAASmM,IAEfmb,EAAWla,EAASia,QAAQha,EAASoc,EAAG,SAAUhqB,GACjDgB,EAAMuiC,QAAQ1hC,GAAK7B,EAEnBA,EAAMO,SAASmM,GACf1L,EAAM+M,SAENoJ,EAAgBnW,EAAMulB,UAAWsB,KAGlC7mB,EAAMulB,UAAU7kB,KAAKmmB,IAGf7nB,IAGRA,EAAQ,GAAIkjC,IAAgBv1B,EAAUC,GACtC5N,EAAMO,SAASmM,GACR1M,KAGRpB,KAAKiyB,cAAe,EACpBjyB,KAAKmP,SA+EN,MApJAF,IAASu1B,EAA0BnmB,GAwEnCmmB,EAAyBxiC,UAAUmN,OAAS,WAC3C,GAAKnP,KAAKykC,KAAV,CAIA,IADA,GAAIxhC,GAAIjD,KAAK2kC,QAAQ5hC,OACdE,KACN,IAAKjD,KAAK2kC,QAAQ1hC,IAAgCR,SAA1BzC,KAAK2kC,QAAQ1hC,GAAGC,MAAqB,MAG9DlD,MAAKiyB,cAAe,CAEpB,IAAIhuB,GAAOjE,KAAK2kC,QAAQ1iC,IAAI,SAAUb,GACrC,MAAOA,GAAM8B,QAEV9B,EAAQpB,KAAKykC,KAAK9D,QAAQ18B,EAE1BjE,MAAKoB,QACRpB,KAAKoB,MAAMuC,WAAW3D,MACtBA,KAAKoB,MAAMqxB,wBAAwBzyB,OAGpCA,KAAKoB,MAAQA,EACbpB,KAAK+S,OAAS3R,EAAM2R,OAEpB3R,EAAMO,SAAS3B,MACfoB,EAAMmxB,sBAAsBvyB,MAExBA,KAAKwjC,cAAcxjC,KAAKwjC,aAAa1hC,eAEzC9B,KAAKugB,SAGNikB,EAAyBxiC,UAAUkwB,gBAAkB,WACpDlyB,KAAK2nB,UAAUhlB,QAAQ,SAAUsmB,GAChC,MAAOA,GAASiJ,oBAEjBlyB,KAAKmP,UAGNq1B,EAAyBxiC,UAAUkB,IAAM,WACxC,MAAOlD,MAAKoB,MAAQpB,KAAKoB,MAAM8B,MAAQT,QAKxC+hC,EAAyBxiC,UAAU8P,SAAW,WAE7C,IADA,GAAI7O,GAAIjD,KAAKo0B,SAASrxB,OACfE,KAAK,CACX,GAAIhD,GAAQD,KAAKo0B,SAASnxB,GAAG6O,UAC7B,IAAI7R,IAAUD,KAAKC,MAAO,MAAOA,GAGlC,MAAOD,MAAKC,OAGbukC,EAAyBxiC,UAAUP,WAAa,WAC/C,MAAOzB,MAAKoB,MAAQpB,KAAKoB,MAAMK,aAAe,cAG/C+iC,EAAyBxiC,UAAUF,aAAe,WACjD9B,KAAKugB,QAGNikB,EAAyBxiC,UAAUyf,SAAW,WAC7C,MAAOzhB,MAAKkD,OAGbshC,EAAyBxiC,UAAUoI,IAAM,SAAanK,GACrD,IAAKD,KAAKoB,MAAO,KAAM,IAAI2K,OAAM,2DACjC/L,MAAKoB,MAAMgJ,IAAInK,IAGhBukC,EAAyBxiC,UAAUqM,OAAS,WAC3CrO,KAAK2nB,UAAUhlB,QAAQ4T,IAGjBiuB,GACLhkB,IAYCoJ,GAAW,SAAW/a,GAGzB,QAAS+a,GAAStoB,GACjBC,GAAevB,KAAM4pB,GAErB/a,EAAMjL,KAAK5D,KAAMsB,GAEjBtB,KAAKuR,eAAiBjQ,EAAQiQ,eAC9BvR,KAAKgP,SAAW1N,EAAQ0N,SACxBhP,KAAKiG,MAAQ3E,EAAQ2E,MAErBjG,KAAK4kC,WAAatjC,EAAQ0N,SAAS2K,EAEnC3Z,KAAKoB,MAAQ,KACbpB,KAAKwD,OAAQ,EA4Dd,MA1EAyL,IAAS2a,EAAU/a,GAiBnB+a,EAAS5nB,UAAUkN,KAAO,WACzB,GAAI9M,GAAQpC,KAGRoB,EAAQkkB,GAAStlB,KAAKuR,eAAgBvR,KAAKgP,UAC3C/O,EAAQmB,EAAQA,EAAM8B,MAAQT,MAElC,OAAIzC,MAAK4kC,cACR5kC,KAAKoB,OAAU8B,IAAK,WAClB,MAAOjD,WAKNmB,GACHA,EAAMO,SAAS3B,MACfA,KAAKoB,MAAQA,GAEbpB,KAAKipB,SAAWjpB,KAAKuR,eAAeyX,QAAQhpB,KAAKgP,SAAS4O,EAAG,SAAUxc,GACtEgB,EAAMhB,MAAQA,EACdA,EAAMO,SAASS,GAEfA,EAAMN,eACNM,EAAM6mB,SAAW,SAKpBW,EAAS5nB,UAAUF,aAAe,WACjC9B,KAAKmP,UAGNya,EAAS5nB,UAAUoN,OAAS,WAC3B,IAAIpP,KAAK4kC,UAAa5kC,KAAKoB,MAA3B,CAEA,GAAIA,GAAQkkB,GAAStlB,KAAKuR,eAAgBvR,KAAKgP,SAE/C,IAAI5N,IAAUpB,KAAKoB,MAAnB,CAEA,GAAIiC,GAAWrD,KAAKoB,MAAM8B,KAC1BlD,MAAKoB,MAAMuC,WAAW3D,MAEtBA,KAAKoB,MAAQA,EAETA,IACHA,EAAMO,SAAS3B,MACXoB,EAAM8B,QAAUG,GAAUrD,KAAK8B,mBAIrC8nB,EAAS5nB,UAAUqM,OAAS,WACtBrO,KAAK4kC,WACT5kC,KAAKoB,OAASpB,KAAKoB,MAAMuC,WAAW3D,MACpCA,KAAKipB,UAAYjpB,KAAKipB,SAAS5a,WAI1Bub,GACL7Z,IAGCiC,GAAoB,4YACpBa,GAAmB,qGAEnBgyB,IAAiBC,KAAM,GAAIC,IAAK,GAAIC,KAAM,GAAIC,GAAI,GAAIC,GAAI,GAAIC,KAAM,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,IAAK,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKrf,MAAO,IAAKsf,QAAS,IAAKC,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"}