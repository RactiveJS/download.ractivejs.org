{"version":3,"file":"ractive-legacy.runtime.min.js","sources":["ractive-legacy.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tWed Sep 02 2015 14:49:01 GMT+0000 (UTC) - commit 39c63c94d762c10f227e34cad38fa9d82946d9a6\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\n  var _namespaces = {\n    get html () { return html; },\n    get mathml () { return mathml; },\n    get svg () { return svg; },\n    get xlink () { return xlink; },\n    get xml () { return xml; },\n    get xmlns () { return xmlns; }\n  };\n\n  var TEMPLATE_VERSION = 3;\n\n  var defaultOptions = {\n\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: { v: TEMPLATE_VERSION, t: [] },\n\n  \t// parse:     // TODO static delimiters?\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tinterpolate: false,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  function noop () {}\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magic = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagic = true;\n  } catch (e) {\n  \tmagic = false;\n  }\n\n  var _svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c<@version@> %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive <@version@> in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\n  // TODO: deprecate in future release\n  function __________________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\t__________________________________________________classCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var _toString = Object.prototype.toString;\n  var arrayLikePattern = /^\\[object (?:Array|FileList)\\]$/;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn _toString.call(thing) === '[object Array]';\n  }\n\n  function isArrayLike(obj) {\n  \treturn arrayLikePattern.test(_toString.call(obj));\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && _toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  function _bind(x) {\n    x.bind();\n  }\n\n  function cancel(x) {\n    x.cancel();\n  }\n\n  function handleChange(x) {\n    x.handleChange();\n  }\n\n  function mark(x) {\n    x.mark();\n  }\n\n  function _render(x) {\n    x.render();\n  }\n\n  function rebind(x) {\n    x.rebind();\n  }\n\n  function teardown(x) {\n    x.teardown();\n  }\n\n  function unbind(x) {\n    x.unbind();\n  }\n\n  function unrender(x) {\n    x.unrender();\n  }\n\n  function _unrenderAndDestroy(x) {\n    x.unrender(true);\n  }\n\n  function _update(x) {\n    x.update();\n  }\n\n  function toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  function _________________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\t_________________________________________________classCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.decoratorQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \t// TODO can we move decorator stuff to element detach() methods?\n\n  \tTransitionManager.prototype.addDecorator = function addDecorator(decorator) {\n  \t\tthis.decoratorQueue.push(decorator);\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = (function (_detachNodes) {\n  \t\tfunction detachNodes() {\n  \t\t\treturn _detachNodes.apply(this, arguments);\n  \t\t}\n\n  \t\tdetachNodes.toString = function () {\n  \t\t\treturn _detachNodes.toString();\n  \t\t};\n\n  \t\treturn detachNodes;\n  \t})(function () {\n  \t\tthis.decoratorQueue.forEach(teardown);\n  \t\tthis.detachQueue.forEach(detach);\n  \t\tthis.children.forEach(detachNodes);\n  \t});\n\n  \tTransitionManager.prototype.init = function init() {\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function detach(element) {\n  \telement.detach();\n  }\n\n  function detachNodes(tm) {\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\t_resolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function _resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\t_resolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new _Promise(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n\n  \t\tbatch.transitionManager.init();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \tregisterDecorator: function (decorator) {\n  \t\tbatch.transitionManager.addDecorator(decorator);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tvar i, thing, changeHash;\n\n  \tbatch.immediateObservers.forEach(dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \ti = batch.fragments.length;\n  \twhile (i--) {\n  \t\tthing = batch.fragments[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = thing.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tthing.update();\n  \t}\n  \tbatch.fragments.length = 0;\n\n  \tbatch.transitionManager.start();\n\n  \tbatch.deferredObservers.forEach(dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length) return flushChanges();\n  }\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \treturn normalise(keypath).split('.');\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tvar promise, model;\n\n  \tmodel = keypath ? this.viewmodel.joinAll(splitKeypath(keypath)) : this.viewmodel;\n\n  \tpromise = runloop.start(this, true);\n  \tmodel.mark();\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(normalise(keypath).split('.'));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + keypath.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var _unrenderHook = new Hook('unrender');\n  function Ractive$unrender() {\n  \tvar promise, shouldDestroy;\n\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn _Promise.resolve();\n  \t}\n\n  \tpromise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tshouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n\n  \t// Cancel any animations in progress\n  \twhile (this._animations[0]) {\n  \t\tthis._animations[0].stop(); // it will remove itself from the index\n  \t}\n\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \t_unrenderHook.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  var _teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tvar promise;\n\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tpromise = this.fragment.rendered ? this.unrender() : _Promise.resolve();\n\n  \t_teardownHook.fire(this);\n\n  \tthis._boundFunctions.forEach(deleteFunctionCopy);\n\n  \treturn promise;\n  }\n\n  function deleteFunctionCopy(bound) {\n  \tdelete bound.fn[bound.prop];\n  }\n\n  var _errorMessage = 'Cannot add to a non-numeric value';\n  function add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar changes = {};\n\n  \t\t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\t\tvar value = model.get();\n\n  \t\t\t\tif (!isNumeric(value)) throw new Error(_errorMessage);\n\n  \t\t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t\t});\n\n  \t\t\treturn {\n  \t\t\t\tv: ractive.set(changes)\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(_errorMessage);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function Ractive$set(keypath, value) {\n  \tvar map, promise;\n\n  \tpromise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n\n  \t\tfor (keypath in map) {\n  \t\t\tif (map.hasOwnProperty(keypath)) {\n  \t\t\t\tset(this, keypath, map[keypath]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\tset(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function set(ractive, keypath, value) {\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar start, literal, done, next;\n\n  \t\tstart = parser.pos;\n  \t\tliteral = '\"';\n  \t\tdone = false;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === \"\\\\'\") {\n  \t\t\t\t\tliteral += \"'\";\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var INVERTED = 5;\n  var CLOSING = 6;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMMENT = 9;\n  var DELIMCHANGE = 10;\n  var CLOSING_TAG = 14;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var INLINE_PARTIAL = 17;\n  var DOCTYPE = 18;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var ARRAY_LITERAL = 22;\n  var OBJECT_LITERAL = 23;\n  var BOOLEAN_LITERAL = 24;\n  var REGEXP_LITERAL = 25;\n\n  var GLOBAL = 26;\n  var KEY_VALUE_PAIR = 27;\n\n  var REFERENCE = 30;\n  var REFINEMENT = 31;\n  var MEMBER = 32;\n  var PREFIX_OPERATOR = 33;\n  var BRACKETED = 34;\n  var CONDITIONAL = 35;\n  var INFIX_OPERATOR = 36;\n\n  var INVOCATION = 40;\n\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var ELSE = 60;\n  var ELSEIF = 61;\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher(\"'\");\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString(\"'\")) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString(\"'\")) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns/';\n\n  var createElement;\n  var matches;\n  var _div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var _i;\n  var j;\n  var makeFunction;\n  // Test for SVG support\n  if (!_svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== namespaces.html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \t_div = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \t_i = methodNames.length;\n\n  \twhile (_i-- && !matches) {\n  \t\tunprefixed = methodNames[_i];\n\n  \t\tif (_div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj = vendors.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tprefixed = vendors[_i] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (_div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\t_div.innerHTML = '';\n\n  \t\t\t\tparentNode = _div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\t_div.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti = nodes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (nodes[i] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function _extend(target) {\n  \tvar prop, source;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \twhile (source = sources.shift()) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var Parser;\n  var ParseError;\n  var _leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(_leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var _numberPattern = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function _readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(_numberPattern)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = _readNumberLiteral(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(name)) {\n  \t\treturn token;\n  \t}\n  }\n\n  var JsonParser;\n  var specials;\n  var specialsPattern;\n  var numberPattern;\n  var placeholderPattern;\n  var placeholderAtStartPattern;\n  var onlyWhitespace;\n  specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'undefined': undefined,\n  \t'null': null\n  };\n\n  specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  onlyWhitespace = /^\\s*$/;\n\n  JsonParser = Parser.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tvar placeholder;\n\n  \t\tif (!parser.values) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tplaceholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special;\n\n  \t\tif (special = parser.matchPattern(specialsPattern)) {\n  \t\t\treturn { v: specials[special] };\n  \t\t}\n  \t}, function getNumber(parser) {\n  \t\tvar number;\n\n  \t\tif (number = parser.matchPattern(numberPattern)) {\n  \t\t\treturn { v: +number };\n  \t\t}\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser),\n  \t\t    values;\n\n  \t\tif (stringLiteral && (values = parser.values)) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tvar result, pair;\n\n  \t\tif (!parser.matchString('{')) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tresult = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tvar result, valueToken;\n\n  \t\tif (!parser.matchString('[')) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tresult = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tvar key, valueToken, pair;\n\n  \tparser.allowWhitespace();\n\n  \tkey = readKey(parser);\n\n  \tif (!key) {\n  \t\treturn null;\n  \t}\n\n  \tpair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvalueToken = parser.read();\n  \tif (!valueToken) {\n  \t\treturn null;\n  \t}\n\n  \tpair.value = valueToken.v;\n\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, {\n  \t\tvalues: values\n  \t});\n\n  \treturn parser.result;\n  }\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function badReference(key) {\n  \tthrow new Error('An index or key reference (' + key + ') cannot have child properties');\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = ref.split('.');\n  \tvar key = keys[0];\n\n  \t// TODO what if there are two component boundaries to cross - does this still work?\n  \tvar base = localViewmodel.mappings.hasOwnProperty(key) ? localViewmodel.mappings[key] : localViewmodel.computations.hasOwnProperty(key) ? localViewmodel.computations[key] : null;\n\n  \tif (base) {\n  \t\treturn keys.length > 1 ? base.joinAll(keys.slice(1)) : base;\n  \t}\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  function ________________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\t________________________________________________classCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = reference.split('.');\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  function _______________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError(\"Cannot call a class as a function\");\n  \t}\n  }\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\t_______________________________________________classCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \treturn Item;\n  })();\n\n  function ______________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ______________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Doctype = (function (_Item) {\n  \t______________________________inherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\t______________________________________________classCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  function _____________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var KeypathModel = (function () {\n  \tfunction KeypathModel(parent) {\n  \t\t_____________________________________________classCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.value = parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange$$() {\n  \t\tthis.value = this.parent.getKeypath();\n  \t\tthis.dependants.forEach(handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  function ____________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\t____________________________________________classCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \tstack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \treturn stack.pop();\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  function ___________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var hasProp = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\t___________________________________________classCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = key;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar value = this.value;\n  \t\tvar len = adaptors.length;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.discard = function discard() {\n  \t\tvar _this = this;\n\n  \t\tthis.deps.forEach(function (d) {\n  \t\t\tif (d.boundsSensitive) _this.unregister(d);\n  \t\t});\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n  \t\t\t\t\tif (isArray(model.value)) {\n  \t\t\t\t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t\t\t\t// it'll do for now. Alternatives welcome\n  \t\t\t\t\t\tif (originatingModel && originatingModel.parent === model && originatingModel.key === 'length') {\n  \t\t\t\t\t\t\tmatches.push(originatingModel);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tmodel.value.forEach(function (member, i) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(i));\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else if (isObject(model.value) || typeof model.value === 'function') {\n  \t\t\t\t\t\tObject.keys(model.value).forEach(function (key) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t// special case - computed properties. TODO mappings also?\n  \t\t\t\t\t\tif (model.isRoot) {\n  \t\t\t\t\t\t\tObject.keys(model.computations).forEach(function (key) {\n  \t\t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(this.key);\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel() {\n  \t\treturn this.keypathModel || (this.keypathModel = new KeypathModel(this));\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath() {\n  \t\t// TODO keypaths inside components... tricky\n  \t\treturn this.parent.isRoot ? this.key : this.parent.getKeypath() + '.' + this.key;\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\treturn this.value && hasProp.call(this.value, key);\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark$$() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(mark);\n\n  \t\t\tthis.deps.forEach(handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tthis.parent.value[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(mark);\n  \t\tthis.deps.forEach(handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this2 = this;\n\n  \t\tvar indexModels = [];\n  \t\tvar max = 0,\n  \t\t    child = undefined;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex > max) max = newIndex;\n\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this2.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\t// some children, notably computations, need to be notified when they are\n  \t\t// no longer attached to anything so they don't recompute\n  \t\twhile (child = this.childByKey[++max]) {\n  \t\t\tif (typeof child.discard === 'function') child.discard();\n  \t\t}\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown$$() {\n  \t\tthis.children.forEach(teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return context.root.joinAll(ref.slice(2).split('.'));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(ref.split('.'));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var functionCache = {};\n  function createFunction(str, i) {\n  \tif (functionCache[str]) return functionCache[str];\n\n  \tvar args = new Array(i);\n  \twhile (i--) args[i] = '_' + i;\n\n  \tvar fn = new Function(args.join(','), 'return (' + str + ')');\n\n  \treturn functionCache[str] = fn;\n  }\n\n  function __________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _____________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function wrapFunction(fn, ractive, uid) {\n  \tif (fn.__ractive_nowrap) return fn;\n\n  \tvar prop = '__ractive_' + uid;\n\n  \tif (fn[prop]) return fn[prop];\n\n  \tif (!/\\bthis\\b/.test(fn)) {\n  \t\tdefineProperty(fn, '__ractive_nowrap', {\n  \t\t\tvalue: true\n  \t\t});\n  \t\treturn fn;\n  \t}\n\n  \tdefineProperty(fn, prop, {\n  \t\tvalue: fn.bind(ractive),\n  \t\tconfigurable: true\n  \t});\n\n  \t// Add properties/methods to wrapped function\n  \tfor (var key in fn) {\n  \t\tif (fn.hasOwnProperty(key)) {\n  \t\t\tfn[prop][key] = fn[key];\n  \t\t}\n  \t}\n\n  \tractive._boundFunctions.push({ fn: fn, prop: prop });\n  \treturn fn[prop];\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \t_____________________________inherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\t__________________________________________classCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = createFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(fragment, ref);\n\n  \t\t\tif (!model) {\n  \t\t\t\t(function () {\n  \t\t\t\t\tvar resolver = fragment.resolve(ref, function (model) {\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t\t_this.bubble();\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t})();\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tvar value = model.get(true);\n\n  \t\t\t\t\tif (typeof value === 'function') {\n  \t\t\t\t\t\treturn wrapFunction(value, ractive, ractive._guid);\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\treturn value;\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n  \t\tcomputation.init();\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n  \t};\n\n  \tExpressionProxy.prototype.get = function get() {\n  \t\treturn this.computation.get();\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind$$() {\n  \t\tthis.resolvers.forEach(unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  function _________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ____________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var ReferenceExpressionProxy = (function (_Model) {\n  \t____________________________inherits(ReferenceExpressionProxy, _Model);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\t_________________________________________classCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve(fragment, template);\n\n  \t\tif (!this.base) {\n  \t\t\t(function () {\n  \t\t\t\tvar resolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t\t_this.base = model;\n  \t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t})();\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\t(function () {\n  \t\t\t\t\t\tvar resolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t})();\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i] || this.members[i].get() === undefined) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn model.get();\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind$$() {\n  \t\tthis.resolvers.forEach(unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function resolve(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  function ________________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ___________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Mustache = (function (_Item) {\n  \t___________________________inherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\t________________________________________classCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = resolve(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = resolve(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tvar oldValue = this.model.get();\n  \t\tthis.model.unregister(this);\n\n  \t\tmodel.register(this);\n  \t\tthis.model = model;\n\n  \t\tif (model.get() !== oldValue) this.handleChange();\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn String.fromCharCode(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn 65533;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing € signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn 65533;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t}\n\n  \treturn 65533;\n  }\n\n  function _______________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function __________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Interpolator = (function (_Mustache) {\n  \t__________________________inherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\t_______________________________________classCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn this.node.parentNode.removeChild(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tthis.node = doc.createTextNode(this.getString());\n\n  \t\ttarget.appendChild(this.node);\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  function readComment(parser, tag) {\n  \tvar index;\n\n  \tif (!parser.matchString('!')) {\n  \t\treturn null;\n  \t}\n\n  \tindex = parser.remaining().indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tparser.pos += index + tag.close.length;\n  \t\treturn { t: COMMENT };\n  \t}\n  }\n\n  function flattenExpression(expression) {\n  \tvar refs;\n\n  \textractRefs(expression, refs = []);\n\n  \treturn {\n  \t\tr: refs,\n  \t\ts: stringify(expression)\n  \t};\n\n  \tfunction stringify(node) {\n  \t\tswitch (node.t) {\n  \t\t\tcase BOOLEAN_LITERAL:\n  \t\t\tcase GLOBAL:\n  \t\t\tcase NUMBER_LITERAL:\n  \t\t\tcase REGEXP_LITERAL:\n  \t\t\t\treturn node.v;\n\n  \t\t\tcase STRING_LITERAL:\n  \t\t\t\treturn JSON.stringify(String(node.v));\n\n  \t\t\tcase ARRAY_LITERAL:\n  \t\t\t\treturn '[' + (node.m ? node.m.map(stringify).join(',') : '') + ']';\n\n  \t\t\tcase OBJECT_LITERAL:\n  \t\t\t\treturn '{' + (node.m ? node.m.map(stringify).join(',') : '') + '}';\n\n  \t\t\tcase KEY_VALUE_PAIR:\n  \t\t\t\treturn node.k + ':' + stringify(node.v);\n\n  \t\t\tcase PREFIX_OPERATOR:\n  \t\t\t\treturn (node.s === 'typeof' ? 'typeof ' : node.s) + stringify(node.o);\n\n  \t\t\tcase INFIX_OPERATOR:\n  \t\t\t\treturn stringify(node.o[0]) + (node.s.substr(0, 2) === 'in' ? ' ' + node.s + ' ' : node.s) + stringify(node.o[1]);\n\n  \t\t\tcase INVOCATION:\n  \t\t\t\treturn stringify(node.x) + '(' + (node.o ? node.o.map(stringify).join(',') : '') + ')';\n\n  \t\t\tcase BRACKETED:\n  \t\t\t\treturn '(' + stringify(node.x) + ')';\n\n  \t\t\tcase MEMBER:\n  \t\t\t\treturn stringify(node.x) + stringify(node.r);\n\n  \t\t\tcase REFINEMENT:\n  \t\t\t\treturn node.n ? '.' + node.n : '[' + stringify(node.x) + ']';\n\n  \t\t\tcase CONDITIONAL:\n  \t\t\t\treturn stringify(node.o[0]) + '?' + stringify(node.o[1]) + ':' + stringify(node.o[2]);\n\n  \t\t\tcase REFERENCE:\n  \t\t\t\treturn '_' + refs.indexOf(node.n);\n\n  \t\t\tdefault:\n  \t\t\t\tthrow new Error('Expected legal JavaScript');\n  \t\t}\n  \t}\n  }\n\n  // TODO maybe refactor this?\n  function extractRefs(node, refs) {\n  \tvar i, list;\n\n  \tif (node.t === REFERENCE) {\n  \t\tif (refs.indexOf(node.n) === -1) {\n  \t\t\trefs.unshift(node.n);\n  \t\t}\n  \t}\n\n  \tlist = node.o || node.m;\n  \tif (list) {\n  \t\tif (isObject(list)) {\n  \t\t\textractRefs(list, refs);\n  \t\t} else {\n  \t\t\ti = list.length;\n  \t\t\twhile (i--) {\n  \t\t\t\textractRefs(list[i], refs);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (node.x) {\n  \t\textractRefs(node.x, refs);\n  \t}\n\n  \tif (node.r) {\n  \t\textractRefs(node.r, refs);\n  \t}\n\n  \tif (node.v) {\n  \t\textractRefs(node.v, refs);\n  \t}\n  }\n\n  var arrayMemberPattern = /^[0-9][1-9]*$/;\n  function refineExpression(expression, mustache) {\n  \tvar referenceExpression;\n\n  \tif (expression) {\n  \t\twhile (expression.t === BRACKETED && expression.x) {\n  \t\t\texpression = expression.x;\n  \t\t}\n\n  \t\t// special case - integers should be treated as array members references,\n  \t\t// rather than as expressions in their own right\n  \t\tif (expression.t === REFERENCE) {\n  \t\t\tmustache.r = expression.n;\n  \t\t} else {\n  \t\t\tif (expression.t === NUMBER_LITERAL && arrayMemberPattern.test(expression.v)) {\n  \t\t\t\tmustache.r = expression.v;\n  \t\t\t} else if (referenceExpression = getReferenceExpression(expression)) {\n  \t\t\t\tmustache.rx = referenceExpression;\n  \t\t\t} else {\n  \t\t\t\tmustache.x = flattenExpression(expression);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn mustache;\n  \t}\n  }\n\n  // TODO refactor this! it's bewildering\n  function getReferenceExpression(expression) {\n  \tvar members = [],\n  \t    refinement;\n\n  \twhile (expression.t === MEMBER && expression.r.t === REFINEMENT) {\n  \t\trefinement = expression.r;\n\n  \t\tif (refinement.x) {\n  \t\t\tif (refinement.x.t === REFERENCE) {\n  \t\t\t\tmembers.unshift(refinement.x);\n  \t\t\t} else {\n  \t\t\t\tmembers.unshift(flattenExpression(refinement.x));\n  \t\t\t}\n  \t\t} else {\n  \t\t\tmembers.unshift(refinement.n);\n  \t\t}\n\n  \t\texpression = expression.x;\n  \t}\n\n  \tif (expression.t !== REFERENCE) {\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tr: expression.n,\n  \t\tm: members\n  \t};\n  }\n\n  var prefixPattern = /^(?:~\\/|(?:\\.\\.\\/)+|\\.\\/(?:\\.\\.\\/)*|\\.)/;\n  var globals;\n  var keywords;\n  // if a reference is a browser global, we don't deference it later, so it needs special treatment\n  globals = /^(?:Array|console|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)\\b/;\n\n  // keywords are not valid references, with the exception of `this`\n  keywords = /^(?:break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with)$/;\n\n  var legalReference = /^[a-zA-Z$_0-9]+(?:(?:\\.[a-zA-Z$_0-9]+)|(?:\\[[0-9]+\\]))*/;\n  var relaxedName = /^[a-zA-Z_$][-\\/a-zA-Z_$0-9]*/;\n  function readReference(parser) {\n  \tvar startPos, prefix, name, global, reference, lastDotIndex;\n\n  \tstartPos = parser.pos;\n\n  \tname = parser.matchPattern(/^@(?:keypath|index|key)/);\n\n  \tif (!name) {\n  \t\tprefix = parser.matchPattern(prefixPattern) || '';\n  \t\tname = !prefix && parser.relaxedNames && parser.matchPattern(relaxedName) || parser.matchPattern(legalReference);\n\n  \t\tif (!name && prefix === '.') {\n  \t\t\tprefix = '';\n  \t\t\tname = '.';\n  \t\t}\n  \t}\n\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \t// bug out if it's a keyword (exception for ancestor/restricted refs - see https://github.com/ractivejs/ractive/issues/1497)\n  \tif (!prefix && !parser.relaxedNames && keywords.test(name)) {\n  \t\tparser.pos = startPos;\n  \t\treturn null;\n  \t}\n\n  \t// if this is a browser global, stop here\n  \tif (!prefix && globals.test(name)) {\n  \t\tglobal = globals.exec(name)[0];\n  \t\tparser.pos = startPos + global.length;\n\n  \t\treturn {\n  \t\t\tt: GLOBAL,\n  \t\t\tv: global\n  \t\t};\n  \t}\n\n  \treference = (prefix || '') + normalise(name);\n\n  \tif (parser.matchString('(')) {\n  \t\t// if this is a method invocation (as opposed to a function) we need\n  \t\t// to strip the method name from the reference combo, else the context\n  \t\t// will be wrong\n  \t\tlastDotIndex = reference.lastIndexOf('.');\n  \t\tif (lastDotIndex !== -1) {\n  \t\t\treference = reference.substr(0, lastDotIndex);\n  \t\t\tparser.pos = startPos + reference.length;\n  \t\t} else {\n  \t\t\tparser.pos -= 1;\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tt: REFERENCE,\n  \t\tn: reference.replace(/^this\\./, './').replace(/^this$/, '.')\n  \t};\n  }\n\n  var expectedExpression = 'Expected a JavaScript expression';\n  var expectedParen = 'Expected closing paren';\n\n  function readExpressionList(parser) {\n  \tvar start, expressions, expr, next;\n\n  \tstart = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \texpr = readExpression(parser);\n\n  \tif (expr === null) {\n  \t\treturn null;\n  \t}\n\n  \texpressions = [expr];\n\n  \t// allow whitespace between expression and ','\n  \tparser.allowWhitespace();\n\n  \tif (parser.matchString(',')) {\n  \t\tnext = readExpressionList(parser);\n  \t\tif (next === null) {\n  \t\t\tparser.error(expectedExpression);\n  \t\t}\n\n  \t\tnext.forEach(append);\n  \t}\n\n  \tfunction append(expression) {\n  \t\texpressions.push(expression);\n  \t}\n\n  \treturn expressions;\n  }\n\n  function readRefinement(parser) {\n  \tvar start, name$$, expr;\n\n  \tstart = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \t// \".\" name\n  \tif (parser.matchString('.')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tif (name$$ = parser.matchPattern(name)) {\n  \t\t\treturn {\n  \t\t\t\tt: REFINEMENT,\n  \t\t\t\tn: name$$\n  \t\t\t};\n  \t\t}\n\n  \t\tparser.error('Expected a property name');\n  \t}\n\n  \t// \"[\" expression \"]\"\n  \tif (parser.matchString('[')) {\n  \t\tparser.allowWhitespace();\n\n  \t\texpr = readExpression(parser);\n  \t\tif (!expr) {\n  \t\t\tparser.error(expectedExpression);\n  \t\t}\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (!parser.matchString(']')) {\n  \t\t\tparser.error('Expected \\']\\'');\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: REFINEMENT,\n  \t\t\tx: expr\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readBracketedExpression(parser) {\n  \tvar start, expr;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString('(')) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpr = readExpression(parser);\n  \tif (!expr) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(')')) {\n  \t\tparser.error(expectedParen);\n  \t}\n\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expr\n  \t};\n  }\n\n  var regexpPattern = /^(\\/(?:[^\\n\\r\\u2028\\u2029/\\\\[]|\\\\.|\\[(?:[^\\n\\r\\u2028\\u2029\\]\\\\]|\\\\.)*])+\\/(?:([gimuy])(?![a-z]*\\2))*(?![a-zA-Z_$0-9]))/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(regexpPattern)) {\n  \t\treturn {\n  \t\t\tt: REGEXP_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readArrayLiteral (parser) {\n  \tvar start, expressionList;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before '['\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('[')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \texpressionList = readExpressionList(parser);\n\n  \tif (!parser.matchString(']')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: ARRAY_LITERAL,\n  \t\tm: expressionList\n  \t};\n  }\n\n  function readKeyValuePair(parser) {\n  \tvar start, key, value;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace between '{' and key\n  \tparser.allowWhitespace();\n\n  \tkey = readKey(parser);\n  \tif (key === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between key and ':'\n  \tparser.allowWhitespace();\n\n  \t// next character must be ':'\n  \tif (!parser.matchString(':')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between ':' and value\n  \tparser.allowWhitespace();\n\n  \t// next expression must be a, well... expression\n  \tvalue = readExpression(parser);\n  \tif (value === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: KEY_VALUE_PAIR,\n  \t\tk: key,\n  \t\tv: value\n  \t};\n  }\n\n  function readKeyValuePairs(parser) {\n  \tvar start, pairs, pair, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \tpair = readKeyValuePair(parser);\n  \tif (pair === null) {\n  \t\treturn null;\n  \t}\n\n  \tpairs = [pair];\n\n  \tif (parser.matchString(',')) {\n  \t\tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t\tif (!keyValuePairs) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn pairs.concat(keyValuePairs);\n  \t}\n\n  \treturn pairs;\n  }\n\n  function readObjectLiteral (parser) {\n  \tvar start, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('{')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t// allow whitespace between final value and '}'\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('}')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: OBJECT_LITERAL,\n  \t\tm: keyValuePairs\n  \t};\n  }\n\n  function readBooleanLiteral(parser) {\n  \tvar remaining = parser.remaining();\n\n  \tif (remaining.substr(0, 4) === 'true') {\n  \t\tparser.pos += 4;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'true'\n  \t\t};\n  \t}\n\n  \tif (remaining.substr(0, 5) === 'false') {\n  \t\tparser.pos += 5;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'false'\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readLiteral(parser) {\n  \treturn _readNumberLiteral(parser) || readBooleanLiteral(parser) || readStringLiteral(parser) || readObjectLiteral(parser) || readArrayLiteral(parser) || readNumberLiteral(parser);\n  }\n\n  function readPrimary (parser) {\n  \treturn readLiteral(parser) || readReference(parser) || readBracketedExpression(parser);\n  }\n\n  function readMemberOrInvocation (parser) {\n  \tvar current, expression, refinement, expressionList;\n\n  \texpression = readPrimary(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \twhile (expression) {\n  \t\tcurrent = parser.pos;\n\n  \t\tif (refinement = readRefinement(parser)) {\n  \t\t\texpression = {\n  \t\t\t\tt: MEMBER,\n  \t\t\t\tx: expression,\n  \t\t\t\tr: refinement\n  \t\t\t};\n  \t\t} else if (parser.matchString('(')) {\n  \t\t\tparser.allowWhitespace();\n  \t\t\texpressionList = readExpressionList(parser);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(')')) {\n  \t\t\t\tparser.error(expectedParen);\n  \t\t\t}\n\n  \t\t\texpression = {\n  \t\t\t\tt: INVOCATION,\n  \t\t\t\tx: expression\n  \t\t\t};\n\n  \t\t\tif (expressionList) {\n  \t\t\t\texpression.o = expressionList;\n  \t\t\t}\n  \t\t} else {\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \treturn expression;\n  }\n\n  var readTypeOf;\n  var makePrefixSequenceMatcher;\n  makePrefixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar expression;\n\n  \t\tif (expression = fallthrough(parser)) {\n  \t\t\treturn expression;\n  \t\t}\n\n  \t\tif (!parser.matchString(symbol)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tparser.allowWhitespace();\n\n  \t\texpression = readExpression(parser);\n  \t\tif (!expression) {\n  \t\t\tparser.error(expectedExpression);\n  \t\t}\n\n  \t\treturn {\n  \t\t\ts: symbol,\n  \t\t\to: expression,\n  \t\t\tt: PREFIX_OPERATOR\n  \t\t};\n  \t};\n  };\n\n  // create all prefix sequence matchers, return readTypeOf\n  (function () {\n  \tvar i, len, matcher, prefixOperators, fallthrough;\n\n  \tprefixOperators = '! ~ + - typeof'.split(' ');\n\n  \tfallthrough = readMemberOrInvocation;\n  \tfor (i = 0, len = prefixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makePrefixSequenceMatcher(prefixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// typeof operator is higher precedence than multiplication, so provides the\n  \t// fallthrough for the multiplication sequence matcher we're about to create\n  \t// (we're skipping void and delete)\n  \treadTypeOf = fallthrough;\n  })();\n\n  var readLogicalOr;\n  var makeInfixSequenceMatcher;\n  makeInfixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar start, left, right;\n\n  \t\tleft = fallthrough(parser);\n  \t\tif (!left) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// Loop to handle left-recursion in a case like `a * b * c` and produce\n  \t\t// left association, i.e. `(a * b) * c`.  The matcher can't call itself\n  \t\t// to parse `left` because that would be infinite regress.\n  \t\twhile (true) {\n  \t\t\tstart = parser.pos;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(symbol)) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\t// special case - in operator must not be followed by [a-zA-Z_$0-9]\n  \t\t\tif (symbol === 'in' && /[a-zA-Z_$0-9]/.test(parser.remaining().charAt(0))) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\t// right operand must also consist of only higher-precedence operators\n  \t\t\tright = fallthrough(parser);\n  \t\t\tif (!right) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tleft = {\n  \t\t\t\tt: INFIX_OPERATOR,\n  \t\t\t\ts: symbol,\n  \t\t\t\to: [left, right]\n  \t\t\t};\n\n  \t\t\t// Loop back around.  If we don't see another occurrence of the symbol,\n  \t\t\t// we'll return left.\n  \t\t}\n  \t};\n  };\n\n  // create all infix sequence matchers, and return readLogicalOr\n  (function () {\n  \tvar i, len, matcher, infixOperators, fallthrough;\n\n  \t// All the infix operators on order of precedence (source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Operator_Precedence)\n  \t// Each sequence matcher will initially fall through to its higher precedence\n  \t// neighbour, and only attempt to match if one of the higher precedence operators\n  \t// (or, ultimately, a literal, reference, or bracketed expression) already matched\n  \tinfixOperators = '* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||'.split(' ');\n\n  \t// A typeof operator is higher precedence than multiplication\n  \tfallthrough = readTypeOf;\n  \tfor (i = 0, len = infixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makeInfixSequenceMatcher(infixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// Logical OR is the fallthrough for the conditional matcher\n  \treadLogicalOr = fallthrough;\n  })();\n\n  function getConditional(parser) {\n  \tvar start, expression, ifTrue, ifFalse;\n\n  \texpression = readLogicalOr(parser);\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('?')) {\n  \t\tparser.pos = start;\n  \t\treturn expression;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifTrue = readExpression(parser);\n  \tif (!ifTrue) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(':')) {\n  \t\tparser.error('Expected \":\"');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifFalse = readExpression(parser);\n  \tif (!ifFalse) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \treturn {\n  \t\tt: CONDITIONAL,\n  \t\to: [expression, ifTrue, ifFalse]\n  \t};\n  }\n\n  function readExpression(parser) {\n  \t// The conditional operator is the lowest precedence operator (except yield,\n  \t// assignment operators, and commas, none of which are supported), so we\n  \t// start there. If it doesn't match, it 'falls through' to progressively\n  \t// higher precedence operators, until it eventually matches (or fails to\n  \t// match) a 'primary' - a literal or a reference. This way, the abstract syntax\n  \t// tree has everything in its proper place, i.e. 2 + 3 * 4 === 14, not 20.\n  \treturn getConditional(parser);\n  }\n\n  function readExpressionOrReference(parser, expectedFollowers) {\n  \tvar start, expression, i;\n\n  \tstart = parser.pos;\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < expectedFollowers.length; i += 1) {\n  \t\tif (parser.remaining().substr(0, expectedFollowers[i].length) === expectedFollowers[i]) {\n  \t\t\treturn expression;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn readReference(parser);\n  }\n\n  function readInterpolator(parser, tag) {\n  \tvar start, expression, interpolator, err;\n\n  \tstart = parser.pos;\n\n  \t// TODO would be good for perf if we could do away with the try-catch\n  \ttry {\n  \t\texpression = readExpressionOrReference(parser, [tag.close]);\n  \t} catch (e) {\n  \t\terr = e;\n  \t}\n\n  \tif (!expression) {\n  \t\tif (parser.str.charAt(start) === '!') {\n  \t\t\t// special case - comment\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tif (err) {\n  \t\t\tthrow err;\n  \t\t}\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\' after reference');\n\n  \t\tif (!expression) {\n  \t\t\t// special case - comment\n  \t\t\tif (parser.nextChar() === '!') {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.error('Expected expression or legal reference');\n  \t\t}\n  \t}\n\n  \tinterpolator = { t: INTERPOLATOR };\n  \trefineExpression(expression, interpolator); // TODO handle this differently - it's mysterious\n\n  \treturn interpolator;\n  }\n\n  var yieldPattern = /^yield\\s*/;\n  function readYielder(parser, tag) {\n  \tvar start, name, yielder;\n\n  \tif (!parser.matchPattern(yieldPattern)) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n  \tname = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-]*/);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('expected legal partial name');\n  \t}\n\n  \tyielder = { t: YIELDER };\n\n  \tif (name) {\n  \t\tyielder.n = name;\n  \t}\n\n  \treturn yielder;\n  }\n\n  var handlebarsBlockCodes = {\n  \t'each': SECTION_EACH,\n  \t'if': SECTION_IF,\n  \t'if-with': SECTION_IF_WITH,\n  \t'with': SECTION_WITH,\n  \t'unless': SECTION_UNLESS\n  };\n\n  var _elsePattern = /^\\s*else\\s*/;\n  function readElse(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(_elsePattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn {\n  \t\tt: ELSE\n  \t};\n  }\n\n  var elsePattern = /^\\s*elseif\\s+/;\n  function readElseIf(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(elsePattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar expression = readExpression(parser);\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn {\n  \t\tt: ELSEIF,\n  \t\tx: expression\n  \t};\n  }\n\n  function readClosing(parser, tag) {\n  \tvar start, remaining, index, closing;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('/')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tremaining = parser.remaining();\n  \tindex = remaining.indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tclosing = {\n  \t\t\tt: CLOSING,\n  \t\t\tr: remaining.substr(0, index).split(' ')[0]\n  \t\t};\n\n  \t\tparser.pos += index;\n\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t\t}\n\n  \t\treturn closing;\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var indexRefPattern = /^\\s*:\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var keyIndexRefPattern = /^\\s*,\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var handlebarsBlockPattern = new RegExp('^(' + Object.keys(handlebarsBlockCodes).join('|') + ')\\\\b');\n  function readSection(parser, tag) {\n  \tvar start, expression, section, child, children, hasElse, block, unlessBlock, conditions, closed, i, expectedClose;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('^')) {\n  \t\tsection = { t: SECTION, f: [], n: SECTION_UNLESS };\n  \t} else if (parser.matchString('#')) {\n  \t\tsection = { t: SECTION, f: [] };\n\n  \t\tif (parser.matchString('partial')) {\n  \t\t\tparser.pos = start - parser.standardDelimiters[0].length;\n  \t\t\tparser.error('Partial definitions can only be at the top level of the template, or immediately inside components');\n  \t\t}\n\n  \t\tif (block = parser.matchPattern(handlebarsBlockPattern)) {\n  \t\t\texpectedClose = block;\n  \t\t\tsection.n = handlebarsBlockCodes[block];\n  \t\t}\n  \t} else {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\tparser.error('Expected expression');\n  \t}\n\n  \t// optional index and key references\n  \tif (i = parser.matchPattern(indexRefPattern)) {\n  \t\tvar extra = undefined;\n\n  \t\tif (extra = parser.matchPattern(keyIndexRefPattern)) {\n  \t\t\tsection.i = i + ',' + extra;\n  \t\t} else {\n  \t\t\tsection.i = i;\n  \t\t}\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \tparser.sectionDepth += 1;\n  \tchildren = section.f;\n\n  \tconditions = [];\n\n  \tdo {\n  \t\tif (child = readClosing(parser, tag)) {\n  \t\t\tif (expectedClose && child.r !== expectedClose) {\n  \t\t\t\tparser.error('Expected ' + tag.open + '/' + expectedClose + tag.close);\n  \t\t\t}\n\n  \t\t\tparser.sectionDepth -= 1;\n  \t\t\tclosed = true;\n  \t\t} else if (child = readElseIf(parser, tag)) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('illegal {{elseif...}} after {{else}}');\n  \t\t\t}\n\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression, section.n);\n  \t\t\t}\n\n  \t\t\tunlessBlock.f.push({\n  \t\t\t\tt: SECTION,\n  \t\t\t\tn: SECTION_IF,\n  \t\t\t\tx: flattenExpression(___combine(conditions.concat(child.x))),\n  \t\t\t\tf: children = []\n  \t\t\t});\n\n  \t\t\tconditions.push(invert(child.x));\n  \t\t} else if (child = readElse(parser, tag)) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('there can only be one {{else}} block, at the end of a section');\n  \t\t\t}\n\n  \t\t\thasElse = true;\n\n  \t\t\t// use an unless block if there's no elseif\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression, section.n);\n  \t\t\t\tchildren = unlessBlock.f;\n  \t\t\t} else {\n  \t\t\t\tunlessBlock.f.push({\n  \t\t\t\t\tt: SECTION,\n  \t\t\t\t\tn: SECTION_IF,\n  \t\t\t\t\tx: flattenExpression(___combine(conditions)),\n  \t\t\t\t\tf: children = []\n  \t\t\t\t});\n  \t\t\t}\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tchildren.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \tif (unlessBlock) {\n  \t\t// special case - `with` should become `if-with` (TODO is this right?\n  \t\t// seems to me that `with` ought to behave consistently, regardless\n  \t\t// of the presence/absence of `else`. In other words should always\n  \t\t// be `if-with`\n  \t\tif (section.n === SECTION_WITH) {\n  \t\t\tsection.n = SECTION_IF_WITH;\n  \t\t}\n\n  \t\tsection.l = unlessBlock;\n  \t}\n\n  \trefineExpression(expression, section);\n\n  \t// TODO if a section is empty it should be discarded. Don't do\n  \t// that here though - we need to clean everything up first, as\n  \t// it may contain removeable whitespace. As a temporary measure,\n  \t// to pass the existing tests, remove empty `f` arrays\n  \tif (!section.f.length) {\n  \t\tdelete section.f;\n  \t}\n\n  \treturn section;\n  }\n\n  function createUnlessBlock(expression, sectionType) {\n  \tvar unlessBlock = {\n  \t\tt: SECTION,\n  \t\tn: SECTION_UNLESS,\n  \t\tf: []\n  \t};\n\n  \trefineExpression(expression, unlessBlock);\n\n  \treturn unlessBlock;\n  }\n\n  function invert(expression) {\n  \tif (expression.t === PREFIX_OPERATOR && expression.s === '!') {\n  \t\treturn expression.o;\n  \t}\n\n  \treturn {\n  \t\tt: PREFIX_OPERATOR,\n  \t\ts: '!',\n  \t\to: parensIfNecessary(expression)\n  \t};\n  }\n\n  function ___combine(expressions) {\n  \tif (expressions.length === 1) {\n  \t\treturn expressions[0];\n  \t}\n\n  \treturn {\n  \t\tt: INFIX_OPERATOR,\n  \t\ts: '&&',\n  \t\to: [parensIfNecessary(expressions[0]), parensIfNecessary(___combine(expressions.slice(1)))]\n  \t};\n  }\n\n  function parensIfNecessary(expression) {\n  \t// TODO only wrap if necessary\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expression\n  \t};\n  }\n\n  function readUnescaped(parser, tag) {\n  \tvar expression, triple;\n\n  \tif (!parser.matchString('&')) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function readPartial(parser, tag) {\n  \tvar start, nameStart, expression, context, partial;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString('>')) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n  \tnameStart = parser.pos;\n\n  \t// Partial names can include hyphens, so we can't use readExpression\n  \t// blindly. Instead, we use the `relaxedNames` flag to indicate that\n  \t// `foo-bar` should be read as a single name, rather than 'subtract\n  \t// bar from foo'\n  \tparser.relaxedNames = true;\n  \texpression = readExpression(parser);\n  \tparser.relaxedNames = false;\n\n  \tparser.allowWhitespace();\n  \tcontext = readExpression(parser);\n  \tparser.allowWhitespace();\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tpartial = { t: PARTIAL };\n  \trefineExpression(expression, partial); // TODO...\n\n  \tparser.allowWhitespace();\n\n  \t// if we have another expression - e.g. `{{>foo bar}}` - then\n  \t// we turn it into `{{#with bar}}{{>foo}}{{/with}}`\n  \tif (context) {\n  \t\tpartial = {\n  \t\t\tt: SECTION,\n  \t\t\tn: SECTION_WITH,\n  \t\t\tf: [partial]\n  \t\t};\n\n  \t\trefineExpression(context, partial);\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn partial;\n  }\n\n  function readTriple(parser, tag) {\n  \tvar expression = readExpression(parser),\n  \t    triple;\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function getLowestIndex (haystack, needles) {\n  \tvar i, index, lowest;\n\n  \ti = needles.length;\n  \twhile (i--) {\n  \t\tindex = haystack.indexOf(needles[i]);\n\n  \t\t// short circuit\n  \t\tif (!index) {\n  \t\t\treturn 0;\n  \t\t}\n\n  \t\tif (index === -1) {\n  \t\t\tcontinue;\n  \t\t}\n\n  \t\tif (!lowest || index < lowest) {\n  \t\t\tlowest = index;\n  \t\t}\n  \t}\n\n  \treturn lowest || -1;\n  }\n\n  function readText(parser) {\n  \tvar index, remaining, disallowed, barrier;\n\n  \tremaining = parser.remaining();\n\n  \tbarrier = parser.inside ? '</' + parser.inside : '<';\n\n  \tif (parser.inside && !parser.interpolate[parser.inside]) {\n  \t\tindex = remaining.indexOf(barrier);\n  \t} else {\n  \t\tdisallowed = parser.tags.map(function (t) {\n  \t\t\treturn t.open;\n  \t\t});\n  \t\tdisallowed = disallowed.concat(parser.tags.map(function (t) {\n  \t\t\treturn '\\\\' + t.open;\n  \t\t}));\n\n  \t\t// http://developers.whatwg.org/syntax.html#syntax-attributes\n  \t\tif (parser.inAttribute === true) {\n  \t\t\t// we're inside an unquoted attribute value\n  \t\t\tdisallowed.push('\"', \"'\", '=', '<', '>', '`');\n  \t\t} else if (parser.inAttribute) {\n  \t\t\t// quoted attribute value\n  \t\t\tdisallowed.push(parser.inAttribute);\n  \t\t} else {\n  \t\t\tdisallowed.push(barrier);\n  \t\t}\n\n  \t\tindex = getLowestIndex(remaining, disallowed);\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tif (index === -1) {\n  \t\tindex = remaining.length;\n  \t}\n\n  \tparser.pos += index;\n\n  \treturn parser.inside ? remaining.substr(0, index) : decodeCharacterReferences(remaining.substr(0, index));\n  }\n\n  function trimWhitespace (items, leadingPattern, trailingPattern) {\n  \tvar item;\n\n  \tif (leadingPattern) {\n  \t\titem = items[0];\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(leadingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.shift();\n  \t\t\t} else {\n  \t\t\t\titems[0] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (trailingPattern) {\n  \t\titem = lastItem(items);\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(trailingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.pop();\n  \t\t\t} else {\n  \t\t\t\titems[items.length - 1] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var leadingLinebreak = /^\\s*\\r?\\n/;\n  var trailingLinebreak = /\\r?\\n\\s*$/;\n  function stripStandalones (items) {\n  \tvar i, current, backOne, backTwo, lastSectionItem;\n\n  \tfor (i = 1; i < items.length; i += 1) {\n  \t\tcurrent = items[i];\n  \t\tbackOne = items[i - 1];\n  \t\tbackTwo = items[i - 2];\n\n  \t\t// if we're at the end of a [text][comment][text] sequence...\n  \t\tif (isString(current) && isComment(backOne) && isString(backTwo)) {\n\n  \t\t\t// ... and the comment is a standalone (i.e. line breaks either side)...\n  \t\t\tif (trailingLinebreak.test(backTwo) && leadingLinebreak.test(current)) {\n\n  \t\t\t\t// ... then we want to remove the whitespace after the first line break\n  \t\t\t\titems[i - 2] = backTwo.replace(trailingLinebreak, '\\n');\n\n  \t\t\t\t// and the leading line break of the second text token\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the current item is a section, and it is preceded by a linebreak, and\n  \t\t// its first item is a linebreak...\n  \t\tif (isSection(current) && isString(backOne)) {\n  \t\t\tif (trailingLinebreak.test(backOne) && isString(current.f[0]) && leadingLinebreak.test(current.f[0])) {\n  \t\t\t\titems[i - 1] = backOne.replace(trailingLinebreak, '\\n');\n  \t\t\t\tcurrent.f[0] = current.f[0].replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the last item was a section, and it is followed by a linebreak, and\n  \t\t// its last item is a linebreak...\n  \t\tif (isString(current) && isSection(backOne)) {\n  \t\t\tlastSectionItem = lastItem(backOne.f);\n\n  \t\t\tif (isString(lastSectionItem) && trailingLinebreak.test(lastSectionItem) && leadingLinebreak.test(current)) {\n  \t\t\t\tbackOne.f[backOne.f.length - 1] = lastSectionItem.replace(trailingLinebreak, '\\n');\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn items;\n  }\n\n  function isString(item) {\n  \treturn typeof item === 'string';\n  }\n\n  function isComment(item) {\n  \treturn item.t === COMMENT || item.t === DELIMCHANGE;\n  }\n\n  function isSection(item) {\n  \treturn (item.t === SECTION || item.t === INVERTED) && item.f;\n  }\n\n  var contiguousWhitespace = /[ \\t\\f\\r\\n]+/g;\n  var preserveWhitespaceElements = /^(?:pre|script|style|textarea)$/i;\n  var leadingWhitespace = /^[ \\t\\f\\r\\n]+/;\n  var trailingWhitespace = /[ \\t\\f\\r\\n]+$/;\n  var leadingNewLine = /^(?:\\r\\n|\\r|\\n)/;\n  var trailingNewLine = /(?:\\r\\n|\\r|\\n)$/;\n  function cleanup(items, stripComments, preserveWhitespace, removeLeadingWhitespace, removeTrailingWhitespace) {\n  \tvar i, item, previousItem, nextItem, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment, key;\n\n  \t// First pass - remove standalones and comments etc\n  \tstripStandalones(items);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Remove delimiter changes, unsafe elements etc\n  \t\tif (item.exclude) {\n  \t\t\titems.splice(i, 1);\n  \t\t}\n\n  \t\t// Remove comments, unless we want to keep them\n  \t\telse if (stripComments && item.t === COMMENT) {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t}\n\n  \t// If necessary, remove leading and trailing whitespace\n  \ttrimWhitespace(items, removeLeadingWhitespace ? leadingWhitespace : null, removeTrailingWhitespace ? trailingWhitespace : null);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Recurse\n  \t\tif (item.f) {\n  \t\t\tvar isPreserveWhitespaceElement = item.t === ELEMENT && preserveWhitespaceElements.test(item.e);\n  \t\t\tpreserveWhitespaceInsideFragment = preserveWhitespace || isPreserveWhitespaceElement;\n\n  \t\t\tif (!preserveWhitespace && isPreserveWhitespaceElement) {\n  \t\t\t\ttrimWhitespace(item.f, leadingNewLine, trailingNewLine);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespaceInsideFragment) {\n  \t\t\t\tpreviousItem = items[i - 1];\n  \t\t\t\tnextItem = items[i + 1];\n\n  \t\t\t\t// if the previous item was a text item with trailing whitespace,\n  \t\t\t\t// remove leading whitespace inside the fragment\n  \t\t\t\tif (!previousItem || typeof previousItem === 'string' && trailingWhitespace.test(previousItem)) {\n  \t\t\t\t\tremoveLeadingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n\n  \t\t\t\t// and vice versa\n  \t\t\t\tif (!nextItem || typeof nextItem === 'string' && leadingWhitespace.test(nextItem)) {\n  \t\t\t\t\tremoveTrailingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tcleanup(item.f, stripComments, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Split if-else blocks into two (an if, and an unless)\n  \t\tif (item.l) {\n  \t\t\tcleanup(item.l.f, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n\n  \t\t\titems.splice(i + 1, 0, item.l);\n  \t\t\tdelete item.l; // TODO would be nice if there was a way around this\n  \t\t}\n\n  \t\t// Clean up element attributes\n  \t\tif (item.a) {\n  \t\t\tfor (key in item.a) {\n  \t\t\t\tif (item.a.hasOwnProperty(key) && typeof item.a[key] !== 'string') {\n  \t\t\t\t\tcleanup(item.a[key], stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Clean up conditional attributes\n  \t\tif (item.m) {\n  \t\t\tcleanup(item.m, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Clean up event handlers\n  \t\tif (item.v) {\n  \t\t\tfor (key in item.v) {\n  \t\t\t\tif (item.v.hasOwnProperty(key)) {\n  \t\t\t\t\t// clean up names\n  \t\t\t\t\tif (isArray(item.v[key].n)) {\n  \t\t\t\t\t\tcleanup(item.v[key].n, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// clean up params\n  \t\t\t\t\tif (isArray(item.v[key].d)) {\n  \t\t\t\t\t\tcleanup(item.v[key].d, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// final pass - fuse text nodes together\n  \ti = items.length;\n  \twhile (i--) {\n  \t\tif (typeof items[i] === 'string') {\n  \t\t\tif (typeof items[i + 1] === 'string') {\n  \t\t\t\titems[i] = items[i] + items[i + 1];\n  \t\t\t\titems.splice(i + 1, 1);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespace) {\n  \t\t\t\titems[i] = items[i].replace(contiguousWhitespace, ' ');\n  \t\t\t}\n\n  \t\t\tif (items[i] === '') {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var closingTagPattern = /^([a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*)\\s*\\>/;\n  function readClosingTag(parser) {\n  \tvar start, tag;\n\n  \tstart = parser.pos;\n\n  \t// are we looking at a closing tag?\n  \tif (!parser.matchString('</')) {\n  \t\treturn null;\n  \t}\n\n  \tif (tag = parser.matchPattern(closingTagPattern)) {\n  \t\tif (parser.inside && tag !== parser.inside) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: CLOSING_TAG,\n  \t\t\te: tag\n  \t\t};\n  \t}\n\n  \t// We have an illegal closing tag, report it\n  \tparser.pos -= 2;\n  \tparser.error('Illegal closing tag');\n  }\n\n  var methodCallPattern = /^([a-zA-Z_$][a-zA-Z_$0-9]*)\\(/;\n  var methodCallExcessPattern = /\\)\\s*$/;\n  var ExpressionParser;\n  ExpressionParser = Parser.extend({\n  \tconverters: [readExpression]\n  });\n\n  // TODO clean this up, it's shocking\n\n  function processDirective(tokens, parentParser) {\n  \tvar result, match, parser, args, token, colonIndex, directiveName, directiveArgs, parsed;\n\n  \tif (typeof tokens === 'string') {\n  \t\tif (match = methodCallPattern.exec(tokens)) {\n  \t\t\tvar end = tokens.lastIndexOf(')');\n\n  \t\t\t// check for invalid method calls\n  \t\t\tif (!methodCallExcessPattern.test(tokens)) {\n  \t\t\t\tparentParser.error('Invalid input after method call expression \\'' + tokens.slice(end + 1) + '\\'');\n  \t\t\t}\n\n  \t\t\tresult = { m: match[1] };\n  \t\t\targs = '[' + tokens.slice(result.m.length + 1, end) + ']';\n\n  \t\t\tparser = new ExpressionParser(args);\n  \t\t\tresult.a = flattenExpression(parser.result[0]);\n\n  \t\t\treturn result;\n  \t\t}\n\n  \t\tif (tokens.indexOf(':') === -1) {\n  \t\t\treturn tokens.trim();\n  \t\t}\n\n  \t\ttokens = [tokens];\n  \t}\n\n  \tresult = {};\n\n  \tdirectiveName = [];\n  \tdirectiveArgs = [];\n\n  \tif (tokens) {\n  \t\twhile (tokens.length) {\n  \t\t\ttoken = tokens.shift();\n\n  \t\t\tif (typeof token === 'string') {\n  \t\t\t\tcolonIndex = token.indexOf(':');\n\n  \t\t\t\tif (colonIndex === -1) {\n  \t\t\t\t\tdirectiveName.push(token);\n  \t\t\t\t} else {\n  \t\t\t\t\t// is the colon the first character?\n  \t\t\t\t\tif (colonIndex) {\n  \t\t\t\t\t\t// no\n  \t\t\t\t\t\tdirectiveName.push(token.substr(0, colonIndex));\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// if there is anything after the colon in this token, treat\n  \t\t\t\t\t// it as the first token of the directiveArgs fragment\n  \t\t\t\t\tif (token.length > colonIndex + 1) {\n  \t\t\t\t\t\tdirectiveArgs[0] = token.substring(colonIndex + 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tdirectiveName.push(token);\n  \t\t\t}\n  \t\t}\n\n  \t\tdirectiveArgs = directiveArgs.concat(tokens);\n  \t}\n\n  \tif (!directiveName.length) {\n  \t\tresult = '';\n  \t} else if (directiveArgs.length || typeof directiveName !== 'string') {\n  \t\tresult = {\n  \t\t\t// TODO is this really necessary? just use the array\n  \t\t\tn: directiveName.length === 1 && typeof directiveName[0] === 'string' ? directiveName[0] : directiveName\n  \t\t};\n\n  \t\tif (directiveArgs.length === 1 && typeof directiveArgs[0] === 'string') {\n  \t\t\tparsed = parseJSON('[' + directiveArgs[0] + ']');\n  \t\t\tresult.a = parsed ? parsed.value : [directiveArgs[0].trim()];\n  \t\t} else {\n  \t\t\tresult.d = directiveArgs;\n  \t\t}\n  \t} else {\n  \t\tresult = directiveName;\n  \t}\n\n  \treturn result;\n  }\n\n  var delimiterChangePattern = /^[^\\s=]+/;\n  var whitespacePattern = /^\\s+/;\n  function readDelimiterChange(parser) {\n  \tvar start, opening, closing;\n\n  \tif (!parser.matchString('=')) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before new opening delimiter\n  \tparser.allowWhitespace();\n\n  \topening = parser.matchPattern(delimiterChangePattern);\n  \tif (!opening) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace (in fact, it's necessary...)\n  \tif (!parser.matchPattern(whitespacePattern)) {\n  \t\treturn null;\n  \t}\n\n  \tclosing = parser.matchPattern(delimiterChangePattern);\n  \tif (!closing) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace before closing '='\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn [opening, closing];\n  }\n\n  var delimiterChangeToken = { t: DELIMCHANGE, exclude: true };\n  function readMustache(parser) {\n  \tvar mustache, i;\n\n  \t// If we're inside a <script> or <style> tag, and we're not\n  \t// interpolating, bug out\n  \tif (parser.interpolate[parser.inside] === false) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < parser.tags.length; i += 1) {\n  \t\tif (mustache = readMustacheOfType(parser, parser.tags[i])) {\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n  }\n\n  function readMustacheOfType(parser, tag) {\n  \tvar start, mustache, reader, i;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\\\\' + tag.open)) {\n  \t\tif (start === 0 || parser.str[start - 1] !== '\\\\') {\n  \t\t\treturn tag.open;\n  \t\t}\n  \t} else if (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \t// delimiter change?\n  \tif (mustache = readDelimiterChange(parser)) {\n  \t\t// find closing delimiter or abort...\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// ...then make the switch\n  \t\ttag.open = mustache[0];\n  \t\ttag.close = mustache[1];\n  \t\tparser.sortMustacheTags();\n\n  \t\treturn delimiterChangeToken;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \t// illegal section closer\n  \tif (parser.matchString('/')) {\n  \t\tparser.pos -= 1;\n  \t\tvar rewind = parser.pos;\n  \t\tif (!readNumberLiteral(parser)) {\n  \t\t\tparser.pos = rewind - tag.close.length;\n  \t\t\tparser.error('Attempted to close a section that wasn\\'t open');\n  \t\t} else {\n  \t\t\tparser.pos = rewind;\n  \t\t}\n  \t}\n\n  \tfor (i = 0; i < tag.readers.length; i += 1) {\n  \t\treader = tag.readers[i];\n\n  \t\tif (mustache = reader(parser, tag)) {\n  \t\t\tif (tag.isStatic) {\n  \t\t\t\tmustache.s = true; // TODO make this `1` instead - more compact\n  \t\t\t}\n\n  \t\t\tif (parser.includeLinePositions) {\n  \t\t\t\tmustache.p = parser.getLinePos(start);\n  \t\t\t}\n\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var attributeNamePattern = /^[^\\s\"'>\\/=]+/;\n  var unquotedAttributeValueTextPattern = /^[^\\s\"'=<>`]+/;\n  function readAttribute(parser) {\n  \tvar attr, name, value;\n\n  \tparser.allowWhitespace();\n\n  \tname = parser.matchPattern(attributeNamePattern);\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \tattr = { name: name };\n\n  \tvalue = readAttributeValue(parser);\n  \tif (value != null) {\n  \t\t// not null/undefined\n  \t\tattr.value = value;\n  \t}\n\n  \treturn attr;\n  }\n\n  function readAttributeValue(parser) {\n  \tvar start, valueStart, startDepth, value;\n\n  \tstart = parser.pos;\n\n  \t// next character must be `=`, `/`, `>` or whitespace\n  \tif (!/[=\\/>\\s]/.test(parser.nextChar())) {\n  \t\tparser.error('Expected `=`, `/`, `>` or whitespace');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tvalueStart = parser.pos;\n  \tstartDepth = parser.sectionDepth;\n\n  \tvalue = readQuotedAttributeValue(parser, \"'\") || readQuotedAttributeValue(parser, '\"') || readUnquotedAttributeValue(parser);\n\n  \tif (value === null) {\n  \t\tparser.error('Expected valid attribute value');\n  \t}\n\n  \tif (parser.sectionDepth !== startDepth) {\n  \t\tparser.pos = valueStart;\n  \t\tparser.error('An attribute value must contain as many opening section tags as closing section tags');\n  \t}\n\n  \tif (!value.length) {\n  \t\treturn '';\n  \t}\n\n  \tif (value.length === 1 && typeof value[0] === 'string') {\n  \t\treturn decodeCharacterReferences(value[0]);\n  \t}\n\n  \treturn value;\n  }\n\n  function readUnquotedAttributeValueToken(parser) {\n  \tvar start, text, haystack, needles, index;\n\n  \tstart = parser.pos;\n\n  \ttext = parser.matchPattern(unquotedAttributeValueTextPattern);\n\n  \tif (!text) {\n  \t\treturn null;\n  \t}\n\n  \thaystack = text;\n  \tneedles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n\n  \tif ((index = getLowestIndex(haystack, needles)) !== -1) {\n  \t\ttext = text.substr(0, index);\n  \t\tparser.pos = start + text.length;\n  \t}\n\n  \treturn text;\n  }\n\n  function readUnquotedAttributeValue(parser) {\n  \tvar tokens, token;\n\n  \tparser.inAttribute = true;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \t}\n\n  \tif (!tokens.length) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n  \treturn tokens;\n  }\n\n  function readQuotedAttributeValue(parser, quoteMark) {\n  \tvar start, tokens, token;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = quoteMark;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \t}\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n\n  \treturn tokens;\n  }\n\n  function readQuotedStringToken(parser, quoteMark) {\n  \tvar start, index, haystack, needles;\n\n  \tstart = parser.pos;\n  \thaystack = parser.remaining();\n\n  \tneedles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n  \tneedles.push(quoteMark);\n\n  \tindex = getLowestIndex(haystack, needles);\n\n  \tif (index === -1) {\n  \t\tparser.error('Quoted attribute value must have a closing quote');\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tparser.pos += index;\n  \treturn haystack.substr(0, index);\n  }\n\n  var tagNamePattern = /^[a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*/;\n  var validTagNameFollower = /^[\\s\\n\\/>]/;\n  var onPattern = /^on/;\n  var proxyEventPattern = /^on-([a-zA-Z\\\\*\\\\.$_][a-zA-Z\\\\*\\\\.$_0-9\\-]+)$/;\n  var reservedEventNames = /^(?:change|reset|teardown|update|construct|config|init|render|unrender|detach|insert)$/;\n  var directives = { 'intro-outro': 't0', intro: 't1', outro: 't2', decorator: 'o' };\n  var exclude = { exclude: true };\n  var disallowedContents;\n  // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission\n  disallowedContents = {\n  \tli: ['li'],\n  \tdt: ['dt', 'dd'],\n  \tdd: ['dt', 'dd'],\n  \tp: 'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(' '),\n  \trt: ['rt', 'rp'],\n  \trp: ['rt', 'rp'],\n  \toptgroup: ['optgroup'],\n  \toption: ['option', 'optgroup'],\n  \tthead: ['tbody', 'tfoot'],\n  \ttbody: ['tbody', 'tfoot'],\n  \ttfoot: ['tbody'],\n  \ttr: ['tr', 'tbody'],\n  \ttd: ['td', 'th', 'tr'],\n  \tth: ['td', 'th', 'tr']\n  };\n\n  function readElement(parser) {\n  \tvar start, element, directiveName, match, addProxyEvent, attribute, directive, selfClosing, children, partials, hasPartials, child, closed, pos, remaining, closingTag;\n\n  \tstart = parser.pos;\n\n  \tif (parser.inside || parser.inAttribute) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString('<')) {\n  \t\treturn null;\n  \t}\n\n  \t// if this is a closing tag, abort straight away\n  \tif (parser.nextChar() === '/') {\n  \t\treturn null;\n  \t}\n\n  \telement = {};\n  \tif (parser.includeLinePositions) {\n  \t\telement.p = parser.getLinePos(start);\n  \t}\n\n  \tif (parser.matchString('!')) {\n  \t\telement.t = DOCTYPE;\n  \t\tif (!parser.matchPattern(/^doctype/i)) {\n  \t\t\tparser.error('Expected DOCTYPE declaration');\n  \t\t}\n\n  \t\telement.a = parser.matchPattern(/^(.+?)>/);\n  \t\treturn element;\n  \t}\n\n  \telement.t = ELEMENT;\n\n  \t// element name\n  \telement.e = parser.matchPattern(tagNamePattern);\n  \tif (!element.e) {\n  \t\treturn null;\n  \t}\n\n  \t// next character must be whitespace, closing solidus or '>'\n  \tif (!validTagNameFollower.test(parser.nextChar())) {\n  \t\tparser.error('Illegal tag name');\n  \t}\n\n  \taddProxyEvent = function (name, directive) {\n  \t\tvar directiveName = directive.n || directive;\n\n  \t\tif (reservedEventNames.test(directiveName)) {\n  \t\t\tparser.pos -= directiveName.length;\n  \t\t\tparser.error('Cannot use reserved event names (change, reset, teardown, update, construct, config, init, render, unrender, detach, insert)');\n  \t\t}\n\n  \t\telement.v[name] = directive;\n  \t};\n\n  \tparser.allowWhitespace();\n\n  \t// directives and attributes\n  \twhile (attribute = readMustache(parser) || readAttribute(parser)) {\n  \t\t// regular attributes\n  \t\tif (attribute.name) {\n  \t\t\t// intro, outro, decorator\n  \t\t\tif (directiveName = directives[attribute.name]) {\n  \t\t\t\telement[directiveName] = processDirective(attribute.value, parser);\n  \t\t\t}\n\n  \t\t\t// on-click etc\n  \t\t\telse if (match = proxyEventPattern.exec(attribute.name)) {\n  \t\t\t\t\tif (!element.v) element.v = {};\n  \t\t\t\t\tdirective = processDirective(attribute.value, parser);\n  \t\t\t\t\taddProxyEvent(match[1], directive);\n  \t\t\t\t} else {\n  \t\t\t\t\tif (!parser.sanitizeEventAttributes || !onPattern.test(attribute.name)) {\n  \t\t\t\t\t\tif (!element.a) element.a = {};\n  \t\t\t\t\t\telement.a[attribute.name] = attribute.value || (attribute.value === '' ? '' : 0);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t}\n\n  \t\t// {{#if foo}}class='foo'{{/if}}\n  \t\telse {\n  \t\t\t\tif (!element.m) element.m = [];\n  \t\t\t\telement.m.push(attribute);\n  \t\t\t}\n\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// allow whitespace before closing solidus\n  \tparser.allowWhitespace();\n\n  \t// self-closing solidus?\n  \tif (parser.matchString('/')) {\n  \t\tselfClosing = true;\n  \t}\n\n  \t// closing angle bracket\n  \tif (!parser.matchString('>')) {\n  \t\treturn null;\n  \t}\n\n  \tvar lowerCaseName = element.e.toLowerCase();\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \tif (!selfClosing && !voidElementNames.test(element.e)) {\n  \t\tparser.elementStack.push(lowerCaseName);\n\n  \t\t// Special case - if we open a script element, further tags should\n  \t\t// be ignored unless they're a closing script element\n  \t\tif (lowerCaseName === 'script' || lowerCaseName === 'style') {\n  \t\t\tparser.inside = lowerCaseName;\n  \t\t}\n\n  \t\tchildren = [];\n  \t\tpartials = create(null);\n\n  \t\tdo {\n  \t\t\tpos = parser.pos;\n  \t\t\tremaining = parser.remaining();\n\n  \t\t\t// if for example we're in an <li> element, and we see another\n  \t\t\t// <li> tag, close the first so they become siblings\n  \t\t\tif (!canContain(lowerCaseName, remaining)) {\n  \t\t\t\tclosed = true;\n  \t\t\t}\n\n  \t\t\t// closing tag\n  \t\t\telse if (closingTag = readClosingTag(parser)) {\n  \t\t\t\t\tclosed = true;\n\n  \t\t\t\t\tvar closingTagName = closingTag.e.toLowerCase();\n\n  \t\t\t\t\t// if this *isn't* the closing tag for the current element...\n  \t\t\t\t\tif (closingTagName !== lowerCaseName) {\n  \t\t\t\t\t\t// rewind parser\n  \t\t\t\t\t\tparser.pos = pos;\n\n  \t\t\t\t\t\t// if it doesn't close a parent tag, error\n  \t\t\t\t\t\tif (! ~parser.elementStack.indexOf(closingTagName)) {\n  \t\t\t\t\t\t\tvar errorMessage = 'Unexpected closing tag';\n\n  \t\t\t\t\t\t\t// add additional help for void elements, since component names\n  \t\t\t\t\t\t\t// might clash with them\n  \t\t\t\t\t\t\tif (voidElementNames.test(closingTagName)) {\n  \t\t\t\t\t\t\t\terrorMessage += ' (<' + closingTagName + '> is a void element - it cannot contain children)';\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tparser.error(errorMessage);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// implicit close by closing section tag. TODO clean this up\n  \t\t\t\telse if (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (child = parser.read(PARTIAL_READERS)) {\n  \t\t\t\t\t\t\tif (partials[child.n]) {\n  \t\t\t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t\t\t\tparser.error('Duplicate partial definition');\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tcleanup(child.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\t\t\t\t\tpartials[child.n] = child.f;\n  \t\t\t\t\t\t\thasPartials = true;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tif (child = parser.read(READERS)) {\n  \t\t\t\t\t\t\t\tchildren.push(child);\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t} while (!closed);\n\n  \t\tif (children.length) {\n  \t\t\telement.f = children;\n  \t\t}\n\n  \t\tif (hasPartials) {\n  \t\t\telement.p = partials;\n  \t\t}\n\n  \t\tparser.elementStack.pop();\n  \t}\n\n  \tparser.inside = null;\n\n  \tif (parser.sanitizeElements && parser.sanitizeElements.indexOf(lowerCaseName) !== -1) {\n  \t\treturn exclude;\n  \t}\n\n  \treturn element;\n  }\n\n  function canContain(name, remaining) {\n  \tvar match, disallowed;\n\n  \tmatch = /^<([a-zA-Z][a-zA-Z0-9]*)/.exec(remaining);\n  \tdisallowed = disallowedContents[name];\n\n  \tif (!match || !disallowed) {\n  \t\treturn true;\n  \t}\n\n  \treturn ! ~disallowed.indexOf(match[1].toLowerCase());\n  }\n\n  var OPEN_COMMENT = '<!--';\n  var CLOSE_COMMENT = '-->';\n  function readHtmlComment(parser) {\n  \tvar start, content, remaining, endIndex, comment;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(OPEN_COMMENT)) {\n  \t\treturn null;\n  \t}\n\n  \tremaining = parser.remaining();\n  \tendIndex = remaining.indexOf(CLOSE_COMMENT);\n\n  \tif (endIndex === -1) {\n  \t\tparser.error('Illegal HTML - expected closing comment sequence (\\'-->\\')');\n  \t}\n\n  \tcontent = remaining.substr(0, endIndex);\n  \tparser.pos += endIndex + 3;\n\n  \tcomment = {\n  \t\tt: COMMENT,\n  \t\tc: content\n  \t};\n\n  \tif (parser.includeLinePositions) {\n  \t\tcomment.p = parser.getLinePos(start);\n  \t}\n\n  \treturn comment;\n  }\n\n  var partialDefinitionSectionPattern = /^#\\s*partial\\s+/;\n  function readPartialDefinitionSection(parser) {\n  \tvar start, name, content, child, closed;\n\n  \tstart = parser.pos;\n\n  \tvar delimiters = parser.standardDelimiters;\n\n  \tif (!parser.matchString(delimiters[0])) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(partialDefinitionSectionPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tname = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-\\/]*/);\n\n  \tif (!name) {\n  \t\tparser.error('expected legal partial name');\n  \t}\n\n  \tif (!parser.matchString(delimiters[1])) {\n  \t\tparser.error('Expected closing delimiter \\'' + delimiters[1] + '\\'');\n  \t}\n\n  \tcontent = [];\n\n  \tdo {\n  \t\t// TODO clean this up\n  \t\tif (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\tif (!child.r === 'partial') {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tn: name,\n  \t\tf: content\n  \t};\n  }\n\n  var _pattern = /[-/\\\\^$*+?.()|[\\]{}]/g;\n  function escapeRegExp(str) {\n  \treturn str.replace(_pattern, '\\\\$&');\n  }\n\n  var startPattern = /^<!--\\s*/;\n  var namePattern = /s*>\\s*([a-zA-Z_$][-a-zA-Z_$0-9]*)\\s*/;\n  var finishPattern = /\\s*-->/;\n  var child;\n  function readPartialDefinitionComment(parser) {\n  \tvar firstPos = parser.pos,\n  \t    open = parser.standardDelimiters[0],\n  \t    close = parser.standardDelimiters[1],\n  \t    content = undefined,\n  \t    closed = undefined;\n\n  \tif (!parser.matchPattern(startPattern) || !parser.matchString(open)) {\n  \t\tparser.pos = firstPos;\n  \t\treturn null;\n  \t}\n\n  \tvar name = parser.matchPattern(namePattern);\n\n  \twarnOnceIfDebug('Inline partial comments are deprecated.\\nUse this...\\n  {{#partial ' + name + '}} ... {{/partial}}\\n\\n...instead of this:\\n  <!-- {{>' + name + '}} --> ... <!-- {{/' + name + '}} -->\\'');\n\n  \t// make sure the rest of the comment is in the correct place\n  \tif (!parser.matchString(close) || !parser.matchPattern(finishPattern)) {\n  \t\tparser.pos = firstPos;\n  \t\treturn null;\n  \t}\n\n  \tcontent = [];\n\n  \tvar endPattern = new RegExp('^<!--\\\\s*' + escapeRegExp(open) + '\\\\s*\\\\/\\\\s*' + name + '\\\\s*' + escapeRegExp(close) + '\\\\s*-->');\n\n  \tdo {\n  \t\tif (parser.matchPattern(endPattern)) {\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('expected closing comment (\\'<!-- ' + open + '/' + name + close + ' -->\\')');\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tf: content,\n  \t\tn: name\n  \t};\n  }\n\n  function readTemplate(parser) {\n  \tvar fragment = [];\n  \tvar partials = create(null);\n  \tvar hasPartials = false;\n\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \twhile (parser.pos < parser.str.length) {\n  \t\tvar pos = parser.pos,\n  \t\t    item = undefined,\n  \t\t    partial = undefined;\n\n  \t\tif (partial = parser.read(PARTIAL_READERS)) {\n  \t\t\tif (partials[partial.n]) {\n  \t\t\t\tparser.pos = pos;\n  \t\t\t\tparser.error('Duplicated partial definition');\n  \t\t\t}\n\n  \t\t\tcleanup(partial.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\tpartials[partial.n] = partial.f;\n  \t\t\thasPartials = true;\n  \t\t} else if (item = parser.read(READERS)) {\n  \t\t\tfragment.push(item);\n  \t\t} else {\n  \t\t\tparser.error('Unexpected template content');\n  \t\t}\n  \t}\n\n  \tvar result = {\n  \t\tv: TEMPLATE_VERSION,\n  \t\tt: fragment\n  \t};\n\n  \tif (hasPartials) {\n  \t\tresult.p = partials;\n  \t}\n\n  \treturn result;\n  }\n\n  var STANDARD_READERS = [readPartial, readUnescaped, readSection, readYielder, readInterpolator, readComment];\n  var TRIPLE_READERS = [readTriple];\n  var STATIC_READERS = [readUnescaped, readSection, readInterpolator]; // TODO does it make sense to have a static section?\n\n  var StandardParser = undefined;\n  function parse(template, options) {\n  \treturn new StandardParser(template, options || {}).result;\n  }\n\n  var READERS = [readMustache, readHtmlComment, readElement, readText];\n  var PARTIAL_READERS = [readPartialDefinitionComment, readPartialDefinitionSection];\n\n  StandardParser = Parser.extend({\n  \tinit: function (str, options) {\n  \t\tvar tripleDelimiters = options.tripleDelimiters || ['{{{', '}}}'],\n  \t\t    staticDelimiters = options.staticDelimiters || ['[[', ']]'],\n  \t\t    staticTripleDelimiters = options.staticTripleDelimiters || ['[[[', ']]]'];\n\n  \t\tthis.standardDelimiters = options.delimiters || ['{{', '}}'];\n\n  \t\tthis.tags = [{ isStatic: false, isTriple: false, open: this.standardDelimiters[0], close: this.standardDelimiters[1], readers: STANDARD_READERS }, { isStatic: false, isTriple: true, open: tripleDelimiters[0], close: tripleDelimiters[1], readers: TRIPLE_READERS }, { isStatic: true, isTriple: false, open: staticDelimiters[0], close: staticDelimiters[1], readers: STATIC_READERS }, { isStatic: true, isTriple: true, open: staticTripleDelimiters[0], close: staticTripleDelimiters[1], readers: TRIPLE_READERS }];\n\n  \t\tthis.sortMustacheTags();\n\n  \t\tthis.sectionDepth = 0;\n  \t\tthis.elementStack = [];\n\n  \t\tthis.interpolate = {\n  \t\t\tscript: !options.interpolate || options.interpolate.script !== false,\n  \t\t\tstyle: !options.interpolate || options.interpolate.style !== false\n  \t\t};\n\n  \t\tif (options.sanitize === true) {\n  \t\t\toptions.sanitize = {\n  \t\t\t\t// blacklist from https://code.google.com/p/google-caja/source/browse/trunk/src/com/google/caja/lang/html/html4-elements-whitelist.json\n  \t\t\t\telements: 'applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title'.split(' '),\n  \t\t\t\teventAttributes: true\n  \t\t\t};\n  \t\t}\n\n  \t\tthis.stripComments = options.stripComments !== false;\n  \t\tthis.preserveWhitespace = options.preserveWhitespace;\n  \t\tthis.sanitizeElements = options.sanitize && options.sanitize.elements;\n  \t\tthis.sanitizeEventAttributes = options.sanitize && options.sanitize.eventAttributes;\n  \t\tthis.includeLinePositions = options.includeLinePositions;\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\t// special case - empty string\n  \t\tif (!result.length) {\n  \t\t\treturn { t: [], v: TEMPLATE_VERSION };\n  \t\t}\n\n  \t\tif (this.sectionDepth > 0) {\n  \t\t\tthis.error('A section was left open');\n  \t\t}\n\n  \t\tcleanup(result[0].t, this.stripComments, this.preserveWhitespace, !this.preserveWhitespace, !this.preserveWhitespace);\n\n  \t\treturn result[0];\n  \t},\n\n  \tconverters: [readTemplate],\n\n  \tsortMustacheTags: function () {\n  \t\t// Sort in order of descending opening delimiter length (longer first),\n  \t\t// to protect against opening delimiters being substrings of each other\n  \t\tthis.tags.sort(function (a, b) {\n  \t\t\treturn b.open.length - a.open.length;\n  \t\t});\n  \t}\n  });\n\n  var parseOptions = ['preserveWhitespace', 'sanitize', 'stripComments', 'delimiters', 'tripleDelimiters', 'interpolate'];\n\n  var parser = {\n  \tfromId: fromId, isHashedId: isHashedId, isParsed: isParsed, getParseOptions: getParseOptions, createHelper: _createHelper,\n  \tparse: doParse\n  };\n\n  function _createHelper(parseOptions) {\n  \tvar helper = create(parser);\n  \thelper.parse = function (template, options) {\n  \t\treturn doParse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function doParse(template, parseOptions) {\n  \tif (!parse) {\n  \t\tthrow new Error('Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser');\n  \t}\n\n  \treturn parse(template, parseOptions || this.options);\n  }\n\n  function fromId(id, options) {\n  \tvar template;\n\n  \tif (!doc) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t}\n\n  \tif (isHashedId(id)) {\n  \t\tid = id.substring(1);\n  \t}\n\n  \tif (!(template = doc.getElementById(id))) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Could not find template element with id #' + id);\n  \t}\n\n  \tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t}\n\n  \treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  }\n\n  function isHashedId(id) {\n  \treturn id && id[0] === '#';\n  }\n\n  function isParsed(template) {\n  \treturn !(typeof template === 'string');\n  }\n\n  function getParseOptions(ractive) {\n  \t// Could be Ractive or a Component\n  \tif (ractive.defaults) {\n  \t\tractive = ractive.defaults;\n  \t}\n\n  \treturn parseOptions.reduce(function (val, key) {\n  \t\tval[key] = ractive[key];\n  \t\treturn val;\n  \t}, {});\n  }\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \tvar partial;\n\n  \t// If the partial in instance or view heirarchy instances, great\n  \tif (partial = getPartialFromRegistry(ractive, name, parentFragment || {})) {\n  \t\treturn partial;\n  \t}\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser.fromId(name, { noThrow: true });\n\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser.parse(partial, parser.getParseOptions(ractive));\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \tvar fn = undefined,\n  \t    partial = findParentPartial(name, parentFragment.owner);\n\n  \t// if there was an instance up-hierarchy, cool\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, parser);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!parser.isParsed(partial)) {\n\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser.parse(partial, parser.getParseOptions(instance));\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) {\n  \t\tpartial._fn = fn;\n  \t}\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  function ______________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Partial = (function (_Mustache) {\n  \t_________________________inherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\t______________________________________classCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.template.r ? getPartialTemplate(this.ractive, this.template.r, this.parentFragment) || null : null;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.template.r) {\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else {\n  \t\t\tthis.setTemplate(this.model.get());\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target) {\n  \t\tthis.fragment.render(target);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model && typeof this.model.get() === 'string' && this.model.get() !== this.name) {\n  \t\t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  var _slicedToArray = (function () {\n  \tfunction sliceIterator(arr, i) {\n  \t\tvar _arr = [];var _n = true;var _d = false;var _e = undefined;try {\n  \t\t\tfor (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n  \t\t\t\t_arr.push(_s.value);if (i && _arr.length === i) break;\n  \t\t\t}\n  \t\t} catch (err) {\n  \t\t\t_d = true;_e = err;\n  \t\t} finally {\n  \t\t\ttry {\n  \t\t\t\tif (!_n && _i['return']) _i['return']();\n  \t\t\t} finally {\n  \t\t\t\tif (_d) throw _e;\n  \t\t\t}\n  \t\t}return _arr;\n  \t}return function (arr, i) {\n  \t\tif (Array.isArray(arr)) {\n  \t\t\treturn arr;\n  \t\t} else if (Symbol.iterator in Object(arr)) {\n  \t\t\treturn sliceIterator(arr, i);\n  \t\t} else {\n  \t\t\tthrow new TypeError('Invalid attempt to destructure non-iterable instance');\n  \t\t}\n  \t};\n  })();\n\n  function _____________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function getRefs(ref, value, parent) {\n  \tvar refs = undefined;\n\n  \tif (ref) {\n  \t\trefs = {};\n  \t\tObject.keys(parent).forEach(function (ref) {\n  \t\t\trefs[ref] = parent[ref];\n  \t\t});\n  \t\trefs[ref] = value;\n  \t} else {\n  \t\trefs = parent;\n  \t}\n\n  \treturn refs;\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\t_____________________________________classCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar _indexRef$split = this.indexRef.split(',');\n\n  \t\t\t\t\tvar _indexRef$split2 = _slicedToArray(_indexRef$split, 2);\n\n  \t\t\t\t\tvar keyRef = _indexRef$split2[0];\n  \t\t\t\t\tvar indexRef = _indexRef$split2[1];\n\n  \t\t\t\t\tthis.keyRef = keyRef;\n  \t\t\t\t\tthis.indexRef = indexRef;\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar parentFragment = this.owner.parentFragment;\n  \t\tvar keyRefs = getRefs(this.keyRef, key, parentFragment.keyRefs);\n  \t\tvar indexRefs = getRefs(this.indexRef, index, parentFragment.indexRefs);\n\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template,\n  \t\t\tindexRefs: indexRefs,\n  \t\t\tkeyRefs: keyRefs\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\treturn this.iterations[iteration.index + 1].firstNode();\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode() : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(context.get())) {\n  \t\t\tthis.iterations.forEach(function (fragment, i) {\n  \t\t\t\tfragment.rebind(context.joinKey(i));\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this2 = this;\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthrow new Error('Section was already shuffled!');\n  \t\t}\n\n  \t\tthis.pendingNewIndices = newIndices;\n  \t\tthis.previousIterations = this.iterations.slice();\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this2.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString$$(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind$$() {\n  \t\tthis.iterations.forEach(unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender$$(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? _unrenderAndDestroy : unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this3 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.context.get();\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n\n  \t\tif (isArray(value)) {\n  \t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t}\n  \t\t} else if (isObject(value)) {\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\tvar i = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar fragment = this.iterations[i];\n  \t\t\t\tif (fragment.key in value) {\n  \t\t\t\t\toldKeys[fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(_update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\t(function () {\n  \t\t\t\tvar docFrag = _this3.rendered ? createDocumentFragment() : null;\n  \t\t\t\tvar i = _this3.iterations.length;\n\n  \t\t\t\tif (isArray(value)) {\n  \t\t\t\t\twhile (i < value.length) {\n  \t\t\t\t\t\tvar fragment = _this3.createIteration(i, i);\n\n  \t\t\t\t\t\t_this3.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this3.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (isObject(value)) {\n  \t\t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\t\tif (!(key in oldKeys)) {\n  \t\t\t\t\t\t\tvar fragment = _this3.createIteration(key, i);\n\n  \t\t\t\t\t\t\t_this3.iterations.push(fragment);\n  \t\t\t\t\t\t\tif (_this3.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\t\ti += 1;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t});\n  \t\t\t\t}\n\n  \t\t\t\tif (_this3.rendered) {\n  \t\t\t\t\tvar parentNode = _this3.parent.findParentNode();\n  \t\t\t\t\tvar anchor = _this3.parent.findNextNode(_this3);\n\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t}\n  \t\t\t})();\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this4 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices;\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar previousNewIndex = -1;\n  \t\tvar reinsertFrom = null;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this4.previousIterations[oldIndex];\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tfragment.rebind(_this4.context.joinKey(newIndex));\n\n  \t\t\t\tif (reinsertFrom === null && newIndex !== previousNewIndex + 1) {\n  \t\t\t\t\treinsertFrom = oldIndex;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tpreviousNewIndex = newIndex;\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar existingFragment = this.iterations[i];\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tif (existingFragment) {\n  \t\t\t\t\tif (reinsertFrom !== null && i >= reinsertFrom) {\n  \t\t\t\t\t\tdocFrag.appendChild(existingFragment.detach());\n  \t\t\t\t\t} else if (docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, existingFragment.firstNode());\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!this.rendered) {\n  \t\t\t\tif (!existingFragment) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(_update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function ____________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ________________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \t________________________inherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\t____________________________________classCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tvar value = this.model.value; // TODO should use this.model.get()... but weirdness around root models\n  \t\t\tvar fragment = undefined;\n\n  \t\t\tif (!this.sectionType) this.sectionType = getType(value, this.template.i);\n\n  \t\t\tif (isEmpty(value) && this.sectionType !== SECTION_WITH) {\n  \t\t\t\t// TODO again, WITH should not render if empty\n  \t\t\t\tif (this.sectionType === SECTION_UNLESS) {\n  \t\t\t\t\tthis.fragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind();\n  \t\t\t\t}\n\n  \t\t\t\t// otherwise, create no children\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (this.sectionType === SECTION_UNLESS) return;\n\n  \t\t\tif (this.sectionType === SECTION_IF) {\n  \t\t\t\tfragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind();\n  \t\t\t}\n\n  \t\t\t// TODO should only be WITH, and it should behave like IF_WITH\n  \t\t\telse if (this.sectionType === SECTION_WITH || this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t} else {\n  \t\t\t\t\tfragment = new RepeatedFragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n\n  \t\t\tthis.fragment = fragment;\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO DRY this out - lot of repeated stuff between this and bind()\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model) return; // TODO can this happen?\n\n  \t\tvar value = this.model.value; // TODO see above - should use .get()\n\n  \t\tif (this.sectionType === null) this.sectionType = getType(value, this.template.i);\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO same comment as before - WITH should be IF_WITH\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value;\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n  var ieBug;\n  var ieBlacklist;\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar container,\n  \t    nodes = [],\n  \t    wrapper,\n  \t    selectedOption,\n  \t    child,\n  \t    i;\n\n  \t// render 0 and false\n  \tif (html != null && html !== '') {\n  \t\tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\t\tcontainer = element('DIV');\n  \t\t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\t\tcontainer = container.querySelector('.x');\n\n  \t\t\tif (container.tagName === 'SELECT') {\n  \t\t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t\t}\n  \t\t} else if (node.namespaceURI === svg) {\n  \t\t\tcontainer = element('DIV');\n  \t\t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\t\tcontainer = container.querySelector('.x');\n  \t\t} else {\n  \t\t\tcontainer = element(node.tagName);\n  \t\t\tcontainer.innerHTML = html;\n\n  \t\t\tif (container.tagName === 'SELECT') {\n  \t\t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t\t}\n  \t\t}\n\n  \t\twhile (child = container.firstChild) {\n  \t\t\tnodes.push(child);\n  \t\t\tdocFrag.appendChild(child);\n  \t\t}\n\n  \t\t// This is really annoying. Extracting <option> nodes from the\n  \t\t// temporary container <select> causes the remaining ones to\n  \t\t// become selected. So now we have to deselect them. IE8, you\n  \t\t// amaze me. You really do\n  \t\t// ...and now Chrome too\n  \t\tif (node.tagName === 'SELECT') {\n  \t\t\ti = nodes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\t\tnodes[i].selected = false;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  function ___________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _______________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Triple = (function (_Mustache) {\n  \t_______________________inherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\t___________________________________classCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn node.parentNode.removeChild(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  function __________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ______________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Yielder = (function (_Item) {\n  \t______________________inherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\t__________________________________classCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthrow new Error('Yielder$rebind is not yet implemented!');\n  \t};\n\n  \tYielder.prototype.render = function render(target) {\n  \t\treturn this.fragment.render(target);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  var exportedShims;\n\n  if (!win) {\n  \texportedShims = null;\n  } else {\n  \texportedShims = {};\n\n  \t// Shims for older browsers\n\n  \tif (!Date.now) {\n  \t\tDate.now = function () {\n  \t\t\treturn +new Date();\n  \t\t};\n  \t}\n\n  \tif (!String.prototype.trim) {\n  \t\tString.prototype.trim = function () {\n  \t\t\treturn this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  \t\t};\n  \t}\n\n  \t// Polyfill for Object.keys\n  \t// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys\n  \tif (!Object.keys) {\n  \t\tObject.keys = (function () {\n  \t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n  \t\t\t    hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n  \t\t\t    dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n  \t\t\t    dontEnumsLength = dontEnums.length;\n\n  \t\t\treturn function (obj) {\n  \t\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n  \t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n  \t\t\t\t}\n\n  \t\t\t\tvar result = [];\n\n  \t\t\t\tfor (var prop in obj) {\n  \t\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\n  \t\t\t\t\t\tresult.push(prop);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif (hasDontEnumBug) {\n  \t\t\t\t\tfor (var i = 0; i < dontEnumsLength; i++) {\n  \t\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\n  \t\t\t\t\t\t\tresult.push(dontEnums[i]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t})();\n  \t}\n\n  \t// TODO: use defineProperty to make these non-enumerable\n\n  \t// Array extras\n  \tif (!Array.prototype.indexOf) {\n  \t\tArray.prototype.indexOf = function (needle, i) {\n  \t\t\tvar len;\n\n  \t\t\tif (i === undefined) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti += this.length;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tfor (len = this.length; i < len; i++) {\n  \t\t\t\tif (this.hasOwnProperty(i) && this[i] === needle) {\n  \t\t\t\t\treturn i;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn -1;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.forEach) {\n  \t\tArray.prototype.forEach = function (callback, context) {\n  \t\t\tvar i, len;\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tcallback.call(context, this[i], i, this);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.map) {\n  \t\tArray.prototype.map = function (mapper, context) {\n  \t\t\tvar array = this,\n  \t\t\t    i,\n  \t\t\t    len,\n  \t\t\t    mapped = [],\n  \t\t\t    isActuallyString;\n\n  \t\t\t// incredibly, if you do something like\n  \t\t\t// Array.prototype.map.call( someString, iterator )\n  \t\t\t// then `this` will become an instance of String in IE8.\n  \t\t\t// And in IE8, you then can't do string[i]. Facepalm.\n  \t\t\tif (array instanceof String) {\n  \t\t\t\tarray = array.toString();\n  \t\t\t\tisActuallyString = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0, len = array.length; i < len; i += 1) {\n  \t\t\t\tif (array.hasOwnProperty(i) || isActuallyString) {\n  \t\t\t\t\tmapped[i] = mapper.call(context, array[i], i, array);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn mapped;\n  \t\t};\n  \t}\n\n  \tif (typeof Array.prototype.reduce !== 'function') {\n  \t\tArray.prototype.reduce = function (callback, opt_initialValue) {\n  \t\t\tvar i, value, len, valueIsSet;\n\n  \t\t\tif ('function' !== typeof callback) {\n  \t\t\t\tthrow new TypeError(callback + ' is not a function');\n  \t\t\t}\n\n  \t\t\tlen = this.length;\n  \t\t\tvalueIsSet = false;\n\n  \t\t\tif (arguments.length > 1) {\n  \t\t\t\tvalue = opt_initialValue;\n  \t\t\t\tvalueIsSet = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tif (valueIsSet) {\n  \t\t\t\t\t\tvalue = callback(value, this[i], i, this);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvalue = this[i];\n  \t\t\t\t\tvalueIsSet = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!valueIsSet) {\n  \t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n  \t\t\t}\n\n  \t\t\treturn value;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.filter) {\n  \t\tArray.prototype.filter = function (filter, context) {\n  \t\t\tvar i,\n  \t\t\t    len,\n  \t\t\t    filtered = [];\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i) && filter.call(context, this[i], i, this)) {\n  \t\t\t\t\tfiltered[filtered.length] = this[i];\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn filtered;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.every) {\n  \t\tArray.prototype.every = function (iterator, context) {\n  \t\t\tvar t, len, i;\n\n  \t\t\tif (this == null) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tt = Object(this);\n  \t\t\tlen = t.length >>> 0;\n\n  \t\t\tif (typeof iterator !== 'function') {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (i in t && !iterator.call(context, t[i], i, t)) {\n  \t\t\t\t\treturn false;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn true;\n  \t\t};\n  \t}\n\n  \tif (typeof Function.prototype.bind !== 'function') {\n  \t\tFunction.prototype.bind = function (context) {\n  \t\t\tvar args,\n  \t\t\t    fn,\n  \t\t\t    Empty,\n  \t\t\t    bound,\n  \t\t\t    slice = [].slice;\n\n  \t\t\tif (typeof this !== 'function') {\n  \t\t\t\tthrow new TypeError('Function.prototype.bind called on non-function');\n  \t\t\t}\n\n  \t\t\targs = slice.call(arguments, 1);\n  \t\t\tfn = this;\n  \t\t\tEmpty = function () {};\n\n  \t\t\tbound = function () {\n  \t\t\t\tvar ctx = this instanceof Empty && context ? this : context;\n  \t\t\t\treturn fn.apply(ctx, args.concat(slice.call(arguments)));\n  \t\t\t};\n\n  \t\t\tEmpty.prototype = this.prototype;\n  \t\t\tbound.prototype = new Empty();\n\n  \t\t\treturn bound;\n  \t\t};\n  \t}\n\n  \t// https://gist.github.com/Rich-Harris/6010282 via https://gist.github.com/jonathantneal/2869388\n  \t// addEventListener polyfill IE6+\n  \tif (!win.addEventListener) {\n  \t\t(function (win, doc) {\n  \t\t\tvar Event, addEventListener, removeEventListener, head, style, origCreateElement;\n\n  \t\t\t// because sometimes inquiring minds want to know\n  \t\t\twin.appearsToBeIELessEqual8 = true;\n\n  \t\t\tEvent = function (e, element) {\n  \t\t\t\tvar property,\n  \t\t\t\t    instance = this;\n\n  \t\t\t\tfor (property in e) {\n  \t\t\t\t\tinstance[property] = e[property];\n  \t\t\t\t}\n\n  \t\t\t\tinstance.currentTarget = element;\n  \t\t\t\tinstance.target = e.srcElement || element;\n  \t\t\t\tinstance.timeStamp = +new Date();\n\n  \t\t\t\tinstance.preventDefault = function () {\n  \t\t\t\t\te.returnValue = false;\n  \t\t\t\t};\n\n  \t\t\t\tinstance.stopPropagation = function () {\n  \t\t\t\t\te.cancelBubble = true;\n  \t\t\t\t};\n  \t\t\t};\n\n  \t\t\taddEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tlisteners = element.listeners || (element.listeners = []);\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\tlisteners[i] = [listener, function (e) {\n  \t\t\t\t\tlistener.call(element, new Event(e, element));\n  \t\t\t\t}];\n\n  \t\t\t\telement.attachEvent('on' + type, listeners[i][1]);\n  \t\t\t};\n\n  \t\t\tremoveEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tif (!element.listeners) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tlisteners = element.listeners;\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\twhile (i--) {\n  \t\t\t\t\tif (listeners[i][0] === listener) {\n  \t\t\t\t\t\telement.detachEvent('on' + type, listeners[i][1]);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\twin.addEventListener = doc.addEventListener = addEventListener;\n  \t\t\twin.removeEventListener = doc.removeEventListener = removeEventListener;\n\n  \t\t\tif ('Element' in win) {\n  \t\t\t\twin.Element.prototype.addEventListener = addEventListener;\n  \t\t\t\twin.Element.prototype.removeEventListener = removeEventListener;\n  \t\t\t} else {\n  \t\t\t\t// First, intercept any calls to document.createElement - this is necessary\n  \t\t\t\t// because the CSS hack (see below) doesn't come into play until after a\n  \t\t\t\t// node is added to the DOM, which is too late for a lot of Ractive setup work\n  \t\t\t\torigCreateElement = doc.createElement;\n\n  \t\t\t\tdoc.createElement = function (tagName) {\n  \t\t\t\t\tvar el = origCreateElement(tagName);\n  \t\t\t\t\tel.addEventListener = addEventListener;\n  \t\t\t\t\tel.removeEventListener = removeEventListener;\n  \t\t\t\t\treturn el;\n  \t\t\t\t};\n\n  \t\t\t\t// Then, mop up any additional elements that weren't created via\n  \t\t\t\t// document.createElement (i.e. with innerHTML).\n  \t\t\t\thead = doc.getElementsByTagName('head')[0];\n  \t\t\t\tstyle = doc.createElement('style');\n\n  \t\t\t\thead.insertBefore(style, head.firstChild);\n\n  \t\t\t\t//style.styleSheet.cssText = '*{-ms-event-prototype:expression(!this.addEventListener&&(this.addEventListener=addEventListener)&&(this.removeEventListener=removeEventListener))}';\n  \t\t\t}\n  \t\t})(win, doc);\n  \t}\n\n  \t// The getComputedStyle polyfill interacts badly with jQuery, so we don't attach\n  \t// it to window. Instead, we export it for other modules to use as needed\n\n  \t// https://github.com/jonathantneal/Polyfills-for-IE8/blob/master/getComputedStyle.js\n  \tif (!win.getComputedStyle) {\n  \t\texportedShims.getComputedStyle = (function () {\n  \t\t\tvar borderSizes = {};\n\n  \t\t\tfunction getPixelSize(element, style, property, fontSize) {\n  \t\t\t\tvar sizeWithSuffix = style[property],\n  \t\t\t\t    size = parseFloat(sizeWithSuffix),\n  \t\t\t\t    suffix = sizeWithSuffix.split(/\\d/)[0],\n  \t\t\t\t    rootSize;\n\n  \t\t\t\tif (isNaN(size)) {\n  \t\t\t\t\tif (/^thin|medium|thick$/.test(sizeWithSuffix)) {\n  \t\t\t\t\t\tsize = getBorderPixelSize(sizeWithSuffix);\n  \t\t\t\t\t\tsuffix = '';\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\t// TODO...\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tfontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;\n  \t\t\t\trootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;\n\n  \t\t\t\treturn suffix == 'em' ? size * fontSize : suffix == 'in' ? size * 96 : suffix == 'pt' ? size * 96 / 72 : suffix == '%' ? size / 100 * rootSize : size;\n  \t\t\t}\n\n  \t\t\tfunction getBorderPixelSize(size) {\n  \t\t\t\tvar div, bcr;\n\n  \t\t\t\t// `thin`, `medium` and `thick` vary between browsers. (Don't ever use them.)\n  \t\t\t\tif (!borderSizes[size]) {\n  \t\t\t\t\tdiv = doc.createElement('div');\n  \t\t\t\t\tdiv.style.display = 'block';\n  \t\t\t\t\tdiv.style.position = 'fixed';\n  \t\t\t\t\tdiv.style.width = div.style.height = '0';\n  \t\t\t\t\tdiv.style.borderRight = size + ' solid black';\n\n  \t\t\t\t\tdoc.getElementsByTagName('body')[0].appendChild(div);\n  \t\t\t\t\tbcr = div.getBoundingClientRect();\n\n  \t\t\t\t\tborderSizes[size] = bcr.right - bcr.left;\n  \t\t\t\t}\n\n  \t\t\t\treturn borderSizes[size];\n  \t\t\t}\n\n  \t\t\tfunction setShortStyleProperty(style, property) {\n  \t\t\t\tvar borderSuffix = property == 'border' ? 'Width' : '',\n  \t\t\t\t    t = property + 'Top' + borderSuffix,\n  \t\t\t\t    r = property + 'Right' + borderSuffix,\n  \t\t\t\t    b = property + 'Bottom' + borderSuffix,\n  \t\t\t\t    l = property + 'Left' + borderSuffix;\n\n  \t\t\t\tstyle[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]] : style[t] == style[b] && style[l] == style[r] ? [style[t], style[r]] : style[l] == style[r] ? [style[t], style[r], style[b]] : [style[t], style[r], style[b], style[l]]).join(' ');\n  \t\t\t}\n\n  \t\t\tvar normalProps = {\n  \t\t\t\tfontWeight: 400,\n  \t\t\t\tlineHeight: 1.2, // actually varies depending on font-family, but is generally close enough...\n  \t\t\t\tletterSpacing: 0\n  \t\t\t};\n\n  \t\t\tfunction CSSStyleDeclaration(element) {\n  \t\t\t\tvar currentStyle, style, fontSize, property;\n\n  \t\t\t\tcurrentStyle = element.currentStyle;\n  \t\t\t\tstyle = this;\n  \t\t\t\tfontSize = getPixelSize(element, currentStyle, 'fontSize', null);\n\n  \t\t\t\t// TODO tidy this up, test it, send PR to jonathantneal!\n  \t\t\t\tfor (property in currentStyle) {\n  \t\t\t\t\tif (currentStyle[property] === 'normal' && normalProps.hasOwnProperty(property)) {\n  \t\t\t\t\t\tstyle[property] = normalProps[property];\n  \t\t\t\t\t} else if (/width|height|margin.|padding.|border.+W/.test(property)) {\n  \t\t\t\t\t\tif (currentStyle[property] === 'auto') {\n  \t\t\t\t\t\t\tif (/^width|height/.test(property)) {\n  \t\t\t\t\t\t\t\t// just use clientWidth/clientHeight...\n  \t\t\t\t\t\t\t\tstyle[property] = (property === 'width' ? element.clientWidth : element.clientHeight) + 'px';\n  \t\t\t\t\t\t\t} else if (/(?:padding)?Top|Bottom$/.test(property)) {\n  \t\t\t\t\t\t\t\tstyle[property] = '0px';\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tstyle[property] = getPixelSize(element, currentStyle, property, fontSize) + 'px';\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (property === 'styleFloat') {\n  \t\t\t\t\t\tstyle.float = currentStyle[property];\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tstyle[property] = currentStyle[property];\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tsetShortStyleProperty(style, 'margin');\n  \t\t\t\tsetShortStyleProperty(style, 'padding');\n  \t\t\t\tsetShortStyleProperty(style, 'border');\n\n  \t\t\t\tstyle.fontSize = fontSize + 'px';\n\n  \t\t\t\treturn style;\n  \t\t\t}\n\n  \t\t\tCSSStyleDeclaration.prototype = {\n  \t\t\t\tconstructor: CSSStyleDeclaration,\n  \t\t\t\tgetPropertyPriority: noop,\n  \t\t\t\tgetPropertyValue: function (prop) {\n  \t\t\t\t\treturn this[prop] || '';\n  \t\t\t\t},\n  \t\t\t\titem: noop,\n  \t\t\t\tremoveProperty: noop,\n  \t\t\t\tsetProperty: noop,\n  \t\t\t\tgetPropertyCSSValue: noop\n  \t\t\t};\n\n  \t\t\tfunction getComputedStyle(element) {\n  \t\t\t\treturn new CSSStyleDeclaration(element);\n  \t\t\t}\n\n  \t\t\treturn getComputedStyle;\n  \t\t})();\n  \t}\n  }\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var __prefix;\n  var prefixCache;\n  var _testStyle;\n  if (!isClient) {\n  \t__prefix = null;\n  } else {\n  \tprefixCache = {};\n  \t_testStyle = createElement('div').style;\n\n  \t__prefix = function (prop) {\n  \t\tvar i, vendor, capped;\n\n  \t\tprop = camelCase(prop);\n\n  \t\tif (!prefixCache[prop]) {\n  \t\t\tif (_testStyle[prop] !== undefined) {\n  \t\t\t\tprefixCache[prop] = prop;\n  \t\t\t} else {\n  \t\t\t\t// test vendors...\n  \t\t\t\tcapped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\ti = vendors.length;\n  \t\t\t\twhile (i--) {\n  \t\t\t\t\tvendor = vendors[i];\n  \t\t\t\t\tif (_testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\tbreak;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn prefixCache[prop];\n  \t};\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  var queue = [];\n\n  var animations = {\n  \ttick: function () {\n  \t\tvar i, animation, now;\n\n  \t\tnow = getTime();\n\n  \t\trunloop.start();\n\n  \t\tfor (i = 0; i < queue.length; i += 1) {\n  \t\t\tanimation = queue[i];\n\n  \t\t\tif (!animation.tick(now)) {\n  \t\t\t\t// animation is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\t\tqueue.splice(i--, 1);\n  \t\t\t}\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tif (queue.length) {\n  \t\t\trequestAnimationFrame(animations.tick);\n  \t\t} else {\n  \t\t\tanimations.running = false;\n  \t\t}\n  \t},\n\n  \tadd: function (animation) {\n  \t\tqueue.push(animation);\n\n  \t\tif (!animations.running) {\n  \t\t\tanimations.running = true;\n  \t\t\trequestAnimationFrame(animations.tick);\n  \t\t}\n  \t},\n\n  \t// TODO optimise this\n  \tabort: function (model, root) {\n  \t\tvar i = queue.length,\n  \t\t    animation;\n\n  \t\twhile (i--) {\n  \t\t\tanimation = queue[i];\n\n  \t\t\tif (animation.root === root && animation.model === model) {\n  \t\t\t\tanimation.stop();\n  \t\t\t}\n  \t\t}\n  \t}\n  };\n\n  // TODO what happens if a transition is aborted?\n  // TODO use this with Animation to dedupe some code?\n\n  var Ticker = function (options) {\n  \tvar easing;\n\n  \tthis.duration = options.duration;\n  \tthis.step = options.step;\n  \tthis.complete = options.complete;\n\n  \t// easing\n  \tif (typeof options.easing === 'string') {\n  \t\teasing = options.root.easing[options.easing];\n\n  \t\tif (!easing) {\n  \t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\teasing = linear;\n  \t\t}\n  \t} else if (typeof options.easing === 'function') {\n  \t\teasing = options.easing;\n  \t} else {\n  \t\teasing = linear;\n  \t}\n\n  \tthis.easing = easing;\n\n  \tthis.start = getTime();\n  \tthis.end = this.start + this.duration;\n\n  \tthis.running = true;\n  \tanimations.add(this);\n  };\n\n  Ticker.prototype = {\n  \ttick: function (now) {\n  \t\tvar elapsed, eased;\n\n  \t\tif (!this.running) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) {\n  \t\t\t\tthis.step(1);\n  \t\t\t}\n\n  \t\t\tif (this.complete) {\n  \t\t\t\tthis.complete(1);\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\telapsed = now - this.start;\n  \t\teased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) {\n  \t\t\tthis.step(eased);\n  \t\t}\n\n  \t\treturn true;\n  \t},\n\n  \tstop: function () {\n  \t\tif (this.abort) {\n  \t\t\tthis.abort();\n  \t\t}\n\n  \t\tthis.running = false;\n  \t}\n  };\n\n  function linear(t) {\n  \treturn t;\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var interpolate = function (from, to, ractive, type) {\n  \tif (from === to) {\n  \t\treturn snap(to);\n  \t}\n\n  \tif (type) {\n\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) {\n  \t\t\treturn interpol(from, to) || snap(to);\n  \t\t}\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators.number(from, to) || interpolators.array(from, to) || interpolators.object(from, to) || snap(to);\n  };\n\n  function snap(to) {\n  \treturn function () {\n  \t\treturn to;\n  \t};\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tvar hyphenated;\n\n  \tif (!str) {\n  \t\treturn ''; // edge case\n  \t}\n\n  \tif (vendorPattern.test(str)) {\n  \t\tstr = '-' + str;\n  \t}\n\n  \thyphenated = str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n\n  \treturn hyphenated;\n  }\n\n  var createTransitions;\n  var testStyle;\n  var TRANSITION;\n  var TRANSITIONEND;\n  var CSS_TRANSITIONS_ENABLED;\n  var TRANSITION_DURATION;\n  var TRANSITION_PROPERTY;\n  var TRANSITION_TIMING_FUNCTION;\n  var canUseCssTransitions = {};\n  var cannotUseCssTransitions = {};\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \ttestStyle = createElement('div').style;\n\n  \t// determine some facts about our environment\n  \t(function () {\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n  \t})();\n\n  \tif (TRANSITION) {\n  \t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t}\n\n  \tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t// TODO use a fastdom-style mechanism?\n  \t\tsetTimeout(function () {\n\n  \t\t\tvar hashPrefix, jsTransitionsComplete, cssTransitionsComplete, checkComplete, transitionEndHandler;\n\n  \t\t\tcheckComplete = function () {\n  \t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\tt.root.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\tresolve();\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t// which properties\n  \t\t\thashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(__prefix).map(hyphenate).join(',');\n  \t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\ttransitionEndHandler = function (event) {\n  \t\t\t\tvar index;\n\n  \t\t\t\tindex = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\tif (index !== -1) {\n  \t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t}\n\n  \t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t// still transitioning...\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\tcheckComplete();\n  \t\t\t};\n\n  \t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar i = changedProperties.length,\n  \t\t\t\t    hash,\n  \t\t\t\t    originalValue,\n  \t\t\t\t    index,\n  \t\t\t\t    propertiesToTransitionInJs = [],\n  \t\t\t\t    prop,\n  \t\t\t\t    suffix;\n\n  \t\t\t\twhile (i--) {\n  \t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\tt.node.style[__prefix(prop)] = to[prop];\n\n  \t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\tt.node.style[__prefix(prop)] = originalValue;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n\n  \t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\tname: __prefix(prop),\n  \t\t\t\t\t\t\tinterpolator: interpolate(parseFloat(originalValue), parseFloat(to[prop])),\n  \t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t});\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// javascript transitions\n  \t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\troot: t.root,\n  \t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\teasing: camelCase(options.easing || ''),\n  \t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\tvar prop, i;\n\n  \t\t\t\t\t\t\ti = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\tprop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\tt.node.style[prop.name] = prop.interpolator(pos) + prop.suffix;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t}\n  \t\t\t\t\t});\n  \t\t\t\t} else {\n  \t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n  \t\t\t}, 0);\n  \t\t}, options.delay || 0);\n  \t};\n  }\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar _prefix = undefined;\n\n  \tif (hidden in doc) {\n  \t\t_prefix = '';\n  \t} else {\n  \t\tvar i = vendors.length;\n  \t\twhile (i--) {\n  \t\t\tvar vendor = vendors[i];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\t_prefix = vendor;\n  \t\t\t\tdoc.addEventListener(_prefix + 'visibilitychange', onChange);\n  \t\t\t\tonChange();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (_prefix === undefined) {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  function _________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var getComputedStyle = win && (win.getComputedStyle || exportedShims.getComputedStyle);\n  var resolved = _Promise.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\t_________________________________classCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\tvar promise = new _Promise(function (resolve) {\n  \t\t\tvar propertyNames, changedProperties, computedStyle, current, from, i, prop;\n\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tresolve();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tpropertyNames = Object.keys(to);\n  \t\t\tchangedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tcomputedStyle = getComputedStyle(_this.node);\n\n  \t\t\tfrom = {};\n  \t\t\ti = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = propertyNames[i];\n  \t\t\t\tcurrent = computedStyle[__prefix(prop)];\n\n  \t\t\t\tif (current === '0px') {\n  \t\t\t\t\tcurrent = 0;\n  \t\t\t\t}\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[__prefix(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tresolve();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions(_this, to, options, changedProperties, resolve);\n  \t\t});\n\n  \t\treturn promise;\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle, styles, i, prop, value;\n\n  \t\tcomputedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvalue = computedStyle[__prefix(props)];\n  \t\t\tif (value === '0px') {\n  \t\t\t\tvalue = 0;\n  \t\t\t}\n  \t\t\treturn value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tstyles = {};\n\n  \t\ti = props.length;\n  \t\twhile (i--) {\n  \t\t\tprop = props[i];\n  \t\t\tvalue = computedStyle[__prefix(prop)];\n  \t\t\tif (value === '0px') {\n  \t\t\t\tvalue = 0;\n  \t\t\t}\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn _extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tvar prop;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[__prefix(style)] = value;\n  \t\t} else {\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[__prefix(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node, originalStyle, completed;\n\n  \t\tnode = this.node = this.owner.node;\n  \t\toriginalStyle = node.getAttribute('style');\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.root, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function _updateLiveQueries(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function ________________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n\n  \t\t________________________________classCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  function _______________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _____________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function handleBlur() {\n  \tvar value;\n\n  \thandleDomEvent.call(this);\n\n  \tvalue = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \t_____________________inherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\t_______________________________classCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  function ______________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ____________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var SingleSelectBinding = (function (_Binding) {\n  \t____________________inherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\t______________________________classCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options, i, len, option, optionValue;\n\n  \t\toptions = this.node.options;\n  \t\tlen = options.length;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\toption = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\toptionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\treturn optionValue;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  function _____________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ___________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var MultipleSelectBinding = (function (_Binding) {\n  \t___________________inherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\t_____________________________classCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  function ____________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function __________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var NumericBinding = (function (_GenericBinding) {\n  \t__________________inherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\t____________________________classCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  function ___________________________classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _________________inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n    }subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var FileListBinding = (function (_Binding) {\n    _________________inherits(FileListBinding, _Binding);\n\n    function FileListBinding() {\n      ___________________________classCallCheck(this, FileListBinding);\n\n      _Binding.apply(this, arguments);\n    }\n\n    return FileListBinding;\n  })(Binding);\n\n  function __________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ________________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var CheckboxBinding = (function (_Binding) {\n  \t________________inherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\t__________________________classCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  function _________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _______________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \t_______________inherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\t_________________________classCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\t// TODO this should use getBindingGroup\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  function ________________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var groups = {};\n  function getBindingGroup(id, group, model, getValue) {\n  \tvar hash = id + group + model.getKeypath();\n  \treturn groups[hash] || (groups[hash] = new BindingGroup(model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(model, getValue) {\n  \t\t________________________classCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.getValue = getValue;\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  function _______________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ______________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function isChecked(binding) {\n  \treturn binding.node.checked;\n  }\n\n  function getValue(binding) {\n  \treturn binding.element.getAttribute('value');\n  }\n\n  function _getGroupValue() {\n  \treturn this.bindings.filter(isChecked).map(getValue);\n  }\n\n  var push = [].push;\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \t______________inherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\t_______________________classCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tvar existingValue, bindingValue;\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup(this.ractive._guid, 'checkboxes', this.model, _getGroupValue);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\texistingValue = this.model.get();\n  \t\t\tbindingValue = this.element.getAttribute('value');\n\n  \t\t\tpush.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true;\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.getValue();\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  function ______________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _____________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function getGroupValue() {\n  \tvar i = this.bindings.length;\n  \twhile (i--) {\n  \t\tvar binding = this.bindings[i];\n  \t\tif (binding.node.checked) return binding.element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \t_____________inherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\t______________________classCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup(this.ractive._guid, 'radioname', this.model, getGroupValue);\n  \t\tthis.group.add(this);\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  function _____________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ____________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var ContentEditableBinding = (function (_Binding) {\n  \t____________inherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\t_____________________classCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn FileListBinding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = keypath.split('.');\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  function ____________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function defaultHandler(event) {\n  \tvar handler = this._ractive.events[event.type];\n\n  \thandler.fire({\n  \t\tnode: this,\n  \t\toriginal: event\n  \t});\n  }\n\n  var EventHandler = (function () {\n  \tfunction EventHandler(owner, name, template) {\n  \t\t____________________classCallCheck(this, EventHandler);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.owner = owner;\n  \t\tthis.name = name;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.node = null;\n  \t}\n\n  \tEventHandler.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\tthis.context = fragment.context;\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\tthis.resolvers = [];\n  \t\t\tthis.models = template.a.r.map(function (ref, i) {\n  \t\t\t\tif (/^event(?:\\.(.+))?$/.test(ref)) {\n  \t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\treturn {\n  \t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\tkeys: ref.length > 5 ? ref.slice(6).split('.') : [],\n  \t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t};\n  \t\t\t\t}\n\n  \t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n\n  \t\t\t\tif (!model) {\n  \t\t\t\t\t(function () {\n  \t\t\t\t\t\tvar resolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t})();\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t});\n\n  \t\t\tthis.argsFn = createFunction(template.a.s, template.a.r.length);\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventHandler.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventHandler.prototype.fire = function fire(event) {\n  \t\t// augment event object\n  \t\tevent.keypath = this.context.getKeypath();\n  \t\tevent.context = this.context.get();\n  \t\tevent.index = this.parentFragment.indexRefs;\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\tif (!model) return undefined;\n\n  \t\t\t\tif (model.event) {\n  \t\t\t\t\tvar obj = event;\n  \t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\treturn obj;\n  \t\t\t\t}\n\n  \t\t\t\tif (model.wrapper) {\n  \t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t}\n\n  \t\t\t\treturn model.get();\n  \t\t\t});\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar oldEvent = this.ractive.event;\n  \t\t\tthis.ractive.event = event;\n\n  \t\t\tvar args = this.argsFn.apply(null, values);\n  \t\t\tthis.ractive[this.method].apply(this.ractive, args);\n\n  \t\t\tthis.ractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tevent.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventHandler.prototype.rebind = function rebind() {\n  \t\tthrow new Error('EventHandler$rebind not yet implemented!'); // TODO add tests\n  \t};\n\n  \tEventHandler.prototype.render = function render() {\n  \t\tvar _this2 = this;\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar fn = findInViewHierarchy('events', this.ractive, this.name);\n\n  \t\tif (fn) {\n  \t\t\tvar fire = function (event) {\n  \t\t\t\treturn _this2.fire(event);\n  \t\t\t};\n  \t\t\tthis.customHandler = fn(this.node, fire);\n  \t\t} else {\n  \t\t\t// no plugin - most likely a standard DOM event\n  \t\t\tif (!('on' + this.name in this.node)) {\n  \t\t\t\tmissingPlugin(this.name, 'events');\n  \t\t\t}\n\n  \t\t\tthis.node._ractive.events[this.name] = this;\n  \t\t\tthis.node.addEventListener(this.name, defaultHandler, false);\n  \t\t}\n  \t};\n\n  \tEventHandler.prototype.unbind = function unbind$$() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.resolvers.forEach(unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models.forEach(function (model) {\n  \t\t\t\tif (model) model.unbind();\n  \t\t\t});\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventHandler.prototype.unrender = function unrender() {\n  \t\tif (this.customHandler) {\n  \t\t\tthis.customHandler.teardown();\n  \t\t} else {\n  \t\t\tthis.node.removeEventListener(this.name, defaultHandler, false);\n  \t\t\tthis.node._ractive.events[this.name] = null;\n  \t\t}\n  \t};\n\n  \tEventHandler.prototype.update = function update() {\n  \t\tif (this.method) return; // nothing to do\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n  \t};\n\n  \treturn EventHandler;\n  })();\n\n  function ___________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\t___________________classCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\tmissingPlugin(this.name, 'decorators');\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tthis.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (this.dynamicName) {\n  \t\t\tvar _name = this.nameFragment.toString();\n\n  \t\t\tif (_name !== this.name) {\n  \t\t\t\tthis.name = _name;\n  \t\t\t\tthis.unrender();\n  \t\t\t\tthis.render();\n  \t\t\t}\n  \t\t} else if (this.intermediary.update) {\n  \t\t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t} else {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  function __________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ___________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var div = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \t___________inherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\t__________________classCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthrow new Error('ConditionalAttribute$rebind is not yet implemented'); // TODO test\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\t(function () {\n  \t\t\t\t\tvar str = _this.fragment.toString();\n  \t\t\t\t\tvar attrs = parseAttributes(str, _this.isSvg);\n\n  \t\t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t\t// must be removed\n  \t\t\t\t\t_this.attributes.filter(function (a) {\n  \t\t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t\t});\n\n  \t\t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.attributes = attrs;\n  \t\t\t\t})();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \tdiv.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>';\n\n  \treturn toArray(div.childNodes[0].attributes);\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n  \tvar namespace = attribute.namespace;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === html)) return updateClassName;\n\n  \tif (attribute.useProperty) return updateProperty;\n\n  \tif (attribute.namespace) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateProperty() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tthis.node[this.propertyName] = this.getValue();\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name, safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \t'accesskey': 'accessKey',\n  \t'bgcolor': 'bgColor',\n  \t'class': 'className',\n  \t'codebase': 'codeBase',\n  \t'colspan': 'colSpan',\n  \t'contenteditable': 'contentEditable',\n  \t'datetime': 'dateTime',\n  \t'dirname': 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \t'ismap': 'isMap',\n  \t'maxlength': 'maxLength',\n  \t'novalidate': 'noValidate',\n  \t'pubdate': 'pubDate',\n  \t'readonly': 'readOnly',\n  \t'rowspan': 'rowSpan',\n  \t'tabindex': 'tabIndex',\n  \t'usemap': 'useMap'\n  };\n\n  function determineNameAndNamespace (attribute, name) {\n  \tvar colonIndex, namespacePrefix;\n\n  \t// are we dealing with a namespaced attribute, e.g. xlink:href?\n  \tcolonIndex = name.indexOf(':');\n  \tif (colonIndex !== -1) {\n\n  \t\t// looks like we are, yes...\n  \t\tnamespacePrefix = name.substr(0, colonIndex);\n\n  \t\t// ...unless it's a namespace *declaration*, which we ignore (on the assumption\n  \t\t// that only valid namespaces will be used)\n  \t\tif (namespacePrefix !== 'xmlns') {\n  \t\t\tname = name.substring(colonIndex + 1);\n\n  \t\t\tattribute.name = name;\n  \t\t\tattribute.namespace = _namespaces[namespacePrefix.toLowerCase()];\n  \t\t\tattribute.namespacePrefix = namespacePrefix;\n\n  \t\t\tif (!attribute.namespace) {\n  \t\t\t\tthrow 'Unknown namespace (\"' + namespacePrefix + '\")';\n  \t\t\t}\n\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tattribute.name = name;\n  }\n\n  function _________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function __________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Attribute = (function (_Item) {\n  \t__________inherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\t_________________classCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tdetermineNameAndNamespace(this, options.name);\n\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === html) {\n  \t\t\tvar propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[propertyName] !== undefined) {\n  \t\t\t\tthis.propertyName = propertyName;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\tif (propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || (this.element.name === 'select' || this.element.name === 'textarea'))) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case – bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator) {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  function ________________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function _makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \t_________inherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\t________________classCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\t_this.eventHandlers.push(new EventHandler(_this, eventName, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(_bind);\n  \t\tthis.conditionalAttributes.forEach(_bind);\n  \t\tthis.eventHandlers.forEach(_bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n\n  \t\tvar parentNode = this.node.parentNode;\n  \t\tif (parentNode) parentNode.removeChild(this.node);\n\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind$$() {\n  \t\tthis.attributes.forEach(rebind);\n  \t\tthis.conditionalAttributes.forEach(rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(_makeDirty);\n  \t};\n\n  \tElement.prototype.render = function render(target) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\tthis.node = node;\n\n  \t\tvar context = this.parentFragment.findContext();\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tractive: this.ractive,\n  \t\t\t\tfragment: this.parentFragment,\n  \t\t\t\tevents: {},\n  \t\t\t\tcontext: context,\n  \t\t\t\tkeypath: context.getKeypath()\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.render(node);\n  \t\t}\n\n  \t\tthis.attributes.forEach(_render);\n  \t\tthis.conditionalAttributes.forEach(_render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(_render);\n\n  \t\t_updateLiveQueries(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\ttarget.appendChild(node);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind$$() {\n  \t\tthis.attributes.forEach(unbind);\n  \t\tthis.conditionalAttributes.forEach(unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender$$(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.attributes.forEach(_update);\n  \t\t\tthis.conditionalAttributes.forEach(_update);\n  \t\t\tthis.eventHandlers.forEach(_update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  function _______________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ________inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Input = (function (_Element) {\n  \t________inherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\t_______________classCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  function ______________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _______inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \t_______inherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\t______________classCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.sync();\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function _____________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ______inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \t______inherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\t_____________classCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f;\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  function ____________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _____inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Form = (function (_Element) {\n  \t_____inherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\t____________classCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(updateModel);\n  \trunloop.end();\n  }\n\n  function updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  var css;\n  var update;\n  var styleElement;\n  var head;\n  var styleSheet;\n  var inDom;\n  var prefix = '/* Ractive.js component styles */\\n';\n  var styles = [];\n  var dirty = false;\n  if (!doc) {\n  \t// TODO handle encapsulated CSS in server-rendered HTML!\n  \tcss = {\n  \t\tadd: noop,\n  \t\tapply: noop\n  \t};\n  } else {\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \thead = doc.getElementsByTagName('head')[0];\n\n  \tinDom = false;\n\n  \t// Internet Exploder won't let you use styleSheet.innerHTML - we have to\n  \t// use styleSheet.cssText instead\n  \tstyleSheet = styleElement.styleSheet;\n\n  \tupdate = function () {\n  \t\tvar css = prefix + styles.map(function (s) {\n  \t\t\treturn '\\n/* {' + s.id + '} */\\n' + s.styles;\n  \t\t}).join('\\n');\n\n  \t\tif (styleSheet) {\n  \t\t\tstyleSheet.cssText = css;\n  \t\t} else {\n  \t\t\tstyleElement.innerHTML = css;\n  \t\t}\n\n  \t\tif (!inDom) {\n  \t\t\thead.appendChild(styleElement);\n  \t\t\tinDom = true;\n  \t\t}\n  \t};\n\n  \tcss = {\n  \t\tadd: function (s) {\n  \t\t\tstyles.push(s);\n  \t\t\tdirty = true;\n  \t\t},\n\n  \t\tapply: function () {\n  \t\t\tif (dirty) {\n  \t\t\t\tupdate();\n  \t\t\t\tdirty = false;\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  var _renderHook = new Hook('render');\n  var _completeHook = new Hook('complete');\n  function render(ractive, target, anchor) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn _renderHook.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) css.apply();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn _completeHook.fire(ractive);\n  \t});\n  }\n\n  function ___________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\tfire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\t___________classCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\tfire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function extend(Parent, proto, options) {\n  \t\tvar template;\n\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\ttemplate = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseIfString(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function init(Parent, ractive, options) {\n  \t\tvar template, fn;\n\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\ttemplate = 'template' in options ? options.template : Parent.prototype.template;\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tfn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseIfString(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive),\n  \t\t    parsed;\n\n  \t\tif (result) {\n  \t\t\tparsed = parseIfString(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template,\n  \t    result;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tresult = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\tresult = parseIfString(result, ractive);\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \tvar helper = createHelper(parser.getParseOptions(ractive));\n  \treturn fn.call(ractive, helper);\n  }\n\n  function createHelper(parseOptions) {\n  \tvar helper = create(parser);\n  \thelper.parse = function (template, options) {\n  \t\treturn parser.parse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function parseIfString(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// ID of an element containing the template?\n  \t\tif (template[0] === '#') {\n  \t\t\ttemplate = parser.fromId(template);\n  \t\t}\n\n  \t\ttemplate = parse(template, parser.getParseOptions(ractive));\n  \t}\n\n  \t// Check that the template even exists\n  \telse if (template == undefined) {\n  \t\t\tthrow new Error('The template cannot be ' + template + '.');\n  \t\t}\n\n  \t\t// Check the parsed template has a version at all\n  \t\telse if (typeof template.v !== 'number') {\n  \t\t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t\t}\n\n  \t\t\t// Check we're using the correct version\n  \t\t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t\t}\n\n  \treturn template;\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined,\n  \t\t    value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = __combine(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = __combine(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') {\n  \t\t\tresult = result.call(ractive);\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function __combine(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>\\~:]))+)((?::[^\\s\\+\\>\\~\\(]+(?:\\([^\\)]+\\))?)?\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var mediaQueryPattern = /^@media/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n  function transformCss(css, id) {\n  \tvar transformed, dataAttr, addGuid;\n\n  \tdataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \taddGuid = function (selector) {\n  \t\tvar selectorUnits,\n  \t\t    match,\n  \t\t    unit,\n  \t\t    base,\n  \t\t    prepended,\n  \t\t    appended,\n  \t\t    i,\n  \t\t    transformed = [];\n\n  \t\tselectorUnits = [];\n\n  \t\twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\t\tselectorUnits.push({\n  \t\t\t\tstr: match[0],\n  \t\t\t\tbase: match[1],\n  \t\t\t\tmodifiers: match[2]\n  \t\t\t});\n  \t\t}\n\n  \t\t// For each simple selector within the selector, we need to create a version\n  \t\t// that a) combines with the id, and b) is inside the id\n  \t\tbase = selectorUnits.map(extractString);\n\n  \t\ti = selectorUnits.length;\n  \t\twhile (i--) {\n  \t\t\tappended = base.slice();\n\n  \t\t\t// Pseudo-selectors should go after the attribute selector\n  \t\t\tunit = selectorUnits[i];\n  \t\t\tappended[i] = unit.base + dataAttr + unit.modifiers || '';\n\n  \t\t\tprepended = base.slice();\n  \t\t\tprepended[i] = dataAttr + ' ' + prepended[i];\n\n  \t\t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t\t}\n\n  \t\treturn transformed.join(', ');\n  \t};\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\tvar selectors, transformed;\n\n  \t\t\t// don't transform media queries!\n  \t\t\tif (mediaQueryPattern.test($1)) return match;\n\n  \t\t\tselectors = $1.split(',').map(trim);\n  \t\t\ttransformed = selectors.map(addGuid).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  function trim(str) {\n  \tif (str.trim) {\n  \t\treturn str.trim();\n  \t}\n\n  \treturn str.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  var _uid = 1;\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \textend: function (Parent, proto, options) {\n  \t\tif (options.css) {\n  \t\t\tvar id = _uid++;\n  \t\t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\t\tproto.cssId = id;\n  \t\t\tcss.add({ id: id, styles: styles });\n  \t\t}\n  \t},\n\n  \tinit: function () {}\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = _combine(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function _combine(a, b) {\n  \tvar c = a.slice(),\n  \t    i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var _registryNames;\n  var Registry;\n  var registries;\n  _registryNames = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  Registry = function (name, useDefaults) {\n  \tthis.name = name;\n  \tthis.useDefaults = useDefaults;\n  };\n\n  Registry.prototype = {\n  \tconstructor: Registry,\n\n  \textend: function (Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t},\n\n  \tinit: function () {\n  \t\t/*this.configure(\n    \tthis.useDefaults ? Parent.defaults : Parent,\n    \tractive,\n    \toptions );*/\n  \t},\n\n  \tconfigure: function (Parent, target, options) {\n  \t\tvar name = this.name,\n  \t\t    option = options[name],\n  \t\t    registry;\n\n  \t\tregistry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n  \t\treturn changed;\n  \t}\n  };\n\n  registries = _registryNames.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) {\n  \t\treturn method;\n  \t}\n\n  \tvar wrapper = function wrapSuper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name),\n  \t\t    hasSuper = ('_super' in this),\n  \t\t    oldSuper = this._super,\n  \t\t    result;\n\n  \t\tthis._super = superMethod;\n\n  \t\tresult = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t};\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tvar value, method;\n\n  \tif (name in parent) {\n  \t\tvalue = parent[name];\n\n  \t\tif (typeof value === 'function') {\n  \t\t\tmethod = value;\n  \t\t} else {\n  \t\t\tmethod = function returnValue() {\n  \t\t\t\treturn value;\n  \t\t\t};\n  \t\t}\n  \t} else {\n  \t\tmethod = noop;\n  \t}\n\n  \treturn method;\n  }\n\n  var config;\n  var order;\n  var defaultKeys;\n  var custom;\n  var isBlacklisted;\n  var isStandardKey;\n  custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  defaultKeys = Object.keys(defaultOptions);\n\n  isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n\n  \t\tcomputation.init();\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\t// TODO ractive.template is always truthy, because of the defaults...\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds,\n  \t\t\tindexRefs: options.indexRefs || {},\n  \t\t\tkeyRefs: options.keyRefs || {}\n  \t\t});\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \t// TODO initHook moved to before binding... will this break\n  \t// this.findComponent inside oninit? Is that a problem?\n  \t// Should be onrender anyway, right?\n  \tif (ractive.fragment) {\n  \t\tractive.fragment.bind(ractive.viewmodel);\n\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function createFunctionFromString(ractive, str) {\n  \tvar functionBody, hasThis, fn;\n\n  \tfunctionBody = 'return (' + str.replace(pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) {\n  \t\tfunctionBody = 'var __ractive = this; ' + functionBody;\n  \t}\n\n  \tfn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(ractive) : fn;\n  }\n\n  function bind(fn, context) {\n  \treturn (/this/.test(fn.toString()) ? fn.bind(context) : fn\n  \t);\n  }\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(ractive, signature);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(ractive, signature.get);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  // TODO `mark` appears to conflict with method name,\n  // hence `markChild` - revert once bundler is fixed\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function __________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ____inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \t____inherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\t__________classCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n  \t\tthis.key = key; // not actually used, but helps with debugging\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t\tthis.dirty = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange$$() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(handleChange);\n  \t\tthis.children.forEach(mark); // TODO rename to mark once bundling glitch fixed\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.init = function init() {};\n\n  \tComputation.prototype.mark = function mark$$() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.register = function register(dependant) {\n  \t\tthis.deps.push(dependant);\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed property \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \tComputation.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  function _________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function ___inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var RootModel = (function (_Model) {\n  \t___inherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\t_________classCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tvar _this = this;\n\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = _extend({}, this.value);\n\n  \t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\tresult[key] = _this.mappings[key].value;\n  \t\t});\n\n  \t\tObject.keys(this.computations).forEach(function (key) {\n  \t\t\tif (key[0] !== '@') {\n  \t\t\t\t// exclude template expressions\n  \t\t\t\tresult[key] = _this.computations[key].value;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\treturn key in this.mappings || key in this.computations || _Model.prototype.has.call(this, key);\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(handleChange);\n  \t\tthis.children.forEach(mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this2 = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this2.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (!!newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods;\n\n  function ________classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\t________classCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatchArrayMethods(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatchArrayMethods.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  function _______classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\t_______classCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + key : key;\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var magicArrayAdaptor;\n  var MagicArrayWrapper;\n  if (magicAdaptor) {\n  \tmagicArrayAdaptor = {\n  \t\tfilter: function (object, keypath, ractive) {\n  \t\t\treturn magicAdaptor.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t\t},\n\n  \t\twrap: function (ractive, array, keypath) {\n  \t\t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t\t}\n  \t};\n\n  \tMagicArrayWrapper = function (ractive, array, keypath) {\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tMagicArrayWrapper.prototype = {\n  \t\tget: function () {\n  \t\t\treturn this.value;\n  \t\t},\n  \t\tteardown: function () {\n  \t\t\tthis.arrayWrapper.teardown();\n  \t\t\tthis.magicWrapper.teardown();\n  \t\t},\n  \t\treset: function (value) {\n  \t\t\treturn this.magicWrapper.reset(value);\n  \t\t}\n  \t};\n  }\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = _extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = _extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice(),\n  \t    i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tvar adapt, magic$$, modifyArrays;\n\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tadapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tmagic$$ = 'magic' in options ? options.magic : ractive.magic;\n  \tmodifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic$$) {\n  \t\tif (!magic) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// animations (so we can stop any in progress at teardown)\n  \tractive._animations = [];\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// bound data functions\n  \tractive._boundFunctions = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \t// these could be overridden if this is an inline component instance\n  \tractive.root = ractive;\n  \tractive.parent = ractive.container = null; // TODO container still applicable?\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function ______classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function __inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \t__inherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\t______classCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tvar model = resolve(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\t(function () {\n  \t\t\t\t\t\t\tvar fragment = new Fragment({\n  \t\t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\t\tvar model = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t\t})();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tindexRefs: this.instance.isolated ? {} : this.parentFragment.indexRefs,\n  \t\t\tkeyRefs: this.instance.isolated ? {} : this.parentFragment.keyRefs,\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode() {\n  \t\treturn this.instance.fragment.firstNode();\n  \t};\n\n  \tComponent.prototype.rebind = function rebind$$() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(rebind);\n\n  \t\tthis.liveQueries.forEach(makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tif (this.template.a) {\n  \t\t\t(function () {\n  \t\t\t\tvar viewmodel = _this3.instance.viewmodel;\n\n  \t\t\t\tObject.keys(_this3.template.a).forEach(function (localKey) {\n  \t\t\t\t\tvar template = _this3.template.a[localKey];\n\n  \t\t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tvar model = resolve(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t})();\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(this.instance.viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render$$(target) {\n  \t\trender(this.instance, target, null);\n\n  \t\tthis.checkYielders();\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tObject.keys(this.template.v).forEach(function (name) {\n  \t\t\tvar template = _this4.template.v[name];\n\n  \t\t\tif (typeof template !== 'string') {\n  \t\t\t\tfatal('Components currently only support simple events - you cannot include arguments. Sorry!');\n  \t\t\t}\n\n  \t\t\tvar ractive = _this4.ractive;\n\n  \t\t\t_this4.instance.on(name, function () {\n  \t\t\t\tvar event = undefined;\n\n  \t\t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\t}\n\n  \t\t\t\tvar args = Array.prototype.slice.call(arguments);\n\n  \t\t\t\tfireEvent(ractive, template, { event: event, args: args });\n\n  \t\t\t\t// cancel bubbling\n  \t\t\t\treturn false;\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind$$() {\n  \t\tthis.complexMappings.forEach(unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tteardownHook.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  function getComponentConstructor(ractive, name) {\n  \tvar Component,\n  \t    instance = findInstance('components', ractive, name);\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  function _____classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }\n\n  function _inherits(subClass, superClass) {\n  \tif (typeof superClass !== 'function' && superClass !== null) {\n  \t\tthrow new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n  \t}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }var Text = (function (_Item) {\n  \t_inherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\t_____classCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\tif (!this.node.parentNode) {\n  \t\t\tthrow new Error('TODO an unexpected situation arose');\n  \t\t}\n  \t\treturn this.node.parentNode.removeChild(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target) {\n  \t\tthis.node = doc.createTextNode(this.template);\n  \t\ttarget.appendChild(this.node);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  var constructors = {};\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Input // it may turn out we need a separate Textarea class, but until then...\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  function ____classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\t____classCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.indexRefs = options.indexRefs || (this.parent ? this.parent.indexRefs : []);\n  \t\tthis.keyRefs = options.keyRefs || (this.parent ? this.parent.keyRefs : {});\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(_bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\tvar nextItem = this.items[item.index + 1];\n\n  \t\tif (nextItem) return nextItem.firstNode();\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.items[0] ? this.items[0].firstNode() : this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind$$(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString$$(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind$$() {\n  \t\tthis.items.forEach(unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender$$(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.items.forEach(_update);\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  function Ractive$resetTemplate(template) {\n  \tvar transitionsEnabled, component;\n\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \ttransitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tif (component = this.component) {\n  \t\tcomponent.shouldDestroy = true;\n  \t}\n\n  \tthis.unrender();\n\n  \tif (component) {\n  \t\tcomponent.shouldDestroy = false;\n  \t}\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind();\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n  \tthis.fragment.bind(this.viewmodel);\n\n  \tthis.render(this.el, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && item.name === name) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others && others.length) {\n  \t\t\tremoveOtherInstances(others);\n  \t\t}\n\n  \t\t// make sure we are the only occupants\n  \t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t}\n\n  \treturn render(this, target, anchor);\n  }\n\n  function removeOtherInstances(others) {\n  \tothers.splice(0, others.length).forEach(teardown);\n  }\n\n  var _push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function _trim (str) {\n    return str.trim();\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \tvar listeners, n, eventNames;\n\n  \t// allow mutliple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tlisteners = [];\n\n  \t\tfor (n in eventName) {\n  \t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\tlisteners.push(this.on(n, eventName[n]));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn {\n  \t\t\tcancel: function () {\n  \t\t\t\tvar listener;\n\n  \t\t\t\twhile (listener = listeners.pop()) {\n  \t\t\t\t\tlistener.cancel();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \teventNames = eventName.split(' ').map(_trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \tvar eventNames;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\teventNames = eventName.split(' ').map(_trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers, index;\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers = _this._subs[eventName]) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tindex = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = _extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = _extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function ___classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\t___classCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function __classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n\n  \tif (isObject(keypath)) {\n  \t\t(function () {\n  \t\t\tvar map = keypath;\n  \t\t\toptions = callback || {};\n\n  \t\t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\t\tvar callback = map[keypath];\n\n  \t\t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t})();\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\tif (!viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(context, model, callback, options) {\n  \t\t__classCallCheck(this, Observer);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(context, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\t__classCallCheck(this, PatternObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath();\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath()] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tbaseModel.register(this);\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\tvar args = [newValue, oldValue, keypath].concat(wildcards);\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath();\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function _classCallCheck(instance, Constructor) {\n  \tif (!(instance instanceof Constructor)) {\n  \t\tthrow new TypeError('Cannot call a class as a function');\n  \t}\n  }function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment;\n\n  \tif (parentFragment = item.parentFragment) {\n  \t\treturn parentFragment.owner;\n  \t}\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry, ancestor;\n\n  \tancestry = [item];\n\n  \tancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\t_classCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries, selector, index;\n\n  \t\tliveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tselector = this.selector;\n\n  \t\tindex = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n\n  \t\tif (index !== -1) {\n  \t\t\tthis.result.splice(index, 1);\n  \t\t}\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \tvar liveQueries, query;\n\n  \toptions = options || {};\n  \tliveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tif (query = liveQueries[selector]) {\n\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tvar liveQueries, query;\n\n  \tif (!this.el) {\n  \t\treturn [];\n  \t}\n\n  \toptions = options || {};\n  \tliveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tif (query = liveQueries[selector]) {\n\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) {\n  \t\treturn null;\n  \t}\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  var Animation = function (options) {\n  \tvar key;\n\n  \tthis.startTime = Date.now();\n\n  \t// from and to\n  \tfor (key in options) {\n  \t\tif (options.hasOwnProperty(key)) {\n  \t\t\tthis[key] = options[key];\n  \t\t}\n  \t}\n\n  \tthis.interpolator = interpolate(this.from, this.to, this.root, this.interpolator);\n  \tthis.running = true;\n\n  \tthis.tick();\n  };\n\n  Animation.prototype = {\n  \ttick: function () {\n  \t\tvar elapsed, t, value, timeNow, index, keypath;\n\n  \t\tkeypath = this.keypath;\n\n  \t\tif (this.running) {\n  \t\t\ttimeNow = Date.now();\n  \t\t\telapsed = timeNow - this.startTime;\n\n  \t\t\tif (elapsed >= this.duration) {\n  \t\t\t\tif (keypath !== null) {\n  \t\t\t\t\trunloop.start(this.root);\n\n  \t\t\t\t\tif (this.model) {\n  \t\t\t\t\t\tthis.model.set(this.to);\n  \t\t\t\t\t}\n\n  \t\t\t\t\trunloop.end();\n  \t\t\t\t}\n\n  \t\t\t\tif (this.step) {\n  \t\t\t\t\tthis.step(1, this.to);\n  \t\t\t\t}\n\n  \t\t\t\tthis.complete(this.to);\n\n  \t\t\t\tindex = this.root._animations.indexOf(this);\n\n  \t\t\t\t// TODO investigate why this happens\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\twarnIfDebug('Animation was not found');\n  \t\t\t\t}\n\n  \t\t\t\tthis.root._animations.splice(index, 1);\n\n  \t\t\t\tthis.running = false;\n  \t\t\t\treturn false; // remove from the stack\n  \t\t\t}\n\n  \t\t\tt = this.easing ? this.easing(elapsed / this.duration) : elapsed / this.duration;\n\n  \t\t\tif (keypath !== null) {\n  \t\t\t\tvalue = this.interpolator(t);\n  \t\t\t\trunloop.start(this.root);\n\n  \t\t\t\tif (this.model) {\n  \t\t\t\t\tthis.model.set(value);\n  \t\t\t\t}\n\n  \t\t\t\trunloop.end();\n  \t\t\t}\n\n  \t\t\tif (this.step) {\n  \t\t\t\tthis.step(t, value);\n  \t\t\t}\n\n  \t\t\treturn true; // keep in the stack\n  \t\t}\n\n  \t\treturn false; // remove from the stack\n  \t},\n\n  \tstop: function () {\n  \t\tvar index;\n\n  \t\tthis.running = false;\n\n  \t\tindex = this.root._animations.indexOf(this);\n\n  \t\t// TODO investigate why this happens\n  \t\tif (index === -1) {\n  \t\t\twarnIfDebug('Animation was not found');\n  \t\t}\n\n  \t\tthis.root._animations.splice(index, 1);\n  \t}\n  };\n\n  var noAnimation = { stop: noop };\n  function Ractive$animate(keypath, to, options) {\n  \tvar promise, fulfilPromise, k, animation, animations, easing, duration, step, complete, makeValueCollector, currentValues, collectValue, dummy, dummyOptions;\n\n  \tpromise = new _Promise(function (fulfil) {\n  \t\treturn fulfilPromise = fulfil;\n  \t});\n\n  \t// animate multiple keypaths\n  \tif (typeof keypath === 'object') {\n  \t\toptions = to || {};\n  \t\teasing = options.easing;\n  \t\tduration = options.duration;\n\n  \t\tanimations = [];\n\n  \t\t// we don't want to pass the `step` and `complete` handlers, as they will\n  \t\t// run for each animation! So instead we'll store the handlers and create\n  \t\t// our own...\n  \t\tstep = options.step;\n  \t\tcomplete = options.complete;\n\n  \t\tif (step || complete) {\n  \t\t\tcurrentValues = {};\n\n  \t\t\toptions.step = null;\n  \t\t\toptions.complete = null;\n\n  \t\t\tmakeValueCollector = function (keypath) {\n  \t\t\t\treturn function (t, value) {\n  \t\t\t\t\tcurrentValues[keypath] = value;\n  \t\t\t\t};\n  \t\t\t};\n  \t\t}\n\n  \t\tfor (k in keypath) {\n  \t\t\tif (keypath.hasOwnProperty(k)) {\n  \t\t\t\tif (step || complete) {\n  \t\t\t\t\tcollectValue = makeValueCollector(k);\n  \t\t\t\t\toptions = { easing: easing, duration: duration };\n\n  \t\t\t\t\tif (step) {\n  \t\t\t\t\t\toptions.step = collectValue;\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\toptions.complete = complete ? collectValue : noop;\n  \t\t\t\tanimations.push(animate(this, k, keypath[k], options));\n  \t\t\t}\n  \t\t}\n\n  \t\t// Create a dummy animation, to facilitate step/complete\n  \t\t// callbacks, and Promise fulfilment\n  \t\tdummyOptions = { easing: easing, duration: duration };\n\n  \t\tif (step) {\n  \t\t\tdummyOptions.step = function (t) {\n  \t\t\t\treturn step(t, currentValues);\n  \t\t\t};\n  \t\t}\n\n  \t\tif (complete) {\n  \t\t\tpromise.then(function (t) {\n  \t\t\t\treturn complete(t, currentValues);\n  \t\t\t});\n  \t\t}\n\n  \t\tdummyOptions.complete = fulfilPromise;\n\n  \t\tdummy = animate(this, null, null, dummyOptions);\n  \t\tanimations.push(dummy);\n\n  \t\tpromise.stop = function () {\n  \t\t\tvar animation;\n\n  \t\t\twhile (animation = animations.pop()) {\n  \t\t\t\tanimation.stop();\n  \t\t\t}\n\n  \t\t\tif (dummy) {\n  \t\t\t\tdummy.stop();\n  \t\t\t}\n  \t\t};\n\n  \t\treturn promise;\n  \t}\n\n  \t// animate a single keypath\n  \toptions = options || {};\n\n  \tif (options.complete) {\n  \t\tpromise.then(options.complete);\n  \t}\n\n  \toptions.complete = fulfilPromise;\n  \tanimation = animate(this, keypath, to, options);\n\n  \tpromise.stop = function () {\n  \t\treturn animation.stop();\n  \t};\n  \treturn promise;\n  }\n\n  function animate(root, keypath, to, options) {\n  \tvar easing, duration, animation, from;\n\n  \tvar model = undefined;\n\n  \tif (keypath) {\n  \t\t// TODO revisit 'dummy' approach to handling multiple\n  \t\t// animations? this seems kind of hokey\n  \t\tmodel = root.viewmodel.joinAll(normalise(keypath).split('.'));\n  \t\tfrom = model.get();\n\n  \t\t// cancel any existing animation\n  \t\t// TODO what about upstream/downstream keypaths?\n  \t\tanimations.abort(model, root);\n  \t}\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\tif (options.complete) {\n  \t\t\toptions.complete(options.to);\n  \t\t}\n\n  \t\treturn noAnimation;\n  \t}\n\n  \t// easing function\n  \tif (options.easing) {\n  \t\tif (typeof options.easing === 'function') {\n  \t\t\teasing = options.easing;\n  \t\t} else {\n  \t\t\teasing = root.easing[options.easing];\n  \t\t}\n\n  \t\tif (typeof easing !== 'function') {\n  \t\t\teasing = null;\n  \t\t}\n  \t}\n\n  \t// duration\n  \tduration = options.duration === undefined ? 400 : options.duration;\n\n  \t// TODO store keys, use an internal set method\n  \tanimation = new Animation({\n  \t\tmodel: model,\n  \t\tfrom: from,\n  \t\tto: to,\n  \t\troot: root,\n  \t\tduration: duration,\n  \t\teasing: easing,\n  \t\tinterpolator: options.interpolator,\n\n  \t\t// TODO wrap callbacks if necessary, to use instance as context\n  \t\tstep: options.step,\n  \t\tcomplete: options.complete\n  \t});\n\n  \tanimations.add(animation);\n  \troot._animations.push(animation);\n\n  \treturn animation;\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var proto = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: _push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn {\n  \t\tractive: storage.ractive,\n  \t\tkeypath: storage.context.getKeypath(),\n  \t\tindex: _extend({}, storage.fragment.indexRefs),\n  \t\tkey: _extend({}, storage.fragment.keyRefs)\n  \t};\n  }\n\n  function _wrap (method, superMethod, force) {\n\n  \tif (force || needsSuper(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = _wrap(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function extend() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = _extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  _extend(Ractive.prototype, proto, defaultOptions);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: extend },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tparse: { value: parse },\n\n  \t// namespaced constructors\n  \tPromise: { value: _Promise },\n\n  \t// support\n  \tsvg: { value: _svg },\n  \tmagic: { value: magic },\n\n  \t// version\n  \tVERSION: { value: '<@version@>' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["mutatorMethods","forEach","methodName","method","_len","arguments","length","args","Array","_key","newIndices","getNewIndices","this","result","prototype","apply","runloop","start","_ractive","setting","i","wrappers","processWrapper","end","defineProperty","patchedArrayProto","value","patchArrayMethods","undefined","unpatchArrayMethods","__proto__","array","configurable","unpatch","errorMessage","arrayAdaptor","filter","object","isArray","wrap","ractive","keypath","ArrayWrapper","________classCallCheck","root","__model","instances","_guid","push","get","teardown","storage","index","indexOf","Error","splice","magicAdaptor","Object","MagicWrapper","err","magicArrayAdaptor","MagicArrayWrapper","_this","_______classCallCheck","originalDescriptors","keys","key","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","reset","set","_this2","__magic","revert","dependants","magic","magicWrapper","arrayWrapper","model","constructHook","Hook","registryNames","uid","teardownHook","Component","_Item","options","ComponentConstructor","______classCallCheck","call","type","COMPONENT","instance","create","name","template","e","parentFragment","complexMappings","liveQueries","el","warnIfDebug","partials","p","content","f","_partials","yielders","construct","fragment","container","owner","YIELDER","parent","component","_inlinePartials","v","setupEvents","__inherits","bind","viewmodel","childData","a","localKey","joinKey","parsed","parseJSON","t","INTERPOLATOR","resolve","warnOnceIfDebug","r","findContext","map","Fragment","valueOf","bubble","initialise","indexRefs","isolated","keyRefs","cssIds","dirty","checkYielders","detach","find","selector","findAll","query","findComponent","findAllComponents","test","add","live","firstNode","rebind","_this3","makeDirty","render","target","updateLiveQueries","rendered","_this4","fatal","on","event","node","shift","slice","fireEvent","toString","toHTML","unbind","_observers","cancel","removeFromLiveComponentQueries","__ractive_instances__","removeFromArray","fire","unrender","shouldDestroy","_this5","remove","update","Item","Text","_____classCallCheck","TEXT","_inherits","parentNode","removeChild","doc","createTextNode","appendChild","escape","escapeHtml","constructors","DOCTYPE","Doctype","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","Yielder","specialElements","doctype","form","Form","input","Input","option","Option","select","Select","textarea","____classCallCheck","isRoot","componentParent","context","resolvers","dirtyArgs","dirtyValue","createItems","items","_bind","bound","addFragment","createItem","docFrag","createDocumentFragment","item","len","found","findNextNode","nextItem","findParentNode","ELEMENT","findRepeatingFragment","isIteration","getArgsList","values","source","processItems","argsList","resetTemplate","wasBound","wasRendered","anchor","insertBefore","callback","resolver","ReferenceResolver","toHtml","toEscapedString","join","unrenderAndDestroy","_update","shouldRerender","completeHook","resetHook","renderHook","unrenderHook","_push","makeArrayMethod","pop","onceOptions","init","once","ListObserver","___classCallCheck","getKeypath","pending","register","sliced","shuffle","handleChange","negativeOne","newValue","inserted","deleted","hadIndex","newIndex","oldIndex","Observer","__classCallCheck","oldValue","defer","strict","dispatch","unregister","addObserver","PatternObserver","baseModel","pattern","replace","baseKeypath","RegExp","oldValues","newValues","findMatches","isEqual","wildcards","exec","concat","comparators","insertHook","Query","isComponentQuery","_classCallCheck","_root","scheduleTask","nodeOrComponent","sort","sortByItemPosition","sortByDocumentPosition","matches","detachHook","Animation","startTime","Date","now","hasOwnProperty","interpolator","interpolate","from","to","running","tick","elapsed","timeNow","duration","step","complete","_animations","easing","stop","noAnimation","noop","proto","Ractive$add","animate","Ractive$animate","Ractive$detach","Ractive$find","Ractive$findAll","Ractive$findAllComponents","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","Ractive$fire","Ractive$get","insert","Ractive$insert","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","Ractive$on","Ractive$once","Ractive$render","Ractive$reset","resetPartial","Ractive$resetTemplate","reverse","Ractive$set","subtract","Ractive$subtract","Ractive$teardown","toggle","Ractive$toggle","Ractive$toHTML","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","linear","pos","easeIn","Math","pow","easeOut","easeInOut","FUNCTION","String","trim","win","addEventListener","_extend","Ractive","defaultOptions","constructor","defaults","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend","getNodeInfo","parse","Promise","_Promise","svg","_svg","VERSION","adaptors","components","decorators","events","interpolators","transitions","isUnresolved","forceResolution","warnAboutAmbiguity","isReadonly","element","attribute","isTwoway","getInitialValue","parentForm","findParentForm","resetValue","formBindings","Binding","registerTwowayBinding","locked","getValue","binding","unregisterTwowayBinding","GenericBinding","_Binding","_______________________________classCallCheck","_____________________inherits","lazy","timeout","isNumeric","handler","handleDelay","handleDomEvent","attachEvent","handleBlur","removeEventListener","SingleSelectBinding","______________________________classCallCheck","____________________inherits","forceUpdate","getAttribute","optionWasSelected","attributeByName","optionValue","selected","disabled","setValue","MultipleSelectBinding","_____________________________classCallCheck","___________________inherits","selectedValues","previousValue","arrayContentsMatch","initialValue","NumericBinding","_GenericBinding","____________________________classCallCheck","__________________inherits","parseFloat","isNaN","FileListBinding","___________________________classCallCheck","_________________inherits","CheckboxBinding","__________________________classCallCheck","________________inherits","checked","siblings","RadioBinding","_________________________classCallCheck","getSiblings","_______________inherits","groups","BindingGroup","________________________classCallCheck","bindings","CheckboxNameBinding","_______________________classCallCheck","existingValue","bindingValue","checkboxName","group","getBindingGroup","_getGroupValue","noInitialValue","______________inherits","changed","wasChecked","isChecked","arrayContains","RadioNameBinding","______________________classCallCheck","getGroupValue","_____________inherits","nameAttributeBinding","getKeypathModel","ContentEditableBinding","_____________________classCallCheck","____________inherits","innerHTML","starMaps","wildcardCache","EventHandler","____________________classCallCheck","m","models","ref","split","resolveReference","argsFn","createFunction","s","action","n","d","obj","wrapper","oldEvent","fn","findInViewHierarchy","customHandler","missingPlugin","defaultHandler","missingDecorator","Decorator","___________________classCallCheck","dynamicName","dynamicArgs","nameFragment","argsFragment","intermediary","_name","div","createElement","ConditionalAttribute","__________________classCallCheck","attributes","___________inherits","isSvg","namespaceURI","str","attrs","parseAttributes","notIn","removeAttribute","setAttribute","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","Attribute","_________________classCallCheck","determineNameAndNamespace","updateDelegate","__________inherits","getString","booleanAttributes","html","propertyName","useProperty","getUpdateDelegate","safeToStringValue","Element","________________classCallCheck","toLowerCase","isVoid","voidElementNames","conditionalAttributes","o","decorator","eventHandlers","eventNames","eventName","_________inherits","createTwowayBinding","shouldBind","twoway","selectBinding","_makeDirty","namespace","getNamespace","proxy","x","_render","_updateLiveQueries","transitionTemplate","t0","t1","transitionsEnabled","transition","Transition","registerTransition","_introTransition","tagName","stringifyAttribute","isSelected","inputIsCheckedRadio","detachWhenReady","t2","_transition","id","nodes","removeFromLiveQueries","_Element","_______________classCallCheck","________inherits","defaultValue","______________classCallCheck","_______inherits","sync","defaultSelected","selectNode","toArray","selectValue","isMultiple","shouldSelect","valueContains","_____________classCallCheck","findParentSelect","______inherits","selectedAttribute","____________classCallCheck","_____inherits","handleReset","prefix","styles","styleElement","head","getElementsByTagName","inDom","styleSheet","css","cssText","_registryNames","Registry","registries","_renderHook","_completeHook","HookQueue","___________classCallCheck","hook","inProcess","queue","begin","getChildQueue","templateConfigurator","Parent","parseIfString","getDynamicTemplate","_config","extendPartials","dataConfigurator","data","isObject","__combine","selectorsPattern","commentsPattern","selectorUnitPattern","mediaQueryPattern","dataRvcGuidPattern","_uid","cssConfigurator","noCssTransform","transformCss","cssId","adaptConfigurator","adapt","_combine","ensureArray","useDefaults","configure","registry","_fn","isOwner","config","order","defaultKeys","custom","isBlacklisted","isStandardKey","makeObj","c","configHook","initHook","Computation","_Model","signature","__________classCallCheck","setter","computationContext","dependencies","children","childByKey","deps","boundsSensitive","____inherits","shouldCapture","capture","startCapturing","getter","message","console","groupCollapsed","functionBody","prettify","getterString","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","mark","clearUnresolveds","dependant","Model","RootModel","_________classCallCheck","changes","mappings","computations","___inherits","applyChanges","_changeHash","flush","compute","computation","has","origin","shouldTeardown","retrieve","updateFromBindings","cascade","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","prop","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","htmlEntities","lessThan","greaterThan","amp","_Mustache","_______________________________________classCallCheck","__________________________inherits","string","Mustache","arrayMemberPattern","prefixPattern","globals","keywords","readTypeOf","makePrefixSequenceMatcher","legalReference","relaxedName","expectedExpression","expectedParen","regexpPattern","symbol","fallthrough","parser","expression","matchString","allowWhitespace","readExpression","PREFIX_OPERATOR","matcher","prefixOperators","readMemberOrInvocation","readLogicalOr","makeInfixSequenceMatcher","left","right","remaining","charAt","INFIX_OPERATOR","infixOperators","ExpressionParser","yieldPattern","handlebarsBlockCodes","each","SECTION_EACH","if","SECTION_IF","if-with","SECTION_IF_WITH","with","SECTION_WITH","unless","SECTION_UNLESS","_elsePattern","elsePattern","indexRefPattern","keyIndexRefPattern","handlebarsBlockPattern","leadingLinebreak","trailingLinebreak","contiguousWhitespace","preserveWhitespaceElements","leadingWhitespace","trailingWhitespace","leadingNewLine","trailingNewLine","closingTagPattern","methodCallPattern","methodCallExcessPattern","Parser","converters","disallowedContents","delimiterChangePattern","whitespacePattern","delimiterChangeToken","DELIMCHANGE","exclude","attributeNamePattern","unquotedAttributeValueTextPattern","tagNamePattern","validTagNameFollower","onPattern","proxyEventPattern","reservedEventNames","directives","intro-outro","intro","outro","li","dt","dd","rt","rp","optgroup","thead","tbody","tfoot","tr","td","th","child","OPEN_COMMENT","CLOSE_COMMENT","partialDefinitionSectionPattern","_pattern","startPattern","namePattern","finishPattern","STANDARD_READERS","readPartial","readUnescaped","readSection","readYielder","readInterpolator","readComment","TRIPLE_READERS","readTriple","STATIC_READERS","StandardParser","READERS","readMustache","readHtmlComment","readElement","readText","PARTIAL_READERS","readPartialDefinitionComment","readPartialDefinitionSection","tripleDelimiters","staticDelimiters","staticTripleDelimiters","standardDelimiters","delimiters","tags","isStatic","isTriple","open","close","readers","sortMustacheTags","sectionDepth","elementStack","script","style","sanitize","elements","eventAttributes","stripComments","preserveWhitespace","sanitizeElements","sanitizeEventAttributes","includeLinePositions","postProcess","cleanup","TEMPLATE_VERSION","readTemplate","b","ieBug","ieBlacklist","parseOptions","fromId","isHashedId","isParsed","getParseOptions","createHelper","_createHelper","doParse","______________________________________classCallCheck","_________________________inherits","getPartialTemplate","named","setTemplate","partialTemplate","forceResetTemplate","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Symbol","iterator","next","done","TypeError","RepeatedFragment","_____________________________________classCallCheck","indexRef","keyRef","pendingNewIndices","indexByKey","iterations","createIteration","_indexRef$split","_indexRef$split2","getRefs","iteration","previousIterations","_unrenderAndDestroy","updatePostShuffle","toRemove","oldKeys","newLength","previousNewIndex","reinsertFrom","existingFragment","childNodes","____________________________________classCallCheck","sectionType","________________________inherits","getType","isEmpty","newFragment","fragmentShouldExist","elementCache","TABLE","THEAD","TBODY","TR","SELECT","exportedShims","___________________________________classCallCheck","_______________________inherits","nodeType","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","insertHtml","decodeCharacterReferences","__________________________________classCallCheck","containerFragment","______________________inherits","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","needle","mapper","isActuallyString","mapped","reduce","opt_initialValue","valueIsSet","filtered","every","Function","Empty","ctx","Event","origCreateElement","appearsToBeIELessEqual8","property","currentTarget","srcElement","timeStamp","preventDefault","returnValue","stopPropagation","cancelBubble","listener","listeners","detachEvent","firstChild","getComputedStyle","getPixelSize","fontSize","rootSize","sizeWithSuffix","size","suffix","getBorderPixelSize","parentElement","currentStyle","clientWidth","clientHeight","bcr","borderSizes","display","position","width","height","borderRight","getBoundingClientRect","setShortStyleProperty","borderSuffix","l","CSSStyleDeclaration","normalProps","fontWeight","lineHeight","letterSpacing","getPropertyPriority","getPropertyValue","removeProperty","setProperty","getPropertyCSSValue","__prefix","prefixCache","_testStyle","isClient","vendor","capped","camelCase","toUpperCase","substring","vendors","requestAnimationFrame","lastTime","setTimeout","currTime","timeToCall","max","getTime","performance","animations","animation","abort","Ticker","eased","createTransitions","testStyle","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","number","delta","intermediate","min","properties","hasOwn","snap","interpol","unprefixPattern","vendorPattern","canUseCssTransitions","cannotUseCssTransitions","webkitTransition","changedProperties","hashPrefix","jsTransitionsComplete","cssTransitionsComplete","checkComplete","transitionEndHandler","isIntro","hyphenate","unprefix","hash","originalValue","propertiesToTransitionInJs","getStyle","delay","visible","hidden","_prefix","onChange","onHide","onShow","resolved","_________________________________classCallCheck","params","animateStyle","setStyle","promise","computedStyle","current","props","processParams","originalStyle","completed","noReset","resetStyle","_manager","________________________________classCallCheck","twowayBinding","_model","joinAll","wildcardIndex","getComparator","JSON","stringify","thing","splitKeypath","comparator","compare","getElement","isDetached","fireInsertHook","Constructor","otherNode","compareDocumentPosition","bitmask","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","fragments","getParent","ancestry","ancestor","_liveComponentQueries","_liveQueries","fulfilPromise","k","makeValueCollector","currentValues","collectValue","dummy","dummyOptions","fulfil","then","normalise","_wrap","superMethod","force","needsSuper","hasSuper","_super","unwrap","Child","addRegistries","addOtherOptions","_Parent","addRegistry","_method","extendOne","computed","_namespaces",{"end":{"file":"ractive-legacy.runtime.js","comments_before":[],"nlb":false,"endpos":500,"endcol":12,"endline":19,"pos":496,"col":8,"line":19,"value":"html","type":"name"},"start":{"file":"ractive-legacy.runtime.js","comments_before":[],"nlb":false,"endpos":500,"endcol":12,"endline":19,"pos":496,"col":8,"line":19,"value":"html","type":"name"},"name":"html"},"mathml","xlink","xml","xmlns","append","modifyArrays","noIntro","window","document","hasConsole","warn","log","printWarning","welcome","implementation","hasFeature","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","deprecations","deprecated","replacement","__________________________________________________classCallCheck","deprecate","arg","_toString","TransitionManager","_________________________________________________classCallCheck","intros","outros","totalChildren","outroChildren","detachQueue","decoratorQueue","outrosComplete","addChild","list","addDecorator","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","handlers","forward","p1result","_resolve","all","promises","processPromise","reason","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","changeHook","batch","returnPromise","previousBatch","transitionManager","tasks","immediateObservers","deferredObservers","flushChanges","addToArray","observer","registerDecorator","task","postRender","_batch","refPattern","updateHook","arrayProto","_unrenderHook","badArguments","noRegistryFunctionReturn","_teardownHook","_errorMessage","_div","methodNames","unprefixed","prefixed","makeFunction","INVERTED","CLOSING","COMMENT","CLOSING_TAG","INLINE_PARTIAL","NUMBER_LITERAL","STRING_LITERAL","ARRAY_LITERAL","OBJECT_LITERAL","BOOLEAN_LITERAL","REGEXP_LITERAL","GLOBAL","KEY_VALUE_PAIR","REFERENCE","REFINEMENT","MEMBER","BRACKETED","CONDITIONAL","INVOCATION","ELSE","ELSEIF","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","ns","createElementNS","namespaces","substr","cloneNode","desc","F","ParseError","_leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","read","leftover","getLinePos","char","columnNum","lineNum","numTabs","annotation","match","character","shortMessage","matchPattern","nextChar","JsonParser","specials","specialsPattern","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","_numberPattern","identifier","true","false","null","placeholder","special","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","reference","________________________________________________classCallCheck","addUnresolved","attemptResolution","resolveAmbiguousReference","unresolved","_______________________________________________classCallCheck","______________________________________________classCallCheck","______________________________inherits","KeypathModel","_____________________________________________classCallCheck","KeyModel","____________________________________________classCallCheck","captureGroup","prefixers","hasProp","originatingModel","___________________________________________classCallCheck","indexModels","unresolvedByKey","adaptor","getPrefixer","specificKey","hasKey","createBranch","branch","discard","existingMatches","_loop","member","getIndexModel","fragmentIndex","getKeyModel","keypathModel","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","parentValue","previousOriginatingModel","updateKeypathDependants","_updateFromBindings","_updateKeypathDependants","functionCache","ExpressionProxy","__________________________________________classCallCheck","_____________________________inherits","wrapFunction","ReferenceExpressionProxy","_________________________________________classCallCheck","base","members","____________________________inherits","________________________________________classCallCheck","___________________________inherits","quot","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","subClass","superClass","enumerable","setPrototypeOf","refs","hasIndexRef","selectedOption","selectedIndex","hyphenatedStr","hyphenated","description","clearTimeout","isBindable","bindName","bindChecked","getPotentialWildcardMatches","starMap","wildcardKeypath","getStarMap","star","num","binary","ones","parseInt","digit","enqueue","_eventQueue","dequeue","_noArg","getWildcardNames","fireEventAs","subscribers","initialFire","_subs","notifySubscribers","fullName","originalEvent","stopEvent","original","haystack","updateId","updateMultipleSelectValue","updateSelectValue","updateValue","updateContentEditableValue","updateRadioValue","updateRadioName","updateCheckboxName","updateIEStyleAttribute","updateProperty","updateNamespacedAttribute","updateAttribute","updateClassName","valueAttribute","className","setAttributeNS","colonIndex","namespacePrefix","typeAttribute","nameAttribute","hookQueue","childQueue","initial","helper","existingPartials","newPartials","overwrite","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","transformed","dataAttr","addGuid","selectorUnits","unit","prepended","appended","modifiers","extractString","selectors","getMessage","correct","isError","deprecateOption","deprecatedOption","getSuperMethod","_parent","oldSuper","extendOtherMethods","userOptions","logIfDebug","createFunctionFromString","hasThis","getComputationSignature","setterString","fnBody","tabs","minIndent","prev","Infinity","truncated","_ref","initialiseProperties","deprecateRactiveData","getAdaptors","combine","protoAdapt","lookup","magic$$","_boundFunctions","getComponentConstructor","findInstance","ElementConstructor","collect","dest","partial","collection","rerender","others","removeOtherInstances","notEmptyString","_trim","observers","createObserver","keypaths","global","factory","exports","module","define","amd","format","_len2","_key2","warnOnce","_len3","_key3","isFinite","arrayLike","tm","called","resolvePromise","rejectPromise","y","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","touchedFrom","deleteFunctionCopy","_ret","okQuote","literal","charCodeAt","output","getElementById","sources","_readNumberLiteral","readKey","token","guid","counter","placeholderId","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","prefixKeypath","rootKeypath","rootDot","relativeKeypath","repeater","parts","__ractive_nowrap","rx","entity","code","fromCharCode","validateCode","tag","flattenExpression","extractRefs","refineExpression","mustache","referenceExpression","getReferenceExpression","refinement","readReference","startPos","lastDotIndex","relaxedNames","lastIndexOf","readExpressionList","expressions","expr","readRefinement","name$$","readBracketedExpression","readNumberLiteral","readArrayLiteral","expressionList","readKeyValuePair","readKeyValuePairs","pairs","keyValuePairs","readObjectLiteral","readBooleanLiteral","readLiteral","readPrimary","getConditional","ifTrue","ifFalse","readExpressionOrReference","expectedFollowers","yielder","readElse","readElseIf","readClosing","closing","section","hasElse","block","unlessBlock","conditions","closed","expectedClose","extra","createUnlessBlock","___combine","invert","parensIfNecessary","triple","nameStart","getLowestIndex","needles","lowest","disallowed","barrier","inside","inAttribute","trimWhitespace","leadingPattern","trailingPattern","stripStandalones","backOne","backTwo","lastSectionItem","isString","isComment","isSection","removeLeadingWhitespace","removeTrailingWhitespace","previousItem","preserveWhitespaceInsideFragment","removeLeadingWhitespaceInsideFragment","removeTrailingWhitespaceInsideFragment","isPreserveWhitespaceElement","readClosingTag","processDirective","tokens","parentParser","directiveName","directiveArgs","readDelimiterChange","opening","readMustacheOfType","reader","rewind","readAttribute","attr","readAttributeValue","valueStart","startDepth","readQuotedAttributeValue","readUnquotedAttributeValue","readUnquotedAttributeValueToken","text","quoteMark","readQuotedStringToken","addProxyEvent","directive","selfClosing","hasPartials","closingTag","lowerCaseName","canContain","closingTagName","endIndex","comment","escapeRegExp","firstPos","endPattern","noThrow","textContent","val","registryName","getPartialFromRegistry","findParentPartial","findOwner","findConstructor"],"mappings":"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AM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,IAAK,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAA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"}